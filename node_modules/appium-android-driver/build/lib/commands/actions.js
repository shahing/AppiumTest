"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _lodash = _interopRequireDefault(require("lodash"));

var _temp = _interopRequireDefault(require("temp"));

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("../logger"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _jimp = _interopRequireDefault(require("jimp"));

var _teen_process = require("teen_process");

const swipeStepsPerSec = 28;
const dragStepsPerSec = 40;
const CONTAINER_PATH_MARKER = '@';
const CONTAINER_PATH_PATTERN = new RegExp(`^${CONTAINER_PATH_MARKER}([^/]+)/(.+)`);
const ANDROID_MEDIA_RESCAN_INTENT = 'android.intent.action.MEDIA_SCANNER_SCAN_FILE';
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keyevent = async function (keycode, metastate = null) {
  _logger.default.warn("keyevent will be deprecated use pressKeyCode");

  return await this.pressKeyCode(keycode, metastate);
};

commands.pressKeyCode = async function (keycode, metastate = null) {
  return await this.bootstrap.sendAction("pressKeyCode", {
    keycode,
    metastate
  });
};

commands.longPressKeyCode = async function (keycode, metastate = null) {
  return await this.bootstrap.sendAction("longPressKeyCode", {
    keycode,
    metastate
  });
};

commands.getOrientation = async function () {
  let params = {
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  let orientation = await this.bootstrap.sendAction("orientation", params);
  return orientation.toUpperCase();
};

commands.setOrientation = async function (orientation) {
  orientation = orientation.toUpperCase();
  let params = {
    orientation,
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  return await this.bootstrap.sendAction("orientation", params);
};

commands.fakeFlick = async function (xSpeed, ySpeed) {
  return await this.bootstrap.sendAction('flick', {
    xSpeed,
    ySpeed
  });
};

commands.fakeFlickElement = async function (elementId, xoffset, yoffset, speed) {
  let params = {
    xoffset,
    yoffset,
    speed,
    elementId
  };
  return await this.bootstrap.sendAction('element:flick', params);
};

commands.swipe = async function (startX, startY, endX, endY, duration, touchCount, elId) {
  if (startX === 'null') {
    startX = 0.5;
  }

  if (startY === 'null') {
    startY = 0.5;
  }

  let swipeOpts = {
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * swipeStepsPerSec)
  };

  if (_appiumSupport.util.hasValue(elId)) {
    swipeOpts.elementId = elId;
  }

  return await this.doSwipe(swipeOpts);
};

commands.doSwipe = async function (swipeOpts) {
  if (_appiumSupport.util.hasValue(swipeOpts.elementId)) {
    return await this.bootstrap.sendAction("element:swipe", swipeOpts);
  } else {
    return await this.bootstrap.sendAction("swipe", swipeOpts);
  }
};

commands.pinchClose = async function (startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'in',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction("element:pinch", pinchOpts);
};

commands.pinchOpen = async function (startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'out',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction("element:pinch", pinchOpts);
};

commands.flick = async function (element, xSpeed, ySpeed, xOffset, yOffset, speed) {
  if (element) {
    await this.fakeFlickElement(element, xOffset, yOffset, speed);
  } else {
    await this.fakeFlick(xSpeed, ySpeed);
  }
};

commands.drag = async function (startX, startY, endX, endY, duration, touchCount, elementId, destElId) {
  let dragOpts = {
    elementId,
    destElId,
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * dragStepsPerSec)
  };
  return await this.doDrag(dragOpts);
};

commands.doDrag = async function (dragOpts) {
  if (_appiumSupport.util.hasValue(dragOpts.elementId)) {
    return await this.bootstrap.sendAction("element:drag", dragOpts);
  } else {
    return await this.bootstrap.sendAction("drag", dragOpts);
  }
};

commands.lock = async function (seconds) {
  await this.adb.lock();

  if (isNaN(seconds)) {
    return;
  }

  const floatSeconds = parseFloat(seconds);

  if (floatSeconds <= 0) {
    return;
  }

  await _bluebird.default.delay(1000 * floatSeconds);
  await this.unlock();
};

commands.isLocked = async function () {
  return await this.adb.isScreenLocked();
};

commands.unlock = async function () {
  return await _androidHelpers.default.unlock(this, this.adb, this.caps);
};

commands.openNotifications = async function () {
  return await this.bootstrap.sendAction("openNotification");
};

commands.setLocation = async function (latitude, longitude) {
  return await this.adb.sendTelnetCommand(`geo fix ${longitude} ${latitude}`);
};

function parseContainerPath(remotePath) {
  const match = CONTAINER_PATH_PATTERN.exec(remotePath);

  if (!match) {
    _logger.default.errorAndThrow(`It is expected that package identifier is separated from the relative path with a single slash. ` + `'${remotePath}' is given instead`);
  }

  return [match[1], _path.default.posix.resolve(`/data/data/${match[1]}`, match[2])];
}

commands.pullFile = async function (remotePath) {
  if (remotePath.endsWith('/')) {
    _logger.default.errorAndThrow(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  let tmpDestination = null;

  if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
    const [packageId, pathInContainer] = parseContainerPath(remotePath);

    _logger.default.info(`Parsed package identifier '${packageId}' from '${remotePath}'. Will get the data from '${pathInContainer}'`);

    tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;

    try {
      await this.adb.shell(['run-as', packageId, `chmod 777 '${pathInContainer.replace(/'/g, '\\\'')}'`]);
      await this.adb.shell(['cp', '-f', pathInContainer, tmpDestination]);
    } catch (e) {
      _logger.default.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
    }
  }

  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.tmp'
  });

  try {
    await this.adb.pull(_lodash.default.isString(tmpDestination) ? tmpDestination : remotePath, localFile);
    const data = await _appiumSupport.fs.readFile(localFile);
    return Buffer.from(data).toString('base64');
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }

    if (_lodash.default.isString(tmpDestination)) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};

commands.pushFile = async function (remotePath, base64Data) {
  if (remotePath.endsWith('/')) {
    _logger.default.errorAndThrow(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.tmp'
  });

  if (_lodash.default.isArray(base64Data)) {
    base64Data = Buffer.from(base64Data).toString('utf8');
  }

  const content = Buffer.from(base64Data, 'base64');
  let tmpDestination = null;

  try {
    await _appiumSupport.fs.writeFile(localFile, content.toString('binary'), 'binary');

    if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
      const [packageId, pathInContainer] = parseContainerPath(remotePath);

      _logger.default.info(`Parsed package identifier '${packageId}' from '${remotePath}'. Will put the data into '${pathInContainer}'`);

      tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;

      try {
        await this.adb.shell(['run-as', packageId, `mkdir -p '${_path.default.posix.dirname(pathInContainer).replace(/'/g, '\\\'')}'`]);
        await this.adb.shell(['run-as', packageId, `touch '${pathInContainer.replace(/'/g, '\\\'')}'`]);
        await this.adb.shell(['run-as', packageId, `chmod 777 '${pathInContainer.replace(/'/g, '\\\'')}'`]);
        await this.adb.push(localFile, tmpDestination);
        await this.adb.shell(['cp', '-f', tmpDestination, pathInContainer]);
      } catch (e) {
        _logger.default.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
      }
    } else {
      await this.adb.push(localFile, remotePath);

      _logger.default.info("After pushing media file, broadcasting media scan intent");

      try {
        await this.adb.shell(['am', 'broadcast', '-a', ANDROID_MEDIA_RESCAN_INTENT, '-d', `file://${remotePath}`]);
      } catch (e) {
        _logger.default.warn(`Got error broadcasting media scan intent: ${e.message}; ignoring`);
      }
    }
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }

    if (_lodash.default.isString(tmpDestination)) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};

commands.pullFolder = async function (remotePath) {
  let localFolder = _temp.default.path({
    prefix: 'appium'
  });

  await this.adb.pull(remotePath, localFolder);
  return (await _appiumSupport.zip.toInMemoryZip(localFolder)).toString('base64');
};

commands.fingerprint = async function (fingerprintId) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("fingerprint method is only available for emulators");
  }

  await this.adb.fingerprint(fingerprintId);
};

commands.sendSMS = async function (phoneNumber, message) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("sendSMS method is only available for emulators");
  }

  await this.adb.sendSMS(phoneNumber, message);
};

commands.gsmCall = async function (phoneNumber, action) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("gsmCall method is only available for emulators");
  }

  await this.adb.gsmCall(phoneNumber, action);
};

commands.gsmSignal = async function (signalStrengh) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("gsmSignal method is only available for emulators");
  }

  await this.adb.gsmSignal(signalStrengh);
};

commands.gsmVoice = async function (state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("gsmVoice method is only available for emulators");
  }

  await this.adb.gsmVoice(state);
};

commands.powerAC = async function (state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("powerAC method is only available for emulators");
  }

  await this.adb.powerAC(state);
};

commands.powerCapacity = async function (batteryPercent) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("powerCapacity method is only available for emulators");
  }

  await this.adb.powerCapacity(batteryPercent);
};

commands.networkSpeed = async function (networkSpeed) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow("networkSpeed method is only available for emulators");
  }

  await this.adb.networkSpeed(networkSpeed);
};

helpers.getScreenshotDataWithAdbShell = async function (adb, opts) {
  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.png'
  });

  if (await _appiumSupport.fs.exists(localFile)) {
    await _appiumSupport.fs.unlink(localFile);
  }

  try {
    const pngDir = opts.androidScreenshotPath || '/data/local/tmp/';

    const png = _path.default.posix.resolve(pngDir, 'screenshot.png');

    const cmd = ['/system/bin/rm', `${png};`, '/system/bin/screencap', '-p', png];
    await adb.shell(cmd);

    if (!(await adb.fileSize(png))) {
      throw new Error('The size of the taken screenshot equals to zero.');
    }

    await adb.pull(png, localFile);
    return await _jimp.default.read(localFile);
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }
  }
};

helpers.getScreenshotDataWithAdbExecOut = async function (adb) {
  let {
    stdout,
    stderr,
    code
  } = await (0, _teen_process.exec)(adb.executable.path, adb.executable.defaultArgs.concat(['exec-out', '/system/bin/screencap', '-p']), {
    encoding: 'binary',
    isBuffer: true
  });

  if (code || stderr.length) {
    throw new Error(`Screenshot returned error, code: '${code}', stderr: '${stderr.toString()}'`);
  }

  if (!stdout.length) {
    throw new Error('Screenshot returned no data');
  }

  return await _jimp.default.read(stdout);
};

commands.getScreenshot = async function () {
  const apiLevel = await this.adb.getApiLevel();
  let image = null;

  if (apiLevel > 20) {
    try {
      image = await this.getScreenshotDataWithAdbExecOut(this.adb);
    } catch (e) {
      _logger.default.info(`Cannot get screenshot data with 'adb exec-out' because of '${e.message}'. ` + `Defaulting to 'adb shell' call`);
    }
  }

  if (!image) {
    try {
      image = await this.getScreenshotDataWithAdbShell(this.adb, this.opts);
    } catch (e) {
      const err = `Cannot get screenshot data because of '${e.message}'. ` + `Make sure the 'LayoutParams.FLAG_SECURE' is not set for ` + `the current view`;

      _logger.default.errorAndThrow(err);
    }
  }

  if (apiLevel < 23) {
    let screenOrientation = await this.adb.getScreenOrientation();

    try {
      image = await image.rotate(-90 * screenOrientation);
    } catch (err) {
      _logger.default.warn(`Could not rotate screenshot due to error: ${err}`);
    }
  }

  const getBuffer = _bluebird.default.promisify(image.getBuffer, {
    context: image
  });

  const imgBuffer = await getBuffer(_jimp.default.MIME_PNG);
  return imgBuffer.toString('base64');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hY3Rpb25zLmpzIl0sIm5hbWVzIjpbInN3aXBlU3RlcHNQZXJTZWMiLCJkcmFnU3RlcHNQZXJTZWMiLCJDT05UQUlORVJfUEFUSF9NQVJLRVIiLCJDT05UQUlORVJfUEFUSF9QQVRURVJOIiwiUmVnRXhwIiwiQU5EUk9JRF9NRURJQV9SRVNDQU5fSU5URU5UIiwiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsImtleWV2ZW50Iiwia2V5Y29kZSIsIm1ldGFzdGF0ZSIsImxvZyIsIndhcm4iLCJwcmVzc0tleUNvZGUiLCJib290c3RyYXAiLCJzZW5kQWN0aW9uIiwibG9uZ1ByZXNzS2V5Q29kZSIsImdldE9yaWVudGF0aW9uIiwicGFyYW1zIiwibmF0dXJhbE9yaWVudGF0aW9uIiwib3B0cyIsImFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInRvVXBwZXJDYXNlIiwic2V0T3JpZW50YXRpb24iLCJmYWtlRmxpY2siLCJ4U3BlZWQiLCJ5U3BlZWQiLCJmYWtlRmxpY2tFbGVtZW50IiwiZWxlbWVudElkIiwieG9mZnNldCIsInlvZmZzZXQiLCJzcGVlZCIsInN3aXBlIiwic3RhcnRYIiwic3RhcnRZIiwiZW5kWCIsImVuZFkiLCJkdXJhdGlvbiIsInRvdWNoQ291bnQiLCJlbElkIiwic3dpcGVPcHRzIiwic3RlcHMiLCJNYXRoIiwicm91bmQiLCJ1dGlsIiwiaGFzVmFsdWUiLCJkb1N3aXBlIiwicGluY2hDbG9zZSIsInBlcmNlbnQiLCJwaW5jaE9wdHMiLCJkaXJlY3Rpb24iLCJwaW5jaE9wZW4iLCJmbGljayIsImVsZW1lbnQiLCJ4T2Zmc2V0IiwieU9mZnNldCIsImRyYWciLCJkZXN0RWxJZCIsImRyYWdPcHRzIiwiZG9EcmFnIiwibG9jayIsInNlY29uZHMiLCJhZGIiLCJpc05hTiIsImZsb2F0U2Vjb25kcyIsInBhcnNlRmxvYXQiLCJCIiwiZGVsYXkiLCJ1bmxvY2siLCJpc0xvY2tlZCIsImlzU2NyZWVuTG9ja2VkIiwiYW5kcm9pZEhlbHBlcnMiLCJjYXBzIiwib3Blbk5vdGlmaWNhdGlvbnMiLCJzZXRMb2NhdGlvbiIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwic2VuZFRlbG5ldENvbW1hbmQiLCJwYXJzZUNvbnRhaW5lclBhdGgiLCJyZW1vdGVQYXRoIiwibWF0Y2giLCJleGVjIiwiZXJyb3JBbmRUaHJvdyIsInBhdGgiLCJwb3NpeCIsInJlc29sdmUiLCJwdWxsRmlsZSIsImVuZHNXaXRoIiwidG1wRGVzdGluYXRpb24iLCJzdGFydHNXaXRoIiwicGFja2FnZUlkIiwicGF0aEluQ29udGFpbmVyIiwiaW5mbyIsImJhc2VuYW1lIiwic2hlbGwiLCJyZXBsYWNlIiwiZSIsIm1lc3NhZ2UiLCJsb2NhbEZpbGUiLCJ0ZW1wIiwicHJlZml4Iiwic3VmZml4IiwicHVsbCIsIl8iLCJpc1N0cmluZyIsImRhdGEiLCJmcyIsInJlYWRGaWxlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiZXhpc3RzIiwidW5saW5rIiwicHVzaEZpbGUiLCJiYXNlNjREYXRhIiwiaXNBcnJheSIsImNvbnRlbnQiLCJ3cml0ZUZpbGUiLCJkaXJuYW1lIiwicHVzaCIsInB1bGxGb2xkZXIiLCJsb2NhbEZvbGRlciIsInppcCIsInRvSW5NZW1vcnlaaXAiLCJmaW5nZXJwcmludCIsImZpbmdlcnByaW50SWQiLCJpc0VtdWxhdG9yIiwic2VuZFNNUyIsInBob25lTnVtYmVyIiwiZ3NtQ2FsbCIsImFjdGlvbiIsImdzbVNpZ25hbCIsInNpZ25hbFN0cmVuZ2giLCJnc21Wb2ljZSIsInN0YXRlIiwicG93ZXJBQyIsInBvd2VyQ2FwYWNpdHkiLCJiYXR0ZXJ5UGVyY2VudCIsIm5ldHdvcmtTcGVlZCIsImdldFNjcmVlbnNob3REYXRhV2l0aEFkYlNoZWxsIiwicG5nRGlyIiwiYW5kcm9pZFNjcmVlbnNob3RQYXRoIiwicG5nIiwiY21kIiwiZmlsZVNpemUiLCJFcnJvciIsImppbXAiLCJyZWFkIiwiZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCIsInN0ZG91dCIsInN0ZGVyciIsImNvZGUiLCJleGVjdXRhYmxlIiwiZGVmYXVsdEFyZ3MiLCJjb25jYXQiLCJlbmNvZGluZyIsImlzQnVmZmVyIiwibGVuZ3RoIiwiZ2V0U2NyZWVuc2hvdCIsImFwaUxldmVsIiwiZ2V0QXBpTGV2ZWwiLCJpbWFnZSIsImVyciIsInNjcmVlbk9yaWVudGF0aW9uIiwiZ2V0U2NyZWVuT3JpZW50YXRpb24iLCJyb3RhdGUiLCJnZXRCdWZmZXIiLCJwcm9taXNpZnkiLCJjb250ZXh0IiwiaW1nQnVmZmVyIiwiTUlNRV9QTkciLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUcsRUFBekI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsRUFBeEI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyxHQUE5QjtBQUVBLE1BQU1DLHNCQUFzQixHQUFHLElBQUlDLE1BQUosQ0FBWSxJQUFHRixxQkFBc0IsY0FBckMsQ0FBL0I7QUFDQSxNQUFNRywyQkFBMkIsR0FBRywrQ0FBcEM7QUFFQSxJQUFJQyxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csUUFBVCxHQUFvQixnQkFBZ0JDLE9BQWhCLEVBQXlCQyxTQUFTLEdBQUcsSUFBckMsRUFBMkM7QUFFN0RDLGtCQUFJQyxJQUFKLENBQVMsOENBQVQ7O0FBQ0EsU0FBTyxNQUFNLEtBQUtDLFlBQUwsQ0FBa0JKLE9BQWxCLEVBQTJCQyxTQUEzQixDQUFiO0FBQ0QsQ0FKRDs7QUFNQUwsUUFBUSxDQUFDUSxZQUFULEdBQXdCLGdCQUFnQkosT0FBaEIsRUFBeUJDLFNBQVMsR0FBRyxJQUFyQyxFQUEyQztBQUNqRSxTQUFPLE1BQU0sS0FBS0ksU0FBTCxDQUFlQyxVQUFmLENBQTBCLGNBQTFCLEVBQTBDO0FBQUNOLElBQUFBLE9BQUQ7QUFBVUMsSUFBQUE7QUFBVixHQUExQyxDQUFiO0FBQ0QsQ0FGRDs7QUFJQUwsUUFBUSxDQUFDVyxnQkFBVCxHQUE0QixnQkFBZ0JQLE9BQWhCLEVBQXlCQyxTQUFTLEdBQUcsSUFBckMsRUFBMkM7QUFDckUsU0FBTyxNQUFNLEtBQUtJLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixrQkFBMUIsRUFBOEM7QUFBQ04sSUFBQUEsT0FBRDtBQUFVQyxJQUFBQTtBQUFWLEdBQTlDLENBQWI7QUFDRCxDQUZEOztBQUlBTCxRQUFRLENBQUNZLGNBQVQsR0FBMEIsa0JBQWtCO0FBQzFDLE1BQUlDLE1BQU0sR0FBRztBQUNYQyxJQUFBQSxrQkFBa0IsRUFBRSxDQUFDLENBQUMsS0FBS0MsSUFBTCxDQUFVQztBQURyQixHQUFiO0FBR0EsTUFBSUMsV0FBVyxHQUFHLE1BQU0sS0FBS1IsU0FBTCxDQUFlQyxVQUFmLENBQTBCLGFBQTFCLEVBQXlDRyxNQUF6QyxDQUF4QjtBQUNBLFNBQU9JLFdBQVcsQ0FBQ0MsV0FBWixFQUFQO0FBQ0QsQ0FORDs7QUFRQWxCLFFBQVEsQ0FBQ21CLGNBQVQsR0FBMEIsZ0JBQWdCRixXQUFoQixFQUE2QjtBQUNyREEsRUFBQUEsV0FBVyxHQUFHQSxXQUFXLENBQUNDLFdBQVosRUFBZDtBQUNBLE1BQUlMLE1BQU0sR0FBRztBQUNYSSxJQUFBQSxXQURXO0FBRVhILElBQUFBLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxLQUFLQyxJQUFMLENBQVVDO0FBRnJCLEdBQWI7QUFJQSxTQUFPLE1BQU0sS0FBS1AsU0FBTCxDQUFlQyxVQUFmLENBQTBCLGFBQTFCLEVBQXlDRyxNQUF6QyxDQUFiO0FBQ0QsQ0FQRDs7QUFTQWIsUUFBUSxDQUFDb0IsU0FBVCxHQUFxQixnQkFBZ0JDLE1BQWhCLEVBQXdCQyxNQUF4QixFQUFnQztBQUNuRCxTQUFPLE1BQU0sS0FBS2IsU0FBTCxDQUFlQyxVQUFmLENBQTBCLE9BQTFCLEVBQW1DO0FBQUNXLElBQUFBLE1BQUQ7QUFBU0MsSUFBQUE7QUFBVCxHQUFuQyxDQUFiO0FBQ0QsQ0FGRDs7QUFJQXRCLFFBQVEsQ0FBQ3VCLGdCQUFULEdBQTRCLGdCQUFnQkMsU0FBaEIsRUFBMkJDLE9BQTNCLEVBQW9DQyxPQUFwQyxFQUE2Q0MsS0FBN0MsRUFBb0Q7QUFDOUUsTUFBSWQsTUFBTSxHQUFHO0FBQUNZLElBQUFBLE9BQUQ7QUFBVUMsSUFBQUEsT0FBVjtBQUFtQkMsSUFBQUEsS0FBbkI7QUFBMEJILElBQUFBO0FBQTFCLEdBQWI7QUFDQSxTQUFPLE1BQU0sS0FBS2YsU0FBTCxDQUFlQyxVQUFmLENBQTBCLGVBQTFCLEVBQTJDRyxNQUEzQyxDQUFiO0FBQ0QsQ0FIRDs7QUFLQWIsUUFBUSxDQUFDNEIsS0FBVCxHQUFpQixnQkFBZ0JDLE1BQWhCLEVBQXdCQyxNQUF4QixFQUFnQ0MsSUFBaEMsRUFBc0NDLElBQXRDLEVBQTRDQyxRQUE1QyxFQUFzREMsVUFBdEQsRUFBa0VDLElBQWxFLEVBQXdFO0FBQ3ZGLE1BQUlOLE1BQU0sS0FBSyxNQUFmLEVBQXVCO0FBQ3JCQSxJQUFBQSxNQUFNLEdBQUcsR0FBVDtBQUNEOztBQUNELE1BQUlDLE1BQU0sS0FBSyxNQUFmLEVBQXVCO0FBQ3JCQSxJQUFBQSxNQUFNLEdBQUcsR0FBVDtBQUNEOztBQUNELE1BQUlNLFNBQVMsR0FBRztBQUFDUCxJQUFBQSxNQUFEO0FBQVNDLElBQUFBLE1BQVQ7QUFBaUJDLElBQUFBLElBQWpCO0FBQXVCQyxJQUFBQSxJQUF2QjtBQUNDSyxJQUFBQSxLQUFLLEVBQUVDLElBQUksQ0FBQ0MsS0FBTCxDQUFXTixRQUFRLEdBQUd2QyxnQkFBdEI7QUFEUixHQUFoQjs7QUFJQSxNQUFJOEMsb0JBQUtDLFFBQUwsQ0FBY04sSUFBZCxDQUFKLEVBQXlCO0FBQ3ZCQyxJQUFBQSxTQUFTLENBQUNaLFNBQVYsR0FBc0JXLElBQXRCO0FBQ0Q7O0FBQ0QsU0FBTyxNQUFNLEtBQUtPLE9BQUwsQ0FBYU4sU0FBYixDQUFiO0FBQ0QsQ0FmRDs7QUFpQkFwQyxRQUFRLENBQUMwQyxPQUFULEdBQW1CLGdCQUFnQk4sU0FBaEIsRUFBMkI7QUFDNUMsTUFBSUksb0JBQUtDLFFBQUwsQ0FBY0wsU0FBUyxDQUFDWixTQUF4QixDQUFKLEVBQXdDO0FBQ3RDLFdBQU8sTUFBTSxLQUFLZixTQUFMLENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkMwQixTQUEzQyxDQUFiO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsV0FBTyxNQUFNLEtBQUszQixTQUFMLENBQWVDLFVBQWYsQ0FBMEIsT0FBMUIsRUFBbUMwQixTQUFuQyxDQUFiO0FBQ0Q7QUFDRixDQU5EOztBQVFBcEMsUUFBUSxDQUFDMkMsVUFBVCxHQUFzQixnQkFBZ0JkLE1BQWhCLEVBQXdCQyxNQUF4QixFQUFnQ0MsSUFBaEMsRUFBc0NDLElBQXRDLEVBQTRDQyxRQUE1QyxFQUFzRFcsT0FBdEQsRUFBK0RQLEtBQS9ELEVBQXNFRixJQUF0RSxFQUE0RTtBQUNoRyxNQUFJVSxTQUFTLEdBQUc7QUFDZEMsSUFBQUEsU0FBUyxFQUFFLElBREc7QUFFZHRCLElBQUFBLFNBQVMsRUFBRVcsSUFGRztBQUdkUyxJQUFBQSxPQUhjO0FBSWRQLElBQUFBO0FBSmMsR0FBaEI7QUFNQSxTQUFPLE1BQU0sS0FBSzVCLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixlQUExQixFQUEyQ21DLFNBQTNDLENBQWI7QUFDRCxDQVJEOztBQVVBN0MsUUFBUSxDQUFDK0MsU0FBVCxHQUFxQixnQkFBZ0JsQixNQUFoQixFQUF3QkMsTUFBeEIsRUFBZ0NDLElBQWhDLEVBQXNDQyxJQUF0QyxFQUE0Q0MsUUFBNUMsRUFBc0RXLE9BQXRELEVBQStEUCxLQUEvRCxFQUFzRUYsSUFBdEUsRUFBNEU7QUFDL0YsTUFBSVUsU0FBUyxHQUFHO0FBQUNDLElBQUFBLFNBQVMsRUFBRSxLQUFaO0FBQW1CdEIsSUFBQUEsU0FBUyxFQUFFVyxJQUE5QjtBQUFvQ1MsSUFBQUEsT0FBcEM7QUFBNkNQLElBQUFBO0FBQTdDLEdBQWhCO0FBQ0EsU0FBTyxNQUFNLEtBQUs1QixTQUFMLENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkNtQyxTQUEzQyxDQUFiO0FBQ0QsQ0FIRDs7QUFLQTdDLFFBQVEsQ0FBQ2dELEtBQVQsR0FBaUIsZ0JBQWdCQyxPQUFoQixFQUF5QjVCLE1BQXpCLEVBQWlDQyxNQUFqQyxFQUF5QzRCLE9BQXpDLEVBQWtEQyxPQUFsRCxFQUEyRHhCLEtBQTNELEVBQWtFO0FBQ2pGLE1BQUlzQixPQUFKLEVBQWE7QUFDWCxVQUFNLEtBQUsxQixnQkFBTCxDQUFzQjBCLE9BQXRCLEVBQStCQyxPQUEvQixFQUF3Q0MsT0FBeEMsRUFBaUR4QixLQUFqRCxDQUFOO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsVUFBTSxLQUFLUCxTQUFMLENBQWVDLE1BQWYsRUFBdUJDLE1BQXZCLENBQU47QUFDRDtBQUNGLENBTkQ7O0FBUUF0QixRQUFRLENBQUNvRCxJQUFULEdBQWdCLGdCQUFnQnZCLE1BQWhCLEVBQXdCQyxNQUF4QixFQUFnQ0MsSUFBaEMsRUFBc0NDLElBQXRDLEVBQTRDQyxRQUE1QyxFQUFzREMsVUFBdEQsRUFBa0VWLFNBQWxFLEVBQTZFNkIsUUFBN0UsRUFBdUY7QUFDckcsTUFBSUMsUUFBUSxHQUFHO0FBQ2I5QixJQUFBQSxTQURhO0FBQ0Y2QixJQUFBQSxRQURFO0FBQ1F4QixJQUFBQSxNQURSO0FBQ2dCQyxJQUFBQSxNQURoQjtBQUN3QkMsSUFBQUEsSUFEeEI7QUFDOEJDLElBQUFBLElBRDlCO0FBRWJLLElBQUFBLEtBQUssRUFBRUMsSUFBSSxDQUFDQyxLQUFMLENBQVdOLFFBQVEsR0FBR3RDLGVBQXRCO0FBRk0sR0FBZjtBQUlBLFNBQU8sTUFBTSxLQUFLNEQsTUFBTCxDQUFZRCxRQUFaLENBQWI7QUFFRCxDQVBEOztBQVNBdEQsUUFBUSxDQUFDdUQsTUFBVCxHQUFrQixnQkFBZ0JELFFBQWhCLEVBQTBCO0FBQzFDLE1BQUlkLG9CQUFLQyxRQUFMLENBQWNhLFFBQVEsQ0FBQzlCLFNBQXZCLENBQUosRUFBdUM7QUFDckMsV0FBTyxNQUFNLEtBQUtmLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixjQUExQixFQUEwQzRDLFFBQTFDLENBQWI7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPLE1BQU0sS0FBSzdDLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixNQUExQixFQUFrQzRDLFFBQWxDLENBQWI7QUFDRDtBQUNGLENBTkQ7O0FBUUF0RCxRQUFRLENBQUN3RCxJQUFULEdBQWdCLGdCQUFnQkMsT0FBaEIsRUFBeUI7QUFDdkMsUUFBTSxLQUFLQyxHQUFMLENBQVNGLElBQVQsRUFBTjs7QUFDQSxNQUFJRyxLQUFLLENBQUNGLE9BQUQsQ0FBVCxFQUFvQjtBQUNsQjtBQUNEOztBQUVELFFBQU1HLFlBQVksR0FBR0MsVUFBVSxDQUFDSixPQUFELENBQS9COztBQUNBLE1BQUlHLFlBQVksSUFBSSxDQUFwQixFQUF1QjtBQUNyQjtBQUNEOztBQUNELFFBQU1FLGtCQUFFQyxLQUFGLENBQVEsT0FBT0gsWUFBZixDQUFOO0FBQ0EsUUFBTSxLQUFLSSxNQUFMLEVBQU47QUFDRCxDQVpEOztBQWNBaEUsUUFBUSxDQUFDaUUsUUFBVCxHQUFvQixrQkFBa0I7QUFDcEMsU0FBTyxNQUFNLEtBQUtQLEdBQUwsQ0FBU1EsY0FBVCxFQUFiO0FBQ0QsQ0FGRDs7QUFJQWxFLFFBQVEsQ0FBQ2dFLE1BQVQsR0FBa0Isa0JBQWtCO0FBQ2xDLFNBQU8sTUFBTUcsd0JBQWVILE1BQWYsQ0FBc0IsSUFBdEIsRUFBNEIsS0FBS04sR0FBakMsRUFBc0MsS0FBS1UsSUFBM0MsQ0FBYjtBQUNELENBRkQ7O0FBSUFwRSxRQUFRLENBQUNxRSxpQkFBVCxHQUE2QixrQkFBa0I7QUFDN0MsU0FBTyxNQUFNLEtBQUs1RCxTQUFMLENBQWVDLFVBQWYsQ0FBMEIsa0JBQTFCLENBQWI7QUFDRCxDQUZEOztBQUlBVixRQUFRLENBQUNzRSxXQUFULEdBQXVCLGdCQUFnQkMsUUFBaEIsRUFBMEJDLFNBQTFCLEVBQXFDO0FBQzFELFNBQU8sTUFBTSxLQUFLZCxHQUFMLENBQVNlLGlCQUFULENBQTRCLFdBQVVELFNBQVUsSUFBR0QsUUFBUyxFQUE1RCxDQUFiO0FBQ0QsQ0FGRDs7QUFJQSxTQUFTRyxrQkFBVCxDQUE2QkMsVUFBN0IsRUFBeUM7QUFDdkMsUUFBTUMsS0FBSyxHQUFHL0Usc0JBQXNCLENBQUNnRixJQUF2QixDQUE0QkYsVUFBNUIsQ0FBZDs7QUFDQSxNQUFJLENBQUNDLEtBQUwsRUFBWTtBQUNWdEUsb0JBQUl3RSxhQUFKLENBQW1CLGtHQUFELEdBQ0MsSUFBR0gsVUFBVyxvQkFEakM7QUFFRDs7QUFDRCxTQUFPLENBQUNDLEtBQUssQ0FBQyxDQUFELENBQU4sRUFBV0csY0FBS0MsS0FBTCxDQUFXQyxPQUFYLENBQW9CLGNBQWFMLEtBQUssQ0FBQyxDQUFELENBQUksRUFBMUMsRUFBNkNBLEtBQUssQ0FBQyxDQUFELENBQWxELENBQVgsQ0FBUDtBQUNEOztBQUVENUUsUUFBUSxDQUFDa0YsUUFBVCxHQUFvQixnQkFBZ0JQLFVBQWhCLEVBQTRCO0FBQzlDLE1BQUlBLFVBQVUsQ0FBQ1EsUUFBWCxDQUFvQixHQUFwQixDQUFKLEVBQThCO0FBQzVCN0Usb0JBQUl3RSxhQUFKLENBQW1CLHdFQUFELEdBQ0MsSUFBR0gsVUFBVyxvQkFEakM7QUFFRDs7QUFDRCxNQUFJUyxjQUFjLEdBQUcsSUFBckI7O0FBQ0EsTUFBSVQsVUFBVSxDQUFDVSxVQUFYLENBQXNCekYscUJBQXRCLENBQUosRUFBa0Q7QUFDaEQsVUFBTSxDQUFDMEYsU0FBRCxFQUFZQyxlQUFaLElBQStCYixrQkFBa0IsQ0FBQ0MsVUFBRCxDQUF2RDs7QUFDQXJFLG9CQUFJa0YsSUFBSixDQUFVLDhCQUE2QkYsU0FBVSxXQUFVWCxVQUFXLDhCQUE2QlksZUFBZ0IsR0FBbkg7O0FBQ0FILElBQUFBLGNBQWMsR0FBSSxtQkFBa0JMLGNBQUtDLEtBQUwsQ0FBV1MsUUFBWCxDQUFvQkYsZUFBcEIsQ0FBcUMsRUFBekU7O0FBQ0EsUUFBSTtBQUNGLFlBQU0sS0FBSzdCLEdBQUwsQ0FBU2dDLEtBQVQsQ0FBZSxDQUFDLFFBQUQsRUFBV0osU0FBWCxFQUF1QixjQUFhQyxlQUFlLENBQUNJLE9BQWhCLENBQXdCLElBQXhCLEVBQThCLE1BQTlCLENBQXNDLEdBQTFFLENBQWYsQ0FBTjtBQUNBLFlBQU0sS0FBS2pDLEdBQUwsQ0FBU2dDLEtBQVQsQ0FBZSxDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWFILGVBQWIsRUFBOEJILGNBQTlCLENBQWYsQ0FBTjtBQUNELEtBSEQsQ0FHRSxPQUFPUSxDQUFQLEVBQVU7QUFDVnRGLHNCQUFJd0UsYUFBSixDQUFtQixtQ0FBa0NRLFNBQVUsaUJBQTdDLEdBQ0MsOEVBREQsR0FFQyxtQkFBa0JNLENBQUMsQ0FBQ0MsT0FBUSxFQUYvQztBQUdEO0FBQ0Y7O0FBQ0QsUUFBTUMsU0FBUyxHQUFHQyxjQUFLaEIsSUFBTCxDQUFVO0FBQUNpQixJQUFBQSxNQUFNLEVBQUUsUUFBVDtBQUFtQkMsSUFBQUEsTUFBTSxFQUFFO0FBQTNCLEdBQVYsQ0FBbEI7O0FBQ0EsTUFBSTtBQUNGLFVBQU0sS0FBS3ZDLEdBQUwsQ0FBU3dDLElBQVQsQ0FBY0MsZ0JBQUVDLFFBQUYsQ0FBV2hCLGNBQVgsSUFBNkJBLGNBQTdCLEdBQThDVCxVQUE1RCxFQUF3RW1CLFNBQXhFLENBQU47QUFDQSxVQUFNTyxJQUFJLEdBQUcsTUFBTUMsa0JBQUdDLFFBQUgsQ0FBWVQsU0FBWixDQUFuQjtBQUNBLFdBQU9VLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZSixJQUFaLEVBQWtCSyxRQUFsQixDQUEyQixRQUEzQixDQUFQO0FBQ0QsR0FKRCxTQUlVO0FBQ1IsUUFBSSxNQUFNSixrQkFBR0ssTUFBSCxDQUFVYixTQUFWLENBQVYsRUFBZ0M7QUFDOUIsWUFBTVEsa0JBQUdNLE1BQUgsQ0FBVWQsU0FBVixDQUFOO0FBQ0Q7O0FBQ0QsUUFBSUssZ0JBQUVDLFFBQUYsQ0FBV2hCLGNBQVgsQ0FBSixFQUFnQztBQUM5QixZQUFNLEtBQUsxQixHQUFMLENBQVNnQyxLQUFULENBQWUsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhTixjQUFiLENBQWYsQ0FBTjtBQUNEO0FBQ0Y7QUFDRixDQWhDRDs7QUFrQ0FwRixRQUFRLENBQUM2RyxRQUFULEdBQW9CLGdCQUFnQmxDLFVBQWhCLEVBQTRCbUMsVUFBNUIsRUFBd0M7QUFDMUQsTUFBSW5DLFVBQVUsQ0FBQ1EsUUFBWCxDQUFvQixHQUFwQixDQUFKLEVBQThCO0FBQzVCN0Usb0JBQUl3RSxhQUFKLENBQW1CLHdFQUFELEdBQ0MsSUFBR0gsVUFBVyxvQkFEakM7QUFFRDs7QUFDRCxRQUFNbUIsU0FBUyxHQUFHQyxjQUFLaEIsSUFBTCxDQUFVO0FBQUNpQixJQUFBQSxNQUFNLEVBQUUsUUFBVDtBQUFtQkMsSUFBQUEsTUFBTSxFQUFFO0FBQTNCLEdBQVYsQ0FBbEI7O0FBQ0EsTUFBSUUsZ0JBQUVZLE9BQUYsQ0FBVUQsVUFBVixDQUFKLEVBQTJCO0FBR3pCQSxJQUFBQSxVQUFVLEdBQUdOLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZSyxVQUFaLEVBQXdCSixRQUF4QixDQUFpQyxNQUFqQyxDQUFiO0FBQ0Q7O0FBQ0QsUUFBTU0sT0FBTyxHQUFHUixNQUFNLENBQUNDLElBQVAsQ0FBWUssVUFBWixFQUF3QixRQUF4QixDQUFoQjtBQUNBLE1BQUkxQixjQUFjLEdBQUcsSUFBckI7O0FBQ0EsTUFBSTtBQUNGLFVBQU1rQixrQkFBR1csU0FBSCxDQUFhbkIsU0FBYixFQUF3QmtCLE9BQU8sQ0FBQ04sUUFBUixDQUFpQixRQUFqQixDQUF4QixFQUFvRCxRQUFwRCxDQUFOOztBQUNBLFFBQUkvQixVQUFVLENBQUNVLFVBQVgsQ0FBc0J6RixxQkFBdEIsQ0FBSixFQUFrRDtBQUNoRCxZQUFNLENBQUMwRixTQUFELEVBQVlDLGVBQVosSUFBK0JiLGtCQUFrQixDQUFDQyxVQUFELENBQXZEOztBQUNBckUsc0JBQUlrRixJQUFKLENBQVUsOEJBQTZCRixTQUFVLFdBQVVYLFVBQVcsOEJBQTZCWSxlQUFnQixHQUFuSDs7QUFDQUgsTUFBQUEsY0FBYyxHQUFJLG1CQUFrQkwsY0FBS0MsS0FBTCxDQUFXUyxRQUFYLENBQW9CRixlQUFwQixDQUFxQyxFQUF6RTs7QUFDQSxVQUFJO0FBQ0YsY0FBTSxLQUFLN0IsR0FBTCxDQUFTZ0MsS0FBVCxDQUNKLENBQUMsUUFBRCxFQUFXSixTQUFYLEVBQXVCLGFBQVlQLGNBQUtDLEtBQUwsQ0FBV2tDLE9BQVgsQ0FBbUIzQixlQUFuQixFQUFvQ0ksT0FBcEMsQ0FBNEMsSUFBNUMsRUFBa0QsTUFBbEQsQ0FBMEQsR0FBN0YsQ0FESSxDQUFOO0FBR0EsY0FBTSxLQUFLakMsR0FBTCxDQUFTZ0MsS0FBVCxDQUFlLENBQUMsUUFBRCxFQUFXSixTQUFYLEVBQXVCLFVBQVNDLGVBQWUsQ0FBQ0ksT0FBaEIsQ0FBd0IsSUFBeEIsRUFBOEIsTUFBOUIsQ0FBc0MsR0FBdEUsQ0FBZixDQUFOO0FBQ0EsY0FBTSxLQUFLakMsR0FBTCxDQUFTZ0MsS0FBVCxDQUFlLENBQUMsUUFBRCxFQUFXSixTQUFYLEVBQXVCLGNBQWFDLGVBQWUsQ0FBQ0ksT0FBaEIsQ0FBd0IsSUFBeEIsRUFBOEIsTUFBOUIsQ0FBc0MsR0FBMUUsQ0FBZixDQUFOO0FBQ0EsY0FBTSxLQUFLakMsR0FBTCxDQUFTeUQsSUFBVCxDQUFjckIsU0FBZCxFQUF5QlYsY0FBekIsQ0FBTjtBQUNBLGNBQU0sS0FBSzFCLEdBQUwsQ0FBU2dDLEtBQVQsQ0FBZSxDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWFOLGNBQWIsRUFBNkJHLGVBQTdCLENBQWYsQ0FBTjtBQUNELE9BUkQsQ0FRRSxPQUFPSyxDQUFQLEVBQVU7QUFDVnRGLHdCQUFJd0UsYUFBSixDQUFtQixtQ0FBa0NRLFNBQVUsaUJBQTdDLEdBQ0MsOEVBREQsR0FFQyxtQkFBa0JNLENBQUMsQ0FBQ0MsT0FBUSxFQUYvQztBQUdEO0FBQ0YsS0FqQkQsTUFpQk87QUFFTCxZQUFNLEtBQUtuQyxHQUFMLENBQVN5RCxJQUFULENBQWNyQixTQUFkLEVBQXlCbkIsVUFBekIsQ0FBTjs7QUFJQXJFLHNCQUFJa0YsSUFBSixDQUFTLDBEQUFUOztBQUNBLFVBQUk7QUFDRixjQUFNLEtBQUs5QixHQUFMLENBQVNnQyxLQUFULENBQWUsQ0FBQyxJQUFELEVBQU8sV0FBUCxFQUFvQixJQUFwQixFQUNuQjNGLDJCQURtQixFQUNVLElBRFYsRUFDaUIsVUFBUzRFLFVBQVcsRUFEckMsQ0FBZixDQUFOO0FBRUQsT0FIRCxDQUdFLE9BQU9pQixDQUFQLEVBQVU7QUFDVnRGLHdCQUFJQyxJQUFKLENBQVUsNkNBQTRDcUYsQ0FBQyxDQUFDQyxPQUFRLFlBQWhFO0FBQ0Q7QUFDRjtBQUNGLEdBakNELFNBaUNVO0FBQ1IsUUFBSSxNQUFNUyxrQkFBR0ssTUFBSCxDQUFVYixTQUFWLENBQVYsRUFBZ0M7QUFDOUIsWUFBTVEsa0JBQUdNLE1BQUgsQ0FBVWQsU0FBVixDQUFOO0FBQ0Q7O0FBQ0QsUUFBSUssZ0JBQUVDLFFBQUYsQ0FBV2hCLGNBQVgsQ0FBSixFQUFnQztBQUM5QixZQUFNLEtBQUsxQixHQUFMLENBQVNnQyxLQUFULENBQWUsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhTixjQUFiLENBQWYsQ0FBTjtBQUNEO0FBQ0Y7QUFDRixDQXRERDs7QUF3REFwRixRQUFRLENBQUNvSCxVQUFULEdBQXNCLGdCQUFnQnpDLFVBQWhCLEVBQTRCO0FBQ2hELE1BQUkwQyxXQUFXLEdBQUd0QixjQUFLaEIsSUFBTCxDQUFVO0FBQUNpQixJQUFBQSxNQUFNLEVBQUU7QUFBVCxHQUFWLENBQWxCOztBQUNBLFFBQU0sS0FBS3RDLEdBQUwsQ0FBU3dDLElBQVQsQ0FBY3ZCLFVBQWQsRUFBMEIwQyxXQUExQixDQUFOO0FBQ0EsU0FBTyxDQUFDLE1BQU1DLG1CQUFJQyxhQUFKLENBQWtCRixXQUFsQixDQUFQLEVBQXVDWCxRQUF2QyxDQUFnRCxRQUFoRCxDQUFQO0FBQ0QsQ0FKRDs7QUFNQTFHLFFBQVEsQ0FBQ3dILFdBQVQsR0FBdUIsZ0JBQWdCQyxhQUFoQixFQUErQjtBQUNwRCxNQUFJLENBQUMsS0FBS0MsVUFBTCxFQUFMLEVBQXdCO0FBQ3RCcEgsb0JBQUl3RSxhQUFKLENBQWtCLG9EQUFsQjtBQUNEOztBQUNELFFBQU0sS0FBS3BCLEdBQUwsQ0FBUzhELFdBQVQsQ0FBcUJDLGFBQXJCLENBQU47QUFDRCxDQUxEOztBQU9BekgsUUFBUSxDQUFDMkgsT0FBVCxHQUFtQixnQkFBZ0JDLFdBQWhCLEVBQTZCL0IsT0FBN0IsRUFBc0M7QUFDdkQsTUFBSSxDQUFDLEtBQUs2QixVQUFMLEVBQUwsRUFBd0I7QUFDdEJwSCxvQkFBSXdFLGFBQUosQ0FBa0IsZ0RBQWxCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLcEIsR0FBTCxDQUFTaUUsT0FBVCxDQUFpQkMsV0FBakIsRUFBOEIvQixPQUE5QixDQUFOO0FBQ0QsQ0FMRDs7QUFPQTdGLFFBQVEsQ0FBQzZILE9BQVQsR0FBbUIsZ0JBQWdCRCxXQUFoQixFQUE2QkUsTUFBN0IsRUFBcUM7QUFDdEQsTUFBSSxDQUFDLEtBQUtKLFVBQUwsRUFBTCxFQUF3QjtBQUN0QnBILG9CQUFJd0UsYUFBSixDQUFrQixnREFBbEI7QUFDRDs7QUFDRCxRQUFNLEtBQUtwQixHQUFMLENBQVNtRSxPQUFULENBQWlCRCxXQUFqQixFQUE4QkUsTUFBOUIsQ0FBTjtBQUNELENBTEQ7O0FBT0E5SCxRQUFRLENBQUMrSCxTQUFULEdBQXFCLGdCQUFnQkMsYUFBaEIsRUFBK0I7QUFDbEQsTUFBSSxDQUFDLEtBQUtOLFVBQUwsRUFBTCxFQUF3QjtBQUN0QnBILG9CQUFJd0UsYUFBSixDQUFrQixrREFBbEI7QUFDRDs7QUFDRCxRQUFNLEtBQUtwQixHQUFMLENBQVNxRSxTQUFULENBQW1CQyxhQUFuQixDQUFOO0FBQ0QsQ0FMRDs7QUFPQWhJLFFBQVEsQ0FBQ2lJLFFBQVQsR0FBb0IsZ0JBQWdCQyxLQUFoQixFQUF1QjtBQUN6QyxNQUFJLENBQUMsS0FBS1IsVUFBTCxFQUFMLEVBQXdCO0FBQ3RCcEgsb0JBQUl3RSxhQUFKLENBQWtCLGlEQUFsQjtBQUNEOztBQUNELFFBQU0sS0FBS3BCLEdBQUwsQ0FBU3VFLFFBQVQsQ0FBa0JDLEtBQWxCLENBQU47QUFDRCxDQUxEOztBQU9BbEksUUFBUSxDQUFDbUksT0FBVCxHQUFtQixnQkFBZ0JELEtBQWhCLEVBQXVCO0FBQ3hDLE1BQUksQ0FBQyxLQUFLUixVQUFMLEVBQUwsRUFBd0I7QUFDdEJwSCxvQkFBSXdFLGFBQUosQ0FBa0IsZ0RBQWxCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLcEIsR0FBTCxDQUFTeUUsT0FBVCxDQUFpQkQsS0FBakIsQ0FBTjtBQUNELENBTEQ7O0FBT0FsSSxRQUFRLENBQUNvSSxhQUFULEdBQXlCLGdCQUFnQkMsY0FBaEIsRUFBZ0M7QUFDdkQsTUFBSSxDQUFDLEtBQUtYLFVBQUwsRUFBTCxFQUF3QjtBQUN0QnBILG9CQUFJd0UsYUFBSixDQUFrQixzREFBbEI7QUFDRDs7QUFDRCxRQUFNLEtBQUtwQixHQUFMLENBQVMwRSxhQUFULENBQXVCQyxjQUF2QixDQUFOO0FBQ0QsQ0FMRDs7QUFPQXJJLFFBQVEsQ0FBQ3NJLFlBQVQsR0FBd0IsZ0JBQWdCQSxZQUFoQixFQUE4QjtBQUNwRCxNQUFJLENBQUMsS0FBS1osVUFBTCxFQUFMLEVBQXdCO0FBQ3RCcEgsb0JBQUl3RSxhQUFKLENBQWtCLHFEQUFsQjtBQUNEOztBQUNELFFBQU0sS0FBS3BCLEdBQUwsQ0FBUzRFLFlBQVQsQ0FBc0JBLFlBQXRCLENBQU47QUFDRCxDQUxEOztBQU9BckksT0FBTyxDQUFDc0ksNkJBQVIsR0FBd0MsZ0JBQWdCN0UsR0FBaEIsRUFBcUIzQyxJQUFyQixFQUEyQjtBQUNqRSxRQUFNK0UsU0FBUyxHQUFHQyxjQUFLaEIsSUFBTCxDQUFVO0FBQUNpQixJQUFBQSxNQUFNLEVBQUUsUUFBVDtBQUFtQkMsSUFBQUEsTUFBTSxFQUFFO0FBQTNCLEdBQVYsQ0FBbEI7O0FBQ0EsTUFBSSxNQUFNSyxrQkFBR0ssTUFBSCxDQUFVYixTQUFWLENBQVYsRUFBZ0M7QUFDOUIsVUFBTVEsa0JBQUdNLE1BQUgsQ0FBVWQsU0FBVixDQUFOO0FBQ0Q7O0FBQ0QsTUFBSTtBQUNGLFVBQU0wQyxNQUFNLEdBQUd6SCxJQUFJLENBQUMwSCxxQkFBTCxJQUE4QixrQkFBN0M7O0FBQ0EsVUFBTUMsR0FBRyxHQUFHM0QsY0FBS0MsS0FBTCxDQUFXQyxPQUFYLENBQW1CdUQsTUFBbkIsRUFBMkIsZ0JBQTNCLENBQVo7O0FBQ0EsVUFBTUcsR0FBRyxHQUFHLENBQUMsZ0JBQUQsRUFBb0IsR0FBRUQsR0FBSSxHQUExQixFQUE4Qix1QkFBOUIsRUFBdUQsSUFBdkQsRUFBNkRBLEdBQTdELENBQVo7QUFDQSxVQUFNaEYsR0FBRyxDQUFDZ0MsS0FBSixDQUFVaUQsR0FBVixDQUFOOztBQUNBLFFBQUksRUFBQyxNQUFNakYsR0FBRyxDQUFDa0YsUUFBSixDQUFhRixHQUFiLENBQVAsQ0FBSixFQUE4QjtBQUM1QixZQUFNLElBQUlHLEtBQUosQ0FBVSxrREFBVixDQUFOO0FBQ0Q7O0FBQ0QsVUFBTW5GLEdBQUcsQ0FBQ3dDLElBQUosQ0FBU3dDLEdBQVQsRUFBYzVDLFNBQWQsQ0FBTjtBQUNBLFdBQU8sTUFBTWdELGNBQUtDLElBQUwsQ0FBVWpELFNBQVYsQ0FBYjtBQUNELEdBVkQsU0FVVTtBQUNSLFFBQUksTUFBTVEsa0JBQUdLLE1BQUgsQ0FBVWIsU0FBVixDQUFWLEVBQWdDO0FBQzlCLFlBQU1RLGtCQUFHTSxNQUFILENBQVVkLFNBQVYsQ0FBTjtBQUNEO0FBQ0Y7QUFDRixDQXBCRDs7QUFzQkE3RixPQUFPLENBQUMrSSwrQkFBUixHQUEwQyxnQkFBZ0J0RixHQUFoQixFQUFxQjtBQUM3RCxNQUFJO0FBQUN1RixJQUFBQSxNQUFEO0FBQVNDLElBQUFBLE1BQVQ7QUFBaUJDLElBQUFBO0FBQWpCLE1BQXlCLE1BQU0sd0JBQUt6RixHQUFHLENBQUMwRixVQUFKLENBQWVyRSxJQUFwQixFQUNEckIsR0FBRyxDQUFDMEYsVUFBSixDQUFlQyxXQUFmLENBQ0dDLE1BREgsQ0FDVSxDQUFDLFVBQUQsRUFBYSx1QkFBYixFQUFzQyxJQUF0QyxDQURWLENBREMsRUFHRDtBQUFDQyxJQUFBQSxRQUFRLEVBQUUsUUFBWDtBQUFxQkMsSUFBQUEsUUFBUSxFQUFFO0FBQS9CLEdBSEMsQ0FBbkM7O0FBS0EsTUFBSUwsSUFBSSxJQUFJRCxNQUFNLENBQUNPLE1BQW5CLEVBQTJCO0FBQ3pCLFVBQU0sSUFBSVosS0FBSixDQUFXLHFDQUFvQ00sSUFBSyxlQUFjRCxNQUFNLENBQUN4QyxRQUFQLEVBQWtCLEdBQXBGLENBQU47QUFDRDs7QUFFRCxNQUFJLENBQUN1QyxNQUFNLENBQUNRLE1BQVosRUFBb0I7QUFDbEIsVUFBTSxJQUFJWixLQUFKLENBQVUsNkJBQVYsQ0FBTjtBQUNEOztBQUVELFNBQU8sTUFBTUMsY0FBS0MsSUFBTCxDQUFVRSxNQUFWLENBQWI7QUFDRCxDQWZEOztBQWlCQWpKLFFBQVEsQ0FBQzBKLGFBQVQsR0FBeUIsa0JBQWtCO0FBQ3pDLFFBQU1DLFFBQVEsR0FBRyxNQUFNLEtBQUtqRyxHQUFMLENBQVNrRyxXQUFULEVBQXZCO0FBQ0EsTUFBSUMsS0FBSyxHQUFHLElBQVo7O0FBQ0EsTUFBSUYsUUFBUSxHQUFHLEVBQWYsRUFBbUI7QUFDakIsUUFBSTtBQUdGRSxNQUFBQSxLQUFLLEdBQUcsTUFBTSxLQUFLYiwrQkFBTCxDQUFxQyxLQUFLdEYsR0FBMUMsQ0FBZDtBQUNELEtBSkQsQ0FJRSxPQUFPa0MsQ0FBUCxFQUFVO0FBQ1Z0RixzQkFBSWtGLElBQUosQ0FBVSw4REFBNkRJLENBQUMsQ0FBQ0MsT0FBUSxLQUF4RSxHQUNDLGdDQURWO0FBRUQ7QUFDRjs7QUFDRCxNQUFJLENBQUNnRSxLQUFMLEVBQVk7QUFDVixRQUFJO0FBQ0ZBLE1BQUFBLEtBQUssR0FBRyxNQUFNLEtBQUt0Qiw2QkFBTCxDQUFtQyxLQUFLN0UsR0FBeEMsRUFBNkMsS0FBSzNDLElBQWxELENBQWQ7QUFDRCxLQUZELENBRUUsT0FBTzZFLENBQVAsRUFBVTtBQUNWLFlBQU1rRSxHQUFHLEdBQUksMENBQXlDbEUsQ0FBQyxDQUFDQyxPQUFRLEtBQXBELEdBQ0MsMERBREQsR0FFQyxrQkFGYjs7QUFHQXZGLHNCQUFJd0UsYUFBSixDQUFrQmdGLEdBQWxCO0FBQ0Q7QUFDRjs7QUFDRCxNQUFJSCxRQUFRLEdBQUcsRUFBZixFQUFtQjtBQUVqQixRQUFJSSxpQkFBaUIsR0FBRyxNQUFNLEtBQUtyRyxHQUFMLENBQVNzRyxvQkFBVCxFQUE5Qjs7QUFDQSxRQUFJO0FBQ0ZILE1BQUFBLEtBQUssR0FBRyxNQUFNQSxLQUFLLENBQUNJLE1BQU4sQ0FBYSxDQUFDLEVBQUQsR0FBTUYsaUJBQW5CLENBQWQ7QUFDRCxLQUZELENBRUUsT0FBT0QsR0FBUCxFQUFZO0FBQ1p4SixzQkFBSUMsSUFBSixDQUFVLDZDQUE0Q3VKLEdBQUksRUFBMUQ7QUFDRDtBQUNGOztBQUNELFFBQU1JLFNBQVMsR0FBR3BHLGtCQUFFcUcsU0FBRixDQUFZTixLQUFLLENBQUNLLFNBQWxCLEVBQTZCO0FBQUNFLElBQUFBLE9BQU8sRUFBRVA7QUFBVixHQUE3QixDQUFsQjs7QUFDQSxRQUFNUSxTQUFTLEdBQUcsTUFBTUgsU0FBUyxDQUFDcEIsY0FBS3dCLFFBQU4sQ0FBakM7QUFDQSxTQUFPRCxTQUFTLENBQUMzRCxRQUFWLENBQW1CLFFBQW5CLENBQVA7QUFDRCxDQW5DRDs7QUFxQ0E2RCxNQUFNLENBQUNDLE1BQVAsQ0FBY3RLLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHRlbXAgZnJvbSAndGVtcCc7XG5pbXBvcnQgeyBmcywgdXRpbCwgemlwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgamltcCBmcm9tICdqaW1wJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuXG5jb25zdCBzd2lwZVN0ZXBzUGVyU2VjID0gMjg7XG5jb25zdCBkcmFnU3RlcHNQZXJTZWMgPSA0MDtcbmNvbnN0IENPTlRBSU5FUl9QQVRIX01BUktFUiA9ICdAJztcbi8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvUExkQjBHLzJcbmNvbnN0IENPTlRBSU5FUl9QQVRIX1BBVFRFUk4gPSBuZXcgUmVnRXhwKGBeJHtDT05UQUlORVJfUEFUSF9NQVJLRVJ9KFteL10rKS8oLispYCk7XG5jb25zdCBBTkRST0lEX01FRElBX1JFU0NBTl9JTlRFTlQgPSAnYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1FRElBX1NDQU5ORVJfU0NBTl9GSUxFJztcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5rZXlldmVudCA9IGFzeW5jIGZ1bmN0aW9uIChrZXljb2RlLCBtZXRhc3RhdGUgPSBudWxsKSB7XG4gIC8vIFRPRE8gZGVwcmVjYXRlIGtleWV2ZW50OyBjdXJyZW50bHkgd2Qgb25seSBpbXBsZW1lbnRzIGtleWV2ZW50XG4gIGxvZy53YXJuKFwia2V5ZXZlbnQgd2lsbCBiZSBkZXByZWNhdGVkIHVzZSBwcmVzc0tleUNvZGVcIik7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByZXNzS2V5Q29kZShrZXljb2RlLCBtZXRhc3RhdGUpO1xufTtcblxuY29tbWFuZHMucHJlc3NLZXlDb2RlID0gYXN5bmMgZnVuY3Rpb24gKGtleWNvZGUsIG1ldGFzdGF0ZSA9IG51bGwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJwcmVzc0tleUNvZGVcIiwge2tleWNvZGUsIG1ldGFzdGF0ZX0pO1xufTtcblxuY29tbWFuZHMubG9uZ1ByZXNzS2V5Q29kZSA9IGFzeW5jIGZ1bmN0aW9uIChrZXljb2RlLCBtZXRhc3RhdGUgPSBudWxsKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwibG9uZ1ByZXNzS2V5Q29kZVwiLCB7a2V5Y29kZSwgbWV0YXN0YXRlfSk7XG59O1xuXG5jb21tYW5kcy5nZXRPcmllbnRhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBuYXR1cmFsT3JpZW50YXRpb246ICEhdGhpcy5vcHRzLmFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24sXG4gIH07XG4gIGxldCBvcmllbnRhdGlvbiA9IGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJvcmllbnRhdGlvblwiLCBwYXJhbXMpO1xuICByZXR1cm4gb3JpZW50YXRpb24udG9VcHBlckNhc2UoKTtcbn07XG5cbmNvbW1hbmRzLnNldE9yaWVudGF0aW9uID0gYXN5bmMgZnVuY3Rpb24gKG9yaWVudGF0aW9uKSB7XG4gIG9yaWVudGF0aW9uID0gb3JpZW50YXRpb24udG9VcHBlckNhc2UoKTtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBvcmllbnRhdGlvbixcbiAgICBuYXR1cmFsT3JpZW50YXRpb246ICEhdGhpcy5vcHRzLmFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24sXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwib3JpZW50YXRpb25cIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmZha2VGbGljayA9IGFzeW5jIGZ1bmN0aW9uICh4U3BlZWQsIHlTcGVlZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZmxpY2snLCB7eFNwZWVkLCB5U3BlZWR9KTtcbn07XG5cbmNvbW1hbmRzLmZha2VGbGlja0VsZW1lbnQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZCkge1xuICBsZXQgcGFyYW1zID0ge3hvZmZzZXQsIHlvZmZzZXQsIHNwZWVkLCBlbGVtZW50SWR9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpmbGljaycsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy5zd2lwZSA9IGFzeW5jIGZ1bmN0aW9uIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHRvdWNoQ291bnQsIGVsSWQpIHtcbiAgaWYgKHN0YXJ0WCA9PT0gJ251bGwnKSB7XG4gICAgc3RhcnRYID0gMC41O1xuICB9XG4gIGlmIChzdGFydFkgPT09ICdudWxsJykge1xuICAgIHN0YXJ0WSA9IDAuNTtcbiAgfVxuICBsZXQgc3dpcGVPcHRzID0ge3N0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLFxuICAgICAgICAgICAgICAgICAgIHN0ZXBzOiBNYXRoLnJvdW5kKGR1cmF0aW9uICogc3dpcGVTdGVwc1BlclNlYyl9O1xuICAvLyBnb2luZyB0aGUgbG9uZyB3YXkgYW5kIGNoZWNraW5nIGZvciB1bmRlZmluZWQgYW5kIG51bGwgc2luY2VcbiAgLy8gd2UgY2FuJ3QgYmUgYXNzdXJlZCBgZWxJZGAgaXMgYSBzdHJpbmcgYW5kIG5vdCBhbiBpbnRcbiAgaWYgKHV0aWwuaGFzVmFsdWUoZWxJZCkpIHtcbiAgICBzd2lwZU9wdHMuZWxlbWVudElkID0gZWxJZDtcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5kb1N3aXBlKHN3aXBlT3B0cyk7XG59O1xuXG5jb21tYW5kcy5kb1N3aXBlID0gYXN5bmMgZnVuY3Rpb24gKHN3aXBlT3B0cykge1xuICBpZiAodXRpbC5oYXNWYWx1ZShzd2lwZU9wdHMuZWxlbWVudElkKSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpzd2lwZVwiLCBzd2lwZU9wdHMpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwic3dpcGVcIiwgc3dpcGVPcHRzKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGluY2hDbG9zZSA9IGFzeW5jIGZ1bmN0aW9uIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHBlcmNlbnQsIHN0ZXBzLCBlbElkKSB7XG4gIGxldCBwaW5jaE9wdHMgPSB7XG4gICAgZGlyZWN0aW9uOiAnaW4nLFxuICAgIGVsZW1lbnRJZDogZWxJZCxcbiAgICBwZXJjZW50LFxuICAgIHN0ZXBzXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpwaW5jaFwiLCBwaW5jaE9wdHMpO1xufTtcblxuY29tbWFuZHMucGluY2hPcGVuID0gYXN5bmMgZnVuY3Rpb24gKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgcGVyY2VudCwgc3RlcHMsIGVsSWQpIHtcbiAgbGV0IHBpbmNoT3B0cyA9IHtkaXJlY3Rpb246ICdvdXQnLCBlbGVtZW50SWQ6IGVsSWQsIHBlcmNlbnQsIHN0ZXBzfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnBpbmNoXCIsIHBpbmNoT3B0cyk7XG59O1xuXG5jb21tYW5kcy5mbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4U3BlZWQsIHlTcGVlZCwgeE9mZnNldCwgeU9mZnNldCwgc3BlZWQpIHtcbiAgaWYgKGVsZW1lbnQpIHtcbiAgICBhd2FpdCB0aGlzLmZha2VGbGlja0VsZW1lbnQoZWxlbWVudCwgeE9mZnNldCwgeU9mZnNldCwgc3BlZWQpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHRoaXMuZmFrZUZsaWNrKHhTcGVlZCwgeVNwZWVkKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZHJhZyA9IGFzeW5jIGZ1bmN0aW9uIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHRvdWNoQ291bnQsIGVsZW1lbnRJZCwgZGVzdEVsSWQpIHtcbiAgbGV0IGRyYWdPcHRzID0ge1xuICAgIGVsZW1lbnRJZCwgZGVzdEVsSWQsIHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLFxuICAgIHN0ZXBzOiBNYXRoLnJvdW5kKGR1cmF0aW9uICogZHJhZ1N0ZXBzUGVyU2VjKVxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5kb0RyYWcoZHJhZ09wdHMpO1xuXG59O1xuXG5jb21tYW5kcy5kb0RyYWcgPSBhc3luYyBmdW5jdGlvbiAoZHJhZ09wdHMpIHtcbiAgaWYgKHV0aWwuaGFzVmFsdWUoZHJhZ09wdHMuZWxlbWVudElkKSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpkcmFnXCIsIGRyYWdPcHRzKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImRyYWdcIiwgZHJhZ09wdHMpO1xuICB9XG59O1xuXG5jb21tYW5kcy5sb2NrID0gYXN5bmMgZnVuY3Rpb24gKHNlY29uZHMpIHtcbiAgYXdhaXQgdGhpcy5hZGIubG9jaygpO1xuICBpZiAoaXNOYU4oc2Vjb25kcykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmbG9hdFNlY29uZHMgPSBwYXJzZUZsb2F0KHNlY29uZHMpO1xuICBpZiAoZmxvYXRTZWNvbmRzIDw9IDApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgQi5kZWxheSgxMDAwICogZmxvYXRTZWNvbmRzKTtcbiAgYXdhaXQgdGhpcy51bmxvY2soKTtcbn07XG5cbmNvbW1hbmRzLmlzTG9ja2VkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuaXNTY3JlZW5Mb2NrZWQoKTtcbn07XG5cbmNvbW1hbmRzLnVubG9jayA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IGFuZHJvaWRIZWxwZXJzLnVubG9jayh0aGlzLCB0aGlzLmFkYiwgdGhpcy5jYXBzKTtcbn07XG5cbmNvbW1hbmRzLm9wZW5Ob3RpZmljYXRpb25zID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcIm9wZW5Ob3RpZmljYXRpb25cIik7XG59O1xuXG5jb21tYW5kcy5zZXRMb2NhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChsYXRpdHVkZSwgbG9uZ2l0dWRlKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmFkYi5zZW5kVGVsbmV0Q29tbWFuZChgZ2VvIGZpeCAke2xvbmdpdHVkZX0gJHtsYXRpdHVkZX1gKTtcbn07XG5cbmZ1bmN0aW9uIHBhcnNlQ29udGFpbmVyUGF0aCAocmVtb3RlUGF0aCkge1xuICBjb25zdCBtYXRjaCA9IENPTlRBSU5FUl9QQVRIX1BBVFRFUk4uZXhlYyhyZW1vdGVQYXRoKTtcbiAgaWYgKCFtYXRjaCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBJdCBpcyBleHBlY3RlZCB0aGF0IHBhY2thZ2UgaWRlbnRpZmllciBpcyBzZXBhcmF0ZWQgZnJvbSB0aGUgcmVsYXRpdmUgcGF0aCB3aXRoIGEgc2luZ2xlIHNsYXNoLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICByZXR1cm4gW21hdGNoWzFdLCBwYXRoLnBvc2l4LnJlc29sdmUoYC9kYXRhL2RhdGEvJHttYXRjaFsxXX1gLCBtYXRjaFsyXSldO1xufVxuXG5jb21tYW5kcy5wdWxsRmlsZSA9IGFzeW5jIGZ1bmN0aW9uIChyZW1vdGVQYXRoKSB7XG4gIGlmIChyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSXQgaXMgZXhwZWN0ZWQgdGhhdCByZW1vdGUgcGF0aCBwb2ludHMgdG8gYSBmaWxlIGFuZCBub3QgdG8gYSBmb2xkZXIuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAnJHtyZW1vdGVQYXRofScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGxldCB0bXBEZXN0aW5hdGlvbiA9IG51bGw7XG4gIGlmIChyZW1vdGVQYXRoLnN0YXJ0c1dpdGgoQ09OVEFJTkVSX1BBVEhfTUFSS0VSKSkge1xuICAgIGNvbnN0IFtwYWNrYWdlSWQsIHBhdGhJbkNvbnRhaW5lcl0gPSBwYXJzZUNvbnRhaW5lclBhdGgocmVtb3RlUGF0aCk7XG4gICAgbG9nLmluZm8oYFBhcnNlZCBwYWNrYWdlIGlkZW50aWZpZXIgJyR7cGFja2FnZUlkfScgZnJvbSAnJHtyZW1vdGVQYXRofScuIFdpbGwgZ2V0IHRoZSBkYXRhIGZyb20gJyR7cGF0aEluQ29udGFpbmVyfSdgKTtcbiAgICB0bXBEZXN0aW5hdGlvbiA9IGAvZGF0YS9sb2NhbC90bXAvJHtwYXRoLnBvc2l4LmJhc2VuYW1lKHBhdGhJbkNvbnRhaW5lcil9YDtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydydW4tYXMnLCBwYWNrYWdlSWQsIGBjaG1vZCA3NzcgJyR7cGF0aEluQ29udGFpbmVyLnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKX0nYF0pO1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydjcCcsICctZicsIHBhdGhJbkNvbnRhaW5lciwgdG1wRGVzdGluYXRpb25dKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ2Fubm90IGFjY2VzcyB0aGUgY29udGFpbmVyIG9mICcke3BhY2thZ2VJZH0nIGFwcGxpY2F0aW9uLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBJcyB0aGUgYXBwbGljYXRpb24gaW5zdGFsbGVkIGFuZCBoYXMgJ2RlYnVnZ2FibGUnIGJ1aWxkIG9wdGlvbiBzZXQgdG8gdHJ1ZT8gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuICBjb25zdCBsb2NhbEZpbGUgPSB0ZW1wLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy50bXAnfSk7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5hZGIucHVsbChfLmlzU3RyaW5nKHRtcERlc3RpbmF0aW9uKSA/IHRtcERlc3RpbmF0aW9uIDogcmVtb3RlUGF0aCwgbG9jYWxGaWxlKTtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZnMucmVhZEZpbGUobG9jYWxGaWxlKTtcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oZGF0YSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICB9IGZpbmFsbHkge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYWxGaWxlKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKGxvY2FsRmlsZSk7XG4gICAgfVxuICAgIGlmIChfLmlzU3RyaW5nKHRtcERlc3RpbmF0aW9uKSkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydybScsICctZicsIHRtcERlc3RpbmF0aW9uXSk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5wdXNoRmlsZSA9IGFzeW5jIGZ1bmN0aW9uIChyZW1vdGVQYXRoLCBiYXNlNjREYXRhKSB7XG4gIGlmIChyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSXQgaXMgZXhwZWN0ZWQgdGhhdCByZW1vdGUgcGF0aCBwb2ludHMgdG8gYSBmaWxlIGFuZCBub3QgdG8gYSBmb2xkZXIuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAnJHtyZW1vdGVQYXRofScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGNvbnN0IGxvY2FsRmlsZSA9IHRlbXAucGF0aCh7cHJlZml4OiAnYXBwaXVtJywgc3VmZml4OiAnLnRtcCd9KTtcbiAgaWYgKF8uaXNBcnJheShiYXNlNjREYXRhKSkge1xuICAgIC8vIHNvbWUgY2xpZW50cyAoYWhlbSkgamF2YSwgc2VuZCBhIGJ5dGUgYXJyYXkgZW5jb2RpbmcgdXRmOCBjaGFyYWN0ZXJzXG4gICAgLy8gaW5zdGVhZCBvZiBhIHN0cmluZywgd2hpY2ggd291bGQgYmUgaW5maW5pdGVseSBiZXR0ZXIhXG4gICAgYmFzZTY0RGF0YSA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEpLnRvU3RyaW5nKCd1dGY4Jyk7XG4gIH1cbiAgY29uc3QgY29udGVudCA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcbiAgbGV0IHRtcERlc3RpbmF0aW9uID0gbnVsbDtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUobG9jYWxGaWxlLCBjb250ZW50LnRvU3RyaW5nKCdiaW5hcnknKSwgJ2JpbmFyeScpO1xuICAgIGlmIChyZW1vdGVQYXRoLnN0YXJ0c1dpdGgoQ09OVEFJTkVSX1BBVEhfTUFSS0VSKSkge1xuICAgICAgY29uc3QgW3BhY2thZ2VJZCwgcGF0aEluQ29udGFpbmVyXSA9IHBhcnNlQ29udGFpbmVyUGF0aChyZW1vdGVQYXRoKTtcbiAgICAgIGxvZy5pbmZvKGBQYXJzZWQgcGFja2FnZSBpZGVudGlmaWVyICcke3BhY2thZ2VJZH0nIGZyb20gJyR7cmVtb3RlUGF0aH0nLiBXaWxsIHB1dCB0aGUgZGF0YSBpbnRvICcke3BhdGhJbkNvbnRhaW5lcn0nYCk7XG4gICAgICB0bXBEZXN0aW5hdGlvbiA9IGAvZGF0YS9sb2NhbC90bXAvJHtwYXRoLnBvc2l4LmJhc2VuYW1lKHBhdGhJbkNvbnRhaW5lcil9YDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFxuICAgICAgICAgIFsncnVuLWFzJywgcGFja2FnZUlkLCBgbWtkaXIgLXAgJyR7cGF0aC5wb3NpeC5kaXJuYW1lKHBhdGhJbkNvbnRhaW5lcikucmVwbGFjZSgvJy9nLCAnXFxcXFxcJycpfSdgXVxuICAgICAgICApO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ3J1bi1hcycsIHBhY2thZ2VJZCwgYHRvdWNoICcke3BhdGhJbkNvbnRhaW5lci5yZXBsYWNlKC8nL2csICdcXFxcXFwnJyl9J2BdKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydydW4tYXMnLCBwYWNrYWdlSWQsIGBjaG1vZCA3NzcgJyR7cGF0aEluQ29udGFpbmVyLnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKX0nYF0pO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5wdXNoKGxvY2FsRmlsZSwgdG1wRGVzdGluYXRpb24pO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2NwJywgJy1mJywgdG1wRGVzdGluYXRpb24sIHBhdGhJbkNvbnRhaW5lcl0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ2Fubm90IGFjY2VzcyB0aGUgY29udGFpbmVyIG9mICcke3BhY2thZ2VJZH0nIGFwcGxpY2F0aW9uLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYElzIHRoZSBhcHBsaWNhdGlvbiBpbnN0YWxsZWQgYW5kIGhhcyAnZGVidWdnYWJsZScgYnVpbGQgb3B0aW9uIHNldCB0byB0cnVlPyBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYWRiIHB1c2ggY3JlYXRlcyBmb2xkZXJzIGFuZCBvdmVyd3JpdGVzIGV4aXN0aW5nIGZpbGVzLlxuICAgICAgYXdhaXQgdGhpcy5hZGIucHVzaChsb2NhbEZpbGUsIHJlbW90ZVBhdGgpO1xuXG4gICAgICAvLyBpZiB3ZSBoYXZlIHB1c2hlZCBhIGZpbGUsIGl0IG1pZ2h0IGJlIGEgbWVkaWEgZmlsZSwgc28gZW5zdXJlIHRoYXRcbiAgICAgIC8vIGFwcHMga25vdyBhYm91dCBpdFxuICAgICAgbG9nLmluZm8oXCJBZnRlciBwdXNoaW5nIG1lZGlhIGZpbGUsIGJyb2FkY2FzdGluZyBtZWRpYSBzY2FuIGludGVudFwiKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnYW0nLCAnYnJvYWRjYXN0JywgJy1hJyxcbiAgICAgICAgICBBTkRST0lEX01FRElBX1JFU0NBTl9JTlRFTlQsICctZCcsIGBmaWxlOi8vJHtyZW1vdGVQYXRofWBdKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLndhcm4oYEdvdCBlcnJvciBicm9hZGNhc3RpbmcgbWVkaWEgc2NhbiBpbnRlbnQ6ICR7ZS5tZXNzYWdlfTsgaWdub3JpbmdgKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbEZpbGUpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsobG9jYWxGaWxlKTtcbiAgICB9XG4gICAgaWYgKF8uaXNTdHJpbmcodG1wRGVzdGluYXRpb24pKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ3JtJywgJy1mJywgdG1wRGVzdGluYXRpb25dKTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbW1hbmRzLnB1bGxGb2xkZXIgPSBhc3luYyBmdW5jdGlvbiAocmVtb3RlUGF0aCkge1xuICBsZXQgbG9jYWxGb2xkZXIgPSB0ZW1wLnBhdGgoe3ByZWZpeDogJ2FwcGl1bSd9KTtcbiAgYXdhaXQgdGhpcy5hZGIucHVsbChyZW1vdGVQYXRoLCBsb2NhbEZvbGRlcik7XG4gIHJldHVybiAoYXdhaXQgemlwLnRvSW5NZW1vcnlaaXAobG9jYWxGb2xkZXIpKS50b1N0cmluZygnYmFzZTY0Jyk7XG59O1xuXG5jb21tYW5kcy5maW5nZXJwcmludCA9IGFzeW5jIGZ1bmN0aW9uIChmaW5nZXJwcmludElkKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcImZpbmdlcnByaW50IG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzXCIpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLmZpbmdlcnByaW50KGZpbmdlcnByaW50SWQpO1xufTtcblxuY29tbWFuZHMuc2VuZFNNUyA9IGFzeW5jIGZ1bmN0aW9uIChwaG9uZU51bWJlciwgbWVzc2FnZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coXCJzZW5kU01TIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzXCIpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLnNlbmRTTVMocGhvbmVOdW1iZXIsIG1lc3NhZ2UpO1xufTtcblxuY29tbWFuZHMuZ3NtQ2FsbCA9IGFzeW5jIGZ1bmN0aW9uIChwaG9uZU51bWJlciwgYWN0aW9uKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcImdzbUNhbGwgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnNcIik7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuZ3NtQ2FsbChwaG9uZU51bWJlciwgYWN0aW9uKTtcbn07XG5cbmNvbW1hbmRzLmdzbVNpZ25hbCA9IGFzeW5jIGZ1bmN0aW9uIChzaWduYWxTdHJlbmdoKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcImdzbVNpZ25hbCBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9yc1wiKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21TaWduYWwoc2lnbmFsU3RyZW5naCk7XG59O1xuXG5jb21tYW5kcy5nc21Wb2ljZSA9IGFzeW5jIGZ1bmN0aW9uIChzdGF0ZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coXCJnc21Wb2ljZSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9yc1wiKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21Wb2ljZShzdGF0ZSk7XG59O1xuXG5jb21tYW5kcy5wb3dlckFDID0gYXN5bmMgZnVuY3Rpb24gKHN0YXRlKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcInBvd2VyQUMgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnNcIik7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIucG93ZXJBQyhzdGF0ZSk7XG59O1xuXG5jb21tYW5kcy5wb3dlckNhcGFjaXR5ID0gYXN5bmMgZnVuY3Rpb24gKGJhdHRlcnlQZXJjZW50KSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcInBvd2VyQ2FwYWNpdHkgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnNcIik7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIucG93ZXJDYXBhY2l0eShiYXR0ZXJ5UGVyY2VudCk7XG59O1xuXG5jb21tYW5kcy5uZXR3b3JrU3BlZWQgPSBhc3luYyBmdW5jdGlvbiAobmV0d29ya1NwZWVkKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhcIm5ldHdvcmtTcGVlZCBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9yc1wiKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5uZXR3b3JrU3BlZWQobmV0d29ya1NwZWVkKTtcbn07XG5cbmhlbHBlcnMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwgPSBhc3luYyBmdW5jdGlvbiAoYWRiLCBvcHRzKSB7XG4gIGNvbnN0IGxvY2FsRmlsZSA9IHRlbXAucGF0aCh7cHJlZml4OiAnYXBwaXVtJywgc3VmZml4OiAnLnBuZyd9KTtcbiAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbEZpbGUpKSB7XG4gICAgYXdhaXQgZnMudW5saW5rKGxvY2FsRmlsZSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zdCBwbmdEaXIgPSBvcHRzLmFuZHJvaWRTY3JlZW5zaG90UGF0aCB8fCAnL2RhdGEvbG9jYWwvdG1wLyc7XG4gICAgY29uc3QgcG5nID0gcGF0aC5wb3NpeC5yZXNvbHZlKHBuZ0RpciwgJ3NjcmVlbnNob3QucG5nJyk7XG4gICAgY29uc3QgY21kID0gWycvc3lzdGVtL2Jpbi9ybScsIGAke3BuZ307YCwgJy9zeXN0ZW0vYmluL3NjcmVlbmNhcCcsICctcCcsIHBuZ107XG4gICAgYXdhaXQgYWRiLnNoZWxsKGNtZCk7XG4gICAgaWYgKCFhd2FpdCBhZGIuZmlsZVNpemUocG5nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc2l6ZSBvZiB0aGUgdGFrZW4gc2NyZWVuc2hvdCBlcXVhbHMgdG8gemVyby4nKTtcbiAgICB9XG4gICAgYXdhaXQgYWRiLnB1bGwocG5nLCBsb2NhbEZpbGUpO1xuICAgIHJldHVybiBhd2FpdCBqaW1wLnJlYWQobG9jYWxGaWxlKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy5nZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJFeGVjT3V0ID0gYXN5bmMgZnVuY3Rpb24gKGFkYikge1xuICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoYWRiLmV4ZWN1dGFibGUucGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYi5leGVjdXRhYmxlLmRlZmF1bHRBcmdzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jb25jYXQoWydleGVjLW91dCcsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZW5jb2Rpbmc6ICdiaW5hcnknLCBpc0J1ZmZlcjogdHJ1ZX0pO1xuICAvLyBpZiB0aGVyZSBpcyBhbiBlcnJvciwgdGhyb3dcbiAgaWYgKGNvZGUgfHwgc3RkZXJyLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgU2NyZWVuc2hvdCByZXR1cm5lZCBlcnJvciwgY29kZTogJyR7Y29kZX0nLCBzdGRlcnI6ICcke3N0ZGVyci50b1N0cmluZygpfSdgKTtcbiAgfVxuICAvLyBpZiB3ZSBkb24ndCBnZXQgYW55dGhpbmcgYXQgYWxsLCB0aHJvd1xuICBpZiAoIXN0ZG91dC5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NjcmVlbnNob3QgcmV0dXJuZWQgbm8gZGF0YScpO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGppbXAucmVhZChzdGRvdXQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2NyZWVuc2hvdCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmFkYi5nZXRBcGlMZXZlbCgpO1xuICBsZXQgaW1hZ2UgPSBudWxsO1xuICBpZiAoYXBpTGV2ZWwgPiAyMCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIHNjcmVlbnNob3RpbmcgYXBwcm9hY2ggaXMgd2F5IGZhc3Rlciwgc2luY2UgaXQgcmVxdWlyZXMgbGVzcyBleHRlcm5hbCBjb21tYW5kc1xuICAgICAgLy8gdG8gYmUgZXhlY3V0ZWQuIFVuZm9ydHVuYXRlbHksIGV4ZWMtb3V0IG9wdGlvbiBpcyBvbmx5IHN1cHBvcnRlZCBieSBuZXdlciBBbmRyb2lkL1NESyB2ZXJzaW9ucyAoNS4wIGFuZCBsYXRlcilcbiAgICAgIGltYWdlID0gYXdhaXQgdGhpcy5nZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJFeGVjT3V0KHRoaXMuYWRiKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cuaW5mbyhgQ2Fubm90IGdldCBzY3JlZW5zaG90IGRhdGEgd2l0aCAnYWRiIGV4ZWMtb3V0JyBiZWNhdXNlIG9mICcke2UubWVzc2FnZX0nLiBgICtcbiAgICAgICAgICAgICAgIGBEZWZhdWx0aW5nIHRvICdhZGIgc2hlbGwnIGNhbGxgKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFpbWFnZSkge1xuICAgIHRyeSB7XG4gICAgICBpbWFnZSA9IGF3YWl0IHRoaXMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwodGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc3QgZXJyID0gYENhbm5vdCBnZXQgc2NyZWVuc2hvdCBkYXRhIGJlY2F1c2Ugb2YgJyR7ZS5tZXNzYWdlfScuIGAgK1xuICAgICAgICAgICAgICAgICAgYE1ha2Ugc3VyZSB0aGUgJ0xheW91dFBhcmFtcy5GTEFHX1NFQ1VSRScgaXMgbm90IHNldCBmb3IgYCArXG4gICAgICAgICAgICAgICAgICBgdGhlIGN1cnJlbnQgdmlld2A7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlcnIpO1xuICAgIH1cbiAgfVxuICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgIC8vIEFuZHJvaWQgYnVnIDg0MzM3NDIgLSByb3RhdGUgc2NyZWVuc2hvdCBpZiBzY3JlZW4gaXMgcm90YXRlZFxuICAgIGxldCBzY3JlZW5PcmllbnRhdGlvbiA9IGF3YWl0IHRoaXMuYWRiLmdldFNjcmVlbk9yaWVudGF0aW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgIGltYWdlID0gYXdhaXQgaW1hZ2Uucm90YXRlKC05MCAqIHNjcmVlbk9yaWVudGF0aW9uKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3Qgcm90YXRlIHNjcmVlbnNob3QgZHVlIHRvIGVycm9yOiAke2Vycn1gKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgZ2V0QnVmZmVyID0gQi5wcm9taXNpZnkoaW1hZ2UuZ2V0QnVmZmVyLCB7Y29udGV4dDogaW1hZ2V9KTtcbiAgY29uc3QgaW1nQnVmZmVyID0gYXdhaXQgZ2V0QnVmZmVyKGppbXAuTUlNRV9QTkcpO1xuICByZXR1cm4gaW1nQnVmZmVyLnRvU3RyaW5nKCdiYXNlNjQnKTtcbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9hY3Rpb25zLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
