"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseWindows = parseWindows;
exports.parseSurfaceLine = parseSurfaceLine;
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _logger = _interopRequireDefault(require("../logger"));

var _webviewHelpers = require("../webview-helpers");

var _moment = _interopRequireDefault(require("moment"));

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keys = async function (keys) {
  keys = _lodash.default.isArray(keys) ? keys.join('') : keys;
  let params = {
    text: keys,
    replace: false
  };

  if (this.opts.unicodeKeyboard) {
    params.unicodeKeyboard = true;
  }

  await this.doSendKeys(params);
};

commands.doSendKeys = async function (params) {
  return await this.bootstrap.sendAction('setText', params);
};

const DEFAULT_DEVICE_TIME = 'YYYY-MM-DDTHH:mm:ssZ';

commands.getDeviceTime = async function (format = DEFAULT_DEVICE_TIME) {
  _logger.default.info('Attempting to capture android device date and time');

  if (!_lodash.default.isString(format)) {
    _logger.default.errorAndThrow(`The format specifier is expected to be a valid string specifier like '${DEFAULT_DEVICE_TIME}'. ` + `The current value is: ${format}`);
  }

  const deviceTimestamp = (await this.adb.shell(['date', '+%Y-%m-%dT%T%z'])).trim();
  const parsedTimestamp = (0, _moment.default)(deviceTimestamp, 'YYYY-MM-DDTHH:mm:ssZ');

  if (!parsedTimestamp.isValid()) {
    _logger.default.warn(`Cannot parse the returned timestamp '${deviceTimestamp}'. Returning as is`);

    return deviceTimestamp;
  }

  return parsedTimestamp.format(format);
};

commands.getPageSource = async function () {
  return await this.bootstrap.sendAction('source');
};

commands.back = async function () {
  return await this.bootstrap.sendAction('pressBack');
};

commands.isKeyboardShown = async function () {
  let keyboardInfo = await this.adb.isSoftKeyboardPresent();
  return keyboardInfo.isKeyboardShown;
};

commands.hideKeyboard = async function () {
  let {
    isKeyboardShown,
    canCloseKeyboard
  } = await this.adb.isSoftKeyboardPresent();

  if (!isKeyboardShown) {
    _logger.default.info('Keyboard has no UI; no closing necessary');

    return;
  }

  for (const keyCode of [111, 4]) {
    if (canCloseKeyboard) {
      await this.adb.keyevent(keyCode);
    }

    try {
      return await (0, _asyncbox.waitForCondition)(async () => {
        ({
          isKeyboardShown
        } = await this.adb.isSoftKeyboardPresent());
        return !isKeyboardShown;
      }, {
        waitMs: 1000,
        intervalMs: 500
      });
    } catch (ign) {}
  }

  throw new Error(`The software keyboard cannot be closed`);
};

commands.openSettingsActivity = async function (setting) {
  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.shell(['am', 'start', '-a', `android.settings.${setting}`]);
  await this.adb.waitForNotActivity(appPackage, appActivity, 5000);
};

commands.getWindowSize = async function () {
  return await this.bootstrap.sendAction('getDeviceSize');
};

commands.getWindowRect = async function () {
  const {
    width,
    height
  } = await this.getWindowSize();
  return {
    width,
    height,
    x: 0,
    y: 0
  };
};

commands.getCurrentActivity = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appActivity;
};

commands.getCurrentPackage = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appPackage;
};

commands.background = async function (seconds) {
  if (seconds < 0) {
    await this.adb.goToHome();
    return true;
  }

  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.goToHome();
  await _bluebird.default.delay(seconds * 1000);
  let args;

  if (this._cachedActivityArgs && this._cachedActivityArgs[`${appPackage}/${appActivity}`]) {
    args = this._cachedActivityArgs[`${appPackage}/${appActivity}`];
  } else {
    try {
      _logger.default.debug(`Activating app '${appPackage}' in order to restore it`);

      await this.activateApp(appPackage);
      return true;
    } catch (ign) {}

    args = appPackage === this.opts.appPackage && appActivity === this.opts.appActivity || appPackage === this.opts.appWaitPackage && (this.opts.appWaitActivity || '').split(',').includes(appActivity) ? {
      pkg: this.opts.appPackage,
      activity: this.opts.appActivity,
      action: this.opts.intentAction,
      category: this.opts.intentCategory,
      flags: this.opts.intentFlags,
      waitPkg: this.opts.appWaitPackage,
      waitActivity: this.opts.appWaitActivity,
      optionalIntentArguments: this.opts.optionalIntentArguments,
      stopApp: false,
      user: this.opts.userProfile
    } : {
      pkg: appPackage,
      activity: appActivity,
      waitPkg: appPackage,
      waitActivity: appActivity,
      stopApp: false
    };
  }

  args = await _appiumSupport.util.filterObject(args);

  _logger.default.debug(`Bringing application back to foreground with arguments: ${JSON.stringify(args)}`);

  return await this.adb.startApp(args);
};

commands.getStrings = async function (language) {
  if (!language) {
    language = await this.adb.getDeviceLanguage();

    _logger.default.info(`No language specified, returning strings for: ${language}`);
  }

  const preprocessStringsMap = mapping => {
    const result = {};

    for (const [key, value] of _lodash.default.toPairs(mapping)) {
      result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    return result;
  };

  if (this.apkStrings[language]) {
    return preprocessStringsMap(this.apkStrings[language]);
  }

  this.apkStrings[language] = await _androidHelpers.default.pushStrings(language, this.adb, this.opts);

  if (this.bootstrap) {
    await this.bootstrap.sendAction('updateStrings');
  }

  return preprocessStringsMap(this.apkStrings[language]);
};

commands.launchApp = async function () {
  await this.initAUT();
  await this.startAUT();
};

commands.startActivity = async function (appPackage, appActivity, appWaitPackage, appWaitActivity, intentAction, intentCategory, intentFlags, optionalIntentArguments, dontStopAppOnReset) {
  _logger.default.debug(`Starting package '${appPackage}' and activity '${appActivity}'`);

  if (!_appiumSupport.util.hasValue(dontStopAppOnReset)) {
    dontStopAppOnReset = !!this.opts.dontStopAppOnReset;
  }

  let args = {
    pkg: appPackage,
    activity: appActivity,
    waitPkg: appWaitPackage || appPackage,
    waitActivity: appWaitActivity || appActivity,
    action: intentAction,
    category: intentCategory,
    flags: intentFlags,
    optionalIntentArguments,
    stopApp: !dontStopAppOnReset
  };
  this._cachedActivityArgs = this._cachedActivityArgs || {};
  this._cachedActivityArgs[`${args.waitPkg}/${args.waitActivity}`] = args;
  await this.adb.startApp(args);
};

commands.reset = async function () {
  await _androidHelpers.default.resetApp(this.adb, Object.assign({}, this.opts, {
    fastReset: true
  }));
  this.curContext = _webviewHelpers.NATIVE_WIN;
  return (await this.isChromeSession) ? this.startChromeSession() : this.startAUT();
};

commands.startAUT = async function () {
  await this.adb.startApp({
    pkg: this.opts.appPackage,
    activity: this.opts.appActivity,
    action: this.opts.intentAction,
    category: this.opts.intentCategory,
    flags: this.opts.intentFlags,
    waitPkg: this.opts.appWaitPackage,
    waitActivity: this.opts.appWaitActivity,
    waitDuration: this.opts.appWaitDuration,
    optionalIntentArguments: this.opts.optionalIntentArguments,
    stopApp: !this.opts.dontStopAppOnReset,
    user: this.opts.userProfile
  });
};

commands.setUrl = async function (uri) {
  await this.adb.startUri(uri, this.opts.appPackage);
};

commands.closeApp = async function () {
  await this.adb.forceStop(this.opts.appPackage);
  this.curContext = _webviewHelpers.NATIVE_WIN;
  await this.stopChromedriverProxies();
};

commands.getDisplayDensity = async function () {
  let out = await this.adb.shell(['getprop', 'ro.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  out = await this.adb.shell(['getprop', 'qemu.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  _logger.default.errorAndThrow('Failed to get display density property.');
};

function parseSurfaceLine(line) {
  let bounds = line.split('rect=')[1].replace(/[(), x]+/g, ' ').trim().split(' ');
  return {
    visible: line.indexOf('shown=true') !== -1,
    x: parseFloat(bounds[0]),
    y: parseFloat(bounds[1]),
    width: parseFloat(bounds[2]),
    height: parseFloat(bounds[3])
  };
}

function parseWindows(lines) {
  let atStatusBar = false;
  let atNavBar = false;
  let statusBar;
  let navigationBar;
  lines.split('\n').forEach(line => {
    if (line.indexOf('  Window #') !== -1) {
      atStatusBar = line.indexOf('StatusBar') !== -1;
      atNavBar = line.indexOf('NavigationBar') !== -1;
      return;
    }

    if (line.indexOf('      Surface:') === -1) {
      return;
    }

    if (atStatusBar) {
      statusBar = parseSurfaceLine(line);
      atStatusBar = false;
    } else if (atNavBar) {
      navigationBar = parseSurfaceLine(line);
      atNavBar = false;
    }
  });

  if (!statusBar) {
    _logger.default.errorAndThrow('Failed to parse status bar information.');
  }

  if (!navigationBar) {
    _logger.default.errorAndThrow('Failed to parse navigation bar information.');
  }

  return {
    statusBar,
    navigationBar
  };
}

commands.getSystemBars = async function () {
  let out = await this.adb.shell(['dumpsys', 'window', 'windows']);

  if (!out) {
    _logger.default.errorAndThrow('Did not get window manager output.');
  }

  return parseWindows(out);
};

commands.mobilePerformEditorAction = async function (opts = {}) {
  const {
    action
  } = opts;

  if (!_appiumSupport.util.hasValue(action)) {
    _logger.default.errorAndThrow(`'action' argument is required`);
  }

  await this.adb.performEditorAction(action);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJrZXlzIiwiXyIsImlzQXJyYXkiLCJqb2luIiwicGFyYW1zIiwidGV4dCIsInJlcGxhY2UiLCJvcHRzIiwidW5pY29kZUtleWJvYXJkIiwiZG9TZW5kS2V5cyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJERUZBVUxUX0RFVklDRV9USU1FIiwiZ2V0RGV2aWNlVGltZSIsImZvcm1hdCIsImxvZyIsImluZm8iLCJpc1N0cmluZyIsImVycm9yQW5kVGhyb3ciLCJkZXZpY2VUaW1lc3RhbXAiLCJhZGIiLCJzaGVsbCIsInRyaW0iLCJwYXJzZWRUaW1lc3RhbXAiLCJpc1ZhbGlkIiwid2FybiIsImdldFBhZ2VTb3VyY2UiLCJiYWNrIiwiaXNLZXlib2FyZFNob3duIiwia2V5Ym9hcmRJbmZvIiwiaXNTb2Z0S2V5Ym9hcmRQcmVzZW50IiwiaGlkZUtleWJvYXJkIiwiY2FuQ2xvc2VLZXlib2FyZCIsImtleUNvZGUiLCJrZXlldmVudCIsIndhaXRNcyIsImludGVydmFsTXMiLCJpZ24iLCJFcnJvciIsIm9wZW5TZXR0aW5nc0FjdGl2aXR5Iiwic2V0dGluZyIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsImdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkiLCJ3YWl0Rm9yTm90QWN0aXZpdHkiLCJnZXRXaW5kb3dTaXplIiwiZ2V0V2luZG93UmVjdCIsIndpZHRoIiwiaGVpZ2h0IiwieCIsInkiLCJnZXRDdXJyZW50QWN0aXZpdHkiLCJnZXRDdXJyZW50UGFja2FnZSIsImJhY2tncm91bmQiLCJzZWNvbmRzIiwiZ29Ub0hvbWUiLCJCIiwiZGVsYXkiLCJhcmdzIiwiX2NhY2hlZEFjdGl2aXR5QXJncyIsImRlYnVnIiwiYWN0aXZhdGVBcHAiLCJhcHBXYWl0UGFja2FnZSIsImFwcFdhaXRBY3Rpdml0eSIsInNwbGl0IiwiaW5jbHVkZXMiLCJwa2ciLCJhY3Rpdml0eSIsImFjdGlvbiIsImludGVudEFjdGlvbiIsImNhdGVnb3J5IiwiaW50ZW50Q2F0ZWdvcnkiLCJmbGFncyIsImludGVudEZsYWdzIiwid2FpdFBrZyIsIndhaXRBY3Rpdml0eSIsIm9wdGlvbmFsSW50ZW50QXJndW1lbnRzIiwic3RvcEFwcCIsInVzZXIiLCJ1c2VyUHJvZmlsZSIsInV0aWwiLCJmaWx0ZXJPYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhcnRBcHAiLCJnZXRTdHJpbmdzIiwibGFuZ3VhZ2UiLCJnZXREZXZpY2VMYW5ndWFnZSIsInByZXByb2Nlc3NTdHJpbmdzTWFwIiwibWFwcGluZyIsInJlc3VsdCIsImtleSIsInZhbHVlIiwidG9QYWlycyIsImFwa1N0cmluZ3MiLCJhbmRyb2lkSGVscGVycyIsInB1c2hTdHJpbmdzIiwibGF1bmNoQXBwIiwiaW5pdEFVVCIsInN0YXJ0QVVUIiwic3RhcnRBY3Rpdml0eSIsImRvbnRTdG9wQXBwT25SZXNldCIsImhhc1ZhbHVlIiwicmVzZXQiLCJyZXNldEFwcCIsIk9iamVjdCIsImFzc2lnbiIsImZhc3RSZXNldCIsImN1ckNvbnRleHQiLCJOQVRJVkVfV0lOIiwiaXNDaHJvbWVTZXNzaW9uIiwic3RhcnRDaHJvbWVTZXNzaW9uIiwid2FpdER1cmF0aW9uIiwiYXBwV2FpdER1cmF0aW9uIiwic2V0VXJsIiwidXJpIiwic3RhcnRVcmkiLCJjbG9zZUFwcCIsImZvcmNlU3RvcCIsInN0b3BDaHJvbWVkcml2ZXJQcm94aWVzIiwiZ2V0RGlzcGxheURlbnNpdHkiLCJvdXQiLCJ2YWwiLCJwYXJzZUludCIsImlzTmFOIiwicGFyc2VTdXJmYWNlTGluZSIsImxpbmUiLCJib3VuZHMiLCJ2aXNpYmxlIiwiaW5kZXhPZiIsInBhcnNlRmxvYXQiLCJwYXJzZVdpbmRvd3MiLCJsaW5lcyIsImF0U3RhdHVzQmFyIiwiYXROYXZCYXIiLCJzdGF0dXNCYXIiLCJuYXZpZ2F0aW9uQmFyIiwiZm9yRWFjaCIsImdldFN5c3Rl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SixDQUFrQiw2Q0FBbEI7QUFDRDs7QUFFRCxTQUFPO0FBQUNxSCxJQUFBQSxTQUFEO0FBQVlDLElBQUFBO0FBQVosR0FBUDtBQUNEOztBQUVEM0ksUUFBUSxDQUFDNkksYUFBVCxHQUF5QixrQkFBa0I7QUFDekMsTUFBSWpCLEdBQUcsR0FBRyxNQUFNLEtBQUtyRyxHQUFMLENBQVNDLEtBQVQsQ0FBZSxDQUFDLFNBQUQsRUFBWSxRQUFaLEVBQXNCLFNBQXRCLENBQWYsQ0FBaEI7O0FBQ0EsTUFBSSxDQUFDb0csR0FBTCxFQUFVO0FBQ1IxRyxvQkFBSUcsYUFBSixDQUFrQixvQ0FBbEI7QUFDRDs7QUFDRCxTQUFPaUgsWUFBWSxDQUFDVixHQUFELENBQW5CO0FBQ0QsQ0FORDs7QUFRQTVILFFBQVEsQ0FBQzhJLHlCQUFULEdBQXFDLGdCQUFnQnBJLElBQUksR0FBRyxFQUF2QixFQUEyQjtBQUM5RCxRQUFNO0FBQUM2RCxJQUFBQTtBQUFELE1BQVc3RCxJQUFqQjs7QUFDQSxNQUFJLENBQUN5RSxvQkFBS3NCLFFBQUwsQ0FBY2xDLE1BQWQsQ0FBTCxFQUE0QjtBQUMxQnJELG9CQUFJRyxhQUFKLENBQW1CLCtCQUFuQjtBQUNEOztBQUVELFFBQU0sS0FBS0UsR0FBTCxDQUFTd0gsbUJBQVQsQ0FBNkJ4RSxNQUE3QixDQUFOO0FBQ0QsQ0FQRDs7QUFTQXFDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjM0csVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgTkFUSVZFX1dJTiB9IGZyb20gJy4uL3dlYnZpZXctaGVscGVycyc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmtleXMgPSBhc3luYyBmdW5jdGlvbiAoa2V5cykge1xuICAvLyBQcm90b2NvbCBzZW5kcyBhbiBhcnJheTsgcmV0aGluayBhcHByb2FjaFxuICBrZXlzID0gXy5pc0FycmF5KGtleXMpID8ga2V5cy5qb2luKCcnKSA6IGtleXM7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgdGV4dDoga2V5cyxcbiAgICByZXBsYWNlOiBmYWxzZVxuICB9O1xuICBpZiAodGhpcy5vcHRzLnVuaWNvZGVLZXlib2FyZCkge1xuICAgIHBhcmFtcy51bmljb2RlS2V5Ym9hcmQgPSB0cnVlO1xuICB9XG4gIGF3YWl0IHRoaXMuZG9TZW5kS2V5cyhwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuZG9TZW5kS2V5cyA9IGFzeW5jIGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3NldFRleHQnLCBwYXJhbXMpO1xufTtcblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgZGV2aWNlJ3MgdGltZXN0YW1wLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtYXQgLSBUaGUgc2V0IG9mIGZvcm1hdCBzcGVjaWZpZXJzLiBSZWFkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cHM6Ly9tb21lbnRqcy5jb20vZG9jcy8gdG8gZ2V0IHRoZSBmdWxsIGxpc3Qgb2Ygc3VwcG9ydGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZXRpbWUgZm9ybWF0IHNwZWNpZmllcnMuIFRoZSBkZWZhdWx0IGZvcm1hdCBpc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgIGBZWVlZLU1NLUREVEhIOm1tOnNzWmAsIHdoaWNoIGNvbXBsaWVzIHRvIElTTy04NjAxXG4gKiBAcmV0dXJucyBGb3JtYXR0ZWQgZGF0ZXRpbWUgc3RyaW5nIG9yIHRoZSByYXcgY29tbWFuZCBvdXRwdXQgaWYgZm9ybWF0dGluZyBmYWlsc1xuICovXG5jb25zdCBERUZBVUxUX0RFVklDRV9USU1FID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJztcbmNvbW1hbmRzLmdldERldmljZVRpbWUgPSBhc3luYyBmdW5jdGlvbiAoZm9ybWF0ID0gREVGQVVMVF9ERVZJQ0VfVElNRSkge1xuICBsb2cuaW5mbygnQXR0ZW1wdGluZyB0byBjYXB0dXJlIGFuZHJvaWQgZGV2aWNlIGRhdGUgYW5kIHRpbWUnKTtcblxuICBpZiAoIV8uaXNTdHJpbmcoZm9ybWF0KSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBUaGUgZm9ybWF0IHNwZWNpZmllciBpcyBleHBlY3RlZCB0byBiZSBhIHZhbGlkIHN0cmluZyBzcGVjaWZpZXIgbGlrZSAnJHtERUZBVUxUX0RFVklDRV9USU1FfScuIGAgK1xuICAgICAgICBgVGhlIGN1cnJlbnQgdmFsdWUgaXM6ICR7Zm9ybWF0fWApO1xuICB9XG5cbiAgY29uc3QgZGV2aWNlVGltZXN0YW1wID0gKGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZGF0ZScsICcrJVktJW0tJWRUJVQleiddKSkudHJpbSgpO1xuICBjb25zdCBwYXJzZWRUaW1lc3RhbXAgPSBtb21lbnQoZGV2aWNlVGltZXN0YW1wLCAnWVlZWS1NTS1ERFRISDptbTpzc1onKTtcbiAgaWYgKCFwYXJzZWRUaW1lc3RhbXAuaXNWYWxpZCgpKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCBwYXJzZSB0aGUgcmV0dXJuZWQgdGltZXN0YW1wICcke2RldmljZVRpbWVzdGFtcH0nLiBSZXR1cm5pbmcgYXMgaXNgKTtcbiAgICByZXR1cm4gZGV2aWNlVGltZXN0YW1wO1xuICB9XG4gIHJldHVybiBwYXJzZWRUaW1lc3RhbXAuZm9ybWF0KGZvcm1hdCk7XG59O1xuXG5jb21tYW5kcy5nZXRQYWdlU291cmNlID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignc291cmNlJyk7XG59O1xuXG5jb21tYW5kcy5iYWNrID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigncHJlc3NCYWNrJyk7XG59O1xuXG5jb21tYW5kcy5pc0tleWJvYXJkU2hvd24gPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBrZXlib2FyZEluZm8gPSBhd2FpdCB0aGlzLmFkYi5pc1NvZnRLZXlib2FyZFByZXNlbnQoKTtcbiAgcmV0dXJuIGtleWJvYXJkSW5mby5pc0tleWJvYXJkU2hvd247XG59O1xuXG5jb21tYW5kcy5oaWRlS2V5Ym9hcmQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCB7aXNLZXlib2FyZFNob3duLCBjYW5DbG9zZUtleWJvYXJkfSA9IGF3YWl0IHRoaXMuYWRiLmlzU29mdEtleWJvYXJkUHJlc2VudCgpO1xuICBpZiAoIWlzS2V5Ym9hcmRTaG93bikge1xuICAgIGxvZy5pbmZvKCdLZXlib2FyZCBoYXMgbm8gVUk7IG5vIGNsb3NpbmcgbmVjZXNzYXJ5Jyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIFRyeSBFU0MgdGhlbiBCQUNLIGlmIHRoZSBmaXJzdCBvbmUgZmFpbHNcbiAgZm9yIChjb25zdCBrZXlDb2RlIG9mIFsxMTEsIDRdKSB7XG4gICAgaWYgKGNhbkNsb3NlS2V5Ym9hcmQpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmtleWV2ZW50KGtleUNvZGUpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAoe2lzS2V5Ym9hcmRTaG93bn0gPSBhd2FpdCB0aGlzLmFkYi5pc1NvZnRLZXlib2FyZFByZXNlbnQoKSk7XG4gICAgICAgIHJldHVybiAhaXNLZXlib2FyZFNob3duO1xuICAgICAgfSwge3dhaXRNczogMTAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9XG4gIHRocm93IG5ldyBFcnJvcihgVGhlIHNvZnR3YXJlIGtleWJvYXJkIGNhbm5vdCBiZSBjbG9zZWRgKTtcbn07XG5cbmNvbW1hbmRzLm9wZW5TZXR0aW5nc0FjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gKHNldHRpbmcpIHtcbiAgbGV0IHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnYW0nLCAnc3RhcnQnLCAnLWEnLCBgYW5kcm9pZC5zZXR0aW5ncy4ke3NldHRpbmd9YF0pO1xuICBhd2FpdCB0aGlzLmFkYi53YWl0Rm9yTm90QWN0aXZpdHkoYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksIDUwMDApO1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2dldERldmljZVNpemUnKTtcbn07XG5cbi8vIEZvciBXM0NcbmNvbW1hbmRzLmdldFdpbmRvd1JlY3QgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gYXdhaXQgdGhpcy5nZXRXaW5kb3dTaXplKCk7XG4gIHJldHVybiB7XG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICAgIHg6IDAsXG4gICAgeTogMFxuICB9O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gKGF3YWl0IHRoaXMuYWRiLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKSkuYXBwQWN0aXZpdHk7XG59O1xuXG5jb21tYW5kcy5nZXRDdXJyZW50UGFja2FnZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIChhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCkpLmFwcFBhY2thZ2U7XG59O1xuXG5jb21tYW5kcy5iYWNrZ3JvdW5kID0gYXN5bmMgZnVuY3Rpb24gKHNlY29uZHMpIHtcbiAgaWYgKHNlY29uZHMgPCAwKSB7XG4gICAgLy8gaWYgdXNlciBwYXNzZXMgaW4gYSBuZWdhdGl2ZSBzZWNvbmRzIHZhbHVlLCBpbnRlcnByZXQgdGhhdCBhcyB0aGUgaW5zdHJ1Y3Rpb25cbiAgICAvLyB0byBub3QgYnJpbmcgdGhlIGFwcCBiYWNrIGF0IGFsbFxuICAgIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbGV0IHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gIGF3YWl0IEIuZGVsYXkoc2Vjb25kcyAqIDEwMDApO1xuXG4gIGxldCBhcmdzO1xuICBpZiAodGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzICYmIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdKSB7XG4gICAgLy8gdGhlIGFjdGl2aXR5IHdhcyBzdGFydGVkIHdpdGggYHN0YXJ0QWN0aXZpdHlgLCBzbyB1c2UgdGhvc2UgYXJncyB0byByZXN0YXJ0XG4gICAgYXJncyA9IHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBsb2cuZGVidWcoYEFjdGl2YXRpbmcgYXBwICcke2FwcFBhY2thZ2V9JyBpbiBvcmRlciB0byByZXN0b3JlIGl0YCk7XG4gICAgICBhd2FpdCB0aGlzLmFjdGl2YXRlQXBwKGFwcFBhY2thZ2UpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIGFyZ3MgPSAoKGFwcFBhY2thZ2UgPT09IHRoaXMub3B0cy5hcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5ID09PSB0aGlzLm9wdHMuYXBwQWN0aXZpdHkpIHx8XG4gICAgICAgICAgICAoYXBwUGFja2FnZSA9PT0gdGhpcy5vcHRzLmFwcFdhaXRQYWNrYWdlICYmICh0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5IHx8ICcnKS5zcGxpdCgnLCcpLmluY2x1ZGVzKGFwcEFjdGl2aXR5KSkpXG4gICAgICA/IHsvLyB0aGUgYWN0aXZpdHkgaXMgdGhlIG9yaWdpbmFsIHNlc3Npb24gYWN0aXZpdHksIHNvIHVzZSB0aGUgb3JpZ2luYWwgYXJnc1xuICAgICAgICBwa2c6IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgICAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgICAgIGNhdGVnb3J5OiB0aGlzLm9wdHMuaW50ZW50Q2F0ZWdvcnksXG4gICAgICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICAgICAgd2FpdEFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5LFxuICAgICAgICBvcHRpb25hbEludGVudEFyZ3VtZW50czogdGhpcy5vcHRzLm9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgICAgICBzdG9wQXBwOiBmYWxzZSxcbiAgICAgICAgdXNlcjogdGhpcy5vcHRzLnVzZXJQcm9maWxlfVxuICAgICAgOiB7Ly8gdGhlIGFjdGl2aXR5IHdhcyBzdGFydGVkIHNvbWUgb3RoZXIgd2F5LCBzbyB1c2UgZGVmYXVsdHNcbiAgICAgICAgcGtnOiBhcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgICAgIHdhaXRQa2c6IGFwcFBhY2thZ2UsXG4gICAgICAgIHdhaXRBY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgICAgIHN0b3BBcHA6IGZhbHNlfTtcbiAgfVxuICBhcmdzID0gYXdhaXQgdXRpbC5maWx0ZXJPYmplY3QoYXJncyk7XG4gIGxvZy5kZWJ1ZyhgQnJpbmdpbmcgYXBwbGljYXRpb24gYmFjayB0byBmb3JlZ3JvdW5kIHdpdGggYXJndW1lbnRzOiAke0pTT04uc3RyaW5naWZ5KGFyZ3MpfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoYXJncyk7XG59O1xuXG5jb21tYW5kcy5nZXRTdHJpbmdzID0gYXN5bmMgZnVuY3Rpb24gKGxhbmd1YWdlKSB7XG4gIGlmICghbGFuZ3VhZ2UpIHtcbiAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuYWRiLmdldERldmljZUxhbmd1YWdlKCk7XG4gICAgbG9nLmluZm8oYE5vIGxhbmd1YWdlIHNwZWNpZmllZCwgcmV0dXJuaW5nIHN0cmluZ3MgZm9yOiAke2xhbmd1YWdlfWApO1xuICB9XG5cbiAgLy8gQ2xpZW50cyByZXF1aXJlIHRoZSByZXN1bHRpbmcgbWFwcGluZyB0byBoYXZlIGJvdGgga2V5c1xuICAvLyBhbmQgdmFsdWVzIG9mIHR5cGUgc3RyaW5nXG4gIGNvbnN0IHByZXByb2Nlc3NTdHJpbmdzTWFwID0gKG1hcHBpbmcpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMobWFwcGluZykpIHtcbiAgICAgIHJlc3VsdFtrZXldID0gXy5pc1N0cmluZyh2YWx1ZSkgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBpZiAodGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSkge1xuICAgIC8vIFJldHVybiBjYWNoZWQgc3RyaW5nc1xuICAgIHJldHVybiBwcmVwcm9jZXNzU3RyaW5nc01hcCh0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdKTtcbiAgfVxuXG4gIHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0gPSBhd2FpdCBhbmRyb2lkSGVscGVycy5wdXNoU3RyaW5ncyhsYW5ndWFnZSwgdGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gIGlmICh0aGlzLmJvb3RzdHJhcCkge1xuICAgIC8vIFRPRE86IFRoaXMgaXMgbXV0YXRpbmcgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UsIGJ1dCBpdCdzIGhvdyBhcHBpdW0gY3VycmVudGx5IHdvcmtzXG4gICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigndXBkYXRlU3RyaW5ncycpO1xuICB9XG5cbiAgcmV0dXJuIHByZXByb2Nlc3NTdHJpbmdzTWFwKHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0pO1xufTtcblxuY29tbWFuZHMubGF1bmNoQXBwID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBhd2FpdCB0aGlzLmluaXRBVVQoKTtcbiAgYXdhaXQgdGhpcy5zdGFydEFVVCgpO1xufTtcblxuY29tbWFuZHMuc3RhcnRBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIChhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSxcbiAgYXBwV2FpdFBhY2thZ2UsIGFwcFdhaXRBY3Rpdml0eSwgaW50ZW50QWN0aW9uLCBpbnRlbnRDYXRlZ29yeSwgaW50ZW50RmxhZ3MsXG4gIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLCBkb250U3RvcEFwcE9uUmVzZXQpIHtcbiAgbG9nLmRlYnVnKGBTdGFydGluZyBwYWNrYWdlICcke2FwcFBhY2thZ2V9JyBhbmQgYWN0aXZpdHkgJyR7YXBwQWN0aXZpdHl9J2ApO1xuXG4gIC8vIGRvbnRTdG9wQXBwT25SZXNldCBpcyBib3RoIGFuIGFyZ3VtZW50IGhlcmUsIGFuZCBhIGRlc2lyZWQgY2FwYWJpbGl0eVxuICAvLyBpZiB0aGUgYXJndW1lbnQgaXMgc2V0LCB1c2UgaXQsIG90aGVyd2lzZSB1c2UgdGhlIGNhcFxuICBpZiAoIXV0aWwuaGFzVmFsdWUoZG9udFN0b3BBcHBPblJlc2V0KSkge1xuICAgIGRvbnRTdG9wQXBwT25SZXNldCA9ICEhdGhpcy5vcHRzLmRvbnRTdG9wQXBwT25SZXNldDtcbiAgfVxuXG4gIGxldCBhcmdzID0ge1xuICAgIHBrZzogYXBwUGFja2FnZSxcbiAgICBhY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgd2FpdFBrZzogYXBwV2FpdFBhY2thZ2UgfHwgYXBwUGFja2FnZSxcbiAgICB3YWl0QWN0aXZpdHk6IGFwcFdhaXRBY3Rpdml0eSB8fCBhcHBBY3Rpdml0eSxcbiAgICBhY3Rpb246IGludGVudEFjdGlvbixcbiAgICBjYXRlZ29yeTogaW50ZW50Q2F0ZWdvcnksXG4gICAgZmxhZ3M6IGludGVudEZsYWdzLFxuICAgIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgIHN0b3BBcHA6ICFkb250U3RvcEFwcE9uUmVzZXRcbiAgfTtcbiAgdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzID0gdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzIHx8IHt9O1xuICB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXJncy53YWl0UGtnfS8ke2FyZ3Mud2FpdEFjdGl2aXR5fWBdID0gYXJncztcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoYXJncyk7XG59O1xuXG5jb21tYW5kcy5yZXNldCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgYW5kcm9pZEhlbHBlcnMucmVzZXRBcHAodGhpcy5hZGIsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0cywge2Zhc3RSZXNldDogdHJ1ZX0pKTtcbiAgLy8gcmVzZXQgY29udGV4dCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQga2luZCBvbiBjb250ZXh0IHdlIHdpbGwgZW5kIHVwIGFmdGVyIGFwcCBsYXVuY2guXG4gIHRoaXMuY3VyQ29udGV4dCA9IE5BVElWRV9XSU47XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMuaXNDaHJvbWVTZXNzaW9uID8gdGhpcy5zdGFydENocm9tZVNlc3Npb24oKSA6IHRoaXMuc3RhcnRBVVQoKTtcbn07XG5cbmNvbW1hbmRzLnN0YXJ0QVVUID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBhd2FpdCB0aGlzLmFkYi5zdGFydEFwcCh7XG4gICAgcGtnOiB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgIGFjdGlvbjogdGhpcy5vcHRzLmludGVudEFjdGlvbixcbiAgICBjYXRlZ29yeTogdGhpcy5vcHRzLmludGVudENhdGVnb3J5LFxuICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgd2FpdFBrZzogdGhpcy5vcHRzLmFwcFdhaXRQYWNrYWdlLFxuICAgIHdhaXRBY3Rpdml0eTogdGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSxcbiAgICB3YWl0RHVyYXRpb246IHRoaXMub3B0cy5hcHBXYWl0RHVyYXRpb24sXG4gICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHM6IHRoaXMub3B0cy5vcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICBzdG9wQXBwOiAhdGhpcy5vcHRzLmRvbnRTdG9wQXBwT25SZXNldCxcbiAgICB1c2VyOiB0aGlzLm9wdHMudXNlclByb2ZpbGUsXG4gIH0pO1xufTtcblxuLy8gd2Ugb3ZlcnJpZGUgc2V0VXJsIHRvIHRha2UgYW4gYW5kcm9pZCBVUkkgd2hpY2ggY2FuIGJlIHVzZWQgZm9yIGRlZXAtbGlua2luZ1xuLy8gaW5zaWRlIGFuIGFwcCwgc2ltaWxhciB0byBzdGFydGluZyBhbiBpbnRlbnRcbmNvbW1hbmRzLnNldFVybCA9IGFzeW5jIGZ1bmN0aW9uICh1cmkpIHtcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRVcmkodXJpLCB0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG59O1xuXG4vLyBjbG9zaW5nIGFwcCB1c2luZyBmb3JjZSBzdG9wXG5jb21tYW5kcy5jbG9zZUFwcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5hZGIuZm9yY2VTdG9wKHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbiAgLy8gcmVzZXQgY29udGV4dCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQga2luZCBvbiBjb250ZXh0IHdlIHdpbGwgZW5kIHVwIGFmdGVyIGFwcCBsYXVuY2guXG4gIHRoaXMuY3VyQ29udGV4dCA9IE5BVElWRV9XSU47XG4gIGF3YWl0IHRoaXMuc3RvcENocm9tZWRyaXZlclByb3hpZXMoKTtcbn07XG5cbmNvbW1hbmRzLmdldERpc3BsYXlEZW5zaXR5ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICAvLyBmaXJzdCB0cnkgdGhlIHByb3BlcnR5IGZvciBkZXZpY2VzXG4gIGxldCBvdXQgPSBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2dldHByb3AnLCAncm8uc2YubGNkX2RlbnNpdHknXSk7XG4gIGlmIChvdXQpIHtcbiAgICBsZXQgdmFsID0gcGFyc2VJbnQob3V0LCAxMCk7XG4gICAgLy8gaWYgdGhlIHZhbHVlIGlzIE5hTiwgdHJ5IGdldHRpbmcgdGhlIGVtdWxhdG9yIHByb3BlcnR5XG4gICAgaWYgKCFpc05hTih2YWwpKSB7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFBhcnNlZCBkZW5zaXR5IHZhbHVlIHdhcyBOYU46IFwiJHtvdXR9XCJgKTtcbiAgfVxuICAvLyBmYWxsYmFjayB0byB0cnlpbmcgcHJvcGVydHkgZm9yIGVtdWxhdG9yc1xuICBvdXQgPSBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2dldHByb3AnLCAncWVtdS5zZi5sY2RfZGVuc2l0eSddKTtcbiAgaWYgKG91dCkge1xuICAgIGxldCB2YWwgPSBwYXJzZUludChvdXQsIDEwKTtcbiAgICBpZiAoIWlzTmFOKHZhbCkpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgUGFyc2VkIGRlbnNpdHkgdmFsdWUgd2FzIE5hTjogXCIke291dH1cImApO1xuICB9XG4gIC8vIGNvdWxkbid0IGdldCBhbnl0aGluZywgc28gZXJyb3Igb3V0XG4gIGxvZy5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gZ2V0IGRpc3BsYXkgZGVuc2l0eSBwcm9wZXJ0eS4nKTtcbn07XG5cbi8qKlxuICogUGFyc2VzIHRoZSBnaXZlbiB3aW5kb3cgbWFuYWdlciBTdXJmYWNlIHN0cmluZyB0byBnZXQgaW5mby5cbiAqIEBwYXJhbSBsaW5lOiBUbyBwYXJzZS4gVGhpcyBpcyBhc3N1bWVkIHRvIGJlIHZhbGlkLlxuICogQHJldHVybjogVmlzaWJpbGl0eSBhbmQgYm91bmRzIG9mIHRoZSBTdXJmYWNlLlxuICovXG5mdW5jdGlvbiBwYXJzZVN1cmZhY2VMaW5lIChsaW5lKSB7XG4gIC8vIHRoZSBzdXJmYWNlIGJvdW5kcyBhcmUgaW4gdGhlIGZvcm1hdDpcbiAgLy8gXCJyZWN0PSgwLjAsMTE4NC4wKSA3NjguMCB4IDk2LjBcIlxuICAvLyAgICAgICBeIGxvY2F0aW9uICAgXiBzaXplXG4gIC8vIGN1dCBvdXQgdGhlIHN0dWZmIGJlZm9yZSB0aGUgJ3JlY3QnIGFuZCB0aGVuIHNwbGl0IHRoZSBudW1iZXJzIGFwYXJ0XG4gIGxldCBib3VuZHMgPSBsaW5lLnNwbGl0KCdyZWN0PScpWzFdXG4gIC5yZXBsYWNlKC9bKCksIHhdKy9nLCAnICcpXG4gIC50cmltKClcbiAgLnNwbGl0KCcgJyk7XG5cbiAgcmV0dXJuIHtcbiAgICB2aXNpYmxlOiAobGluZS5pbmRleE9mKCdzaG93bj10cnVlJykgIT09IC0xKSxcbiAgICB4OiBwYXJzZUZsb2F0KGJvdW5kc1swXSksXG4gICAgeTogcGFyc2VGbG9hdChib3VuZHNbMV0pLFxuICAgIHdpZHRoOiBwYXJzZUZsb2F0KGJvdW5kc1syXSksXG4gICAgaGVpZ2h0OiBwYXJzZUZsb2F0KGJvdW5kc1szXSlcbiAgfTtcbn1cblxuLyoqXG4gKiBFeHRyYWN0cyBzdGF0dXMgYW5kIG5hdmlnYXRpb24gYmFyIGluZm9ybWF0aW9uIGZyb20gdGhlIHdpbmRvdyBtYW5hZ2VyIG91dHB1dC5cbiAqIEBwYXJhbSBsaW5lczogT3V0cHV0IGZyb20gZHVtcHN5cyBjb21tYW5kXG4gKiBAcmV0dXJuOiBWaXNpYmlsaXR5IGFuZCBib3VuZHMgaW5mbyBvZiBzdGF0dXMgYW5kIG5hdmlnYXRpb24gYmFyXG4gKi9cbmZ1bmN0aW9uIHBhcnNlV2luZG93cyAobGluZXMpIHtcbiAgbGV0IGF0U3RhdHVzQmFyID0gZmFsc2U7XG4gIGxldCBhdE5hdkJhciA9IGZhbHNlO1xuICBsZXQgc3RhdHVzQmFyO1xuICBsZXQgbmF2aWdhdGlvbkJhcjtcbiAgLy8gdGhlIHdpbmRvdyBtYW5hZ2VyIG91dHB1dCBsb29rcyBsaWtlOlxuICAvLyBXaW5kb3cgIzEgLi4uIFdpbmRvd0lEXG4gIC8vICAgQSBidW5jaCBvZiBwcm9wZXJ0aWVzXG4gIC8vIFdpbmRvdyAjMiAuLi4gV2luZG93SURcbiAgLy8gICBBIGJ1bmNoIG9mIHByb3BlcnRpZXNcbiAgbGluZXMuc3BsaXQoJ1xcbicpLmZvckVhY2goKGxpbmUpID0+IHtcbiAgICAvLyB0aGUgc3RhcnQgb2YgYSBuZXcgd2luZG93IHNlY3Rpb25cbiAgICBpZiAobGluZS5pbmRleE9mKCcgIFdpbmRvdyAjJykgIT09IC0xKSB7XG4gICAgICAvLyBkZXRlcm1pbmUgd2hpY2ggc2VjdGlvbiB3ZSdyZSBpblxuICAgICAgLy8gb25seSBvbmUgd2lsbCBiZSB0cnVlXG4gICAgICBhdFN0YXR1c0JhciA9IChsaW5lLmluZGV4T2YoJ1N0YXR1c0JhcicpICE9PSAtMSk7XG4gICAgICBhdE5hdkJhciA9IChsaW5lLmluZGV4T2YoJ05hdmlnYXRpb25CYXInKSAhPT0gLTEpO1xuICAgICAgLy8gZG9uJ3QgbmVlZCBhbnl0aGluZyBlbHNlLiBtb3ZlIHRvIG5leHQgbGluZVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBvbmNlIHdlJ3JlIGluIGEgd2luZG93IHNlY3Rpb24sIGxvb2sgZm9yIHRoZSBzdXJmYWNlIGRhdGEgbGluZVxuICAgIGlmIChsaW5lLmluZGV4T2YoJyAgICAgIFN1cmZhY2U6JykgPT09IC0xKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChhdFN0YXR1c0Jhcikge1xuICAgICAgc3RhdHVzQmFyID0gcGFyc2VTdXJmYWNlTGluZShsaW5lKTtcbiAgICAgIGF0U3RhdHVzQmFyID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChhdE5hdkJhcikge1xuICAgICAgbmF2aWdhdGlvbkJhciA9IHBhcnNlU3VyZmFjZUxpbmUobGluZSk7XG4gICAgICBhdE5hdkJhciA9IGZhbHNlO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKCFzdGF0dXNCYXIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRmFpbGVkIHRvIHBhcnNlIHN0YXR1cyBiYXIgaW5mb3JtYXRpb24uJyk7XG4gIH1cbiAgaWYgKCFuYXZpZ2F0aW9uQmFyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0ZhaWxlZCB0byBwYXJzZSBuYXZpZ2F0aW9uIGJhciBpbmZvcm1hdGlvbi4nKTtcbiAgfVxuXG4gIHJldHVybiB7c3RhdHVzQmFyLCBuYXZpZ2F0aW9uQmFyfTtcbn1cblxuY29tbWFuZHMuZ2V0U3lzdGVtQmFycyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZHVtcHN5cycsICd3aW5kb3cnLCAnd2luZG93cyddKTtcbiAgaWYgKCFvdXQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRGlkIG5vdCBnZXQgd2luZG93IG1hbmFnZXIgb3V0cHV0LicpO1xuICB9XG4gIHJldHVybiBwYXJzZVdpbmRvd3Mob3V0KTtcbn07XG5cbmNvbW1hbmRzLm1vYmlsZVBlcmZvcm1FZGl0b3JBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHthY3Rpb259ID0gb3B0cztcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKGFjdGlvbikpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgJ2FjdGlvbicgYXJndW1lbnQgaXMgcmVxdWlyZWRgKTtcbiAgfVxuXG4gIGF3YWl0IHRoaXMuYWRiLnBlcmZvcm1FZGl0b3JBY3Rpb24oYWN0aW9uKTtcbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4vLyBmb3IgdW5pdCB0ZXN0c1xuZXhwb3J0IHsgcGFyc2VXaW5kb3dzLCBwYXJzZVN1cmZhY2VMaW5lIH07XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
