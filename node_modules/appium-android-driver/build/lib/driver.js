"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.AndroidDriver = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _desiredCaps = _interopRequireDefault(require("./desired-caps"));

var _index = _interopRequireDefault(require("./commands/index"));

var _androidHelpers = _interopRequireDefault(require("./android-helpers"));

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumAdb = require("appium-adb");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _sharedPreferencesBuilder = require("shared-preferences-builder");

var _bluebird = _interopRequireDefault(require("bluebird"));

const APP_EXTENSION = '.apk';
const DEVICE_PORT = 4724;
const NO_PROXY = [['POST', new RegExp('^/session/[^/]+/context')], ['GET', new RegExp('^/session/[^/]+/context')], ['POST', new RegExp('^/session/[^/]+/appium')], ['GET', new RegExp('^/session/[^/]+/appium')], ['POST', new RegExp('^/session/[^/]+/touch/perform')], ['POST', new RegExp('^/session/[^/]+/touch/multi/perform')], ['POST', new RegExp('^/session/[^/]+/orientation')], ['GET', new RegExp('^/session/[^/]+/orientation')]];

class AndroidDriver extends _appiumBaseDriver.BaseDriver {
  constructor(opts = {}, shouldValidateCaps = true) {
    super(opts, shouldValidateCaps);
    this.locatorStrategies = ['xpath', 'id', 'class name', 'accessibility id', '-android uiautomator'];
    this.desiredCapConstraints = _desiredCaps.default;
    this.sessionChromedrivers = {};
    this.jwpProxyActive = false;
    this.jwpProxyAvoid = _lodash.default.clone(NO_PROXY);
    this.settings = new _appiumBaseDriver.DeviceSettings({
      ignoreUnimportantViews: false
    }, this.onSettingsUpdate.bind(this));
    this.chromedriver = null;
    this.apkStrings = {};
    this.bootstrapPort = opts.bootstrapPort || DEVICE_PORT;
    this.unlocker = _androidHelpers.default.unlocker;

    for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
      AndroidDriver.prototype[cmd] = fn;
    }
  }

  async createSession(...args) {
    try {
      let [sessionId, caps] = await super.createSession(...args);
      let serverDetails = {
        platform: 'LINUX',
        webStorageEnabled: false,
        takesScreenshot: true,
        javascriptEnabled: true,
        databaseEnabled: false,
        networkConnectionEnabled: true,
        locationContextEnabled: false,
        warnings: {},
        desired: this.caps
      };
      this.caps = Object.assign(serverDetails, this.caps);
      let defaultOpts = {
        action: "android.intent.action.MAIN",
        category: "android.intent.category.LAUNCHER",
        flags: "0x10200000",
        disableAndroidWatchers: false,
        tmpDir: await _appiumSupport.tempDir.staticDir(),
        fullReset: false,
        autoLaunch: true,
        adbPort: _appiumAdb.DEFAULT_ADB_PORT,
        androidInstallTimeout: 90000
      };

      _lodash.default.defaults(this.opts, defaultOpts);

      if (!this.opts.javaVersion) {
        this.opts.javaVersion = await _androidHelpers.default.getJavaVersion();
      }

      this.useUnlockHelperApp = _lodash.default.isUndefined(this.caps.unlockType);

      if (this.opts.noReset === true) {
        this.opts.fullReset = false;
      }

      if (this.opts.fullReset === true) {
        this.opts.noReset = false;
      }

      this.opts.fastReset = !this.opts.fullReset && !this.opts.noReset;
      this.opts.skipUninstall = this.opts.fastReset || this.opts.noReset;
      this.curContext = this.defaultContextName();

      if (this.isChromeSession) {
        _logger.default.info("We're going to run a Chrome-based session");

        let {
          pkg,
          activity
        } = _androidHelpers.default.getChromePkg(this.opts.browserName);

        this.opts.appPackage = pkg;
        this.opts.appActivity = activity;

        _logger.default.info(`Chrome-type package and activity are ${pkg} and ${activity}`);
      }

      if (this.opts.nativeWebScreenshot) {
        this.jwpProxyAvoid.push(['GET', new RegExp('^/session/[^/]+/screenshot')]);
      }

      if (this.opts.reboot) {
        this.setAvdFromCapabilities(caps);
      }

      let {
        udid,
        emPort
      } = await _androidHelpers.default.getDeviceInfoFromCaps(this.opts);
      this.opts.udid = udid;
      this.opts.emPort = emPort;
      this.adb = await _androidHelpers.default.createADB({
        javaVersion: this.opts.javaVersion,
        udid: this.opts.udid,
        emPort: this.opts.emPort,
        adbPort: this.opts.adbPort,
        suppressKillServer: this.opts.suppressKillServer,
        remoteAdbHost: this.opts.remoteAdbHost,
        clearDeviceLogsOnStart: this.opts.clearDeviceLogsOnStart,
        adbExecTimeout: this.opts.adbExecTimeout
      });

      if ((await this.adb.getApiLevel()) >= 23) {
        _logger.default.warn("Consider setting 'automationName' capability to " + "'uiautomator2' on Android >= 6, since UIAutomator framework " + "is not maintained anymore by the OS vendor.");
      }

      if (this.helpers.isPackageOrBundle(this.opts.app)) {
        this.opts.appPackage = this.opts.app;
        this.opts.app = null;
      }

      if (this.opts.app) {
        this.opts.app = await this.helpers.configureApp(this.opts.app, APP_EXTENSION);
        this.opts.appIsTemp = this.opts.app && (await _appiumSupport.fs.exists(this.opts.app)) && !(await _appiumSupport.util.isSameDestination(caps.app, this.opts.app));
        await this.checkAppPresent();
      } else if (this.appOnDevice) {
        _logger.default.info(`App file was not listed, instead we're going to run ` + `${this.opts.appPackage} directly on the device`);

        await this.checkPackagePresent();
      }

      if (_appiumSupport.util.hasValue(this.opts.networkSpeed)) {
        if (!this.isEmulator()) {
          _logger.default.warn("Sorry, networkSpeed capability is only available for emulators");
        } else {
          let networkSpeed = _androidHelpers.default.ensureNetworkSpeed(this.adb, this.opts.networkSpeed);

          await this.adb.networkSpeed(networkSpeed);
        }
      }

      if (_appiumSupport.util.hasValue(this.opts.gpsEnabled)) {
        if (this.isEmulator()) {
          _logger.default.info(`Trying to ${this.opts.gpsEnabled ? "enable" : "disable"} gps location provider`);

          await this.adb.toggleGPSLocationProvider(this.opts.gpsEnabled);
        } else {
          _logger.default.warn('Sorry! gpsEnabled capability is only available for emulators');
        }
      }

      await this.startAndroidSession(this.opts);
      return [sessionId, this.caps];
    } catch (e) {
      try {
        await this.deleteSession();
      } catch (ign) {}

      throw e;
    }
  }

  isEmulator() {
    return !!(this.opts.avd || /emulator/.test(this.opts.udid));
  }

  setAvdFromCapabilities(caps) {
    if (this.opts.avd) {
      _logger.default.info('avd name defined, ignoring device name and platform version');
    } else {
      if (!caps.deviceName) {
        _logger.default.errorAndThrow('avd or deviceName should be specified when reboot option is enables');
      }

      if (!caps.platformVersion) {
        _logger.default.errorAndThrow('avd or platformVersion should be specified when reboot option is enabled');
      }

      let avdDevice = caps.deviceName.replace(/[^a-zA-Z0-9_.]/g, "-");
      this.opts.avd = `${avdDevice}__${caps.platformVersion}`;
    }
  }

  get appOnDevice() {
    return this.helpers.isPackageOrBundle(this.opts.app) || !this.opts.app && this.helpers.isPackageOrBundle(this.opts.appPackage);
  }

  get isChromeSession() {
    return _androidHelpers.default.isChromeBrowser(this.opts.browserName);
  }

  async onSettingsUpdate(key, value) {
    if (key === "ignoreUnimportantViews") {
      await this.setCompressedLayoutHierarchy(value);
    }
  }

  async startAndroidSession() {
    _logger.default.info(`Starting Android session`);

    this.defaultIME = await _androidHelpers.default.initDevice(this.adb, this.opts);
    this.caps.deviceName = this.adb.curDeviceId;
    this.caps.deviceUDID = this.opts.udid;
    this.caps.platformVersion = await this.adb.getPlatformVersion();
    this.caps.deviceScreenSize = await this.adb.getScreenSize();
    this.caps.deviceModel = await this.adb.getModel();
    this.caps.deviceManufacturer = await this.adb.getManufacturer();

    if (this.opts.autoLaunch) {
      await this.initAUT();
    }

    if (this.opts.disableWindowAnimation) {
      if (await this.adb.isAnimationOn()) {
        if ((await this.adb.getApiLevel()) >= 28) {
          _logger.default.warn('Relaxing hidden api policy to manage animation scale');

          await this.adb.setHiddenApiPolicy('1');
        }

        _logger.default.info('Disabling window animation as it is requested by "disableWindowAnimation" capability');

        await this.adb.setAnimationState(false);
        this._wasWindowAnimationDisabled = true;
      } else {
        _logger.default.info('Window animation is already disabled');
      }
    }

    this.bootstrap = new _androidHelpers.default.bootstrap(this.adb, this.bootstrapPort, this.opts.websocket);
    await this.bootstrap.start(this.opts.appPackage, this.opts.disableAndroidWatchers, this.opts.acceptSslCerts);
    this.bootstrap.onUnexpectedShutdown.catch(async err => {
      if (!this.bootstrap.ignoreUnexpectedShutdown) {
        await this.startUnexpectedShutdown(err);
      }
    });

    if (!this.opts.skipUnlock) {
      await _androidHelpers.default.unlock(this, this.adb, this.caps);
    }

    if (this.opts.ignoreUnimportantViews) {
      await this.settings.update({
        ignoreUnimportantViews: this.opts.ignoreUnimportantViews
      });
    }

    if (this.isChromeSession) {
      await this.startChromeSession();
    } else {
      if (this.opts.autoLaunch) {
        await this.startAUT();
      }
    }

    if (_appiumSupport.util.hasValue(this.opts.orientation)) {
      _logger.default.debug(`Setting initial orientation to '${this.opts.orientation}'`);

      await this.setOrientation(this.opts.orientation);
    }

    await this.initAutoWebview();
  }

  async initAutoWebview() {
    if (this.opts.autoWebview) {
      let viewName = this.defaultWebviewName();
      let timeout = this.opts.autoWebviewTimeout || 2000;

      _logger.default.info(`Setting auto webview to context '${viewName}' with timeout ${timeout}ms`);

      await (0, _asyncbox.retryInterval)(timeout / 500, 500, async () => {
        await this.setContext(viewName);
      });
    }
  }

  async initAUT() {
    let launchInfo = await _androidHelpers.default.getLaunchInfo(this.adb, this.opts);
    Object.assign(this.opts, launchInfo);
    Object.assign(this.caps, launchInfo);

    if (this.opts.otherApps) {
      let otherApps;

      try {
        otherApps = _androidHelpers.default.parseArray(this.opts.otherApps);
      } catch (e) {
        _logger.default.errorAndThrow(`Could not parse "otherApps" capability: ${e.message}`);
      }

      otherApps = await _bluebird.default.all(otherApps.map(app => this.helpers.configureApp(app, APP_EXTENSION)));
      await _androidHelpers.default.installOtherApks(otherApps, this.adb, this.opts);
    }

    if (!this.opts.app) {
      if (this.opts.fullReset) {
        _logger.default.errorAndThrow('Full reset requires an app capability, use fastReset if app is not provided');
      }

      _logger.default.debug('No app capability. Assuming it is already on the device');

      if (this.opts.fastReset) {
        await _androidHelpers.default.resetApp(this.adb, this.opts);
      }

      return;
    }

    if (!this.opts.skipUninstall) {
      await this.adb.uninstallApk(this.opts.appPackage);
    }

    await _androidHelpers.default.installApk(this.adb, this.opts);
    const apkStringsForLanguage = await _androidHelpers.default.pushStrings(this.opts.language, this.adb, this.opts);

    if (this.opts.language) {
      this.apkStrings[this.opts.language] = apkStringsForLanguage;
    }

    if (!_lodash.default.isUndefined(this.opts.sharedPreferences)) {
      await this.setSharedPreferences(this.opts);
    }
  }

  async checkAppPresent() {
    _logger.default.debug("Checking whether app is actually present");

    if (!(await _appiumSupport.fs.exists(this.opts.app))) {
      _logger.default.errorAndThrow(`Could not find app apk at ${this.opts.app}`);
    }
  }

  async checkPackagePresent() {
    _logger.default.debug("Checking whether package is present on the device");

    if (!(await this.adb.shell(['pm', 'list', 'packages', this.opts.appPackage]))) {
      _logger.default.errorAndThrow(`Could not find package ${this.opts.appPackage} on the device`);
    }
  }

  async setCompressedLayoutHierarchy(compress) {
    await this.bootstrap.sendAction("compressedLayoutHierarchy", {
      compressLayout: compress
    });
  }

  async deleteSession() {
    _logger.default.debug("Shutting down Android driver");

    await _androidHelpers.default.removeAllSessionWebSocketHandlers(this.server, this.sessionId);
    await super.deleteSession();

    if (this.bootstrap) {
      await this.stopChromedriverProxies();

      if (this.opts.unicodeKeyboard && this.opts.resetKeyboard && this.defaultIME) {
        _logger.default.debug(`Resetting IME to ${this.defaultIME}`);

        await this.adb.setIME(this.defaultIME);
      }

      if (!this.isChromeSession) {
        await this.adb.forceStop(this.opts.appPackage);
      }

      await this.adb.goToHome();

      if (this.opts.fullReset && !this.opts.skipUninstall && !this.appOnDevice) {
        await this.adb.uninstallApk(this.opts.appPackage);
      }

      await this.bootstrap.shutdown();
      this.bootstrap = null;
    } else {
      _logger.default.debug("Called deleteSession but bootstrap wasn't active");
    }

    await this.adb.stopLogcat();

    if (this.useUnlockHelperApp) {
      await this.adb.forceStop('io.appium.unlock');
    }

    if (this._wasWindowAnimationDisabled) {
      _logger.default.info('Restoring window animation state');

      await this.adb.setAnimationState(true);

      if ((await this.adb.getApiLevel()) >= 28) {
        _logger.default.info('Restoring hidden api policy to the device default configuration');

        await this.adb.setDefaultHiddenApiPolicy();
      }
    }

    if (this.opts.reboot) {
      let avdName = this.opts.avd.replace('@', '');

      _logger.default.debug(`closing emulator '${avdName}'`);

      await this.adb.killEmulator(avdName);
    }

    if (this.opts.clearSystemFiles) {
      if (this.opts.appIsTemp) {
        _logger.default.debug(`Temporary copy of app was made: deleting '${this.opts.app}'`);

        try {
          await _appiumSupport.fs.rimraf(this.opts.app);
        } catch (err) {
          _logger.default.warn(`Unable to delete temporary app: ${err.message}`);
        }
      } else {
        _logger.default.debug('App was not copied, so not deleting');
      }
    } else {
      _logger.default.debug('Not cleaning generated files. Add `clearSystemFiles` capability if wanted.');
    }
  }

  async setSharedPreferences() {
    let sharedPrefs = this.opts.sharedPreferences;

    _logger.default.info("Trying to set shared preferences");

    let name = sharedPrefs.name;

    if (_lodash.default.isUndefined(name)) {
      _logger.default.warn(`Skipping setting Shared preferences, name is undefined: ${JSON.stringify(sharedPrefs)}`);

      return false;
    }

    let remotePath = `/data/data/${this.opts.appPackage}/shared_prefs`;
    let remoteFile = `${remotePath}/${name}.xml`;
    let localPath = `/tmp/${name}.xml`;
    let builder = this.getPrefsBuilder();
    builder.build(sharedPrefs.prefs);

    _logger.default.info(`Creating temporary shared preferences: ${localPath}`);

    builder.toFile(localPath);

    _logger.default.info(`Creating shared_prefs remote folder: ${remotePath}`);

    await this.adb.shell(['mkdir', '-p', remotePath]);

    _logger.default.info(`Pushing shared_prefs to ${remoteFile}`);

    await this.adb.push(localPath, remoteFile);

    try {
      _logger.default.info(`Trying to remove shared preferences temporary file`);

      if (await _appiumSupport.fs.exists(localPath)) {
        await _appiumSupport.fs.unlink(localPath);
      }
    } catch (e) {
      _logger.default.warn(`Error trying to remove temporary file ${localPath}`);
    }

    return true;
  }

  getPrefsBuilder() {
    return new _sharedPreferencesBuilder.SharedPrefsBuilder();
  }

  validateDesiredCaps(caps) {
    if (!super.validateDesiredCaps(caps)) {
      return false;
    }

    return _androidHelpers.default.validateDesiredCaps(caps);
  }

  proxyActive(sessionId) {
    super.proxyActive(sessionId);
    return this.jwpProxyActive;
  }

  getProxyAvoidList(sessionId) {
    super.getProxyAvoidList(sessionId);
    return this.jwpProxyAvoid;
  }

  canProxy(sessionId) {
    super.canProxy(sessionId);
    return _lodash.default.isFunction(this.proxyReqRes);
  }

}

exports.AndroidDriver = AndroidDriver;
var _default = AndroidDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiQVBQX0VYVEVOU0lPTiIsIkRFVklDRV9QT1JUIiwiTk9fUFJPWFkiLCJSZWdFeHAiLCJBbmRyb2lkRHJpdmVyIiwiQmFzZURyaXZlciIsImNvbnN0cnVjdG9yIiwib3B0cyIsInNob3VsZFZhbGlkYXRlQ2FwcyIsImxvY2F0b3JTdHJhdGVnaWVzIiwiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwiZGVzaXJlZENvbnN0cmFpbnRzIiwic2Vzc2lvbkNocm9tZWRyaXZlcnMiLCJqd3BQcm94eUFjdGl2ZSIsImp3cFByb3h5QXZvaWQiLCJfIiwiY2xvbmUiLCJzZXR0aW5ncyIsIkRldmljZVNldHRpbmdzIiwiaWdub3JlVW5pbXBvcnRhbnRWaWV3cyIsIm9uU2V0dGluZ3NVcGRhdGUiLCJiaW5kIiwiY2hyb21lZHJpdmVyIiwiYXBrU3RyaW5ncyIsImJvb3RzdHJhcFBvcnQiLCJ1bmxvY2tlciIsImhlbHBlcnMiLCJjbWQiLCJmbiIsInRvUGFpcnMiLCJjb21tYW5kcyIsInByb3RvdHlwZSIsImNyZWF0ZVNlc3Npb24iLCJhcmdzIiwic2Vzc2lvbklkIiwiY2FwcyIsInNlcnZlckRldGFpbHMiLCJwbGF0Zm9ybSIsIndlYlN0b3JhZ2VFbmFibGVkIiwidGFrZXNTY3JlZW5zaG90IiwiamF2YXNjcmlwdEVuYWJsZWQiLCJkYXRhYmFzZUVuYWJsZWQiLCJuZXR3b3JrQ29ubmVjdGlvbkVuYWJsZWQiLCJsb2NhdGlvbkNvbnRleHRFbmFibGVkIiwid2FybmluZ3MiLCJkZXNpcmVkIiwiT2JqZWN0IiwiYXNzaWduIiwiZGVmYXVsdE9wdHMiLCJhY3Rpb24iLCJjYXRlZ29yeSIsImZsYWdzIiwiZGlzYWJsZUFuZHJvaWRXYXRjaGVycyIsInRtcERpciIsInRlbXBEaXIiLCJzdGF0aWNEaXIiLCJmdWxsUmVzZXQiLCJhdXRvTGF1bmNoIiwiYWRiUG9ydCIsIkRFRkFVTFRfQURCX1BPUlQiLCJhbmRyb2lkSW5zdGFsbFRpbWVvdXQiLCJkZWZhdWx0cyIsImphdmFWZXJzaW9uIiwiZ2V0SmF2YVZlcnNpb24iLCJ1c2VVbmxvY2tIZWxwZXJBcHAiLCJpc1VuZGVmaW5lZCIsInVubG9ja1R5cGUiLCJub1Jlc2V0IiwiZmFzdFJlc2V0Iiwic2tpcFVuaW5zdGFsbCIsImN1ckNvbnRleHQiLCJkZWZhdWx0Q29udGV4dE5hbWUiLCJpc0Nocm9tZVNlc3Npb24iLCJsb2ciLCJpbmZvIiwicGtnIiwiYWN0aXZpdHkiLCJnZXRDaHJvbWVQa2ciLCJicm93c2VyTmFtZSIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsIm5hdGl2ZVdlYlNjcmVlbnNob3QiLCJwdXNoIiwicmVib290Iiwic2V0QXZkRnJvbUNhcGFiaWxpdGllcyIsInVkaWQiLCJlbVBvcnQiLCJnZXREZXZpY2VJbmZvRnJvbUNhcHMiLCJhZGIiLCJjcmVhdGVBREIiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwiZ2V0QXBpTGV2ZWwiLCJ3YXJuIiwiaXNQYWNrYWdlT3JCdW5kbGUiLCJhcHAiLCJjb25maWd1cmVBcHAiLCJhcHBJc1RlbXAiLCJmcyIsImV4aXN0cyIsInV0aWwiLCJpc1NhbWVEZXN0aW5hdGlvbiIsImNoZWNrQXBwUHJlc2VudCIsImFwcE9uRGV2aWNlIiwiY2hlY2tQYWNrYWdlUHJlc2VudCIsImhhc1ZhbHVlIiwibmV0d29ya1NwZWVkIiwiaXNFbXVsYXRvciIsImVuc3VyZU5ldHdvcmtTcGVlZCIsImdwc0VuYWJsZWQiLCJ0b2dnbGVHUFNMb2NhdGlvblByb3ZpZGVyIiwic3RhcnRBbmRyb2lkU2Vzc2lvbiIsImUiLCJkZWxldGVTZXNzaW9uIiwiaWduIiwiYXZkIiwidGVzdCIsImRldmljZU5hbWUiLCJlcnJvckFuZFRocm93IiwicGxhdGZvcm1WZXJzaW9uIiwiYXZkRGV2aWNlIiwicmVwbGFjZSIsImlzQ2hyb21lQnJvd3NlciIsImtleSIsInZhbHVlIiwic2V0Q29tcHJlc3NlZExheW91dEhpZXJhcmNoeSIsImRlZmF1bHRJTUUiLCJpbml0RGV2aWNlIiwiY3VyRGV2aWNlSWQiLCJkZXZpY2VVRElEIiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwiZGV2aWNlU2NyZWVuU2l6ZSIsImdldFNjcmVlblNpemUiLCJkZXZpY2VNb2RlbCIsImdldE1vZGVsIiwiZGV2aWNlTWFudWZhY3R1cmVyIiwiZ2V0TWFudWZhY3R1cmVyIiwiaW5pdEFVVCIsImRpc2FibGVXaW5kb3dBbmltYXRpb24iLCJpc0FuaW1hdGlvbk9uIiwic2V0SGlkZGVuQXBpUG9saWN5Iiwic2V0QW5pbWF0aW9uU3RhdGUiLCJfd2FzV2luZG93QW5pbWF0aW9uRGlzYWJsZWQiLCJib290c3RyYXAiLCJ3ZWJzb2NrZXQiLCJzdGFydCIsImFjY2VwdFNzbENlcnRzIiwib25VbmV4cGVjdGVkU2h1dGRvd24iLCJjYXRjaCIsImVyciIsImlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biIsInN0YXJ0VW5leHBlY3RlZFNodXRkb3duIiwic2tpcFVubG9jayIsInVubG9jayIsInVwZGF0ZSIsInN0YXJ0Q2hyb21lU2Vzc2lvbiIsInN0YXJ0QVVUIiwib3JpZW50YXRpb24iLCJkZWJ1ZyIsInNldE9yaWVudGF0aW9uIiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJ2aWV3TmFtZSIsImRlZmF1bHRXZWJ2aWV3TmFtZSIsInRpbWVvdXQiLCJhdXRvV2Vidmlld1RpbWVvdXQiLCJzZXRDb250ZXh0IiwibGF1bmNoSW5mbyIsImdldExhdW5jaEluZm8iLCJvdGhlckFwcHMiLCJwYXJzZUFycmF5IiwibWVzc2FnZSIsIkIiLCJhbGwiLCJtYXAiLCJpbnN0YWxsT3RoZXJBcGtzIiwicmVzZXRBcHAiLCJ1bmluc3RhbGxBcGsiLCJpbnN0YWxsQXBrIiwiYXBrU3RyaW5nc0Zvckxhbmd1YWdlIiwicHVzaFN0cmluZ3MiLCJsYW5ndWFnZSIsInNoYXJlZFByZWZlcmVuY2VzIiwic2V0U2hhcmVkUHJlZmVyZW5jZXMiLCJzaGVsbCIsImNvbXByZXNzIiwic2VuZEFjdGlvbiIsImNvbXByZXNzTGF5b3V0IiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic3RvcENocm9tZWRyaXZlclByb3hpZXMiLCJ1bmljb2RlS2V5Ym9hcmQiLCJyZXNldEtleWJvYXJkIiwic2V0SU1FIiwiZm9yY2VTdG9wIiwiZ29Ub0hvbWUiLCJzaHV0ZG93biIsInN0b3BMb2djYXQiLCJzZXREZWZhdWx0SGlkZGVuQXBpUG9saWN5IiwiYXZkTmFtZSIsImtpbGxFbXVsYXRvciIsImNsZWFyU3lzdGVtRmlsZXMiLCJyaW1yYWYiLCJzaGFyZWRQcmVmcyIsIm5hbWUiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3RlUGF0aCIsInJlbW90ZUZpbGUiLCJsb2NhbFBhdGgiLCJidWlsZGVyIiwiZ2V0UHJlZnNCdWlsZGVyIiwiYnVpbGQiLCJwcmVmcyIsInRvRmlsZSIsInVubGluayIsIlNoYXJlZFByZWZzQnVpbGRlciIsInZhbGlkYXRlRGVzaXJlZENhcHMiLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiLCJpc0Z1bmN0aW9uIiwicHJveHlSZXFSZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsYUFBYSxHQUFHLE1BQXRCO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLElBQXBCO0FBSUEsTUFBTUMsUUFBUSxHQUFHLENBQ2YsQ0FBQyxNQUFELEVBQVMsSUFBSUMsTUFBSixDQUFXLHlCQUFYLENBQVQsQ0FEZSxFQUVmLENBQUMsS0FBRCxFQUFRLElBQUlBLE1BQUosQ0FBVyx5QkFBWCxDQUFSLENBRmUsRUFHZixDQUFDLE1BQUQsRUFBUyxJQUFJQSxNQUFKLENBQVcsd0JBQVgsQ0FBVCxDQUhlLEVBSWYsQ0FBQyxLQUFELEVBQVEsSUFBSUEs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QUFPbkIsZ0JBQUVnTixVQUFGLENBQWEsS0FBS0MsV0FBbEIsQ0FBUDtBQUNEOztBQS9kb0M7OztlQW1leEI1TixhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZURyaXZlciwgRGV2aWNlU2V0dGluZ3MgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IGRlc2lyZWRDb25zdHJhaW50cyBmcm9tICcuL2Rlc2lyZWQtY2Fwcyc7XG5pbXBvcnQgY29tbWFuZHMgZnJvbSAnLi9jb21tYW5kcy9pbmRleCc7XG5pbXBvcnQgaGVscGVycyBmcm9tICcuL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBERUZBVUxUX0FEQl9QT1JUIH0gZnJvbSAnYXBwaXVtLWFkYic7XG5pbXBvcnQgeyBmcywgdGVtcERpciwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBTaGFyZWRQcmVmc0J1aWxkZXIgfSBmcm9tICdzaGFyZWQtcHJlZmVyZW5jZXMtYnVpbGRlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbmNvbnN0IEFQUF9FWFRFTlNJT04gPSAnLmFwayc7XG5jb25zdCBERVZJQ0VfUE9SVCA9IDQ3MjQ7XG5cbi8vIFRoaXMgaXMgYSBzZXQgb2YgbWV0aG9kcyBhbmQgcGF0aHMgdGhhdCB3ZSBuZXZlciB3YW50IHRvIHByb3h5IHRvXG4vLyBDaHJvbWVkcml2ZXJcbmNvbnN0IE5PX1BST1hZID0gW1xuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvY29udGV4dCcpXSxcbiAgWydHRVQnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvY29udGV4dCcpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL2FwcGl1bScpXSxcbiAgWydHRVQnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvYXBwaXVtJyldLFxuICBbJ1BPU1QnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvdG91Y2gvcGVyZm9ybScpXSxcbiAgWydQT1NUJywgbmV3IFJlZ0V4cCgnXi9zZXNzaW9uL1teL10rL3RvdWNoL211bHRpL3BlcmZvcm0nKV0sXG4gIFsnUE9TVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9vcmllbnRhdGlvbicpXSxcbiAgWydHRVQnLCBuZXcgUmVnRXhwKCdeL3Nlc3Npb24vW14vXSsvb3JpZW50YXRpb24nKV0sXG5dO1xuXG5jbGFzcyBBbmRyb2lkRHJpdmVyIGV4dGVuZHMgQmFzZURyaXZlciB7XG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30sIHNob3VsZFZhbGlkYXRlQ2FwcyA9IHRydWUpIHtcbiAgICBzdXBlcihvcHRzLCBzaG91bGRWYWxpZGF0ZUNhcHMpO1xuXG4gICAgdGhpcy5sb2NhdG9yU3RyYXRlZ2llcyA9IFtcbiAgICAgICd4cGF0aCcsXG4gICAgICAnaWQnLFxuICAgICAgJ2NsYXNzIG5hbWUnLFxuICAgICAgJ2FjY2Vzc2liaWxpdHkgaWQnLFxuICAgICAgJy1hbmRyb2lkIHVpYXV0b21hdG9yJ1xuICAgIF07XG4gICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMgPSBkZXNpcmVkQ29uc3RyYWludHM7XG4gICAgdGhpcy5zZXNzaW9uQ2hyb21lZHJpdmVycyA9IHt9O1xuICAgIHRoaXMuandwUHJveHlBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLmp3cFByb3h5QXZvaWQgPSBfLmNsb25lKE5PX1BST1hZKTtcbiAgICB0aGlzLnNldHRpbmdzID0gbmV3IERldmljZVNldHRpbmdzKHtpZ25vcmVVbmltcG9ydGFudFZpZXdzOiBmYWxzZX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uU2V0dGluZ3NVcGRhdGUuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5jaHJvbWVkcml2ZXIgPSBudWxsO1xuICAgIHRoaXMuYXBrU3RyaW5ncyA9IHt9O1xuICAgIHRoaXMuYm9vdHN0cmFwUG9ydCA9IG9wdHMuYm9vdHN0cmFwUG9ydCB8fCBERVZJQ0VfUE9SVDtcbiAgICB0aGlzLnVubG9ja2VyID0gaGVscGVycy51bmxvY2tlcjtcblxuICAgIGZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gICAgICBBbmRyb2lkRHJpdmVyLnByb3RvdHlwZVtjbWRdID0gZm47XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoLi4uYXJncykge1xuICAgIC8vIHRoZSB3aG9sZSBjcmVhdGVTZXNzaW9uIGZsb3cgaXMgc3Vycm91bmRlZCBpbiBhIHRyeS1jYXRjaCBzdGF0ZW1lbnRcbiAgICAvLyBpZiBjcmVhdGluZyBhIHNlc3Npb24gZmFpbHMgYXQgYW55IHBvaW50LCB3ZSB0ZWFyZG93biBldmVyeXRoaW5nIHdlXG4gICAgLy8gc2V0IHVwIGJlZm9yZSB0aHJvd2luZyB0aGUgZXJyb3IuXG4gICAgdHJ5IHtcbiAgICAgIGxldCBbc2Vzc2lvbklkLCBjYXBzXSA9IGF3YWl0IHN1cGVyLmNyZWF0ZVNlc3Npb24oLi4uYXJncyk7XG5cbiAgICAgIGxldCBzZXJ2ZXJEZXRhaWxzID0ge1xuICAgICAgICBwbGF0Zm9ybTogJ0xJTlVYJyxcbiAgICAgICAgd2ViU3RvcmFnZUVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICB0YWtlc1NjcmVlbnNob3Q6IHRydWUsXG4gICAgICAgIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICAgICAgICBkYXRhYmFzZUVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICBuZXR3b3JrQ29ubmVjdGlvbkVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGxvY2F0aW9uQ29udGV4dEVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICB3YXJuaW5nczoge30sXG4gICAgICAgIGRlc2lyZWQ6IHRoaXMuY2Fwc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5jYXBzID0gT2JqZWN0LmFzc2lnbihzZXJ2ZXJEZXRhaWxzLCB0aGlzLmNhcHMpO1xuXG4gICAgICAvLyBhc3NpZ25pbmcgZGVmYXVsdHNcbiAgICAgIGxldCBkZWZhdWx0T3B0cyA9IHtcbiAgICAgICAgYWN0aW9uOiBcImFuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOXCIsXG4gICAgICAgIGNhdGVnb3J5OiBcImFuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSXCIsXG4gICAgICAgIGZsYWdzOiBcIjB4MTAyMDAwMDBcIixcbiAgICAgICAgZGlzYWJsZUFuZHJvaWRXYXRjaGVyczogZmFsc2UsXG4gICAgICAgIHRtcERpcjogYXdhaXQgdGVtcERpci5zdGF0aWNEaXIoKSxcbiAgICAgICAgZnVsbFJlc2V0OiBmYWxzZSxcbiAgICAgICAgYXV0b0xhdW5jaDogdHJ1ZSxcbiAgICAgICAgYWRiUG9ydDogREVGQVVMVF9BREJfUE9SVCxcbiAgICAgICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0OiA5MDAwMCxcbiAgICAgIH07XG4gICAgICBfLmRlZmF1bHRzKHRoaXMub3B0cywgZGVmYXVsdE9wdHMpO1xuICAgICAgaWYgKCF0aGlzLm9wdHMuamF2YVZlcnNpb24pIHtcbiAgICAgICAgdGhpcy5vcHRzLmphdmFWZXJzaW9uID0gYXdhaXQgaGVscGVycy5nZXRKYXZhVmVyc2lvbigpO1xuICAgICAgfVxuICAgICAgdGhpcy51c2VVbmxvY2tIZWxwZXJBcHAgPSBfLmlzVW5kZWZpbmVkKHRoaXMuY2Fwcy51bmxvY2tUeXBlKTtcblxuICAgICAgLy8gbm90IHVzZXIgdmlzaWJsZSB2aWEgY2Fwc1xuICAgICAgaWYgKHRoaXMub3B0cy5ub1Jlc2V0ID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMub3B0cy5mdWxsUmVzZXQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdHMuZnVsbFJlc2V0ID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMub3B0cy5ub1Jlc2V0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLm9wdHMuZmFzdFJlc2V0ID0gIXRoaXMub3B0cy5mdWxsUmVzZXQgJiYgIXRoaXMub3B0cy5ub1Jlc2V0O1xuICAgICAgdGhpcy5vcHRzLnNraXBVbmluc3RhbGwgPSB0aGlzLm9wdHMuZmFzdFJlc2V0IHx8IHRoaXMub3B0cy5ub1Jlc2V0O1xuXG4gICAgICB0aGlzLmN1ckNvbnRleHQgPSB0aGlzLmRlZmF1bHRDb250ZXh0TmFtZSgpO1xuXG4gICAgICBpZiAodGhpcy5pc0Nocm9tZVNlc3Npb24pIHtcbiAgICAgICAgbG9nLmluZm8oXCJXZSdyZSBnb2luZyB0byBydW4gYSBDaHJvbWUtYmFzZWQgc2Vzc2lvblwiKTtcbiAgICAgICAgbGV0IHtwa2csIGFjdGl2aXR5fSA9IGhlbHBlcnMuZ2V0Q2hyb21lUGtnKHRoaXMub3B0cy5icm93c2VyTmFtZSk7XG4gICAgICAgIHRoaXMub3B0cy5hcHBQYWNrYWdlID0gcGtnO1xuICAgICAgICB0aGlzLm9wdHMuYXBwQWN0aXZpdHkgPSBhY3Rpdml0eTtcbiAgICAgICAgbG9nLmluZm8oYENocm9tZS10eXBlIHBhY2thZ2UgYW5kIGFjdGl2aXR5IGFyZSAke3BrZ30gYW5kICR7YWN0aXZpdHl9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdHMubmF0aXZlV2ViU2NyZWVuc2hvdCkge1xuICAgICAgICB0aGlzLmp3cFByb3h5QXZvaWQucHVzaChbJ0dFVCcsIG5ldyBSZWdFeHAoJ14vc2Vzc2lvbi9bXi9dKy9zY3JlZW5zaG90JyldKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0cy5yZWJvb3QpIHtcbiAgICAgICAgdGhpcy5zZXRBdmRGcm9tQ2FwYWJpbGl0aWVzKGNhcHMpO1xuICAgICAgfVxuXG4gICAgICAvLyBnZXQgZGV2aWNlIHVkaWQgZm9yIHRoaXMgc2Vzc2lvblxuICAgICAgbGV0IHt1ZGlkLCBlbVBvcnR9ID0gYXdhaXQgaGVscGVycy5nZXREZXZpY2VJbmZvRnJvbUNhcHModGhpcy5vcHRzKTtcbiAgICAgIHRoaXMub3B0cy51ZGlkID0gdWRpZDtcbiAgICAgIHRoaXMub3B0cy5lbVBvcnQgPSBlbVBvcnQ7XG5cbiAgICAgIC8vIHNldCB1cCBhbiBpbnN0YW5jZSBvZiBBREJcbiAgICAgIHRoaXMuYWRiID0gYXdhaXQgaGVscGVycy5jcmVhdGVBREIoe1xuICAgICAgICBqYXZhVmVyc2lvbjogdGhpcy5vcHRzLmphdmFWZXJzaW9uLFxuICAgICAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZCxcbiAgICAgICAgZW1Qb3J0OiB0aGlzLm9wdHMuZW1Qb3J0LFxuICAgICAgICBhZGJQb3J0OiB0aGlzLm9wdHMuYWRiUG9ydCxcbiAgICAgICAgc3VwcHJlc3NLaWxsU2VydmVyOiB0aGlzLm9wdHMuc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgICAgICByZW1vdGVBZGJIb3N0OiB0aGlzLm9wdHMucmVtb3RlQWRiSG9zdCxcbiAgICAgICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydDogdGhpcy5vcHRzLmNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgICAgIGFkYkV4ZWNUaW1lb3V0OiB0aGlzLm9wdHMuYWRiRXhlY1RpbWVvdXQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKGF3YWl0IHRoaXMuYWRiLmdldEFwaUxldmVsKCkgPj0gMjMpIHtcbiAgICAgICAgbG9nLndhcm4oXCJDb25zaWRlciBzZXR0aW5nICdhdXRvbWF0aW9uTmFtZScgY2FwYWJpbGl0eSB0byBcIiArXG4gICAgICAgICAgXCIndWlhdXRvbWF0b3IyJyBvbiBBbmRyb2lkID49IDYsIHNpbmNlIFVJQXV0b21hdG9yIGZyYW1ld29yayBcIiArXG4gICAgICAgICAgXCJpcyBub3QgbWFpbnRhaW5lZCBhbnltb3JlIGJ5IHRoZSBPUyB2ZW5kb3IuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5oZWxwZXJzLmlzUGFja2FnZU9yQnVuZGxlKHRoaXMub3B0cy5hcHApKSB7XG4gICAgICAgIC8vIHVzZXIgcHJvdmlkZWQgcGFja2FnZSBpbnN0ZWFkIG9mIGFwcCBmb3IgJ2FwcCcgY2FwYWJpbGl0eSwgbWFzc2FnZSBvcHRpb25zXG4gICAgICAgIHRoaXMub3B0cy5hcHBQYWNrYWdlID0gdGhpcy5vcHRzLmFwcDtcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdHMuYXBwKSB7XG4gICAgICAgIC8vIGZpbmQgYW5kIGNvcHksIG9yIGRvd25sb2FkIGFuZCB1bnppcCBhbiBhcHAgdXJsIG9yIHBhdGhcbiAgICAgICAgdGhpcy5vcHRzLmFwcCA9IGF3YWl0IHRoaXMuaGVscGVycy5jb25maWd1cmVBcHAodGhpcy5vcHRzLmFwcCwgQVBQX0VYVEVOU0lPTik7XG4gICAgICAgIHRoaXMub3B0cy5hcHBJc1RlbXAgPSB0aGlzLm9wdHMuYXBwICYmIGF3YWl0IGZzLmV4aXN0cyh0aGlzLm9wdHMuYXBwKVxuICAgICAgICAgICYmICFhd2FpdCB1dGlsLmlzU2FtZURlc3RpbmF0aW9uKGNhcHMuYXBwLCB0aGlzLm9wdHMuYXBwKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jaGVja0FwcFByZXNlbnQoKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5hcHBPbkRldmljZSkge1xuICAgICAgICAvLyB0aGUgYXBwIGlzbid0IGFuIGFjdHVhbCBhcHAgZmlsZSBidXQgcmF0aGVyIHNvbWV0aGluZyB3ZSB3YW50IHRvXG4gICAgICAgIC8vIGFzc3VtZSBpcyBvbiB0aGUgZGV2aWNlIGFuZCBqdXN0IGxhdW5jaCB2aWEgdGhlIGFwcFBhY2thZ2VcbiAgICAgICAgbG9nLmluZm8oYEFwcCBmaWxlIHdhcyBub3QgbGlzdGVkLCBpbnN0ZWFkIHdlJ3JlIGdvaW5nIHRvIHJ1biBgICtcbiAgICAgICAgICAgICAgICAgYCR7dGhpcy5vcHRzLmFwcFBhY2thZ2V9IGRpcmVjdGx5IG9uIHRoZSBkZXZpY2VgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jaGVja1BhY2thZ2VQcmVzZW50KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNvbWUgY2xvdWQgc2VydmljZXMgdXNpbmcgYXBwaXVtIGxhdW5jaCB0aGUgYXZkIHRoZW1zZWx2ZXMsIHNvIHdlIGVuc3VyZSBuZXRzcGVlZFxuICAgICAgLy8gaXMgc2V0IGZvciBlbXVsYXRvcnMgYnkgY2FsbGluZyBhZGIubmV0d29ya1NwZWVkIGJlZm9yZSBydW5uaW5nIHRoZSBhcHBcbiAgICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5uZXR3b3JrU3BlZWQpKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICAgICAgICBsb2cud2FybihcIlNvcnJ5LCBuZXR3b3JrU3BlZWQgY2FwYWJpbGl0eSBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBuZXR3b3JrU3BlZWQgPSBoZWxwZXJzLmVuc3VyZU5ldHdvcmtTcGVlZCh0aGlzLmFkYiwgdGhpcy5vcHRzLm5ldHdvcmtTcGVlZCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hZGIubmV0d29ya1NwZWVkKG5ldHdvcmtTcGVlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNoZWNrIGlmIHdlIGhhdmUgdG8gZW5hYmxlL2Rpc2FibGUgZ3BzIGJlZm9yZSBydW5uaW5nIHRoZSBhcHBsaWNhdGlvblxuICAgICAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5vcHRzLmdwc0VuYWJsZWQpKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgICAgICAgIGxvZy5pbmZvKGBUcnlpbmcgdG8gJHt0aGlzLm9wdHMuZ3BzRW5hYmxlZCA/IFwiZW5hYmxlXCIgOiBcImRpc2FibGVcIn0gZ3BzIGxvY2F0aW9uIHByb3ZpZGVyYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5hZGIudG9nZ2xlR1BTTG9jYXRpb25Qcm92aWRlcih0aGlzLm9wdHMuZ3BzRW5hYmxlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nLndhcm4oJ1NvcnJ5ISBncHNFbmFibGVkIGNhcGFiaWxpdHkgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRBbmRyb2lkU2Vzc2lvbih0aGlzLm9wdHMpO1xuICAgICAgcmV0dXJuIFtzZXNzaW9uSWQsIHRoaXMuY2Fwc107XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gaWdub3JpbmcgZGVsZXRlIHNlc3Npb24gZXhjZXB0aW9uIGlmIGFueSBhbmQgdGhyb3cgdGhlIHJlYWwgZXJyb3JcbiAgICAgIC8vIHRoYXQgaGFwcGVuZWQgd2hpbGUgY3JlYXRpbmcgdGhlIHNlc3Npb24uXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZVNlc3Npb24oKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgaXNFbXVsYXRvciAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMub3B0cy5hdmQgfHwgL2VtdWxhdG9yLy50ZXN0KHRoaXMub3B0cy51ZGlkKSk7XG4gIH1cblxuICBzZXRBdmRGcm9tQ2FwYWJpbGl0aWVzIChjYXBzKSB7XG4gICAgaWYgKHRoaXMub3B0cy5hdmQpIHtcbiAgICAgIGxvZy5pbmZvKCdhdmQgbmFtZSBkZWZpbmVkLCBpZ25vcmluZyBkZXZpY2UgbmFtZSBhbmQgcGxhdGZvcm0gdmVyc2lvbicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWNhcHMuZGV2aWNlTmFtZSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnYXZkIG9yIGRldmljZU5hbWUgc2hvdWxkIGJlIHNwZWNpZmllZCB3aGVuIHJlYm9vdCBvcHRpb24gaXMgZW5hYmxlcycpO1xuICAgICAgfVxuICAgICAgaWYgKCFjYXBzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnYXZkIG9yIHBsYXRmb3JtVmVyc2lvbiBzaG91bGQgYmUgc3BlY2lmaWVkIHdoZW4gcmVib290IG9wdGlvbiBpcyBlbmFibGVkJyk7XG4gICAgICB9XG4gICAgICBsZXQgYXZkRGV2aWNlID0gY2Fwcy5kZXZpY2VOYW1lLnJlcGxhY2UoL1teYS16QS1aMC05Xy5dL2csIFwiLVwiKTtcbiAgICAgIHRoaXMub3B0cy5hdmQgPSBgJHthdmREZXZpY2V9X18ke2NhcHMucGxhdGZvcm1WZXJzaW9ufWA7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGFwcE9uRGV2aWNlICgpIHtcbiAgICByZXR1cm4gdGhpcy5oZWxwZXJzLmlzUGFja2FnZU9yQnVuZGxlKHRoaXMub3B0cy5hcHApIHx8ICghdGhpcy5vcHRzLmFwcCAmJlxuICAgICAgICAgICB0aGlzLmhlbHBlcnMuaXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmFwcFBhY2thZ2UpKTtcbiAgfVxuXG4gIGdldCBpc0Nocm9tZVNlc3Npb24gKCkge1xuICAgIHJldHVybiBoZWxwZXJzLmlzQ2hyb21lQnJvd3Nlcih0aGlzLm9wdHMuYnJvd3Nlck5hbWUpO1xuICB9XG5cbiAgYXN5bmMgb25TZXR0aW5nc1VwZGF0ZSAoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgPT09IFwiaWdub3JlVW5pbXBvcnRhbnRWaWV3c1wiKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldENvbXByZXNzZWRMYXlvdXRIaWVyYXJjaHkodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0YXJ0QW5kcm9pZFNlc3Npb24gKCkge1xuICAgIGxvZy5pbmZvKGBTdGFydGluZyBBbmRyb2lkIHNlc3Npb25gKTtcbiAgICAvLyBzZXQgdXAgdGhlIGRldmljZSB0byBydW4gb24gKHJlYWwgb3IgZW11bGF0b3IsIGV0YylcbiAgICB0aGlzLmRlZmF1bHRJTUUgPSBhd2FpdCBoZWxwZXJzLmluaXREZXZpY2UodGhpcy5hZGIsIHRoaXMub3B0cyk7XG5cbiAgICAvLyBzZXQgYWN0dWFsIGRldmljZSBuYW1lLCB1ZGlkLCBwbGF0Zm9ybSB2ZXJzaW9uLCBzY3JlZW4gc2l6ZSwgbW9kZWwgYW5kIG1hbnVmYWN0dXJlciBkZXRhaWxzLlxuICAgIHRoaXMuY2Fwcy5kZXZpY2VOYW1lID0gdGhpcy5hZGIuY3VyRGV2aWNlSWQ7XG4gICAgdGhpcy5jYXBzLmRldmljZVVESUQgPSB0aGlzLm9wdHMudWRpZDtcbiAgICB0aGlzLmNhcHMucGxhdGZvcm1WZXJzaW9uID0gYXdhaXQgdGhpcy5hZGIuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgdGhpcy5jYXBzLmRldmljZVNjcmVlblNpemUgPSBhd2FpdCB0aGlzLmFkYi5nZXRTY3JlZW5TaXplKCk7XG4gICAgdGhpcy5jYXBzLmRldmljZU1vZGVsID0gYXdhaXQgdGhpcy5hZGIuZ2V0TW9kZWwoKTtcbiAgICB0aGlzLmNhcHMuZGV2aWNlTWFudWZhY3R1cmVyID0gYXdhaXQgdGhpcy5hZGIuZ2V0TWFudWZhY3R1cmVyKCk7XG5cbiAgICAvLyBJZiB0aGUgdXNlciBzZXRzIGF1dG9MYXVuY2ggdG8gZmFsc2UsIHRoZXkgYXJlIHJlc3BvbnNpYmxlIGZvciBpbml0QVVUKCkgYW5kIHN0YXJ0QVVUKClcbiAgICBpZiAodGhpcy5vcHRzLmF1dG9MYXVuY2gpIHtcbiAgICAgIC8vIHNldCB1cCBhcHAgdW5kZXIgdGVzdFxuICAgICAgYXdhaXQgdGhpcy5pbml0QVVUKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0cy5kaXNhYmxlV2luZG93QW5pbWF0aW9uKSB7XG4gICAgICBpZiAoYXdhaXQgdGhpcy5hZGIuaXNBbmltYXRpb25PbigpKSB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmFkYi5nZXRBcGlMZXZlbCgpID49IDI4KSB7IC8vIEFQSSBsZXZlbCAyOCBpcyBBbmRyb2lkIFBcbiAgICAgICAgICAvLyBEb24ndCBmb3JnZXQgdG8gcmVzZXQgdGhlIHJlbGF4aW5nIGluIGRlbGV0ZSBzZXNzaW9uXG4gICAgICAgICAgbG9nLndhcm4oJ1JlbGF4aW5nIGhpZGRlbiBhcGkgcG9saWN5IHRvIG1hbmFnZSBhbmltYXRpb24gc2NhbGUnKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLmFkYi5zZXRIaWRkZW5BcGlQb2xpY3koJzEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZy5pbmZvKCdEaXNhYmxpbmcgd2luZG93IGFuaW1hdGlvbiBhcyBpdCBpcyByZXF1ZXN0ZWQgYnkgXCJkaXNhYmxlV2luZG93QW5pbWF0aW9uXCIgY2FwYWJpbGl0eScpO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zZXRBbmltYXRpb25TdGF0ZShmYWxzZSk7XG4gICAgICAgIHRoaXMuX3dhc1dpbmRvd0FuaW1hdGlvbkRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5pbmZvKCdXaW5kb3cgYW5pbWF0aW9uIGlzIGFscmVhZHkgZGlzYWJsZWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBzdGFydCBVaUF1dG9tYXRvclxuICAgIHRoaXMuYm9vdHN0cmFwID0gbmV3IGhlbHBlcnMuYm9vdHN0cmFwKHRoaXMuYWRiLCB0aGlzLmJvb3RzdHJhcFBvcnQsIHRoaXMub3B0cy53ZWJzb2NrZXQpO1xuICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnN0YXJ0KHRoaXMub3B0cy5hcHBQYWNrYWdlLCB0aGlzLm9wdHMuZGlzYWJsZUFuZHJvaWRXYXRjaGVycywgdGhpcy5vcHRzLmFjY2VwdFNzbENlcnRzKTtcbiAgICAvLyBoYW5kbGluZyB1bmV4cGVjdGVkIHNodXRkb3duXG4gICAgdGhpcy5ib290c3RyYXAub25VbmV4cGVjdGVkU2h1dGRvd24uY2F0Y2goYXN5bmMgKGVycikgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgaWYgKCF0aGlzLmJvb3RzdHJhcC5pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24pIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihlcnIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCF0aGlzLm9wdHMuc2tpcFVubG9jaykge1xuICAgICAgLy8gTGV0J3MgdHJ5IHRvIHVubG9jayB0aGUgZGV2aWNlXG4gICAgICBhd2FpdCBoZWxwZXJzLnVubG9jayh0aGlzLCB0aGlzLmFkYiwgdGhpcy5jYXBzKTtcbiAgICB9XG5cbiAgICAvLyBTZXQgQ29tcHJlc3NlZExheW91dEhpZXJhcmNoeSBvbiB0aGUgZGV2aWNlIGJhc2VkIG9uIGN1cnJlbnQgc2V0dGluZ3Mgb2JqZWN0XG4gICAgLy8gdGhpcyBoYXMgdG8gaGFwcGVuIF9hZnRlcl8gYm9vdHN0cmFwIGlzIGluaXRpYWxpemVkXG4gICAgaWYgKHRoaXMub3B0cy5pZ25vcmVVbmltcG9ydGFudFZpZXdzKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldHRpbmdzLnVwZGF0ZSh7aWdub3JlVW5pbXBvcnRhbnRWaWV3czogdGhpcy5vcHRzLmlnbm9yZVVuaW1wb3J0YW50Vmlld3N9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0Nocm9tZVNlc3Npb24pIHtcbiAgICAgIC8vIHN0YXJ0IGEgY2hyb21lZHJpdmVyIHNlc3Npb24gYW5kIHByb3h5IHRvIGl0XG4gICAgICBhd2FpdCB0aGlzLnN0YXJ0Q2hyb21lU2Vzc2lvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5vcHRzLmF1dG9MYXVuY2gpIHtcbiAgICAgICAgLy8gc3RhcnQgYXBwXG4gICAgICAgIGF3YWl0IHRoaXMuc3RhcnRBVVQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMub3JpZW50YXRpb24pKSB7XG4gICAgICBsb2cuZGVidWcoYFNldHRpbmcgaW5pdGlhbCBvcmllbnRhdGlvbiB0byAnJHt0aGlzLm9wdHMub3JpZW50YXRpb259J2ApO1xuICAgICAgYXdhaXQgdGhpcy5zZXRPcmllbnRhdGlvbih0aGlzLm9wdHMub3JpZW50YXRpb24pO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuaW5pdEF1dG9XZWJ2aWV3KCk7XG4gIH1cblxuICBhc3luYyBpbml0QXV0b1dlYnZpZXcgKCkge1xuICAgIGlmICh0aGlzLm9wdHMuYXV0b1dlYnZpZXcpIHtcbiAgICAgIGxldCB2aWV3TmFtZSA9IHRoaXMuZGVmYXVsdFdlYnZpZXdOYW1lKCk7XG4gICAgICBsZXQgdGltZW91dCA9ICh0aGlzLm9wdHMuYXV0b1dlYnZpZXdUaW1lb3V0KSB8fCAyMDAwO1xuXG4gICAgICBsb2cuaW5mbyhgU2V0dGluZyBhdXRvIHdlYnZpZXcgdG8gY29udGV4dCAnJHt2aWV3TmFtZX0nIHdpdGggdGltZW91dCAke3RpbWVvdXR9bXNgKTtcblxuICAgICAgLy8gdHJ5IGV2ZXJ5IDUwMG1zIHVudGlsIHRpbWVvdXQgaXMgb3ZlclxuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCh0aW1lb3V0IC8gNTAwLCA1MDAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KHZpZXdOYW1lKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGluaXRBVVQgKCkge1xuICAgIC8vIHBvcHVsYXRlIGFwcFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0UGFja2FnZSwgYXBwV2FpdEFjdGl2aXR5LFxuICAgIC8vIGFuZCB0aGUgZGV2aWNlIGJlaW5nIHVzZWRcbiAgICAvLyBpbiB0aGUgb3B0cyBhbmQgY2FwcyAoc28gaXQgZ2V0cyBiYWNrIHRvIHRoZSB1c2VyIG9uIHNlc3Npb24gY3JlYXRpb24pXG4gICAgbGV0IGxhdW5jaEluZm8gPSBhd2FpdCBoZWxwZXJzLmdldExhdW5jaEluZm8odGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLm9wdHMsIGxhdW5jaEluZm8pO1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy5jYXBzLCBsYXVuY2hJbmZvKTtcblxuICAgIC8vIEluc3RhbGwgYW55IFwib3RoZXJBcHBzXCIgdGhhdCB3ZXJlIHNwZWNpZmllZCBpbiBjYXBzXG4gICAgaWYgKHRoaXMub3B0cy5vdGhlckFwcHMpIHtcbiAgICAgIGxldCBvdGhlckFwcHM7XG4gICAgICB0cnkge1xuICAgICAgICBvdGhlckFwcHMgPSBoZWxwZXJzLnBhcnNlQXJyYXkodGhpcy5vcHRzLm90aGVyQXBwcyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgcGFyc2UgXCJvdGhlckFwcHNcIiBjYXBhYmlsaXR5OiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICAgIG90aGVyQXBwcyA9IGF3YWl0IEIuYWxsKG90aGVyQXBwcy5tYXAoKGFwcCkgPT4gdGhpcy5oZWxwZXJzLmNvbmZpZ3VyZUFwcChhcHAsIEFQUF9FWFRFTlNJT04pKSk7XG4gICAgICBhd2FpdCBoZWxwZXJzLmluc3RhbGxPdGhlckFwa3Mob3RoZXJBcHBzLCB0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICB9XG5cbiAgICAvLyBpbnN0YWxsIGFwcFxuICAgIGlmICghdGhpcy5vcHRzLmFwcCkge1xuICAgICAgaWYgKHRoaXMub3B0cy5mdWxsUmVzZXQpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coJ0Z1bGwgcmVzZXQgcmVxdWlyZXMgYW4gYXBwIGNhcGFiaWxpdHksIHVzZSBmYXN0UmVzZXQgaWYgYXBwIGlzIG5vdCBwcm92aWRlZCcpO1xuICAgICAgfVxuICAgICAgbG9nLmRlYnVnKCdObyBhcHAgY2FwYWJpbGl0eS4gQXNzdW1pbmcgaXQgaXMgYWxyZWFkeSBvbiB0aGUgZGV2aWNlJyk7XG4gICAgICBpZiAodGhpcy5vcHRzLmZhc3RSZXNldCkge1xuICAgICAgICBhd2FpdCBoZWxwZXJzLnJlc2V0QXBwKHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXRoaXMub3B0cy5za2lwVW5pbnN0YWxsKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkYi51bmluc3RhbGxBcGsodGhpcy5vcHRzLmFwcFBhY2thZ2UpO1xuICAgIH1cbiAgICBhd2FpdCBoZWxwZXJzLmluc3RhbGxBcGsodGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgY29uc3QgYXBrU3RyaW5nc0Zvckxhbmd1YWdlID0gYXdhaXQgaGVscGVycy5wdXNoU3RyaW5ncyh0aGlzLm9wdHMubGFuZ3VhZ2UsIHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICAgIGlmICh0aGlzLm9wdHMubGFuZ3VhZ2UpIHtcbiAgICAgIHRoaXMuYXBrU3RyaW5nc1t0aGlzLm9wdHMubGFuZ3VhZ2VdID0gYXBrU3RyaW5nc0Zvckxhbmd1YWdlO1xuICAgIH1cblxuICAgIC8vIFRoaXMgbXVzdCBydW4gYWZ0ZXIgaW5zdGFsbGluZyB0aGUgYXBrLCBvdGhlcndpc2UgaXQgd291bGQgY2F1c2UgdGhlXG4gICAgLy8gaW5zdGFsbCB0byBmYWlsLiBBbmQgYmVmb3JlIHJ1bm5pbmcgdGhlIGFwcC5cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQodGhpcy5vcHRzLnNoYXJlZFByZWZlcmVuY2VzKSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRTaGFyZWRQcmVmZXJlbmNlcyh0aGlzLm9wdHMpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNoZWNrQXBwUHJlc2VudCAoKSB7XG4gICAgbG9nLmRlYnVnKFwiQ2hlY2tpbmcgd2hldGhlciBhcHAgaXMgYWN0dWFsbHkgcHJlc2VudFwiKTtcbiAgICBpZiAoIShhd2FpdCBmcy5leGlzdHModGhpcy5vcHRzLmFwcCkpKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGZpbmQgYXBwIGFwayBhdCAke3RoaXMub3B0cy5hcHB9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2hlY2tQYWNrYWdlUHJlc2VudCAoKSB7XG4gICAgbG9nLmRlYnVnKFwiQ2hlY2tpbmcgd2hldGhlciBwYWNrYWdlIGlzIHByZXNlbnQgb24gdGhlIGRldmljZVwiKTtcbiAgICBpZiAoIShhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ3BtJywgJ2xpc3QnLCAncGFja2FnZXMnLCB0aGlzLm9wdHMuYXBwUGFja2FnZV0pKSkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBmaW5kIHBhY2thZ2UgJHt0aGlzLm9wdHMuYXBwUGFja2FnZX0gb24gdGhlIGRldmljZWApO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNldCBDb21wcmVzc2VkTGF5b3V0SGllcmFyY2h5IG9uIHRoZSBkZXZpY2VcbiAgYXN5bmMgc2V0Q29tcHJlc3NlZExheW91dEhpZXJhcmNoeSAoY29tcHJlc3MpIHtcbiAgICBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiY29tcHJlc3NlZExheW91dEhpZXJhcmNoeVwiLCB7Y29tcHJlc3NMYXlvdXQ6IGNvbXByZXNzfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uICgpIHtcbiAgICBsb2cuZGVidWcoXCJTaHV0dGluZyBkb3duIEFuZHJvaWQgZHJpdmVyXCIpO1xuICAgIGF3YWl0IGhlbHBlcnMucmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzKHRoaXMuc2VydmVyLCB0aGlzLnNlc3Npb25JZCk7XG4gICAgYXdhaXQgc3VwZXIuZGVsZXRlU2Vzc2lvbigpO1xuICAgIGlmICh0aGlzLmJvb3RzdHJhcCkge1xuICAgICAgLy8gY2VydGFpbiBjbGVhbnVwIHdlIG9ubHkgY2FyZSB0byBkbyBpZiB0aGUgYm9vdHN0cmFwIHdhcyBldmVyIHJ1blxuICAgICAgYXdhaXQgdGhpcy5zdG9wQ2hyb21lZHJpdmVyUHJveGllcygpO1xuICAgICAgaWYgKHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmQgJiYgdGhpcy5vcHRzLnJlc2V0S2V5Ym9hcmQgJiYgdGhpcy5kZWZhdWx0SU1FKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgUmVzZXR0aW5nIElNRSB0byAke3RoaXMuZGVmYXVsdElNRX1gKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2V0SU1FKHRoaXMuZGVmYXVsdElNRSk7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuaXNDaHJvbWVTZXNzaW9uKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLmZvcmNlU3RvcCh0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmFkYi5nb1RvSG9tZSgpO1xuICAgICAgaWYgKHRoaXMub3B0cy5mdWxsUmVzZXQgJiYgIXRoaXMub3B0cy5za2lwVW5pbnN0YWxsICYmICF0aGlzLmFwcE9uRGV2aWNlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnVuaW5zdGFsbEFwayh0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zaHV0ZG93bigpO1xuICAgICAgdGhpcy5ib290c3RyYXAgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZGVidWcoXCJDYWxsZWQgZGVsZXRlU2Vzc2lvbiBidXQgYm9vdHN0cmFwIHdhc24ndCBhY3RpdmVcIik7XG4gICAgfVxuICAgIC8vIHNvbWUgY2xlYW51cCB3ZSB3YW50IHRvIGRvIHJlZ2FyZGxlc3MsIGluIGNhc2Ugd2UgYXJlIHNodXR0aW5nIGRvd25cbiAgICAvLyBtaWQtc3RhcnR1cFxuICAgIGF3YWl0IHRoaXMuYWRiLnN0b3BMb2djYXQoKTtcbiAgICBpZiAodGhpcy51c2VVbmxvY2tIZWxwZXJBcHApIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmZvcmNlU3RvcCgnaW8uYXBwaXVtLnVubG9jaycpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fd2FzV2luZG93QW5pbWF0aW9uRGlzYWJsZWQpIHtcbiAgICAgIGxvZy5pbmZvKCdSZXN0b3Jpbmcgd2luZG93IGFuaW1hdGlvbiBzdGF0ZScpO1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2V0QW5pbWF0aW9uU3RhdGUodHJ1ZSk7XG5cbiAgICAgIC8vIFRoaXMgd2FzIG5lY2Vzc2FyeSB0byBjaGFuZ2UgYW5pbWF0aW9uIHNjYWxlIG92ZXIgQW5kcm9pZCBQLiBXZSBtdXN0IHJlc2V0IHRoZSBwb2xpY3kgZm9yIHRoZSBzZWN1cml0eS5cbiAgICAgIGlmIChhd2FpdCB0aGlzLmFkYi5nZXRBcGlMZXZlbCgpID49IDI4KSB7XG4gICAgICAgIGxvZy5pbmZvKCdSZXN0b3JpbmcgaGlkZGVuIGFwaSBwb2xpY3kgdG8gdGhlIGRldmljZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24nKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2V0RGVmYXVsdEhpZGRlbkFwaVBvbGljeSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdHMucmVib290KSB7XG4gICAgICBsZXQgYXZkTmFtZSA9IHRoaXMub3B0cy5hdmQucmVwbGFjZSgnQCcsICcnKTtcbiAgICAgIGxvZy5kZWJ1ZyhgY2xvc2luZyBlbXVsYXRvciAnJHthdmROYW1lfSdgKTtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmtpbGxFbXVsYXRvcihhdmROYW1lKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0cy5jbGVhclN5c3RlbUZpbGVzKSB7XG4gICAgICBpZiAodGhpcy5vcHRzLmFwcElzVGVtcCkge1xuICAgICAgICBsb2cuZGVidWcoYFRlbXBvcmFyeSBjb3B5IG9mIGFwcCB3YXMgbWFkZTogZGVsZXRpbmcgJyR7dGhpcy5vcHRzLmFwcH0nYCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMub3B0cy5hcHApO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cud2FybihgVW5hYmxlIHRvIGRlbGV0ZSB0ZW1wb3JhcnkgYXBwOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoJ0FwcCB3YXMgbm90IGNvcGllZCwgc28gbm90IGRlbGV0aW5nJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5kZWJ1ZygnTm90IGNsZWFuaW5nIGdlbmVyYXRlZCBmaWxlcy4gQWRkIGBjbGVhclN5c3RlbUZpbGVzYCBjYXBhYmlsaXR5IGlmIHdhbnRlZC4nKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZXRTaGFyZWRQcmVmZXJlbmNlcyAoKSB7XG4gICAgbGV0IHNoYXJlZFByZWZzID0gdGhpcy5vcHRzLnNoYXJlZFByZWZlcmVuY2VzO1xuICAgIGxvZy5pbmZvKFwiVHJ5aW5nIHRvIHNldCBzaGFyZWQgcHJlZmVyZW5jZXNcIik7XG4gICAgbGV0IG5hbWUgPSBzaGFyZWRQcmVmcy5uYW1lO1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKG5hbWUpKSB7XG4gICAgICBsb2cud2FybihgU2tpcHBpbmcgc2V0dGluZyBTaGFyZWQgcHJlZmVyZW5jZXMsIG5hbWUgaXMgdW5kZWZpbmVkOiAke0pTT04uc3RyaW5naWZ5KHNoYXJlZFByZWZzKX1gKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbGV0IHJlbW90ZVBhdGggPSBgL2RhdGEvZGF0YS8ke3RoaXMub3B0cy5hcHBQYWNrYWdlfS9zaGFyZWRfcHJlZnNgO1xuICAgIGxldCByZW1vdGVGaWxlID0gYCR7cmVtb3RlUGF0aH0vJHtuYW1lfS54bWxgO1xuICAgIGxldCBsb2NhbFBhdGggPSBgL3RtcC8ke25hbWV9LnhtbGA7XG4gICAgbGV0IGJ1aWxkZXIgPSB0aGlzLmdldFByZWZzQnVpbGRlcigpO1xuICAgIGJ1aWxkZXIuYnVpbGQoc2hhcmVkUHJlZnMucHJlZnMpO1xuICAgIGxvZy5pbmZvKGBDcmVhdGluZyB0ZW1wb3Jhcnkgc2hhcmVkIHByZWZlcmVuY2VzOiAke2xvY2FsUGF0aH1gKTtcbiAgICBidWlsZGVyLnRvRmlsZShsb2NhbFBhdGgpO1xuICAgIGxvZy5pbmZvKGBDcmVhdGluZyBzaGFyZWRfcHJlZnMgcmVtb3RlIGZvbGRlcjogJHtyZW1vdGVQYXRofWApO1xuICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnbWtkaXInLCAnLXAnLCByZW1vdGVQYXRoXSk7XG4gICAgbG9nLmluZm8oYFB1c2hpbmcgc2hhcmVkX3ByZWZzIHRvICR7cmVtb3RlRmlsZX1gKTtcbiAgICBhd2FpdCB0aGlzLmFkYi5wdXNoKGxvY2FsUGF0aCwgcmVtb3RlRmlsZSk7XG4gICAgdHJ5IHtcbiAgICAgIGxvZy5pbmZvKGBUcnlpbmcgdG8gcmVtb3ZlIHNoYXJlZCBwcmVmZXJlbmNlcyB0ZW1wb3JhcnkgZmlsZWApO1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbFBhdGgpKSB7XG4gICAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbFBhdGgpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBFcnJvciB0cnlpbmcgdG8gcmVtb3ZlIHRlbXBvcmFyeSBmaWxlICR7bG9jYWxQYXRofWApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGdldFByZWZzQnVpbGRlciAoKSB7XG4gICAgLyogQWRkIHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSBhIG5ldyBTaGFyZWRQcmVmc0J1aWxkZXIgaW5zdGVhZCBvZlxuICAgICAqIGRpcmVjdGx5IGNyZWF0aW5nIHRoZSBvYmplY3Qgb24gc2V0U2hhcmVkUHJlZmVyZW5jZXMgZm9yIHRlc3RpbmcgcHVycG9zZXNcbiAgICAqL1xuICAgIHJldHVybiBuZXcgU2hhcmVkUHJlZnNCdWlsZGVyKCk7XG4gIH1cblxuICB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gICAgaWYgKCFzdXBlci52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBoZWxwZXJzLnZhbGlkYXRlRGVzaXJlZENhcHMoY2Fwcyk7XG4gIH1cblxuICBwcm94eUFjdGl2ZSAoc2Vzc2lvbklkKSB7XG4gICAgc3VwZXIucHJveHlBY3RpdmUoc2Vzc2lvbklkKTtcblxuICAgIHJldHVybiB0aGlzLmp3cFByb3h5QWN0aXZlO1xuICB9XG5cbiAgZ2V0UHJveHlBdm9pZExpc3QgKHNlc3Npb25JZCkge1xuICAgIHN1cGVyLmdldFByb3h5QXZvaWRMaXN0KHNlc3Npb25JZCk7XG5cbiAgICByZXR1cm4gdGhpcy5qd3BQcm94eUF2b2lkO1xuICB9XG5cbiAgY2FuUHJveHkgKHNlc3Npb25JZCkge1xuICAgIHN1cGVyLmNhblByb3h5KHNlc3Npb25JZCk7XG5cbiAgICAvLyB0aGlzIHdpbGwgY2hhbmdlIGRlcGVuZGluZyBvbiBDaHJvbWVEcml2ZXIgc3RhdHVzXG4gICAgcmV0dXJuIF8uaXNGdW5jdGlvbih0aGlzLnByb3h5UmVxUmVzKTtcbiAgfVxufVxuXG5leHBvcnQgeyBBbmRyb2lkRHJpdmVyIH07XG5leHBvcnQgZGVmYXVsdCBBbmRyb2lkRHJpdmVyO1xuIl0sImZpbGUiOiJsaWIvZHJpdmVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
