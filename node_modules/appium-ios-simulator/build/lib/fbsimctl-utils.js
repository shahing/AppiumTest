"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.execFbsimctl = execFbsimctl;
exports.setGeoLocation = setGeoLocation;
exports.focus = focus;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("./logger"));

var _teen_process = require("teen_process");

var _appiumSupport = require("appium-support");

var _shellQuote = require("shell-quote");

const FBSIMCTL = 'fbsimctl';

function assertPresence() {
  return _assertPresence.apply(this, arguments);
}

function _assertPresence() {
  _assertPresence = (0, _asyncToGenerator2.default)(function* () {
    try {
      yield _appiumSupport.fs.which(FBSIMCTL);
    } catch (err) {
      throw new Error(`${FBSIMCTL} tool should be present in PATH. ` + `Use 'brew tap facebook/fb && brew install fbsimctl --HEAD' command to install it`);
    }
  });
  return _assertPresence.apply(this, arguments);
}

function execFbsimctl(_x) {
  return _execFbsimctl.apply(this, arguments);
}

function _execFbsimctl() {
  _execFbsimctl = (0, _asyncToGenerator2.default)(function* (args) {
    yield assertPresence();

    _logger.default.debug(`Executing: ${FBSIMCTL} ${(0, _shellQuote.quote)(args)}`);

    try {
      const _ref = yield (0, _teen_process.exec)(FBSIMCTL, args),
            stdout = _ref.stdout;

      _logger.default.debug(`Command output: ${stdout}`);

      return stdout;
    } catch (err) {
      throw new Error(`Cannot execute "${FBSIMCTL} ${(0, _shellQuote.quote)(args)}". Original error: ${err.stderr || err.message}`);
    }
  });
  return _execFbsimctl.apply(this, arguments);
}

function setGeoLocation(_x2, _x3, _x4) {
  return _setGeoLocation.apply(this, arguments);
}

function _setGeoLocation() {
  _setGeoLocation = (0, _asyncToGenerator2.default)(function* (udid, latitude, longitude) {
    yield assertPresence();
    latitude = `${latitude}`.trim();
    longitude = `${longitude}`.trim();

    try {
      const latitudeWithComma = latitude.replace('.', ',');
      const longitudeWithComma = longitude.replace('.', ',');
      yield execFbsimctl([udid, 'set_location', latitudeWithComma, longitudeWithComma]);
    } catch (err) {
      const latitudeWithDot = latitude.replace(',', '.');
      const longitudeWithDot = longitude.replace(',', '.');
      yield execFbsimctl([udid, 'set_location', latitudeWithDot, longitudeWithDot]);
    }
  });
  return _setGeoLocation.apply(this, arguments);
}

function focus(_x5) {
  return _focus.apply(this, arguments);
}

function _focus() {
  _focus = (0, _asyncToGenerator2.default)(function* (udid) {
    yield execFbsimctl([udid, 'focus']);
  });
  return _focus.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9mYnNpbWN0bC11dGlscy5qcyJdLCJuYW1lcyI6WyJGQlNJTUNUTCIsImFzc2VydFByZXNlbmNlIiwiZnMiLCJ3aGljaCIsImVyciIsIkVycm9yIiwiZXhlY0Zic2ltY3RsIiwiYXJncyIsImxvZyIsImRlYnVnIiwic3Rkb3V0Iiwic3RkZXJyIiwibWVzc2FnZSIsInNldEdlb0xvY2F0aW9uIiwidWRpZCIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwidHJpbSIsImxhdGl0dWRlV2l0aENvbW1hIiwicmVwbGFjZSIsImxvbmdpdHVkZVdpdGhDb21tYSIsImxhdGl0dWRlV2l0aERvdCIsImxvbmdpdHVkZVdpdGhEb3QiLCJmb2N1cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLFFBQVEsR0FBRyxVQUFqQjs7U0FFZUMsYzs7Ozs7b0RBQWYsYUFBaUM7QUFDL0IsUUFBSTtBQUNGLFlBQU1DLGtCQUFHQyxLQUFILENBQVNILFFBQVQsQ0FBTjtBQUNELEtBRkQsQ0FFRSxPQUFPSSxHQUFQLEVBQVk7QUFDWixZQUFNLElBQUlDLEtBQUosQ0FBVyxHQUFFTCxRQUFTLG1DQUFaLEdBQ2Isa0ZBREcsQ0FBTjtBQUVEO0FBQ0YsRzs7OztTQVVjTSxZOzs7OztrREFBZixXQUE2QkMsSUFBN0IsRUFBbUM7QUFDakMsVUFBTU4sY0FBYyxFQUFwQjs7QUFDQU8sb0JBQUlDLEtBQUosQ0FBVyxjQUFhVCxRQUFTLElBQUcsdUJBQU1PLElBQU4sQ0FBWSxFQUFoRDs7QUFDQSxRQUFJO0FBQUEseUJBQ3FCLHdCQUFLUCxRQUFMLEVBQWVPLElBQWYsQ0FEckI7QUFBQSxZQUNLRyxNQURMLFFBQ0tBLE1BREw7O0FBRUZGLHNCQUFJQyxLQUFKLENBQVcsbUJBQWtCQyxNQUFPLEVBQXBDOztBQUNBLGFBQU9BLE1BQVA7QUFDRCxLQUpELENBSUUsT0FBT04sR0FBUCxFQUFZO0FBQ1osWUFBTSxJQUFJQyxLQUFKLENBQVcsbUJBQWtCTCxRQUFTLElBQUcsdUJBQU1PLElBQU4sQ0FBWSxzQkFBcUJILEdBQUcsQ0FBQ08sTUFBSixJQUFjUCxHQUFHLENBQUNRLE9BQVEsRUFBcEcsQ0FBTjtBQUNEO0FBQ0YsRzs7OztTQVdjQyxjOzs7OztvREFBZixXQUErQkMsSUFBL0IsRUFBcUNDLFFBQXJDLEVBQStDQyxTQUEvQyxFQUEwRDtBQUV4RCxVQUFNZixjQUFjLEVBQXBCO0FBRUFjLElBQUFBLFFBQVEsR0FBSSxHQUFFQSxRQUFTLEVBQVosQ0FBY0UsSUFBZCxFQUFYO0FBQ0FELElBQUFBLFNBQVMsR0FBSSxHQUFFQSxTQUFVLEVBQWIsQ0FBZUMsSUFBZixFQUFaOztBQUNBLFFBQUk7QUFFRixZQUFNQyxpQkFBaUIsR0FBR0gsUUFBUSxDQUFDSSxPQUFULENBQWlCLEdBQWpCLEVBQXNCLEdBQXRCLENBQTFCO0FBQ0EsWUFBTUMsa0JBQWtCLEdBQUdKLFNBQVMsQ0FBQ0csT0FBVixDQUFrQixHQUFsQixFQUF1QixHQUF2QixDQUEzQjtBQUNBLFlBQU1iLFlBQVksQ0FBQyxDQUFDUSxJQUFELEVBQU8sY0FBUCxFQUF1QkksaUJBQXZCLEVBQTBDRSxrQkFBMUMsQ0FBRCxDQUFsQjtBQUNELEtBTEQsQ0FLRSxPQUFPaEIsR0FBUCxFQUFZO0FBQ1osWUFBTWlCLGVBQWUsR0FBR04sUUFBUSxDQUFDSSxPQUFULENBQWlCLEdBQWpCLEVBQXNCLEdBQXRCLENBQXhCO0FBQ0EsWUFBTUcsZ0JBQWdCLEdBQUdOLFNBQVMsQ0FBQ0csT0FBVixDQUFrQixHQUFsQixFQUF1QixHQUF2QixDQUF6QjtBQUNBLFlBQU1iLFlBQVksQ0FBQyxDQUFDUSxJQUFELEVBQU8sY0FBUCxFQUF1Qk8sZUFBdkIsRUFBd0NDLGdCQUF4QyxDQUFELENBQWxCO0FBQ0Q7QUFDRixHOzs7O1NBUWNDLEs7Ozs7OzJDQUFmLFdBQXNCVCxJQUF0QixFQUE0QjtBQUMxQixVQUFNUixZQUFZLENBQUMsQ0FBQ1EsSUFBRCxFQUFPLE9BQVAsQ0FBRCxDQUFsQjtBQUNELEciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBxdW90ZSB9IGZyb20gJ3NoZWxsLXF1b3RlJztcblxuY29uc3QgRkJTSU1DVEwgPSAnZmJzaW1jdGwnO1xuXG5hc3luYyBmdW5jdGlvbiBhc3NlcnRQcmVzZW5jZSAoKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud2hpY2goRkJTSU1DVEwpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7RkJTSU1DVEx9IHRvb2wgc2hvdWxkIGJlIHByZXNlbnQgaW4gUEFUSC4gYCArXG4gICAgICBgVXNlICdicmV3IHRhcCBmYWNlYm9vay9mYiAmJiBicmV3IGluc3RhbGwgZmJzaW1jdGwgLS1IRUFEJyBjb21tYW5kIHRvIGluc3RhbGwgaXRgKTtcbiAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGZic2ltY3RsIHdpdGggZ2l2ZW4gYXJndW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7QXJyYXk8U3RyaW5nPn0gYXJncyAtIEFuIGFycmF5IG9mIGZic2ltY3RsIGFyZ3VtZW50cy5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IENvbW1hbmQgc3Rkb3V0LlxuICogQHRocm93cyB7RXJyb3J9IElmIGZic2ltY3RsIGlzIG5vdCBwcmVzZW50IGluIFBBVEggb3IgaXRzIHJldHVybiBjb2RlXG4gKiBpcyBub3QgZXF1YWwgdG8gemVyby5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXhlY0Zic2ltY3RsIChhcmdzKSB7XG4gIGF3YWl0IGFzc2VydFByZXNlbmNlKCk7XG4gIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nOiAke0ZCU0lNQ1RMfSAke3F1b3RlKGFyZ3MpfWApO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhGQlNJTUNUTCwgYXJncyk7XG4gICAgbG9nLmRlYnVnKGBDb21tYW5kIG91dHB1dDogJHtzdGRvdXR9YCk7XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZXhlY3V0ZSBcIiR7RkJTSU1DVEx9ICR7cXVvdGUoYXJncyl9XCIuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5zdGRlcnIgfHwgZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuLyoqXG4gKiBTZXRzIHRoZSBnaXZlbiBHUFMgY29vcmRpbmF0ZXMgZm9yIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvci5cbiAqIFRoZSBTaW11bGF0b3IgbXVzdCBiZSBpbiBib290ZWQgc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgU2ltdWxhdG9yIFVESURcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gbGF0aXR1ZGUgLSBMYXRpdHVkZSB2YWx1ZVxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBsb25naXR1ZGUgLSBMb25naXR1ZGUgdmFsdWVcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29tbWFuZCBmYWlsZWQgb3IgZmJzaW1jdGwgaXMgbm90IHByZXNlbnQgaW4gUEFUSFxuICovXG5hc3luYyBmdW5jdGlvbiBzZXRHZW9Mb2NhdGlvbiAodWRpZCwgbGF0aXR1ZGUsIGxvbmdpdHVkZSkge1xuICAvLyBGYWlsIGZhc3QgaWYgdGhlIGJpbmFyeSBpcyBub3QgcHJlc2VudFxuICBhd2FpdCBhc3NlcnRQcmVzZW5jZSgpO1xuXG4gIGxhdGl0dWRlID0gYCR7bGF0aXR1ZGV9YC50cmltKCk7XG4gIGxvbmdpdHVkZSA9IGAke2xvbmdpdHVkZX1gLnRyaW0oKTtcbiAgdHJ5IHtcbiAgICAvLyBUcnkgYm90aCBkZWNpbWFsIHNlcGFyYXRvcnNcbiAgICBjb25zdCBsYXRpdHVkZVdpdGhDb21tYSA9IGxhdGl0dWRlLnJlcGxhY2UoJy4nLCAnLCcpO1xuICAgIGNvbnN0IGxvbmdpdHVkZVdpdGhDb21tYSA9IGxvbmdpdHVkZS5yZXBsYWNlKCcuJywgJywnKTtcbiAgICBhd2FpdCBleGVjRmJzaW1jdGwoW3VkaWQsICdzZXRfbG9jYXRpb24nLCBsYXRpdHVkZVdpdGhDb21tYSwgbG9uZ2l0dWRlV2l0aENvbW1hXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnN0IGxhdGl0dWRlV2l0aERvdCA9IGxhdGl0dWRlLnJlcGxhY2UoJywnLCAnLicpO1xuICAgIGNvbnN0IGxvbmdpdHVkZVdpdGhEb3QgPSBsb25naXR1ZGUucmVwbGFjZSgnLCcsICcuJyk7XG4gICAgYXdhaXQgZXhlY0Zic2ltY3RsKFt1ZGlkLCAnc2V0X2xvY2F0aW9uJywgbGF0aXR1ZGVXaXRoRG90LCBsb25naXR1ZGVXaXRoRG90XSk7XG4gIH1cbn1cblxuLyoqXG4gKiBBY3RpdmF0ZXMgdGhlIHdpbmRvdyBvZiB0aGUgZ2l2ZW4gc2ltdWxhdG9yXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgU2ltdWxhdG9yIFVESURcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29tbWFuZCBmYWlsZWQgb3IgZmJzaW1jdGwgaXMgbm90IHByZXNlbnQgaW4gUEFUSFxuICovXG5hc3luYyBmdW5jdGlvbiBmb2N1cyAodWRpZCkge1xuICBhd2FpdCBleGVjRmJzaW1jdGwoW3VkaWQsICdmb2N1cyddKTtcbn1cblxuZXhwb3J0IHtcbiAgZXhlY0Zic2ltY3RsLCBzZXRHZW9Mb2NhdGlvbiwgZm9jdXNcbn07Il0sImZpbGUiOiJsaWIvZmJzaW1jdGwtdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
