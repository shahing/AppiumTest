"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("./logger"));

var _tccDb = _interopRequireDefault(require("./tcc-db"));

var _shellQuote = require("shell-quote");

const STATUS_UNSET = 'unset';
const STATUS_YES = 'yes';
const STATUS_NO = 'no';
const WIX_SIM_UTILS = 'applesimutils';
const SERVICES = {
  calendar: 'kTCCServiceCalendar',
  camera: 'kTCCServiceCamera',
  contacts: 'kTCCServiceAddressBook',
  homekit: 'kTCCServiceWillow',
  microphone: 'kTCCServiceMicrophone',
  photos: 'kTCCServicePhotos',
  reminders: 'kTCCServiceReminders',
  medialibrary: 'kTCCServiceMediaLibrary',
  motion: 'kTCCServiceMotion',
  health: 'kTCCServiceMSO',
  siri: 'kTCCServiceSiri',
  speech: 'kTCCServiceSpeechRecognition'
};

function toInternalServiceName(serviceName) {
  if (_lodash.default.has(SERVICES, _lodash.default.toLower(serviceName))) {
    return SERVICES[_lodash.default.toLower(serviceName)];
  }

  throw new Error(`'${serviceName}' is unknown. Only the following service names are supported: ${JSON.stringify(_lodash.default.keys(SERVICES))}`);
}

function formatStatus(status) {
  return [STATUS_UNSET, STATUS_NO].includes(status) ? _lodash.default.toUpper(status) : status;
}

function execWix(_x) {
  return _execWix.apply(this, arguments);
}

function _execWix() {
  _execWix = (0, _asyncToGenerator2.default)(function* (args) {
    try {
      yield _appiumSupport.fs.which(WIX_SIM_UTILS);
    } catch (e) {
      throw new Error(`${WIX_SIM_UTILS} binary has not been found in your PATH. ` + `Please install it ('brew tap wix/brew && brew install wix/brew/applesimutils') to ` + `be able to change application permissions`);
    }

    _logger.default.debug(`Executing: ${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}`);

    try {
      const _ref = yield (0, _teen_process.exec)(WIX_SIM_UTILS, args),
            stdout = _ref.stdout;

      _logger.default.debug(`Command output: ${stdout}`);

      return stdout;
    } catch (e) {
      throw new Error(`Cannot execute "${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}". Original error: ${e.stderr || e.message}`);
    }
  });
  return _execWix.apply(this, arguments);
}

class Permissions {
  constructor(xcodeVersion, sharedResourcesDir, udid) {
    this.tccDb = new _tccDb.default(xcodeVersion, sharedResourcesDir);
    this.udid = udid;
  }

  setAccess(permissionsMapping, bundleId) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      const permissionsArg = _lodash.default.toPairs(permissionsMapping).map(x => `${x[0]}=${formatStatus(x[1])}`).join(',');

      return yield execWix(['--byId', _this.udid, '--bundle', bundleId, '--setPermissions', permissionsArg]);
    })();
  }

  getAccess(serviceName, bundleId) {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      serviceName = toInternalServiceName(serviceName);
      var _arr = [['0', STATUS_NO], ['1', STATUS_YES]];

      for (var _i = 0; _i < _arr.length; _i++) {
        const _arr$_i = (0, _slicedToArray2.default)(_arr[_i], 2),
              sqlValue = _arr$_i[0],
              status = _arr$_i[1];

        const count = yield _this2.tccDb.execQuery(`SELECT count(*) FROM 'access' WHERE client='?' AND allowed=? AND service='?'`, bundleId, sqlValue, serviceName);

        if (parseInt(count.split('=')[1], 10) > 0) {
          return status;
        }
      }

      return STATUS_UNSET;
    })();
  }

}

var _default = Permissions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wZXJtaXNzaW9ucy5qcyJdLCJuYW1lcyI6WyJTVEFUVVNfVU5TRVQiLCJTVEFUVVNfWUVTIiwiU1RBVFVTX05PIiwiV0lYX1NJTV9VVElMUyIsIlNFUlZJQ0VTIiwiY2FsZW5kYXIiLCJjYW1lcmEiLCJjb250YWN0cyIsImhvbWVraXQiLCJtaWNyb3Bob25lIiwicGhvdG9zIiwicmVtaW5kZXJzIiwibWVkaWFsaWJyYXJ5IiwibW90aW9uIiwiaGVhbHRoIiwic2lyaSIsInNwZWVjaCIsInRvSW50ZXJuYWxTZXJ2aWNlTmFtZSIsInNlcnZpY2VOYW1lIiwiXyIsImhhcyIsInRvTG93ZXIiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJrZXlzIiwiZm9ybWF0U3RhdHVzIiwic3RhdHVzIiwiaW5jbHVkZXMiLCJ0b1VwcGVyIiwiZXhlY1dpeCIsImFyZ3MiLCJmcyIsIndoaWNoIiwiZSIsImxvZyIsImRlYnVnIiwic3Rkb3V0Iiwic3RkZXJyIiwibWVzc2FnZSIsIlBlcm1pc3Npb25zIiwiY29uc3RydWN0b3IiLCJ4Y29kZVZlcnNpb24iLCJzaGFyZWRSZXNvdXJjZXNEaXIiLCJ1ZGlkIiwidGNjRGIiLCJUQ0NEQiIsInNldEFjY2VzcyIsInBlcm1pc3Npb25zTWFwcGluZyIsImJ1bmRsZUlkIiwicGVybWlzc2lvbnNBcmciLCJ0b1BhaXJzIiwibWFwIiwieCIsImpvaW4iLCJnZXRBY2Nlc3MiLCJzcWxWYWx1ZSIsImNvdW50IiwiZXhlY1F1ZXJ5IiwicGFyc2VJbnQiLCJzcGxpdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLFlBQVksR0FBRyxPQUFyQjtBQUNBLE1BQU1DLFVBQVUsR0FBRyxLQUFuQjtBQUNBLE1BQU1DLFNBQVMsR0FBRyxJQUFsQjtBQUNBLE1BQU1DLGFBQWEsR0FBRyxlQUF0QjtBQUNBLE1BQU1DLFFBQVEsR0FBRztBQUNmQyxFQUFBQSxR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LENBQ25CLFFBRG1CLEVBQ1QsS0FBSSxDQUFDYyxJQURJLEVBRW5CLFVBRm1CLEVBRVBLLFFBRk8sRUFHbkIsa0JBSG1CLEVBR0NDLGNBSEQsQ0FBRCxDQUFwQjtBQUo2QztBQVM5Qzs7QUFXS0ssRUFBQUEsU0FBTixDQUFpQnJDLFdBQWpCLEVBQThCK0IsUUFBOUIsRUFBd0M7QUFBQTs7QUFBQTtBQUN0Qy9CLE1BQUFBLFdBQVcsR0FBR0QscUJBQXFCLENBQUNDLFdBQUQsQ0FBbkM7QUFEc0MsaUJBR0wsQ0FBQyxDQUFDLEdBQUQsRUFBTWhCLFNBQU4sQ0FBRCxFQUFtQixDQUFDLEdBQUQsRUFBTUQsVUFBTixDQUFuQixDQUhLOztBQUd0QywrQ0FBd0U7QUFBQTtBQUFBLGNBQTVEdUQsUUFBNEQ7QUFBQSxjQUFsRDdCLE1BQWtEOztBQUN0RSxjQUFNOEIsS0FBSyxTQUFTLE1BQUksQ0FBQ1osS0FBTCxDQUFXYSxTQUFYLENBQXNCLDhFQUF0QixFQUNsQlQsUUFEa0IsRUFDUk8sUUFEUSxFQUNFdEMsV0FERixDQUFwQjs7QUFFQSxZQUFJeUMsUUFBUSxDQUFDRixLQUFLLENBQUNHLEtBQU4sQ0FBWSxHQUFaLEVBQWlCLENBQWpCLENBQUQsRUFBc0IsRUFBdEIsQ0FBUixHQUFvQyxDQUF4QyxFQUEyQztBQUN6QyxpQkFBT2pDLE1BQVA7QUFDRDtBQUNGOztBQUNELGFBQU8zQixZQUFQO0FBVnNDO0FBV3ZDOztBQTlDZTs7ZUFpREh3QyxXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBUQ0NEQiBmcm9tICcuL3RjYy1kYic7XG5pbXBvcnQgeyBxdW90ZSB9IGZyb20gJ3NoZWxsLXF1b3RlJztcblxuY29uc3QgU1RBVFVTX1VOU0VUID0gJ3Vuc2V0JztcbmNvbnN0IFNUQVRVU19ZRVMgPSAneWVzJztcbmNvbnN0IFNUQVRVU19OTyA9ICdubyc7XG5jb25zdCBXSVhfU0lNX1VUSUxTID0gJ2FwcGxlc2ltdXRpbHMnO1xuY29uc3QgU0VSVklDRVMgPSB7XG4gIGNhbGVuZGFyOiAna1RDQ1NlcnZpY2VDYWxlbmRhcicsXG4gIGNhbWVyYTogJ2tUQ0NTZXJ2aWNlQ2FtZXJhJyxcbiAgY29udGFjdHM6ICdrVENDU2VydmljZUFkZHJlc3NCb29rJyxcbiAgaG9tZWtpdDogJ2tUQ0NTZXJ2aWNlV2lsbG93JyxcbiAgbWljcm9waG9uZTogJ2tUQ0NTZXJ2aWNlTWljcm9waG9uZScsXG4gIHBob3RvczogJ2tUQ0NTZXJ2aWNlUGhvdG9zJyxcbiAgcmVtaW5kZXJzOiAna1RDQ1NlcnZpY2VSZW1pbmRlcnMnLFxuICBtZWRpYWxpYnJhcnk6ICdrVENDU2VydmljZU1lZGlhTGlicmFyeScsXG4gIG1vdGlvbjogJ2tUQ0NTZXJ2aWNlTW90aW9uJyxcbiAgaGVhbHRoOiAna1RDQ1NlcnZpY2VNU08nLFxuICBzaXJpOiAna1RDQ1NlcnZpY2VTaXJpJyxcbiAgc3BlZWNoOiAna1RDQ1NlcnZpY2VTcGVlY2hSZWNvZ25pdGlvbicsXG59O1xuXG5mdW5jdGlvbiB0b0ludGVybmFsU2VydmljZU5hbWUgKHNlcnZpY2VOYW1lKSB7XG4gIGlmIChfLmhhcyhTRVJWSUNFUywgXy50b0xvd2VyKHNlcnZpY2VOYW1lKSkpIHtcbiAgICByZXR1cm4gU0VSVklDRVNbXy50b0xvd2VyKHNlcnZpY2VOYW1lKV07XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGAnJHtzZXJ2aWNlTmFtZX0nIGlzIHVua25vd24uIE9ubHkgdGhlIGZvbGxvd2luZyBzZXJ2aWNlIG5hbWVzIGFyZSBzdXBwb3J0ZWQ6ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKFNFUlZJQ0VTKSl9YCk7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFN0YXR1cyAoc3RhdHVzKSB7XG4gIHJldHVybiBbU1RBVFVTX1VOU0VULCBTVEFUVVNfTk9dLmluY2x1ZGVzKHN0YXR1cykgPyBfLnRvVXBwZXIoc3RhdHVzKSA6IHN0YXR1cztcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXhlY1dpeCAoYXJncykge1xuICB0cnkge1xuICAgIGF3YWl0IGZzLndoaWNoKFdJWF9TSU1fVVRJTFMpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke1dJWF9TSU1fVVRJTFN9IGJpbmFyeSBoYXMgbm90IGJlZW4gZm91bmQgaW4geW91ciBQQVRILiBgICtcbiAgICAgIGBQbGVhc2UgaW5zdGFsbCBpdCAoJ2JyZXcgdGFwIHdpeC9icmV3ICYmIGJyZXcgaW5zdGFsbCB3aXgvYnJldy9hcHBsZXNpbXV0aWxzJykgdG8gYCArXG4gICAgICBgYmUgYWJsZSB0byBjaGFuZ2UgYXBwbGljYXRpb24gcGVybWlzc2lvbnNgKTtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nOiAke1dJWF9TSU1fVVRJTFN9ICR7cXVvdGUoYXJncyl9YCk7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKFdJWF9TSU1fVVRJTFMsIGFyZ3MpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tbWFuZCBvdXRwdXQ6ICR7c3Rkb3V0fWApO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleGVjdXRlIFwiJHtXSVhfU0lNX1VUSUxTfSAke3F1b3RlKGFyZ3MpfVwiLiBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuY2xhc3MgUGVybWlzc2lvbnMge1xuICBjb25zdHJ1Y3RvciAoeGNvZGVWZXJzaW9uLCBzaGFyZWRSZXNvdXJjZXNEaXIsIHVkaWQpIHtcbiAgICB0aGlzLnRjY0RiID0gbmV3IFRDQ0RCKHhjb2RlVmVyc2lvbiwgc2hhcmVkUmVzb3VyY2VzRGlyKTtcbiAgICB0aGlzLnVkaWQgPSB1ZGlkO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgcGVybWlzc2lvbnMgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvblxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gcGVybWlzc2lvbnNNYXBwaW5nIC0gQW4gb2JqZWN0LCB3aGVyZSBrZXlzIGFyICBzZXJ2aWNlIG5hbWVzXG4gICAqIGFuZCB2YWx1ZXMgYXJlIGNvcnJlc3BvbmRpbmcgc3RhdGUgdmFsdWVzLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzXG4gICAqIGZvciBtb3JlIGRldGFpbHMgb24gYXZhaWxhYmxlIHNlcnZpY2UgbmFtZXMgYW5kIHN0YXR1c2VzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGNoYW5naW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgc2V0QWNjZXNzIChwZXJtaXNzaW9uc01hcHBpbmcsIGJ1bmRsZUlkKSB7XG4gICAgY29uc3QgcGVybWlzc2lvbnNBcmcgPSBfLnRvUGFpcnMocGVybWlzc2lvbnNNYXBwaW5nKVxuICAgICAgLm1hcCgoeCkgPT4gYCR7eFswXX09JHtmb3JtYXRTdGF0dXMoeFsxXSl9YClcbiAgICAgIC5qb2luKCcsJyk7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWNXaXgoW1xuICAgICAgJy0tYnlJZCcsIHRoaXMudWRpZCxcbiAgICAgICctLWJ1bmRsZScsIGJ1bmRsZUlkLFxuICAgICAgJy0tc2V0UGVybWlzc2lvbnMnLCBwZXJtaXNzaW9uc0FyZyxcbiAgICBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcGVybWlzc2lvbiBzdGF0dXMgZm9yIHRoZSBnaXZlbiBzZXJ2aWNlIGFuZCBhcHBsaWNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlcnZpY2VOYW1lIC0gdGhlIG5hbWUgb2YgdGhlIHNlcnZpY2UuIFNob3VsZCBiZSBvbmUgb2ZcbiAgICogYFNFUlZJQ0VTYCBrZXlzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSBjdXJyZW50IHN0YXR1czogeWVzL25vL3Vuc2V0XG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcmV0cmlldmluZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldEFjY2VzcyAoc2VydmljZU5hbWUsIGJ1bmRsZUlkKSB7XG4gICAgc2VydmljZU5hbWUgPSB0b0ludGVybmFsU2VydmljZU5hbWUoc2VydmljZU5hbWUpO1xuXG4gICAgZm9yIChjb25zdCBbc3FsVmFsdWUsIHN0YXR1c10gb2YgW1snMCcsIFNUQVRVU19OT10sIFsnMScsIFNUQVRVU19ZRVNdXSkge1xuICAgICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLnRjY0RiLmV4ZWNRdWVyeShgU0VMRUNUIGNvdW50KCopIEZST00gJ2FjY2VzcycgV0hFUkUgY2xpZW50PSc/JyBBTkQgYWxsb3dlZD0/IEFORCBzZXJ2aWNlPSc/J2AsXG4gICAgICAgIGJ1bmRsZUlkLCBzcWxWYWx1ZSwgc2VydmljZU5hbWUpO1xuICAgICAgaWYgKHBhcnNlSW50KGNvdW50LnNwbGl0KCc9JylbMV0sIDEwKSA+IDApIHtcbiAgICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFNUQVRVU19VTlNFVDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQZXJtaXNzaW9uczsiXSwiZmlsZSI6ImxpYi9wZXJtaXNzaW9ucy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
