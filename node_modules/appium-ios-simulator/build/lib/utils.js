"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.killAllSimulators = killAllSimulators;
exports.endAllSimulatorDaemons = endAllSimulatorDaemons;
exports.safeRimRaf = safeRimRaf;
exports.simExists = simExists;
exports.installSSLCert = installSSLCert;
exports.uninstallSSLCert = uninstallSSLCert;
exports.hasSSLCert = hasSSLCert;
exports.execSQLiteQuery = execSQLiteQuery;
exports.toBiometricDomainComponent = toBiometricDomainComponent;
exports.getDeveloperRoot = getDeveloperRoot;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumXcode = require("appium-xcode");

var _nodeSimctl = require("node-simctl");

var _appiumSupport = require("appium-support");

var _certificate = require("./certificate");

var _path = _interopRequireDefault(require("path"));

var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-6"));

var _fkill = _interopRequireDefault(require("fkill"));

const DEFAULT_SIM_SHUTDOWN_TIMEOUT = 30000;
const BIOMETRICS = {
  touchId: 'fingerTouch',
  faceId: 'pearl'
};

function toBiometricDomainComponent(name) {
  if (!BIOMETRICS[name]) {
    throw new Error(`'${name}' is not a valid biometric. Use one of: ${JSON.stringify(_lodash.default.keys(BIOMETRICS))}`);
  }

  return BIOMETRICS[name];
}

function pkill(_x) {
  return _pkill.apply(this, arguments);
}

function _pkill() {
  _pkill = (0, _asyncToGenerator2.default)(function* (appName, forceKill = false) {
    let args = forceKill ? ['-9'] : [];
    args.push('-x', appName);

    try {
      yield (0, _teen_process.exec)('pkill', args);
      return 0;
    } catch (err) {
      if (!_lodash.default.isUndefined(err.code)) {
        throw new Error(`Cannot forcefully terminate ${appName}. pkill error code: ${err.code}`);
      }

      _logger.default.error(`Received unexpected error while trying to kill ${appName}: ${err.message}`);

      throw err;
    }
  });
  return _pkill.apply(this, arguments);
}

function killAllSimulators() {
  return _killAllSimulators.apply(this, arguments);
}

function _killAllSimulators() {
  _killAllSimulators = (0, _asyncToGenerator2.default)(function* (timeout = DEFAULT_SIM_SHUTDOWN_TIMEOUT) {
    _logger.default.debug('Killing all iOS Simulators');

    const xcodeVersion = yield (0, _appiumXcode.getVersion)(true);
    const appName = xcodeVersion.major >= 7 ? 'Simulator' : 'iOS Simulator';
    timeout = timeout * (xcodeVersion.major >= 8 ? 2 : 1);

    try {
      yield (0, _teen_process.exec)('xcrun', ['simctl', 'shutdown', xcodeVersion.major > 8 ? 'all' : 'booted'], {
        timeout
      });
    } catch (ign) {}

    const pids = [];

    try {
      const _ref = yield (0, _teen_process.exec)('osascript', ['-e', `tell application "System Events" to unix id of processes whose bundle identifier is "com.apple.iphonesimulator"`]),
            stdout = _ref.stdout;

      if (stdout.trim()) {
        pids.push(...stdout.trim().split(/\s+/));
      }
    } catch (ign) {}

    try {
      const _ref2 = yield (0, _teen_process.exec)('pgrep', ['-x', appName]),
            stdout = _ref2.stdout;

      if (stdout.trim()) {
        pids.push(...stdout.trim().split('\n'));
      }
    } catch (e) {
      if (e.code === 1 && !pids.length) {
        _logger.default.debug(`${appName} is not running. Continuing...`);

        return;
      }

      if (!pids.length) {
        _logger.default.warn(`pgrep error ${e.code} while detecting whether ${appName} is running. Trying to kill anyway.`);
      }
    }

    if (pids.length) {
      const uniquePids = _lodash.default.uniq(pids);

      _logger.default.debug(`Using fkill to kill processes: ${uniquePids.join(', ')}`);

      try {
        yield (0, _fkill.default)(uniquePids, {
          force: true
        });
      } catch (ign) {}
    }

    _logger.default.debug(`Using pkill to kill application: ${appName}`);

    try {
      yield pkill(appName, true);
    } catch (ign) {}

    let remainingDevices = [];

    function allSimsAreDown() {
      return _allSimsAreDown.apply(this, arguments);
    }

    function _allSimsAreDown() {
      _allSimsAreDown = (0, _asyncToGenerator2.default)(function* () {
        remainingDevices = [];
        let devices = yield (0, _nodeSimctl.getDevices)();
        devices = _lodash.default.flatten(_lodash.default.values(devices));
        return _lodash.default.every(devices, sim => {
          let state = sim.state.toLowerCase();
          let done = state === 'shutdown' || state === 'unavailable' || state === 'disconnected';

          if (!done) {
            remainingDevices.push(`${sim.name} (${sim.sdk}, udid: ${sim.udid}) is still in state '${state}'`);
          }

          return done;
        });
      });
      return _allSimsAreDown.apply(this, arguments);
    }

    try {
      yield (0, _asyncbox.waitForCondition)(allSimsAreDown, {
        waitMs: timeout,
        intervalMs: 200
      });
    } catch (err) {
      if (remainingDevices.length > 0) {
        _logger.default.warn(`The following devices are still not in the correct state after ${timeout} ms:`);

        for (var _i = 0; _i < remainingDevices.length; _i++) {
          let device = remainingDevices[_i];

          _logger.default.warn(`    ${device}`);
        }
      }

      throw err;
    }
  });
  return _killAllSimulators.apply(this, arguments);
}

function endAllSimulatorDaemons() {
  return _endAllSimulatorDaemons.apply(this, arguments);
}

function _endAllSimulatorDaemons() {
  _endAllSimulatorDaemons = (0, _asyncToGenerator2.default)(function* () {
    _logger.default.debug('Ending all simulator daemons');

    var _arr = ['com.apple.iphonesimulator', 'com.apple.CoreSimulator'];

    for (var _i2 = 0; _i2 < _arr.length; _i2++) {
      let servicePattern = _arr[_i2];

      _logger.default.debug(`Killing any other ${servicePattern} daemons`);

      let launchCtlCommand = `launchctl list | grep ${servicePattern} | cut -f 3 | xargs -n 1 launchctl`;

      try {
        let stopCmd = `${launchCtlCommand} stop`;
        yield (0, _teen_process.exec)('bash', ['-c', stopCmd]);
      } catch (err) {
        _logger.default.warn(`Could not stop ${servicePattern} daemons, carrying on anyway!`);
      }

      try {
        let removeCmd = `${launchCtlCommand} remove`;
        yield (0, _teen_process.exec)('bash', ['-c', removeCmd]);
      } catch (err) {
        _logger.default.warn(`Could not remove ${servicePattern} daemons, carrying on anyway!`);
      }
    }

    try {
      yield (0, _asyncbox.waitForCondition)((0, _asyncToGenerator2.default)(function* () {
        let _ref4 = yield (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]),
            stdout = _ref4.stdout;

        return stdout.trim().length === 0;
      }), {
        waitMs: 5000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end all simulator daemons, carrying on!`);
    }

    _logger.default.debug('Finishing ending all simulator daemons');
  });
  return _endAllSimulatorDaemons.apply(this, arguments);
}

function simExists(_x2) {
  return _simExists.apply(this, arguments);
}

function _simExists() {
  _simExists = (0, _asyncToGenerator2.default)(function* (udid) {
    let devices = yield (0, _nodeSimctl.getDevices)();
    devices = _lodash.default.toPairs(devices).map(pair => {
      return pair[1];
    }).reduce((a, b) => {
      return a.concat(b);
    }, []);
    return !!_lodash.default.find(devices, sim => {
      return sim.udid === udid;
    });
  });
  return _simExists.apply(this, arguments);
}

function safeRimRaf(_x3) {
  return _safeRimRaf.apply(this, arguments);
}

function _safeRimRaf() {
  _safeRimRaf = (0, _asyncToGenerator2.default)(function* (delPath, tryNum = 0) {
    try {
      yield _appiumSupport.fs.rimraf(delPath);
    } catch (err) {
      if (tryNum < 20) {
        if (err.message.indexOf('ENOTEMPTY') !== -1) {
          _logger.default.debug(`Path '${delPath}' was not empty during delete; retrying`);

          return yield safeRimRaf(delPath, tryNum + 1);
        } else if (err.message.indexOf('ENOENT') !== -1) {
          _logger.default.debug(`Path '${delPath}' did not exist when we tried to delete, ignoring`);

          return yield safeRimRaf(delPath, tryNum + 1);
        }
      }
    }
  });
  return _safeRimRaf.apply(this, arguments);
}

function installSSLCert(_x4, _x5) {
  return _installSSLCert.apply(this, arguments);
}

function _installSSLCert() {
  _installSSLCert = (0, _asyncToGenerator2.default)(function* (pemText, udid) {
    try {
      yield _appiumSupport.fs.which('openssl');
    } catch (e) {
      _logger.default.debug(`customSSLCert requires openssl to be available on path`);

      _logger.default.errorAndThrow(`Command 'openssl' not found`);
    }

    try {
      yield _appiumSupport.fs.which('sqlite3');
    } catch (e) {
      _logger.default.debug(`customSSLCert requires sqlite3 to be available on path`);

      _logger.default.errorAndThrow(`Command 'sqlite3' not found`);
    }

    let tempFileName = _path.default.resolve((yield _appiumSupport.tempDir.openDir()), 'temp-ssl-cert.pem');

    let pathToKeychain = new _simulatorXcode.default(udid).getDir();
    yield _appiumSupport.fs.writeFile(tempFileName, pemText);

    try {
      yield _appiumSupport.fs.stat(pathToKeychain);
    } catch (e) {
      _logger.default.debug(`Could not install SSL certificate. No simulator with udid '${udid}'`);

      _logger.default.errorAndThrow(e);
    }

    let certificate = new _certificate.Certificate(tempFileName);

    _logger.default.debug(`Installing certificate to ${pathToKeychain}`);

    yield certificate.add(pathToKeychain);
    yield _appiumSupport.fs.unlink(tempFileName);
    return certificate;
  });
  return _installSSLCert.apply(this, arguments);
}

function uninstallSSLCert(_x6, _x7) {
  return _uninstallSSLCert.apply(this, arguments);
}

function _uninstallSSLCert() {
  _uninstallSSLCert = (0, _asyncToGenerator2.default)(function* (pemText, udid) {
    try {
      let tempFileName = _path.default.resolve(__dirname, 'temp-ssl-cert.pem');

      let pathToKeychain = _path.default.resolve(new _simulatorXcode.default(udid).getDir());

      yield _appiumSupport.fs.writeFile(tempFileName, pemText);
      let certificate = new _certificate.Certificate(tempFileName);
      yield certificate.remove(pathToKeychain);
      yield _appiumSupport.fs.unlink(tempFileName);
      return certificate;
    } catch (e) {
      _logger.default.debug(`Could not uninstall SSL certificate. No simulator with udid '${udid}'`);

      _logger.default.errorAndThrow(e);
    }
  });
  return _uninstallSSLCert.apply(this, arguments);
}

function hasSSLCert(_x8, _x9) {
  return _hasSSLCert.apply(this, arguments);
}

function _hasSSLCert() {
  _hasSSLCert = (0, _asyncToGenerator2.default)(function* (pemText, udid) {
    const tempFileName = _path.default.resolve((yield _appiumSupport.tempDir.openDir()), 'temp-ssl-cert.pem');

    const pathToKeychain = new _simulatorXcode.default(udid).getDir();
    yield _appiumSupport.fs.writeFile(tempFileName, pemText);
    const certificate = new _certificate.Certificate(tempFileName);
    return certificate.has(pathToKeychain);
  });
  return _hasSSLCert.apply(this, arguments);
}

function execSQLiteQuery(_x10, _x11) {
  return _execSQLiteQuery.apply(this, arguments);
}

function _execSQLiteQuery() {
  _execSQLiteQuery = (0, _asyncToGenerator2.default)(function* (db, query, ...queryParams) {
    query = query.replace(/\n+/g, ' ');
    let queryTokens = query.split('?');
    let formattedQuery = [];
    queryParams.map(param => `${param}`).forEach((param, i) => {
      formattedQuery.push(queryTokens[i]);
      formattedQuery.push(param.replace(/'/g, "''"));
    });
    formattedQuery.push(queryTokens[queryTokens.length - 1]);

    _logger.default.debug(`Executing SQL query "${formattedQuery.join('')}" on '${db}'`);

    try {
      return (yield (0, _teen_process.exec)('sqlite3', ['-line', db, formattedQuery.join('')])).stdout;
    } catch (err) {
      throw new Error(`Cannot execute SQLite query "${formattedQuery.join('')}" to '${db}'. ` + `Original error: ${err.stderr}`);
    }
  });
  return _execSQLiteQuery.apply(this, arguments);
}

function getDeveloperRoot() {
  return _getDeveloperRoot.apply(this, arguments);
}

function _getDeveloperRoot() {
  _getDeveloperRoot = (0, _asyncToGenerator2.default)(function* () {
    const _ref5 = yield (0, _teen_process.exec)('xcode-select', ['-p']),
          stdout = _ref5.stdout;

    return stdout.trim();
  });
  return _getDeveloperRoot.apply(this, arguments);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUIiwiQklPTUVUUklDUyIsInRvdWNoSWQiLCJmYWNlSWQiLCJ0b0Jpb21ldHJpY0RvbWFpbkNvbXBvbmVudCIsIm5hbWUiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJfIiwia2V5cyIsInBraWxsIiwiYXBwTmFtZSIsImZvcmNlS2lsbCIsImFyZ3MiLCJwdXNoIiwiZXJyIiwiaXNVbmRlZmluZWQiLCJjb2RlIiwibG9nIiwiZXJyb3IiLCJtZXNzYWdlIiwia2lsbEFsbFNpbXVsYXRvcnMiLCJ0aW1lb3V0IiwiZGVidWciLCJ4Y29kZVZlcnNpb24iLCJtYWpvciIsImlnbiIsInBpZHMiLCJzdGRvdXQiLCJ0cmltIiwic3BsaXQiLCJlIiwibGVuZ3RoIiwid2FybiIsInVuaXF1ZVBpZHMiLCJ1bmlxIiwiam9pbiIsImZvcmNlIiwicmVtYWluaW5nRGV2aWNlcyIsImFsbFNpbXNBcmVEb3duIiwiZGV2aWNlcyIsImZsYXR0ZW4iLCJ2YWx1ZXMiLCJldmVyeSIsInNpbSIsInN0YXRlIiwidG9Mb3dlckNhc2UiLCJkb25lIiwic2RrIiwidWRpZCIsIndhaXRNcyIsImludGVydmFsTXMiLCJkZXZpY2UiLCJlbmRBbGxTaW11bGF0b3JEYWVtb25zIiwic2VydmljZVBhdHRlcm4iLCJsYXVuY2hDdGxDb21tYW5kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsInNpbUV4aXN0cyIsInRvUGFpcnMiLCJtYXAiLCJwYWlyIiwicmVkdWNlIiwiYSIsImIiLCJjb25jYXQiLCJmaW5kIiwic2FmZVJpbVJhZiIsImRlbFBhdGgiLCJ0cnlOdW0iLCJmcyIsInJpbXJhZiIsImluZGV4T2YiLCJpbnN0YWxsU1NMQ2VydCIsInBlbVRleHQiLCJ3aGljaCIsImVycm9yQW5kVGhyb3ciLCJ0ZW1wRmlsZU5hbWUiLCJwYXRoIiwicmVzb2x2ZSIsInRlbXBEaXIiLCJvcGVuRGlyIiwicGF0aFRvS2V5Y2hhaW4iLCJTaW11bGF0b3IiLCJnZXREaXIiLCJ3cml0ZUZpbGUiLCJzdGF0IiwiY2VydGlmaWNhdGUiLCJDZXJ0aWZpY2F0ZSIsImFkZCIsInVubGluayIsInVuaW5zdGFsbFNTTENlcnQiLCJfX2Rpcm5hbWUiLCJyZW1vdmUiLCJoYXNTU0xDZXJ0IiwiaGFzIiwiZXhlY1NRTGl0ZVF1ZXJ5IiwiZGIiLCJxdWVyeSIsInF1ZXJ5UGFyYW1zIiwicmVwbGFjZSIsInF1ZXJ5VG9rZW5zIiwiZm9ybWF0dGVkUXVlcnkiLCJwYXJhbSIsImZvckVhY2giLCJpIiwic3RkZXJyIiwiZ2V0RGV2ZWxvcGVyUm9vdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSw0QkFBNEIsR0FBRyxLQUFyQztBQUVBLE1BQU1DLFVBQVUsR0FBRztBQUNqQkMsRUFBQUEsT0FBTyxFQUFFLGFBRFE7QUFFakJDLEVBQUFBLE1BQU0sRUFBRTtBQUZTLENBQW5COztBQUtBLFNBQVNDLDBCQUFULENBQXFDQyxJQUFyQyxFQUEyQztBQUN6QyxNQUFJLENBQUNKLFVBQVUsQ0FBQ0ksSUFBRCxDQUFmLEVBQXVCO0FBQ3JCLFVBQU0sSUFBSUMsS0FBSixDQUFXLElBQUdELElBQUssMkNBQTBDRSxJQUFJLENBQUNDLFNBQUwsQ0FBZUMsZ0JBQUVDLElBQUYsQ0FBT1QsVUFBUCxDQUFmLENBQW1DLEVBQWhHLENBQU47QUFDRDs7QUFDRCxTQUFPQSxVQUFVLENBQUNJLElBQUQsQ0FBakI7QUFDRDs7U0FRY00sSzs7Ozs7MkNBQWYsV0FBc0JDLE9BQXRCLEVBQStCQyxTQUFTLEdBQUcsS0FBM0MsRUFBa0Q7QUFDaEQsUUFBSUMsSUFBSSxHQUFHRCxTQUFTLEdBQUcsQ0FBQyxJQUFELENBQUgsR0FBWSxFQUFoQztBQUNBQyxJQUFBQSxJQUFJLENBQUNDLElBQUwsQ0FBVSxJQUFWLEVB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SSxDQUFELENBQS9CO0FBQ0FILE1BQUFBLGNBQWMsQ0FBQ3hGLElBQWYsQ0FBb0J5RixLQUFLLENBQUNILE9BQU4sQ0FBYyxJQUFkLEVBQW9CLElBQXBCLENBQXBCO0FBQ0QsS0FMSDtBQU1BRSxJQUFBQSxjQUFjLENBQUN4RixJQUFmLENBQW9CdUYsV0FBVyxDQUFDQSxXQUFXLENBQUNyRSxNQUFaLEdBQXFCLENBQXRCLENBQS9COztBQUVBZCxvQkFBSUssS0FBSixDQUFXLHdCQUF1QitFLGNBQWMsQ0FBQ2xFLElBQWYsQ0FBb0IsRUFBcEIsQ0FBd0IsU0FBUTZELEVBQUcsR0FBckU7O0FBQ0EsUUFBSTtBQUNGLGFBQU8sT0FBTyx3QkFBSyxTQUFMLEVBQWdCLENBQUMsT0FBRCxFQUFVQSxFQUFWLEVBQWNLLGNBQWMsQ0FBQ2xFLElBQWYsQ0FBb0IsRUFBcEIsQ0FBZCxDQUFoQixDQUFQLEVBQWdFUixNQUF2RTtBQUNELEtBRkQsQ0FFRSxPQUFPYixHQUFQLEVBQVk7QUFDWixZQUFNLElBQUlWLEtBQUosQ0FBVyxnQ0FBK0JpRyxjQUFjLENBQUNsRSxJQUFmLENBQW9CLEVBQXBCLENBQXdCLFNBQVE2RCxFQUFHLEtBQW5FLEdBQ2IsbUJBQWtCbEYsR0FBRyxDQUFDMkYsTUFBTyxFQUQxQixDQUFOO0FBRUQ7QUFDRixHOzs7O1NBRWNDLGdCOzs7OztzREFBZixhQUFtQztBQUFBLHdCQUNWLHdCQUFLLGNBQUwsRUFBcUIsQ0FBQyxJQUFELENBQXJCLENBRFU7QUFBQSxVQUMxQi9FLE1BRDBCLFNBQzFCQSxNQUQwQjs7QUFFakMsV0FBT0EsTUFBTSxDQUFDQyxJQUFQLEVBQVA7QUFDRCxHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZ2V0VmVyc2lvbiB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgeyBnZXREZXZpY2VzIH0gZnJvbSAnbm9kZS1zaW1jdGwnO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBDZXJ0aWZpY2F0ZSB9IGZyb20gJy4vY2VydGlmaWNhdGUnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgU2ltdWxhdG9yIGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTYnO1xuaW1wb3J0IGZraWxsIGZyb20gJ2ZraWxsJztcblxuXG5jb25zdCBERUZBVUxUX1NJTV9TSFVURE9XTl9USU1FT1VUID0gMzAwMDA7XG5cbmNvbnN0IEJJT01FVFJJQ1MgPSB7XG4gIHRvdWNoSWQ6ICdmaW5nZXJUb3VjaCcsXG4gIGZhY2VJZDogJ3BlYXJsJyxcbn07XG5cbmZ1bmN0aW9uIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IChuYW1lKSB7XG4gIGlmICghQklPTUVUUklDU1tuYW1lXSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7bmFtZX0nIGlzIG5vdCBhIHZhbGlkIGJpb21ldHJpYy4gVXNlIG9uZSBvZjogJHtKU09OLnN0cmluZ2lmeShfLmtleXMoQklPTUVUUklDUykpfWApO1xuICB9XG4gIHJldHVybiBCSU9NRVRSSUNTW25hbWVdO1xufVxuXG4vLyBwZ3JlcC9wa2lsbCBleGl0IGNvZGVzOlxuLy8gMCAgICAgICBPbmUgb3IgbW9yZSBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMSAgICAgICBObyBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMiAgICAgICBJbnZhbGlkIG9wdGlvbnMgd2VyZSBzcGVjaWZpZWQgb24gdGhlIGNvbW1hbmQgbGluZS5cbi8vIDMgICAgICAgQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuXG5cbmFzeW5jIGZ1bmN0aW9uIHBraWxsIChhcHBOYW1lLCBmb3JjZUtpbGwgPSBmYWxzZSkge1xuICBsZXQgYXJncyA9IGZvcmNlS2lsbCA/IFsnLTknXSA6IFtdO1xuICBhcmdzLnB1c2goJy14JywgYXBwTmFtZSk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYygncGtpbGwnLCBhcmdzKTtcbiAgICByZXR1cm4gMDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKGVyci5jb2RlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZm9yY2VmdWxseSB0ZXJtaW5hdGUgJHthcHBOYW1lfS4gcGtpbGwgZXJyb3IgY29kZTogJHtlcnIuY29kZX1gKTtcbiAgICB9XG4gICAgbG9nLmVycm9yKGBSZWNlaXZlZCB1bmV4cGVjdGVkIGVycm9yIHdoaWxlIHRyeWluZyB0byBraWxsICR7YXBwTmFtZX06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGtpbGxBbGxTaW11bGF0b3JzICh0aW1lb3V0ID0gREVGQVVMVF9TSU1fU0hVVERPV05fVElNRU9VVCkge1xuICBsb2cuZGVidWcoJ0tpbGxpbmcgYWxsIGlPUyBTaW11bGF0b3JzJyk7XG4gIGNvbnN0IHhjb2RlVmVyc2lvbiA9IGF3YWl0IGdldFZlcnNpb24odHJ1ZSk7XG4gIGNvbnN0IGFwcE5hbWUgPSB4Y29kZVZlcnNpb24ubWFqb3IgPj0gNyA/ICdTaW11bGF0b3InIDogJ2lPUyBTaW11bGF0b3InO1xuXG4gIC8vIGxhdGVyIHZlcnNpb25zIGFyZSBzbG93ZXIgdG8gY2xvc2VcbiAgdGltZW91dCA9IHRpbWVvdXQgKiAoeGNvZGVWZXJzaW9uLm1ham9yID49IDggPyAyIDogMSk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKCd4Y3J1bicsIFsnc2ltY3RsJywgJ3NodXRkb3duJywgeGNvZGVWZXJzaW9uLm1ham9yID4gOCA/ICdhbGwnIDogJ2Jvb3RlZCddLCB7dGltZW91dH0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgY29uc3QgcGlkcyA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnb3Nhc2NyaXB0JyxcbiAgICAgIFsnLWUnLCBgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIiB0byB1bml4IGlkIG9mIHByb2Nlc3NlcyB3aG9zZSBidW5kbGUgaWRlbnRpZmllciBpcyBcImNvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3JcImBdKTtcbiAgICBpZiAoc3Rkb3V0LnRyaW0oKSkge1xuICAgICAgcGlkcy5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLykpKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGlnbikge31cbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BncmVwJywgWycteCcsIGFwcE5hbWVdKTtcbiAgICBpZiAoc3Rkb3V0LnRyaW0oKSkge1xuICAgICAgcGlkcy5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KCdcXG4nKSkpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlLmNvZGUgPT09IDEgJiYgIXBpZHMubGVuZ3RoKSB7XG4gICAgICBsb2cuZGVidWcoYCR7YXBwTmFtZX0gaXMgbm90IHJ1bm5pbmcuIENvbnRpbnVpbmcuLi5gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFwaWRzLmxlbmd0aCkge1xuICAgICAgbG9nLndhcm4oYHBncmVwIGVycm9yICR7ZS5jb2RlfSB3aGlsZSBkZXRlY3Rpbmcgd2hldGhlciAke2FwcE5hbWV9IGlzIHJ1bm5pbmcuIFRyeWluZyB0byBraWxsIGFueXdheS5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKHBpZHMubGVuZ3RoKSB7XG4gICAgY29uc3QgdW5pcXVlUGlkcyA9IF8udW5pcShwaWRzKTtcbiAgICBsb2cuZGVidWcoYFVzaW5nIGZraWxsIHRvIGtpbGwgcHJvY2Vzc2VzOiAke3VuaXF1ZVBpZHMuam9pbignLCAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZmtpbGwodW5pcXVlUGlkcywge2ZvcmNlOiB0cnVlfSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9XG5cbiAgbG9nLmRlYnVnKGBVc2luZyBwa2lsbCB0byBraWxsIGFwcGxpY2F0aW9uOiAke2FwcE5hbWV9YCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgcGtpbGwoYXBwTmFtZSwgdHJ1ZSk7XG4gIH0gY2F0Y2ggKGlnbikge31cblxuICAvLyB3YWl0IGZvciBhbGwgdGhlIGRldmljZXMgdG8gYmUgc2h1dGRvd24gYmVmb3JlIENvbnRpbnVpbmdcbiAgLy8gYnV0IG9ubHkgcHJpbnQgb3V0IHRoZSBmYWlsZWQgb25lcyB3aGVuIHRoZXkgYXJlIGFjdHVhbGx5IGZ1bGx5IGZhaWxlZFxuICBsZXQgcmVtYWluaW5nRGV2aWNlcyA9IFtdO1xuICBhc3luYyBmdW5jdGlvbiBhbGxTaW1zQXJlRG93biAoKSB7XG4gICAgcmVtYWluaW5nRGV2aWNlcyA9IFtdO1xuICAgIGxldCBkZXZpY2VzID0gYXdhaXQgZ2V0RGV2aWNlcygpO1xuICAgIGRldmljZXMgPSBfLmZsYXR0ZW4oXy52YWx1ZXMoZGV2aWNlcykpO1xuICAgIHJldHVybiBfLmV2ZXJ5KGRldmljZXMsIChzaW0pID0+IHtcbiAgICAgIGxldCBzdGF0ZSA9IHNpbS5zdGF0ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgbGV0IGRvbmUgPSBzdGF0ZSA9PT0gJ3NodXRkb3duJyB8fFxuICAgICAgICAgICAgICAgICBzdGF0ZSA9PT0gJ3VuYXZhaWxhYmxlJyB8fFxuICAgICAgICAgICAgICAgICBzdGF0ZSA9PT0gJ2Rpc2Nvbm5lY3RlZCc7XG4gICAgICBpZiAoIWRvbmUpIHtcbiAgICAgICAgcmVtYWluaW5nRGV2aWNlcy5wdXNoKGAke3NpbS5uYW1lfSAoJHtzaW0uc2RrfSwgdWRpZDogJHtzaW0udWRpZH0pIGlzIHN0aWxsIGluIHN0YXRlICcke3N0YXRlfSdgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkb25lO1xuICAgIH0pO1xuICB9XG4gIHRyeSB7XG4gICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhbGxTaW1zQXJlRG93biwge1xuICAgICAgd2FpdE1zOiB0aW1lb3V0LFxuICAgICAgaW50ZXJ2YWxNczogMjAwXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChyZW1haW5pbmdEZXZpY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZy53YXJuKGBUaGUgZm9sbG93aW5nIGRldmljZXMgYXJlIHN0aWxsIG5vdCBpbiB0aGUgY29ycmVjdCBzdGF0ZSBhZnRlciAke3RpbWVvdXR9IG1zOmApO1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIHJlbWFpbmluZ0RldmljZXMpIHtcbiAgICAgICAgbG9nLndhcm4oYCAgICAke2RldmljZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgZXJyO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVuZEFsbFNpbXVsYXRvckRhZW1vbnMgKCkge1xuICBsb2cuZGVidWcoJ0VuZGluZyBhbGwgc2ltdWxhdG9yIGRhZW1vbnMnKTtcbiAgZm9yIChsZXQgc2VydmljZVBhdHRlcm4gb2YgWydjb20uYXBwbGUuaXBob25lc2ltdWxhdG9yJywgJ2NvbS5hcHBsZS5Db3JlU2ltdWxhdG9yJ10pIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgYW55IG90aGVyICR7c2VydmljZVBhdHRlcm59IGRhZW1vbnNgKTtcbiAgICBsZXQgbGF1bmNoQ3RsQ29tbWFuZCA9IGBsYXVuY2hjdGwgbGlzdCB8IGdyZXAgJHtzZXJ2aWNlUGF0dGVybn0gfCBjdXQgLWYgMyB8IHhhcmdzIC1uIDEgbGF1bmNoY3RsYDtcbiAgICB0cnkge1xuICAgICAgbGV0IHN0b3BDbWQgPSBgJHtsYXVuY2hDdGxDb21tYW5kfSBzdG9wYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgc3RvcENtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBzdG9wICR7c2VydmljZVBhdHRlcm59IGRhZW1vbnMsIGNhcnJ5aW5nIG9uIGFueXdheSFgKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGxldCByZW1vdmVDbWQgPSBgJHtsYXVuY2hDdGxDb21tYW5kfSByZW1vdmVgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCByZW1vdmVDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3QgcmVtb3ZlICR7c2VydmljZVBhdHRlcm59IGRhZW1vbnMsIGNhcnJ5aW5nIG9uIGFueXdheSFgKTtcbiAgICB9XG4gIH1cbiAgLy8gd2FpdGluZyB1bnRpbCB0aGUgc2ltdWxhdG9yIHNlcnZpY2UgaGFzIGRpZWQuXG4gIHRyeSB7XG4gICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsXG4gICAgICAgIGBwcyAtZSAgfCBncmVwIGxhdW5jaGRfc2ltIHwgZ3JlcCAtdiBiYXNoIHwgZ3JlcCAtdiBncmVwIHwgYXdrIHsncHJpbnQkMSd9YF0pO1xuICAgICAgcmV0dXJuIHN0ZG91dC50cmltKCkubGVuZ3RoID09PSAwO1xuICAgIH0sIHt3YWl0TXM6IDUwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgQ291bGQgbm90IGVuZCBhbGwgc2ltdWxhdG9yIGRhZW1vbnMsIGNhcnJ5aW5nIG9uIWApO1xuICB9XG4gIGxvZy5kZWJ1ZygnRmluaXNoaW5nIGVuZGluZyBhbGwgc2ltdWxhdG9yIGRhZW1vbnMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2ltRXhpc3RzICh1ZGlkKSB7XG4gIC8vIHNlZSB0aGUgUkVBRE1FIGZvciBnaXRodWIuY29tL2FwcGl1bS9ub2RlLXNpbWN0bCBmb3IgZXhhbXBsZSBvdXRwdXQgb2YgZ2V0RGV2aWNlcygpXG4gIGxldCBkZXZpY2VzID0gYXdhaXQgZ2V0RGV2aWNlcygpO1xuXG4gIGRldmljZXMgPSBfLnRvUGFpcnMoZGV2aWNlcykubWFwKChwYWlyKSA9PiB7XG4gICAgcmV0dXJuIHBhaXJbMV07XG4gIH0pLnJlZHVjZSgoYSwgYikgPT4ge1xuICAgIHJldHVybiBhLmNvbmNhdChiKTtcbiAgfSwgW10pO1xuICByZXR1cm4gISFfLmZpbmQoZGV2aWNlcywgKHNpbSkgPT4ge1xuICAgIHJldHVybiBzaW0udWRpZCA9PT0gdWRpZDtcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNhZmVSaW1SYWYgKGRlbFBhdGgsIHRyeU51bSA9IDApIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYoZGVsUGF0aCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICh0cnlOdW0gPCAyMCkge1xuICAgICAgaWYgKGVyci5tZXNzYWdlLmluZGV4T2YoJ0VOT1RFTVBUWScpICE9PSAtMSkge1xuICAgICAgICBsb2cuZGVidWcoYFBhdGggJyR7ZGVsUGF0aH0nIHdhcyBub3QgZW1wdHkgZHVyaW5nIGRlbGV0ZTsgcmV0cnlpbmdgKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHNhZmVSaW1SYWYoZGVsUGF0aCwgdHJ5TnVtICsgMSk7XG4gICAgICB9IGVsc2UgaWYgKGVyci5tZXNzYWdlLmluZGV4T2YoJ0VOT0VOVCcpICE9PSAtMSkge1xuICAgICAgICBsb2cuZGVidWcoYFBhdGggJyR7ZGVsUGF0aH0nIGRpZCBub3QgZXhpc3Qgd2hlbiB3ZSB0cmllZCB0byBkZWxldGUsIGlnbm9yaW5nYCk7XG4gICAgICAgIHJldHVybiBhd2FpdCBzYWZlUmltUmFmKGRlbFBhdGgsIHRyeU51bSArIDEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEluc3RhbGwgYW4gU1NMIGNlcnRpZmljYXRlIHRvIGEgZGV2aWNlIHdpdGggZ2l2ZW4gdWRpZFxuICogQHBhcmFtIHtzdHJpbmd9IHBlbVRleHQgU1NMIHBlbSB0ZXh0XG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCBJZGVudGlmaWVyIG9mIHRoZSBTaW11bGF0b3JcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaW5zdGFsbFNTTENlcnQgKHBlbVRleHQsIHVkaWQpIHtcbiAgLy8gQ2hlY2sgdGhhdCBvcGVuc3NsIGlzIGluc3RhbGxlZCBvbiB0aGUgcGF0aFxuICB0cnkge1xuICAgIGF3YWl0IGZzLndoaWNoKCdvcGVuc3NsJyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYGN1c3RvbVNTTENlcnQgcmVxdWlyZXMgb3BlbnNzbCB0byBiZSBhdmFpbGFibGUgb24gcGF0aGApO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb21tYW5kICdvcGVuc3NsJyBub3QgZm91bmRgKTtcbiAgfVxuXG4gIC8vIENoZWNrIHRoYXQgc3FsaXRlMyBpcyBpbnN0YWxsZWQgb24gdGhlIHBhdGhcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy53aGljaCgnc3FsaXRlMycpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGBjdXN0b21TU0xDZXJ0IHJlcXVpcmVzIHNxbGl0ZTMgdG8gYmUgYXZhaWxhYmxlIG9uIHBhdGhgKTtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ29tbWFuZCAnc3FsaXRlMycgbm90IGZvdW5kYCk7XG4gIH1cblxuICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgZmlsZSB0byBzdG9yZSBQRU0gdGV4dFxuICAvLyAoYSB0ZW1wIGZpbGUgaXMgbmVjZXNzYXJ5IHRvIHJ1biBgb3BlbnNzbGAgc2hlbGwgY29tbWFuZHMsIGNhbid0IGJlIGRvbmUgaW4gbWVtb3J5KVxuICBsZXQgdGVtcEZpbGVOYW1lID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRlbXBEaXIub3BlbkRpcigpLCAndGVtcC1zc2wtY2VydC5wZW0nKTtcbiAgbGV0IHBhdGhUb0tleWNoYWluID0gbmV3IFNpbXVsYXRvcih1ZGlkKS5nZXREaXIoKTtcbiAgYXdhaXQgZnMud3JpdGVGaWxlKHRlbXBGaWxlTmFtZSwgcGVtVGV4dCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMuc3RhdChwYXRoVG9LZXljaGFpbik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYENvdWxkIG5vdCBpbnN0YWxsIFNTTCBjZXJ0aWZpY2F0ZS4gTm8gc2ltdWxhdG9yIHdpdGggdWRpZCAnJHt1ZGlkfSdgKTtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgfVxuXG4gIC8vIERvIHRoZSBjZXJ0aWZpY2F0ZSBpbnN0YWxsYXRpb25cbiAgbGV0IGNlcnRpZmljYXRlID0gbmV3IENlcnRpZmljYXRlKHRlbXBGaWxlTmFtZSk7XG4gIGxvZy5kZWJ1ZyhgSW5zdGFsbGluZyBjZXJ0aWZpY2F0ZSB0byAke3BhdGhUb0tleWNoYWlufWApO1xuICBhd2FpdCBjZXJ0aWZpY2F0ZS5hZGQocGF0aFRvS2V5Y2hhaW4pO1xuXG4gIC8vIFJlbW92ZSB0aGUgdGVtcG9yYXJ5IGZpbGVcbiAgYXdhaXQgZnMudW5saW5rKHRlbXBGaWxlTmFtZSk7XG5cbiAgcmV0dXJuIGNlcnRpZmljYXRlO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1bmluc3RhbGxTU0xDZXJ0IChwZW1UZXh0LCB1ZGlkKSB7XG4gIHRyeSB7XG4gICAgbGV0IHRlbXBGaWxlTmFtZSA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICd0ZW1wLXNzbC1jZXJ0LnBlbScpO1xuICAgIGxldCBwYXRoVG9LZXljaGFpbiA9IHBhdGgucmVzb2x2ZShuZXcgU2ltdWxhdG9yKHVkaWQpLmdldERpcigpKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUodGVtcEZpbGVOYW1lLCBwZW1UZXh0KTtcbiAgICBsZXQgY2VydGlmaWNhdGUgPSBuZXcgQ2VydGlmaWNhdGUodGVtcEZpbGVOYW1lKTtcbiAgICBhd2FpdCBjZXJ0aWZpY2F0ZS5yZW1vdmUocGF0aFRvS2V5Y2hhaW4pO1xuICAgIGF3YWl0IGZzLnVubGluayh0ZW1wRmlsZU5hbWUpO1xuICAgIHJldHVybiBjZXJ0aWZpY2F0ZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ291bGQgbm90IHVuaW5zdGFsbCBTU0wgY2VydGlmaWNhdGUuIE5vIHNpbXVsYXRvciB3aXRoIHVkaWQgJyR7dWRpZH0nYCk7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB0aGUgU2ltdWxhdG9yIGFscmVhZHkgaGFzIHRoaXMgU1NMIGNlcnRpZmljYXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gcGVtVGV4dCBQRU0gdGV4dCBvZiBTU0wgY2VydFxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgSWRlbnRpZmllciBvZiB0aGUgU2ltdWxhdG9yXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGhhc1NTTENlcnQgKHBlbVRleHQsIHVkaWQpIHtcbiAgY29uc3QgdGVtcEZpbGVOYW1lID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRlbXBEaXIub3BlbkRpcigpLCAndGVtcC1zc2wtY2VydC5wZW0nKTtcbiAgY29uc3QgcGF0aFRvS2V5Y2hhaW4gPSBuZXcgU2ltdWxhdG9yKHVkaWQpLmdldERpcigpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUodGVtcEZpbGVOYW1lLCBwZW1UZXh0KTtcbiAgY29uc3QgY2VydGlmaWNhdGUgPSBuZXcgQ2VydGlmaWNhdGUodGVtcEZpbGVOYW1lKTtcbiAgcmV0dXJuIGNlcnRpZmljYXRlLmhhcyhwYXRoVG9LZXljaGFpbik7XG59XG5cbi8qKlxuICogUnVucyBhIGNvbW1hbmQgbGluZSBzcWxpdGUzIHF1ZXJ5XG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGRiIC0gRnVsbCBwYXRoIHRvIHNxbGl0ZSBkYXRhYmFzZVxuICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5IC0gVGhlIGFjdHVhbCBxdWVyeSBzdHJpbmdcbiAqIEBwYXJhbSB7Li4uc3RyaW5nfSBxdWVyeVBhcmFtcyAtIFRoZSBsaXN0IG9mIHF1ZXJ5IHBhcmFtZXRlcnNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHNxbGl0ZSBjb21tYW5kIHN0ZG91dFxuICovXG5hc3luYyBmdW5jdGlvbiBleGVjU1FMaXRlUXVlcnkgKGRiLCBxdWVyeSwgLi4ucXVlcnlQYXJhbXMpIHtcbiAgcXVlcnkgPSBxdWVyeS5yZXBsYWNlKC9cXG4rL2csICcgJyk7XG4gIGxldCBxdWVyeVRva2VucyA9IHF1ZXJ5LnNwbGl0KCc/Jyk7XG4gIGxldCBmb3JtYXR0ZWRRdWVyeSA9IFtdO1xuICBxdWVyeVBhcmFtc1xuICAgIC5tYXAoKHBhcmFtKSA9PiBgJHtwYXJhbX1gKVxuICAgIC5mb3JFYWNoKChwYXJhbSwgaSkgPT4ge1xuICAgICAgZm9ybWF0dGVkUXVlcnkucHVzaChxdWVyeVRva2Vuc1tpXSk7XG4gICAgICBmb3JtYXR0ZWRRdWVyeS5wdXNoKHBhcmFtLnJlcGxhY2UoLycvZywgXCInJ1wiKSk7XG4gICAgfSk7XG4gIGZvcm1hdHRlZFF1ZXJ5LnB1c2gocXVlcnlUb2tlbnNbcXVlcnlUb2tlbnMubGVuZ3RoIC0gMV0pO1xuXG4gIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nIFNRTCBxdWVyeSBcIiR7Zm9ybWF0dGVkUXVlcnkuam9pbignJyl9XCIgb24gJyR7ZGJ9J2ApO1xuICB0cnkge1xuICAgIHJldHVybiAoYXdhaXQgZXhlYygnc3FsaXRlMycsIFsnLWxpbmUnLCBkYiwgZm9ybWF0dGVkUXVlcnkuam9pbignJyldKSkuc3Rkb3V0O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleGVjdXRlIFNRTGl0ZSBxdWVyeSBcIiR7Zm9ybWF0dGVkUXVlcnkuam9pbignJyl9XCIgdG8gJyR7ZGJ9Jy4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLnN0ZGVycn1gKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXREZXZlbG9wZXJSb290ICgpIHtcbiAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd4Y29kZS1zZWxlY3QnLCBbJy1wJ10pO1xuICByZXR1cm4gc3Rkb3V0LnRyaW0oKTtcbn1cblxuZXhwb3J0IHtcbiAga2lsbEFsbFNpbXVsYXRvcnMsXG4gIGVuZEFsbFNpbXVsYXRvckRhZW1vbnMsXG4gIHNhZmVSaW1SYWYsXG4gIHNpbUV4aXN0cyxcbiAgaW5zdGFsbFNTTENlcnQsXG4gIHVuaW5zdGFsbFNTTENlcnQsXG4gIGhhc1NTTENlcnQsXG4gIGV4ZWNTUUxpdGVRdWVyeSxcbiAgdG9CaW9tZXRyaWNEb21haW5Db21wb25lbnQsXG4gIGdldERldmVsb3BlclJvb3QsXG59O1xuIl0sImZpbGUiOiJsaWIvdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
