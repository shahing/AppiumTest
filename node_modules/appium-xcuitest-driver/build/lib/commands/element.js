"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumIosDriver = require("appium-ios-driver");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    extensions = {};
exports.commands = commands;
Object.assign(extensions, _appiumIosDriver.iosCommands.element);

commands.getNativeAttribute = async function getNativeAttribute(attribute, el) {
  if (attribute === 'contentSize') {
    return await this.getContentSize(el);
  }

  let value = await this.proxyCommand(`/element/${el}/attribute/${attribute}`, 'GET');

  if ([0, 1].includes(value)) {
    value = !!value;
  }

  return _lodash.default.isNull(value) || _lodash.default.isString(value) ? value : JSON.stringify(value);
};

commands.getAttribute = async function (attribute, el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (!this.isWebContext()) {
    return await this.getNativeAttribute(attribute, el);
  }

  let atomsElement = this.getAtomsElement(el);

  if (_lodash.default.isNull(atomsElement)) {
    throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}`);
  }

  return await this.executeAtom('get_attribute_value', [atomsElement, attribute]);
};

commands.getText = async function (el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (!this.isWebContext()) {
    return await this.proxyCommand(`/element/${el}/text`, 'GET');
  }

  let atomsElement = this.useAtomsElement(el);
  return await this.executeAtom('get_text', [atomsElement]);
};

commands.getElementRect = async function (el) {
  if (this.isWebContext()) {
    const {
      x,
      y
    } = await this.getLocation(el);
    const {
      width,
      height
    } = await this.getSize(el);
    return {
      x,
      y,
      width,
      height
    };
  }

  el = _appiumSupport.util.unwrapElement(el);
  return await this.getNativeRect(el);
};

extensions.getNativeRect = async function (el) {
  return await this.proxyCommand(`/element/${el}/rect`, 'GET');
};

commands.getLocation = async function (el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (this.isWebContext()) {
    const atomsElement = await this.useAtomsElement(el);
    let loc = await this.executeAtom('get_top_left_coordinates', [atomsElement]);

    if (this.opts.absoluteWebLocations) {
      const script = 'return [document.body.scrollLeft, document.body.scrollTop];';
      const [xOffset, yOffset] = await this.execute(script);
      loc.x += xOffset;
      loc.y += yOffset;
    }

    return loc;
  }

  const rect = await this.getElementRect(el);
  return {
    x: rect.x,
    y: rect.y
  };
};

commands.getLocationInView = async function (el) {
  return await this.getLocation(el);
};

commands.getSize = async function (el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (this.isWebContext()) {
    let atomsElement = this.getAtomsElement(el);

    if (atomsElement === null) {
      throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
    }

    return await this.executeAtom('get_size', [atomsElement]);
  }

  const rect = await this.getElementRect(el);
  return {
    width: rect.width,
    height: rect.height
  };
};

function hasSpecialKeys(keys) {
  for (let char of keys) {
    if (isSpecialKey(char)) {
      return true;
    }
  }

  return false;
}

function isSpecialKey(k) {
  if (k === '\uE003' || k === '\ue017') {
    return true;
  } else if (k === '\uE006' || k === '\uE007') {
    return true;
  }

  return false;
}

function translateKey(k) {
  if (k === '\uE006' || k === '\uE007') {
    return '\n';
  } else if (k === '\uE003' || k === '\ue017') {
    return '\b';
  }

  return k;
}

extensions.bringUpKeyboard = async function (element) {
  let implicitWaitMs = this.implicitWaitMs;
  await this.setImplicitWait(0);

  try {
    await (0, _asyncbox.retryInterval)(10, 10, async () => {
      try {
        await this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);

        _logger.default.debug('Keyboard found. Continuing with text input.');
      } catch (err) {
        _logger.default.debug('No keyboard found. Clicking element to open it.');

        await this.nativeClick(element);
        await this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);
      }
    });
  } finally {
    await this.setImplicitWait(implicitWaitMs);
  }
};

commands.setValueImmediate = async function (value, el) {
  _logger.default.info('There is currently no way to bypass typing using XCUITest. Setting value through keyboard');

  await this.setValue(value, el);
};

commands.setValue = async function (value, el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('click', [atomsElement]);
    await this.executeAtom('type', [atomsElement, value]);
  } else {
    const setFormattedValue = async (input, isKeyboardPresenceCheckEnabled) => {
      if (typeof input !== 'string' && !(input instanceof Array)) {
        input = input.toString().split('');
      }

      try {
        await this.proxyCommand(`/element/${el}/value`, 'POST', {
          value: input
        });
      } catch (err) {
        if (isKeyboardPresenceCheckEnabled && (await this.getAttribute('type', el)) === 'XCUIElementTypeTextField') {
          _logger.default.info(`Cannot type in the text field because of ${err}.\nTrying to apply a workaround...`);

          await this.bringUpKeyboard(el);
          await this.proxyCommand(`/element/${el}/value`, 'POST', {
            value: input
          });
        } else {
          throw err;
        }
      }
    };

    if (_lodash.default.isNull(value) || _lodash.default.isUndefined(value) || _lodash.default.isPlainObject(value)) {
      throw new Error(`Only strings and arrays of strings are supported as input arguments. Received: '${JSON.stringify(value)}'`);
    }

    if (_lodash.default.isArray(value)) {
      value = _lodash.default.flatMap(value, v => (_lodash.default.isString(v) ? v : JSON.stringify(v)).split(''));
    } else {
      value = (value || '').toString().split('');
    }

    if (!hasSpecialKeys(value)) {
      await setFormattedValue(value, true);
      return;
    }

    let buffer = [];
    let isFirstChar = true;

    for (let k of value) {
      let char = translateKey(k);

      if (char === k) {
        buffer.push(char);
        continue;
      }

      await setFormattedValue(buffer, isFirstChar);
      isFirstChar = false;
      buffer = [];
      await setFormattedValue([char], isFirstChar);
    }

    if (buffer.length) {
      await setFormattedValue(buffer, false);
    }
  }
};

commands.keys = async function (value) {
  if (_lodash.default.isArray(value)) {
    value = value.join('');
  }

  if (_lodash.default.isString(value)) {
    value = value.split('');
  }

  let buffer = [];

  for (let k of value) {
    let char = translateKey(k);
    buffer.push(char);
  }

  await this.proxyCommand('/wda/keys', 'POST', {
    value: buffer
  });
};

commands.clear = async function (el) {
  el = _appiumSupport.util.unwrapElement(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('clear', [atomsElement]);
    return;
  }

  await (0, _asyncbox.retry)(5, this.proxyCommand.bind(this), `/element/${el}/clear`, 'POST');
};

commands.getContentSize = async function (el) {
  if (this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotYetImplementedError('Support for getContentSize for webcontext is not yet implemented. Please contact an Appium dev');
  }

  const type = await this.getAttribute('type', el);

  if (type !== "XCUIElementTypeTable" && type !== "XCUIElementTypeCollectionView") {
    throw new Error(`Can't get content size for type '${type}', only for ` + `tables and collection views`);
  }

  let locator = "*";

  if (type === "XCUIElementTypeTable") {
    locator = "XCUIElementTypeCell";
  }

  let contentHeight = 0;
  let children = await this.findElOrEls(`class chain`, locator, true, el);

  if (children.length === 1) {
    const rect = await this.getElementRect(_lodash.default.head(children));
    contentHeight = rect.height;
  } else if (children.length) {
    switch (type) {
      case "XCUIElementTypeTable":
        {
          const firstRect = await this.getElementRect(_lodash.default.head(children));
          const lastRect = await this.getElementRect(_lodash.default.last(children));
          contentHeight = lastRect.y + lastRect.height - firstRect.y;
          break;
        }

      case "XCUIElementTypeCollectionView":
        {
          let elsInRow = 1;
          let firstRect = await this.getElementRect(_lodash.default.head(children));
          let initialRects = [firstRect];

          for (let i = 1; i < children.length; i++) {
            const rect = await this.getElementRect(children[i]);
            initialRects.push(rect);

            if (rect.y !== firstRect.y) {
              elsInRow = i;
              break;
            }
          }

          const spaceBetweenEls = initialRects[elsInRow].y - initialRects[elsInRow - 1].y - initialRects[elsInRow - 1].height;
          const numRows = Math.ceil(children.length / elsInRow);
          contentHeight = numRows * firstRect.height + spaceBetweenEls * (numRows - 1);
          break;
        }

      default:
        throw new Error(`Programming error: type '${type}' was not ` + `valid but should have already been rejected`);
    }
  }

  const size = await this.getSize(el);
  const origin = await this.getLocationInView(el);
  return JSON.stringify({
    width: size.width,
    height: size.height,
    top: origin.y,
    left: origin.x,
    scrollableOffset: contentHeight
  });
};

commands.isKeyboardShown = async function () {
  try {
    await this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);
    return true;
  } catch (ign) {
    return false;
  }
};

Object.assign(extensions, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZXh0ZW5zaW9ucyIsIk9iamVjdCIsImFzc2lnbiIsImlvc0NvbW1hbmRzIiwiZWxlbWVudCIsImdldE5hdGl2ZUF0dHJpYnV0ZSIsImF0dHJpYnV0ZSIsImVsIiwiZ2V0Q29udGVudFNpemUiLCJ2YWx1ZSIsInByb3h5Q29tbWFuZCIsImluY2x1ZGVzIiwiXyIsImlzTnVsbCIsImlzU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEF0dHJpYnV0ZSIsInV0aWwiLCJ1bndyYXBFbGVtZW50IiwiaXNXZWJDb250ZXh0IiwiYXRvbXNFbGVtZW50IiwiZ2V0QXRvbXNFbGVtZW50IiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwiZXhlY3V0ZUF0b20iLCJnZXRUZXh0IiwidXNlQXRvbXNFbGVtZW50IiwiZ2V0RWxlbWVudFJlY3QiLCJ4IiwieSIsImdldExvY2F0aW9uIiwid2lkdGgiLCJoZWlnaHQiLCJnZXRTaXplIiwiZ2V0TmF0aXZlUmVjdCIsImxvYyIsIm9wdHMiLCJhYnNvbHV0ZVdlYkxvY2F0aW9ucyIsInNjcmlwdCIsInhPZmZzZXQiLCJ5T2Zmc2V0IiwiZXhlY3V0ZSIsInJlY3QiLCJnZXRMb2NhdGlvbkluVmlldyIsImhhc1NwZWNpYWxLZXlzIiwia2V5cyIsImNoYXIiLCJpc1NwZWNpYWxLZXkiLCJrIiwidHJhbnNsYXRlS2V5IiwiYnJpbmdVcEtleWJvYXJkIiwiaW1wbGljaXRXYWl0TXMiLCJzZXRJbXBsaWNpdFdhaXQiLCJmaW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMiLCJsb2ciLCJkZWJ1ZyIsImVyciIsIm5hdGl2ZUNsaWNrIiwic2V0VmFsdWVJbW1lZGlhdGUiLCJpbmZvIiwic2V0VmFsdWUiLCJzZXRGb3JtYXR0ZWRWYWx1ZSIsImlucHV0IiwiaXNLZXlib2FyZFByZXNlbmNlQ2hlY2tFbmFibGVkIiwiQXJyYXkiLCJ0b1N0cmluZyIsInNwbGl0IiwiaXNVbmRlZmluZWQiLCJpc1BsYWluT2JqZWN0IiwiRXJyb3IiLCJpc0FycmF5IiwiZmxhdE1hcCIsInYiLCJidWZmZXIiLCJpc0ZpcnN0Q2hhciIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiY2xlYXIiLCJiaW5kIiwiTm90WWV0SW1wbGVtZW50ZWRFcnJvciIsInR5cGUiLCJsb2NhdG9yIiwiY29udGVudEhlaWdodCIsImNoaWxkcmVuIiwiZmluZEVsT3JFbHMiLCJoZWFkIiwiZmlyc3RSZWN0IiwibGFzdFJlY3QiLCJsYXN0IiwiZWxzSW5Sb3ciLCJpbml0aWFsUmVjdHMiLCJpIiwic3BhY2VCZXR3ZWVuRWxzIiwibnVtUm93cyIsIk1hdGgiLCJjZWlsIiwic2l6ZSIsIm9yaWdpbiIsInRvcCIsImxlZnQiLCJzY3JvbGxhYmxlT2Zmc2V0IiwiaXNLZXlib2FyZFNob3duIiwiaWduIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLFVBQVUsR0FBRyxFQUFoQzs7QUFJQUMsTUFBTSxDQUFDQyxNQUFQLENBQWNGLFVBQWQsRUFBMEJHLDZCQUFZQyxPQUF0Qzs7QUFFQUwsUUFBUSxDQUFDTSxrQkFBVCxHQUE4QixlQUFlQSxrQkFBZixDQUFtQ0MsU0FBbkMsRUFBOENDLEVBQTlDLEVBQWtEO0FBQzlFLE1BQUlELFNBQVMsS0FBSyxhQUFsQixFQUFpQztBQUUvQixXQUFPLE1BQU0sS0FBS0UsY0FBTCxDQUFvQkQsRUFBcEIsQ0FBYjtBQUNEOztBQUdELE1BQUlFLEtBQUssR0FBRyxNQUFNLEtBQUtDLFlBQUwsQ0FBbUIsWUFBV0gsRUFBRyxjQUFhRCxTQUFVLEVBQXhELEVBQTJELEtBQTNELENBQWxCOztBQUVBLE1BQUksQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPSyxRQUFQLENBQWdCRixLQUFoQixDQUFKLEVBQTRCO0FBQzFCQSxJQUFBQSxLQUFLLEdBQUcsQ0FBQyxD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XyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IGlvc0NvbW1hbmRzIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwsIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuXG5cbmxldCBjb21tYW5kcyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbi8vIHB1bGwgaW4gYWxsIHRoZSBlbGVtZW50IGNvbW1hbmRzIGFuZCBoZWxwZXJzIGZyb20gaW9zLWRyaXZlcixcbi8vIHRoZW4gb3ZlcnJpZGUgYW55dGhpbmcgd2Ugd2FudCBiZWxvd1xuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBpb3NDb21tYW5kcy5lbGVtZW50KTtcblxuY29tbWFuZHMuZ2V0TmF0aXZlQXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmF0aXZlQXR0cmlidXRlIChhdHRyaWJ1dGUsIGVsKSB7XG4gIGlmIChhdHRyaWJ1dGUgPT09ICdjb250ZW50U2l6ZScpIHtcbiAgICAvLyBkb24ndCBwcm94eSByZXF1ZXN0cyBmb3IgdGhlIGNvbnRlbnQgc2l6ZSBvZiBhIHNjcm9sbGFibGUgZWxlbWVudFxuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldENvbnRlbnRTaXplKGVsKTtcbiAgfVxuXG4gIC8vIG90aGVyd2lzZSBsZXQgV0RBIGhhbmRsZSBhdHRyaWJ1dGUgcmVxdWVzdHNcbiAgbGV0IHZhbHVlID0gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L2F0dHJpYnV0ZS8ke2F0dHJpYnV0ZX1gLCAnR0VUJyk7XG4gIC8vIFRyYW5zZm9ybSB0aGUgcmVzdWx0IGZvciB0aGUgY2FzZSB3aGVuIFdEQSByZXR1cm5zIGFuIGludGVnZXIgcmVwcmVzZW50YXRpb24gZm9yIGEgYm9vbGVhbiB2YWx1ZVxuICBpZiAoWzAsIDFdLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgIHZhbHVlID0gISF2YWx1ZTtcbiAgfVxuICAvLyBUaGUgcmV0dXJuZWQgdmFsdWUgbXVzdCBiZSBvZiB0eXBlIHN0cmluZyBhY2NvcmRpbmcgdG8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jZ2V0LWVsZW1lbnQtYXR0cmlidXRlXG4gIHJldHVybiAoXy5pc051bGwodmFsdWUpIHx8IF8uaXNTdHJpbmcodmFsdWUpKSA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xufTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXROYXRpdmVBdHRyaWJ1dGUoYXR0cmlidXRlLCBlbCk7XG4gIH1cbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgaWYgKF8uaXNOdWxsKGF0b21zRWxlbWVudCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9YCk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9hdHRyaWJ1dGVfdmFsdWUnLCBbYXRvbXNFbGVtZW50LCBhdHRyaWJ1dGVdKTtcbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3RleHRgLCAnR0VUJyk7XG4gIH1cbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF90ZXh0JywgW2F0b21zRWxlbWVudF0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFJlY3QgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAvLyBNb2JpbGUgc2FmYXJpIGRvZXNuJ3Qgc3VwcG9ydCByZWN0XG4gICAgY29uc3Qge3gsIHl9ID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbCk7XG4gICAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5nZXRTaXplKGVsKTtcbiAgICByZXR1cm4ge3gsIHksIHdpZHRoLCBoZWlnaHR9O1xuICB9XG5cbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXROYXRpdmVSZWN0KGVsKTtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmF0aXZlUmVjdCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7ZWx9L3JlY3RgLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRMb2NhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgY29uc3QgYXRvbXNFbGVtZW50ID0gYXdhaXQgdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGxldCBsb2MgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgaWYgKHRoaXMub3B0cy5hYnNvbHV0ZVdlYkxvY2F0aW9ucykge1xuICAgICAgY29uc3Qgc2NyaXB0ID0gJ3JldHVybiBbZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0LCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcF07JztcbiAgICAgIGNvbnN0IFt4T2Zmc2V0LCB5T2Zmc2V0XSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQpO1xuICAgICAgbG9jLnggKz0geE9mZnNldDtcbiAgICAgIGxvYy55ICs9IHlPZmZzZXQ7XG4gICAgfVxuICAgIHJldHVybiBsb2M7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7eDogcmVjdC54LCB5OiByZWN0Lnl9O1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICBpZiAoYXRvbXNFbGVtZW50ID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9J2ApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH1cblxuICBjb25zdCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gIHJldHVybiB7d2lkdGg6IHJlY3Qud2lkdGgsIGhlaWdodDogcmVjdC5oZWlnaHR9O1xufTtcblxuZnVuY3Rpb24gaGFzU3BlY2lhbEtleXMgKGtleXMpIHtcbiAgZm9yIChsZXQgY2hhciBvZiBrZXlzKSB7XG4gICAgaWYgKGlzU3BlY2lhbEtleShjaGFyKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaXNTcGVjaWFsS2V5IChrKSB7XG4gIGlmIChrID09PSAnXFx1RTAwMycgfHwgayA9PT0gJ1xcdWUwMTcnKSB7IC8vIEJBQ0tTUEFDRSBvciBERUxFVEVcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChrID09PSAnXFx1RTAwNicgfHwgayA9PT0gJ1xcdUUwMDcnKSB7IC8vIFJFVFVSTiBvciBFTlRFUlxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlS2V5IChrKSB7XG4gIGlmIChrID09PSAnXFx1RTAwNicgfHwgayA9PT0gJ1xcdUUwMDcnKSB7IC8vIFJFVFVSTiBvciBFTlRFUlxuICAgIHJldHVybiAnXFxuJztcbiAgfSBlbHNlIGlmIChrID09PSAnXFx1RTAwMycgfHwgayA9PT0gJ1xcdWUwMTcnKSB7IC8vIEJBQ0tTUEFDRSBvciBERUxFVEVcbiAgICByZXR1cm4gJ1xcYic7XG4gIH1cbiAgcmV0dXJuIGs7XG59XG5cbmV4dGVuc2lvbnMuYnJpbmdVcEtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgLy8gc29tZXRpbWVzIGlucHV0IGlzIGF0dGVtcHRlZCBiZWZvcmUgd2UgaGF2ZSBhIGtleWJvYXJkLiBUcnkgdG8gYnJpbmcgb25lIHVwXG4gIC8vIGJ1dCB3ZSB3YW50IHRvIGhhbmRsZSB0aGUgcmV0cmllcyBvbiBmaW5kXG4gIGxldCBpbXBsaWNpdFdhaXRNcyA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gIGF3YWl0IHRoaXMuc2V0SW1wbGljaXRXYWl0KDApO1xuICB0cnkge1xuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMTAsIDEwLCBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cygnY2xhc3MgbmFtZScsICdYQ1VJRWxlbWVudFR5cGVLZXlib2FyZCcsIGZhbHNlKTtcbiAgICAgICAgbG9nLmRlYnVnKCdLZXlib2FyZCBmb3VuZC4gQ29udGludWluZyB3aXRoIHRleHQgaW5wdXQuJyk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gbm8ga2V5Ym9hcmQgZm91bmRcbiAgICAgICAgbG9nLmRlYnVnKCdObyBrZXlib2FyZCBmb3VuZC4gQ2xpY2tpbmcgZWxlbWVudCB0byBvcGVuIGl0LicpO1xuICAgICAgICBhd2FpdCB0aGlzLm5hdGl2ZUNsaWNrKGVsZW1lbnQpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZUtleWJvYXJkJywgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIG5vIG1hdHRlciB3aGF0IHdlIGRvLCBtYWtlIHN1cmUgd2UgaGF2ZSB0aGUgaW1wbGljaXQgd2FpdCBzZXQgdXAgY29ycmVjdGx5XG4gICAgYXdhaXQgdGhpcy5zZXRJbXBsaWNpdFdhaXQoaW1wbGljaXRXYWl0TXMpO1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZUltbWVkaWF0ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWwpIHtcbiAgLy8gV0RBIGRvZXMgbm90IHByb3ZpZGUgbm8gd2F5IHRvIHNldCB0aGUgdmFsdWUgZGlyZWN0bHlcbiAgbG9nLmluZm8oJ1RoZXJlIGlzIGN1cnJlbnRseSBubyB3YXkgdG8gYnlwYXNzIHR5cGluZyB1c2luZyBYQ1VJVGVzdC4gU2V0dGluZyB2YWx1ZSB0aHJvdWdoIGtleWJvYXJkJyk7XG4gIGF3YWl0IHRoaXMuc2V0VmFsdWUodmFsdWUsIGVsKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlLCBlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCd0eXBlJywgW2F0b21zRWxlbWVudCwgdmFsdWVdKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBzZXRGb3JtYXR0ZWRWYWx1ZSA9IGFzeW5jIChpbnB1dCwgaXNLZXlib2FyZFByZXNlbmNlQ2hlY2tFbmFibGVkKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJyAmJiAhKGlucHV0IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgIGlucHV0ID0gaW5wdXQudG9TdHJpbmcoKS5zcGxpdCgnJyk7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtlbH0vdmFsdWVgLCAnUE9TVCcsIHt2YWx1ZTogaW5wdXR9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBtYWtlIHN1cmUgdGhlcmUgaXMgYSBrZXlib2FyZCBpZiB0aGlzIGlzIGEgdGV4dCBmaWVsZFxuICAgICAgICBpZiAoaXNLZXlib2FyZFByZXNlbmNlQ2hlY2tFbmFibGVkICYmIGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCd0eXBlJywgZWwpID09PSAnWENVSUVsZW1lbnRUeXBlVGV4dEZpZWxkJykge1xuICAgICAgICAgIGxvZy5pbmZvKGBDYW5ub3QgdHlwZSBpbiB0aGUgdGV4dCBmaWVsZCBiZWNhdXNlIG9mICR7ZXJyfS5cXG5UcnlpbmcgdG8gYXBwbHkgYSB3b3JrYXJvdW5kLi4uYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5icmluZ1VwS2V5Ym9hcmQoZWwpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2VsfS92YWx1ZWAsICdQT1NUJywge3ZhbHVlOiBpbnB1dH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBwb3NzaWJsZSB2YWx1ZXMgb2YgYHZhbHVlYDpcbiAgICAvLyAgIFsnc29tZSB0ZXh0J11cbiAgICAvLyAgIFsncycsICdvJywgJ20nLCAnZScsICcgJywgJ3QnLCAnZScsICd4JywgJ3QnXVxuICAgIC8vICAgJ3NvbWUgdGV4dCdcbiAgICBpZiAoXy5pc051bGwodmFsdWUpIHx8IF8uaXNVbmRlZmluZWQodmFsdWUpIHx8IF8uaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT25seSBzdHJpbmdzIGFuZCBhcnJheXMgb2Ygc3RyaW5ncyBhcmUgc3VwcG9ydGVkIGFzIGlucHV0IGFyZ3VtZW50cy4gUmVjZWl2ZWQ6ICcke0pTT04uc3RyaW5naWZ5KHZhbHVlKX0nYCk7XG4gICAgfVxuICAgIGlmIChfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAvLyBtYWtlIHN1cmUgdGhhdCBhbGwgdGhlIHN0cmluZ3MgaW5zaWRlIGFyZSBhIHNpbmdsZSBjaGFyYWN0ZXIgbG9uZ1xuICAgICAgdmFsdWUgPSBfLmZsYXRNYXAodmFsdWUsICh2KSA9PiAoXy5pc1N0cmluZyh2KSA/IHYgOiBKU09OLnN0cmluZ2lmeSh2KSkuc3BsaXQoJycpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbWFrZSBpdCBpbnRvIGFuIGFycmF5IG9mIGNoYXJhY3RlcnNcbiAgICAgIHZhbHVlID0gKHZhbHVlIHx8ICcnKS50b1N0cmluZygpLnNwbGl0KCcnKTtcbiAgICB9XG5cbiAgICBpZiAoIWhhc1NwZWNpYWxLZXlzKHZhbHVlKSkge1xuICAgICAgLy8gbm90aGluZyBzcGVjaWFsLCBzbyBqdXN0IHNlbmQgaXQgaW5cbiAgICAgIGF3YWl0IHNldEZvcm1hdHRlZFZhbHVlKHZhbHVlLCB0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGVyZSBhcmUgc3BlY2lhbCBjaGFyYWN0ZXJzLCBnbyB0aHJvdWdoIHRoZSB2YWx1ZSB1bnRpbCB3ZSBnZXQgdG8gb25lLFxuICAgIC8vIGFuZCB0aGVuIHByaW50IGl0IGluZGl2aWR1YWxseVxuICAgIC8vIGN1cnJlbnRseSBvbmx5IHN1cHBvcnRpbmcgcmV0dXJuLCBlbnRlciwgYmFja3NwYWNlLCBhbmQgZGVsZXRlXG4gICAgbGV0IGJ1ZmZlciA9IFtdO1xuICAgIGxldCBpc0ZpcnN0Q2hhciA9IHRydWU7XG4gICAgZm9yIChsZXQgayBvZiB2YWx1ZSkge1xuICAgICAgbGV0IGNoYXIgPSB0cmFuc2xhdGVLZXkoayk7XG5cbiAgICAgIGlmIChjaGFyID09PSBrKSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKGNoYXIpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gd3JpdGUgYW5kIGNsZWFyIHRoZSBidWZmZXJcbiAgICAgIGF3YWl0IHNldEZvcm1hdHRlZFZhbHVlKGJ1ZmZlciwgaXNGaXJzdENoYXIpO1xuICAgICAgaXNGaXJzdENoYXIgPSBmYWxzZTtcbiAgICAgIGJ1ZmZlciA9IFtdO1xuXG4gICAgICAvLyB3cml0ZSB0aGUgY2hhcmFjdGVyXG4gICAgICBhd2FpdCBzZXRGb3JtYXR0ZWRWYWx1ZShbY2hhcl0sIGlzRmlyc3RDaGFyKTtcbiAgICB9XG4gICAgLy8gZmluYWxseSwgc2VuZCBhbnl0aGluZyB0aGF0IG1pZ2h0IGJlIGxlZnRcbiAgICBpZiAoYnVmZmVyLmxlbmd0aCkge1xuICAgICAgYXdhaXQgc2V0Rm9ybWF0dGVkVmFsdWUoYnVmZmVyLCBmYWxzZSk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5rZXlzID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlKSB7XG4gIGlmIChfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgLy8gY29uY2F0ZW5hdGUgYW55IGluZGl2aWR1YWwgc3RyaW5nc1xuICAgIHZhbHVlID0gdmFsdWUuam9pbignJyk7XG4gIH1cbiAgaWYgKF8uaXNTdHJpbmcodmFsdWUpKSB7XG4gICAgLy8gc3BsaXQgaW50byBjb21wb25lbnQgY2hhcmFjdGVyc1xuICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJycpO1xuICB9XG5cbiAgbGV0IGJ1ZmZlciA9IFtdO1xuICBmb3IgKGxldCBrIG9mIHZhbHVlKSB7XG4gICAgbGV0IGNoYXIgPSB0cmFuc2xhdGVLZXkoayk7XG5cbiAgICBidWZmZXIucHVzaChjaGFyKTtcbiAgfVxuICBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9rZXlzJywgJ1BPU1QnLCB7dmFsdWU6IGJ1ZmZlcn0pO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xlYXInLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGF3YWl0IHJldHJ5KDUsIHRoaXMucHJveHlDb21tYW5kLmJpbmQodGhpcyksIGAvZWxlbWVudC8ke2VsfS9jbGVhcmAsICdQT1NUJyk7XG59O1xuXG5jb21tYW5kcy5nZXRDb250ZW50U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcignU3VwcG9ydCBmb3IgZ2V0Q29udGVudFNpemUgZm9yIHdlYmNvbnRleHQgaXMgbm90IHlldCBpbXBsZW1lbnRlZC4gUGxlYXNlIGNvbnRhY3QgYW4gQXBwaXVtIGRldicpO1xuICB9XG5cbiAgY29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCd0eXBlJywgZWwpO1xuXG4gIGlmICh0eXBlICE9PSBcIlhDVUlFbGVtZW50VHlwZVRhYmxlXCIgJiZcbiAgICAgIHR5cGUgIT09IFwiWENVSUVsZW1lbnRUeXBlQ29sbGVjdGlvblZpZXdcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZ2V0IGNvbnRlbnQgc2l6ZSBmb3IgdHlwZSAnJHt0eXBlfScsIG9ubHkgZm9yIGAgK1xuICAgICAgICAgICAgICAgICAgICBgdGFibGVzIGFuZCBjb2xsZWN0aW9uIHZpZXdzYCk7XG4gIH1cbiAgbGV0IGxvY2F0b3IgPSBcIipcIjtcbiAgaWYgKHR5cGUgPT09IFwiWENVSUVsZW1lbnRUeXBlVGFibGVcIikge1xuICAgIC8vIG9ubHkgZmluZCB0YWJsZSBjZWxscywgbm90IGp1c3QgYW55IGNoaWxkcmVuXG4gICAgbG9jYXRvciA9IFwiWENVSUVsZW1lbnRUeXBlQ2VsbFwiO1xuICB9XG5cbiAgbGV0IGNvbnRlbnRIZWlnaHQgPSAwO1xuICBsZXQgY2hpbGRyZW4gPSBhd2FpdCB0aGlzLmZpbmRFbE9yRWxzKGBjbGFzcyBjaGFpbmAsIGxvY2F0b3IsIHRydWUsIGVsKTtcbiAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xuICAgIC8vIGlmIHdlIGtub3cgdGhlcmUncyBvbmx5IG9uZSBlbGVtZW50LCB3ZSBjYW4gb3B0aW1pemUgdG8gbWFrZSBqdXN0IG9uZVxuICAgIC8vIGNhbGwgdG8gV0RBXG4gICAgY29uc3QgcmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5oZWFkKGNoaWxkcmVuKSk7XG4gICAgY29udGVudEhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuICB9IGVsc2UgaWYgKGNoaWxkcmVuLmxlbmd0aCkge1xuICAgIC8vIG90aGVyd2lzZSBpZiB3ZSBoYXZlIG11bHRpcGxlIGVsZW1lbnRzLCBsb2dpYyBkaWZmZXJzIGJhc2VkIG9uIGVsZW1lbnRcbiAgICAvLyB0eXBlXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFwiWENVSUVsZW1lbnRUeXBlVGFibGVcIjoge1xuICAgICAgICBjb25zdCBmaXJzdFJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KF8uaGVhZChjaGlsZHJlbikpO1xuICAgICAgICBjb25zdCBsYXN0UmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5sYXN0KGNoaWxkcmVuKSk7XG4gICAgICAgIGNvbnRlbnRIZWlnaHQgPSBsYXN0UmVjdC55ICsgbGFzdFJlY3QuaGVpZ2h0IC0gZmlyc3RSZWN0Lnk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcIlhDVUlFbGVtZW50VHlwZUNvbGxlY3Rpb25WaWV3XCI6IHtcbiAgICAgICAgbGV0IGVsc0luUm93ID0gMTsgLy8gd2Uga25vdyB0aGVyZSBtdXN0IGJlIGF0IGxlYXN0IG9uZSBlbGVtZW50IGluIHRoZSByb3dcbiAgICAgICAgbGV0IGZpcnN0UmVjdCA9IGF3YWl0IHRoaXMuZ2V0RWxlbWVudFJlY3QoXy5oZWFkKGNoaWxkcmVuKSk7XG4gICAgICAgIGxldCBpbml0aWFsUmVjdHMgPSBbZmlyc3RSZWN0XTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IHJlY3QgPSBhd2FpdCB0aGlzLmdldEVsZW1lbnRSZWN0KGNoaWxkcmVuW2ldKTtcbiAgICAgICAgICBpbml0aWFsUmVjdHMucHVzaChyZWN0KTtcbiAgICAgICAgICBpZiAocmVjdC55ICE9PSBmaXJzdFJlY3QueSkge1xuICAgICAgICAgICAgZWxzSW5Sb3cgPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwYWNlQmV0d2VlbkVscyA9IGluaXRpYWxSZWN0c1tlbHNJblJvd10ueSAtIGluaXRpYWxSZWN0c1tlbHNJblJvdyAtIDFdLnkgLSBpbml0aWFsUmVjdHNbZWxzSW5Sb3cgLSAxXS5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IG51bVJvd3MgPSBNYXRoLmNlaWwoY2hpbGRyZW4ubGVuZ3RoIC8gZWxzSW5Sb3cpO1xuXG4gICAgICAgIC8vIGFzc3VtZSBhbGwgY2VsbHMgYXJlIHRoZSBzYW1lIGhlaWdodFxuICAgICAgICBjb250ZW50SGVpZ2h0ID0gKG51bVJvd3MgKiBmaXJzdFJlY3QuaGVpZ2h0KSArIChzcGFjZUJldHdlZW5FbHMgKiAobnVtUm93cyAtIDEpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoYFByb2dyYW1taW5nIGVycm9yOiB0eXBlICcke3R5cGV9JyB3YXMgbm90IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB2YWxpZCBidXQgc2hvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIHJlamVjdGVkYCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IHNpemUgPSBhd2FpdCB0aGlzLmdldFNpemUoZWwpO1xuICBjb25zdCBvcmlnaW4gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uSW5WaWV3KGVsKTtcbiAgLy8gYXR0cmlidXRlcyBoYXZlIHRvIGJlIHN0cmluZ3MsIHNvIHN0cmluZ2lmeSB0aGlzIHVwXG4gIHJldHVybiBKU09OLnN0cmluZ2lmeSh7XG4gICAgd2lkdGg6IHNpemUud2lkdGgsXG4gICAgaGVpZ2h0OiBzaXplLmhlaWdodCxcbiAgICB0b3A6IG9yaWdpbi55LFxuICAgIGxlZnQ6IG9yaWdpbi54LFxuICAgIHNjcm9sbGFibGVPZmZzZXQ6IGNvbnRlbnRIZWlnaHRcbiAgfSk7XG59O1xuXG5jb21tYW5kcy5pc0tleWJvYXJkU2hvd24gPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlS2V5Ym9hcmQnLCBmYWxzZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGlnbikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcyk7XG5leHBvcnQgeyBjb21tYW5kcyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
