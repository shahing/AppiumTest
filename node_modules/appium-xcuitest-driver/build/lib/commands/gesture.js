"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

commands.mobileShake = async function () {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  await this.opts.device.shake();
};

commands.click = async function (el) {
  if (!this.isWebContext()) {
    return await this.nativeClick(el);
  }

  el = _appiumSupport.util.unwrapElement(el);

  if ((await this.settings.getSettings()).nativeWebTap) {
    _logger.default.debug('Using native web tap');

    await this.nativeWebTap(el);
  } else {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('click', [atomsElement]);
  }
};

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = async function (actions) {
  _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

  const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
    parameters: {
      pointerType: 'touch'
    }
  } : {})).map(action => {
    const modifiedAction = _lodash.default.clone(action) || {};
    modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
    return modifiedAction;
  });

  _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

  return await this.proxyCommand('/actions', 'POST', {
    actions: preprocessedActions
  });
};

commands.performTouch = async function (gestures) {
  _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

  try {
    return await this.proxyCommand('/wda/touch/perform', 'POST', {
      actions: gestures
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.performMultiAction = async function (actions) {
  _logger.default.debug(`Received the following multi touch action:`);

  for (let i in actions) {
    _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
  }

  try {
    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {
      actions
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.nativeClick = async function (el) {
  el = _appiumSupport.util.unwrapElement(el);
  let endpoint = `/element/${el}/click`;
  return await this.proxyCommand(endpoint, 'POST', {});
};

helpers.mobileScroll = async function (opts = {}, swipe = false) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  let params = {};

  if (opts.name && !swipe) {
    params.name = opts.name;
  } else if (opts.direction) {
    if (!['up', 'down', 'left', 'right'].includes(opts.direction.toLowerCase())) {
      let msg = 'Direction must be up, down, left or right';

      _logger.default.errorAndThrow(msg);
    }

    params.direction = opts.direction;
  } else if (opts.predicateString && !swipe) {
    params.predicateString = opts.predicateString;
  } else if (opts.toVisible && !swipe) {
    params.toVisible = opts.toVisible;
  } else {
    let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

    _logger.default.errorAndThrow(msg);
  }

  if (!swipe && opts.distance) {
    params.distance = opts.distance;
  }

  let element = opts.element.ELEMENT || opts.element;
  let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
  return await this.proxyCommand(endpoint, 'POST', params);
};

helpers.mobileSwipe = async function (opts = {}) {
  return await this.mobileScroll(opts, true);
};

function parseFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

helpers.mobilePinch = async function (opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const params = {
    scale: parseFloatParameter('scale', opts.scale, 'pinch'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'pinch')
  };
  const el = opts.element.ELEMENT || opts.element;
  return await this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
};

helpers.mobileDoubleTap = async function (opts = {}) {
  if (opts.element) {
    const el = opts.element.ELEMENT || opts.element;
    return await this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
  }

  const params = {
    x: parseFloatParameter('x', opts.x, 'doubleTap'),
    y: parseFloatParameter('y', opts.y, 'doubleTap')
  };
  return await this.proxyCommand('/wda/doubleTap', 'POST', params);
};

helpers.mobileTwoFingerTap = async function (opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const el = opts.element.ELEMENT || opts.element;
  return await this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
};

helpers.mobileTouchAndHold = async function (opts = {}) {
  let params = {
    duration: parseFloatParameter('duration', opts.duration, 'touchAndHold')
  };

  if (opts.element) {
    const el = opts.element.ELEMENT || opts.element;
    return await this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
  }

  params.x = parseFloatParameter('x', opts.x, 'touchAndHold');
  params.y = parseFloatParameter('y', opts.y, 'touchAndHold');
  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);
};

helpers.mobileTap = async function (opts = {}) {
  const params = {
    x: parseFloatParameter('x', opts.x, 'tap'),
    y: parseFloatParameter('y', opts.y, 'tap')
  };
  const el = opts.element ? opts.element.ELEMENT || opts.element : '0';
  return await this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
};

helpers.mobileDragFromToForDuration = async function (opts = {}) {
  const params = {
    duration: parseFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
    fromX: parseFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
    fromY: parseFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
    toX: parseFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
    toY: parseFloatParameter('toY', opts.toY, 'dragFromToForDuration')
  };

  if (opts.element) {
    const el = opts.element.ELEMENT || opts.element;
    return await this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
  }

  return await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
};

helpers.mobileSelectPickerWheelValue = async function (opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
  }

  if (!_lodash.default.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {
    _logger.default.errorAndThrow(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
  }

  const el = opts.element.ELEMENT || opts.element;
  const params = {
    order: opts.order
  };

  if (opts.offset) {
    params.offset = parseFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
  }

  return await this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
};

helpers.getCoordinates = async function (gesture) {
  let el = gesture.options.element;
  let coordinates = {
    x: 0,
    y: 0,
    areOffsets: false
  };
  let optionX = null;

  if (gesture.options.x) {
    optionX = parseFloatParameter('x', gesture.options.x, 'getCoordinates');
  }

  let optionY = null;

  if (gesture.options.y) {
    optionY = parseFloatParameter('y', gesture.options.y, 'getCoordinates');
  }

  if (el) {
    let rect = await this.getElementRect(el);
    let pos = {
      x: rect.x,
      y: rect.y
    };
    let size = {
      w: rect.width,
      h: rect.height
    };
    let offsetX = 0;
    let offsetY = 0;

    if (optionX || optionY) {
      offsetX = optionX || 0;
      offsetY = optionY || 0;
    } else {
      offsetX = size.w / 2;
      offsetY = size.h / 2;
    }

    coordinates.x = pos.x + offsetX;
    coordinates.y = pos.y + offsetY;
  } else {
    coordinates.areOffsets = gesture.action === 'moveTo';
    coordinates.x = optionX || 0;
    coordinates.y = optionY || 0;
  }

  return coordinates;
};

helpers.applyMoveToOffset = function (firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibG9nIiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJfIiwiZGlmZmVyZW5jZSIsImtleXMiLCJpc0FycmF5IiwiaW50ZXJzZWN0aW9uIiwibGVuZ3RoIiwiYWN0aW9uIiwieCIsImlzUGxhaW5PYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsInBlcmZvcm1BY3Rpb25zIiwiYWN0aW9ucyIsInByZXByb2Nlc3NlZEFjdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlIiwicGFyYW1ldGVycyIsInBvaW50ZXJUeXBlIiwibW9kaWZpZWRBY3Rpb24iLCJjbG9uZSIsImZpbHRlciIsImlubmVyQWN0aW9uIiwiZHVyYXRpb24iLCJwcm94eUNvbW1hbmQiLCJwZXJmb3JtVG91Y2giLCJlIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJpIiwicGFyc2VJbnQiLCJlbmRwb2ludCIsIm1vYmlsZVNjcm9sbCIsInN3aXBlIiwiZWxlbWVudCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsInBhcmFtcyIsIm5hbWUiLCJkaXJlY3Rpb24iLCJpbmNsdWRlcyIsInRvTG93ZXJDYXNlIiwibXNnIiwicHJlZGljYXRlU3RyaW5nIiwidG9WaXNpYmxlIiwiZGlzdGFuY2UiLCJFTEVNRU5UIiwibW9iaWxlU3dpcGUiLCJwYXJzZUZsb2F0UGFyYW1ldGVyIiwicGFyYW1OYW1lIiwicGFyYW1WYWx1ZSIsIm1ldGhvZE5hbWUiLCJpc1VuZGVmaW5lZCIsInJlc3VsdCIsInBhcnNlRmxvYXQiLCJpc05hTiIsIm1vYmlsZVBpbmNoIiwic2NhbGUiLCJ2ZWxvY2l0eSIsIm1vYmlsZURvdWJsZVRhcCIsInkiLCJtb2JpbGVUd29GaW5nZXJUYXAiLCJtb2JpbGVUb3VjaEFuZEhvbGQiLCJtb2JpbGVUYXAiLCJtb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24iLCJmcm9tWCIsImZyb21ZIiwidG9YIiwidG9ZIiwibW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSIsImlzU3RyaW5nIiwib3JkZXIiLCJvZmZzZXQiLCJnZXRDb29yZGluYXRlcyIsIm9wdGlvbnMiLCJjb29yZGluYXRlcyIsImFyZU9mZnNldHMiLCJvcHRpb25YIiwib3B0aW9uWSIsInJlY3QiLCJnZXRFbGVtZW50UmVjdCIsInBvcyIsInNpemUiLCJ3Iiwid2lkdGgiLCJoIiwiaGVpZ2h0Iiwib2Zmc2V0WCIsIm9mZnNldFkiLCJhcHBseU1vdmVUb09mZnNldCIsImZpcnN0Q29vcmRpbmF0ZXMiLCJzZWNvbmRDb29yZGluYXRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsSUFBSUEsT0FBTyxHQUFHLEVBQWQ7QUFBQSxJQUFrQkMsVUFBVSxHQUFHLEVBQS9CO0FBQUEsSUFBbUNDLFFBQVEsR0FBRyxFQUE5Qzs7OztBQUVBQSxRQUFRLENBQUNDLE1BQVQsR0FBa0JDLDZCQUFZQyxPQUFaLENBQW9CRixNQUF0Qzs7QUFFQUQsUUFBUSxDQUFDSSxXQUFULEdBQXVCLGtCQUFrQjtBQUN2QyxNQUFJLENB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RDs7QUFDRCxTQUFPSCxXQUFQO0FBQ0QsQ0E1Q0Q7O0FBOENBN0csT0FBTyxDQUFDMkgsaUJBQVIsR0FBNEIsVUFBVUMsZ0JBQVYsRUFBNEJDLGlCQUE1QixFQUErQztBQUN6RSxNQUFJQSxpQkFBaUIsQ0FBQ2YsVUFBdEIsRUFBa0M7QUFDaEMsV0FBTztBQUNMdEUsTUFBQUEsQ0FBQyxFQUFFb0YsZ0JBQWdCLENBQUNwRixDQUFqQixHQUFxQnFGLGlCQUFpQixDQUFDckYsQ0FEckM7QUFFTHNELE1BQUFBLENBQUMsRUFBRThCLGdCQUFnQixDQUFDOUIsQ0FBakIsR0FBcUIrQixpQkFBaUIsQ0FBQy9CO0FBRnJDLEtBQVA7QUFJRCxHQUxELE1BS087QUFDTCxXQUFPK0IsaUJBQVA7QUFDRDtBQUNGLENBVEQ7O0FBV0E3RSxNQUFNLENBQUNDLE1BQVAsQ0FBY2hELFVBQWQsRUFBMEJELE9BQTFCLEVBQW1DRSxRQUFuQztlQUVlRCxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBpb3NDb21tYW5kcyB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9LCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5tb3ZlVG8gPSBpb3NDb21tYW5kcy5nZXN0dXJlLm1vdmVUbztcblxuY29tbWFuZHMubW9iaWxlU2hha2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGlmICghdGhpcy5pc1NpbXVsYXRvcigpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1NoYWtlIGlzIG5vdCBzdXBwb3J0ZWQgb24gcmVhbCBkZXZpY2VzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5zaGFrZSgpO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gdGhlcmUgYXJlIG11bHRpcGxlIGNvbW1hbmRzIHRoYXQgbWFwIGhlcmUsIHNvIG1hbnVhbGx5IHByb3h5XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0aXZlQ2xpY2soZWwpO1xuICB9XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKChhd2FpdCB0aGlzLnNldHRpbmdzLmdldFNldHRpbmdzKCkpLm5hdGl2ZVdlYlRhcCkge1xuICAgIC8vIGF0b21zLWJhc2VkIGNsaWNrcyBkb24ndCBhbHdheXMgd29yayBpbiBzYWZhcmkgN1xuICAgIGxvZy5kZWJ1ZygnVXNpbmcgbmF0aXZlIHdlYiB0YXAnKTtcbiAgICBhd2FpdCB0aGlzLm5hdGl2ZVdlYlRhcChlbCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xpY2snLCBbYXRvbXNFbGVtZW50XSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdlc3R1cmVzQ2hhaW5Ub1N0cmluZyAoZ2VzdHVyZXMsIGtleXNUb0luY2x1ZGUgPSBbJ29wdGlvbnMnXSkge1xuICByZXR1cm4gZ2VzdHVyZXMubWFwKChpdGVtKSA9PiB7XG4gICAgbGV0IG90aGVyS2V5cyA9IF8uZGlmZmVyZW5jZShfLmtleXMoaXRlbSksIFsnYWN0aW9uJ10pO1xuICAgIG90aGVyS2V5cyA9IF8uaXNBcnJheShrZXlzVG9JbmNsdWRlKSA/IF8uaW50ZXJzZWN0aW9uKG90aGVyS2V5cywga2V5c1RvSW5jbHVkZSkgOiBvdGhlcktleXM7XG4gICAgaWYgKG90aGVyS2V5cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBgJHtpdGVtLmFjdGlvbn1gICtcbiAgICAgICAgYCgke18ubWFwKG90aGVyS2V5cywgKHgpID0+IHggKyAnPScgKyAoXy5pc1BsYWluT2JqZWN0KGl0ZW1beF0pID8gSlNPTi5zdHJpbmdpZnkoaXRlbVt4XSkgOiBpdGVtW3hdKSkuam9pbignLCAnKX0pYDtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW0uYWN0aW9uO1xuICB9KS5qb2luKCctJyk7XG59XG5cbmNvbW1hbmRzLnBlcmZvcm1BY3Rpb25zID0gYXN5bmMgZnVuY3Rpb24gKGFjdGlvbnMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIFczQyBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KGFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICAvLyBUaGlzIGlzIG1hbmRhdG9yeSwgc2luY2UgV0RBIG9ubHkgc3VwcG9ydHMgVE9VQ0ggcG9pbnRlciB0eXBlXG4gIC8vIGFuZCBTZWxlbml1bSBBUEkgdXNlcyBNT1VTRSBhcyB0aGUgZGVmYXVsdCBvbmVcbiAgY29uc3QgcHJlcHJvY2Vzc2VkQWN0aW9ucyA9IGFjdGlvbnNcbiAgICAubWFwKChhY3Rpb24pID0+IE9iamVjdC5hc3NpZ24oe30sIGFjdGlvbiwgYWN0aW9uLnR5cGUgPT09ICdwb2ludGVyJyA/IHtcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgcG9pbnRlclR5cGU6ICd0b3VjaCdcbiAgICAgIH1cbiAgICB9IDoge30pKVxuICAgIC5tYXAoKGFjdGlvbikgPT4ge1xuICAgICAgY29uc3QgbW9kaWZpZWRBY3Rpb24gPSBfLmNsb25lKGFjdGlvbikgfHwge307XG4gICAgICAvLyBTZWxlbml1bSBBUEkgdW5leHBlY3RlZGx5IGluc2VydHMgemVybyBwYXVzZXMsIHdoaWNoIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IFdEQVxuICAgICAgbW9kaWZpZWRBY3Rpb24uYWN0aW9ucyA9IChhY3Rpb24uYWN0aW9ucyB8fCBbXSlcbiAgICAgICAgLmZpbHRlcigoaW5uZXJBY3Rpb24pID0+ICEoaW5uZXJBY3Rpb24udHlwZSA9PT0gJ3BhdXNlJyAmJiBpbm5lckFjdGlvbi5kdXJhdGlvbiA9PT0gMCkpO1xuICAgICAgcmV0dXJuIG1vZGlmaWVkQWN0aW9uO1xuICAgIH0pO1xuICBsb2cuZGVidWcoYFByZXByb2Nlc3NlZCBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KHByZXByb2Nlc3NlZEFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9hY3Rpb25zJywgJ1BPU1QnLCB7YWN0aW9uczogcHJlcHJvY2Vzc2VkQWN0aW9uc30pO1xufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyB0b3VjaCBhY3Rpb246ICR7Z2VzdHVyZXNDaGFpblRvU3RyaW5nKGdlc3R1cmVzKX1gKTtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2gvcGVyZm9ybScsICdQT1NUJywge2FjdGlvbnM6IGdlc3R1cmVzfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KCdUaGUgVG91Y2ggQVBJIGlzIGFpbWVkIGZvciB1c2FnZSBpbiBOQVRJVkUgY29udGV4dC4gJyArXG4gICAgICAnQ29uc2lkZXIgdXNpbmcgXCJleGVjdXRlXCIgQVBJIHdpdGggY3VzdG9tIGV2ZW50cyB0cmlnZ2VyIHNjcmlwdCAnICtcbiAgICAgIGB0byBlbXVsYXRlIHRvdWNoIGV2ZW50cyBiZWluZyBpbiBXRUJWSUVXIGNvbnRleHQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGVyZm9ybU11bHRpQWN0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGFjdGlvbnMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIG11bHRpIHRvdWNoIGFjdGlvbjpgKTtcbiAgZm9yIChsZXQgaSBpbiBhY3Rpb25zKSB7XG4gICAgbG9nLmRlYnVnKGAgICAgJHtwYXJzZUludChpLCAxMCkgKyAxfTogJHtfLm1hcChhY3Rpb25zW2ldLCAnYWN0aW9uJykuam9pbignLScpfWApO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoL211bHRpL3BlcmZvcm0nLCAnUE9TVCcsIHthY3Rpb25zfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KCdUaGUgTXVsdGlUb3VjaCBBUEkgaXMgYWltZWQgZm9yIHVzYWdlIGluIE5BVElWRSBjb250ZXh0LiAnICtcbiAgICAgICdDb25zaWRlciB1c2luZyBcImV4ZWN1dGVcIiBBUEkgd2l0aCBjdXN0b20gZXZlbnRzIHRyaWdnZXIgc2NyaXB0ICcgK1xuICAgICAgYHRvIGVtdWxhdGUgbXVsdGl0b3VjaCBldmVudHMgYmVpbmcgaW4gV0VCVklFVyBjb250ZXh0LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLm5hdGl2ZUNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgbGV0IGVuZHBvaW50ID0gYC9lbGVtZW50LyR7ZWx9L2NsaWNrYDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHt9KTtcbn07XG5cbi8qXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL1dlYkRyaXZlckFnZW50L2Jsb2IvbWFzdGVyL1dlYkRyaXZlckFnZW50TGliL0NvbW1hbmRzL0ZCRWxlbWVudENvbW1hbmRzLm1cbiAqIHRvIGdldCB0aGUgaW5mbyBhYm91dCBhdmFpbGFibGUgV0RBIGdlc3R1cmVzIEFQSVxuICpcbiAqIFNlZSBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vcmVmZXJlbmNlL3hjdGVzdC94Y3VpZWxlbWVudCBhbmRcbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9yZWZlcmVuY2UveGN0ZXN0L3hjdWljb29yZGluYXRlIHRvIGdldCB0aGUgZGV0YWlsZWQgZGVzY3JpcHRpb24gb2ZcbiAqIGFsbCBYQ1Rlc3QgZ2VzdHVyZXNcbiovXG5cbmhlbHBlcnMubW9iaWxlU2Nyb2xsID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSwgc3dpcGUgPSBmYWxzZSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIC8vIFdEQSBzdXBwb3J0cyBmb3VyIHNjcm9sbGluZyBzdHJhdGVnaWVzOiBwcmVkaWNhdGlvbiBiYXNlZCBvbiBuYW1lLCBkaXJlY3Rpb24sXG4gIC8vIHByZWRpY2F0ZVN0cmluZywgYW5kIHRvVmlzaWJsZSwgaW4gdGhhdCBvcmRlci4gU3dpcGluZyByZXF1aXJlcyBkaXJlY3Rpb24uXG4gIGxldCBwYXJhbXMgPSB7fTtcbiAgaWYgKG9wdHMubmFtZSAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMubmFtZSA9IG9wdHMubmFtZTtcbiAgfSBlbHNlIGlmIChvcHRzLmRpcmVjdGlvbikge1xuICAgIGlmICghWyd1cCcsICdkb3duJywgJ2xlZnQnLCAncmlnaHQnXS5pbmNsdWRlcyhvcHRzLmRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgbGV0IG1zZyA9ICdEaXJlY3Rpb24gbXVzdCBiZSB1cCwgZG93biwgbGVmdCBvciByaWdodCc7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgICBwYXJhbXMuZGlyZWN0aW9uID0gb3B0cy5kaXJlY3Rpb247XG4gIH0gZWxzZSBpZiAob3B0cy5wcmVkaWNhdGVTdHJpbmcgJiYgIXN3aXBlKSB7XG4gICAgcGFyYW1zLnByZWRpY2F0ZVN0cmluZyA9IG9wdHMucHJlZGljYXRlU3RyaW5nO1xuICB9IGVsc2UgaWYgKG9wdHMudG9WaXNpYmxlICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy50b1Zpc2libGUgPSBvcHRzLnRvVmlzaWJsZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgbXNnID0gc3dpcGVcbiAgICAgID8gJ01vYmlsZSBzd2lwZSByZXF1aXJlcyBkaXJlY3Rpb24nXG4gICAgICA6ICdNb2JpbGUgc2Nyb2xsIHN1cHBvcnRzIHRoZSBmb2xsb3dpbmcgc3RyYXRlZ2llczogbmFtZSwgZGlyZWN0aW9uLCBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUuIFNwZWNpZnkgb25lIG9mIHRoZXNlJztcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICB9XG5cbiAgLy8gd2UgY2FuIGFsc28gb3B0aW9uYWxseSBwYXNzIGEgZGlzdGFuY2Ugd2hpY2ggYXBwZWFycyB0byBiZSBhIHJhdGlvIG9mXG4gIC8vIHNjcmVlbiBoZWlnaHQsIHNvIDEuMCBtZWFucyBhIGZ1bGwgc2NyZWVuJ3Mgd29ydGggb2Ygc2Nyb2xsaW5nXG4gIGlmICghc3dpcGUgJiYgb3B0cy5kaXN0YW5jZSkge1xuICAgIHBhcmFtcy5kaXN0YW5jZSA9IG9wdHMuZGlzdGFuY2U7XG4gIH1cblxuICBsZXQgZWxlbWVudCA9IG9wdHMuZWxlbWVudC5FTEVNRU5UIHx8IG9wdHMuZWxlbWVudDtcbiAgbGV0IGVuZHBvaW50ID0gYC93ZGEvZWxlbWVudC8ke2VsZW1lbnR9LyR7c3dpcGUgPyAnc3dpcGUnIDogJ3Njcm9sbCd9YDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVN3aXBlID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5tb2JpbGVTY3JvbGwob3B0cywgdHJ1ZSk7XG59O1xuXG5mdW5jdGlvbiBwYXJzZUZsb2F0UGFyYW1ldGVyIChwYXJhbU5hbWUsIHBhcmFtVmFsdWUsIG1ldGhvZE5hbWUpIHtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGFyYW1WYWx1ZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCIke3BhcmFtTmFtZX1cIiBwYXJhbWV0ZXIgaXMgbWFuZGF0b3J5IGZvciBcIiR7bWV0aG9kTmFtZX1cIiBjYWxsYCk7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VGbG9hdChwYXJhbVZhbHVlKTtcbiAgaWYgKGlzTmFOKHJlc3VsdCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCIke3BhcmFtTmFtZX1cIiBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgdmFsaWQgbnVtYmVyLiBcIiR7cGFyYW1WYWx1ZX1cIiBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuaGVscGVycy5tb2JpbGVQaW5jaCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBvcHRzLmVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyhgY2xhc3MgbmFtZWAsIGBYQ1VJRWxlbWVudFR5cGVBcHBsaWNhdGlvbmAsIGZhbHNlKTtcbiAgfVxuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgc2NhbGU6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3NjYWxlJywgb3B0cy5zY2FsZSwgJ3BpbmNoJyksXG4gICAgdmVsb2NpdHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3ZlbG9jaXR5Jywgb3B0cy52ZWxvY2l0eSwgJ3BpbmNoJylcbiAgfTtcbiAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3BpbmNoYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVEb3VibGVUYXAgPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9KSB7XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBEb3VibGUgdGFwIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IG9wdHMuZWxlbWVudC5FTEVNRU5UIHx8IG9wdHMuZWxlbWVudDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9kb3VibGVUYXBgLCAnUE9TVCcpO1xuICB9XG4gIC8vIERvdWJsZSB0YXAgY29vcmRpbmF0ZXNcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICdkb3VibGVUYXAnKSxcbiAgICB5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAnZG91YmxlVGFwJylcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2RvdWJsZVRhcCcsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVHdvRmluZ2VyVGFwID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIGNvbnN0IGVsID0gb3B0cy5lbGVtZW50LkVMRU1FTlQgfHwgb3B0cy5lbGVtZW50O1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS90d29GaW5nZXJUYXBgLCAnUE9TVCcpO1xufTtcblxuaGVscGVycy5tb2JpbGVUb3VjaEFuZEhvbGQgPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9KSB7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2R1cmF0aW9uJywgb3B0cy5kdXJhdGlvbiwgJ3RvdWNoQW5kSG9sZCcpXG4gIH07XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBMb25nIHRhcCBlbGVtZW50XG4gICAgY29uc3QgZWwgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vdG91Y2hBbmRIb2xkYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICB9XG4gIC8vIExvbmcgdGFwIGNvb3JkaW5hdGVzXG4gIHBhcmFtcy54ID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ3RvdWNoQW5kSG9sZCcpO1xuICBwYXJhbXMueSA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICd0b3VjaEFuZEhvbGQnKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoQW5kSG9sZCcsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVGFwID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgeDogcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ3RhcCcpLFxuICAgIHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICd0YXAnKVxuICB9O1xuICBjb25zdCBlbCA9IG9wdHMuZWxlbWVudCA/IChvcHRzLmVsZW1lbnQuRUxFTUVOVCB8fCBvcHRzLmVsZW1lbnQpIDogJzAnO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvdGFwLyR7ZWx9YCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVEcmFnRnJvbVRvRm9yRHVyYXRpb24gPSBhc3luYyBmdW5jdGlvbiAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBkdXJhdGlvbjogcGFyc2VGbG9hdFBhcmFtZXRlcignZHVyYXRpb24nLCBvcHRzLmR1cmF0aW9uLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgZnJvbVg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2Zyb21YJywgb3B0cy5mcm9tWCwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIGZyb21ZOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdmcm9tWScsIG9wdHMuZnJvbVksICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICB0b1g6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3RvWCcsIG9wdHMudG9YLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9ZOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd0b1knLCBvcHRzLnRvWSwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpXG4gIH07XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBEcmFnIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IG9wdHMuZWxlbWVudC5FTEVNRU5UIHx8IG9wdHMuZWxlbWVudDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9kcmFnZnJvbXRvZm9yZHVyYXRpb25gLCAnUE9TVCcsIHBhcmFtcyk7XG4gIH1cbiAgLy8gRHJhZyBjb29yZGluYXRlc1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvZHJhZ2Zyb210b2ZvcmR1cmF0aW9uJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdFbGVtZW50IGlkIGlzIGV4cGVjdGVkIHRvIGJlIHNldCBmb3Igc2VsZWN0UGlja2VyV2hlZWxWYWx1ZSBtZXRob2QnKTtcbiAgfVxuICBpZiAoIV8uaXNTdHJpbmcob3B0cy5vcmRlcikgfHwgIVsnbmV4dCcsICdwcmV2aW91cyddLmluY2x1ZGVzKG9wdHMub3JkZXIudG9Mb3dlckNhc2UoKSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIG1hbmRhdG9yeSAnb3JkZXInIHBhcmFtZXRlciBpcyBleHBlY3RlZCB0byBiZSBlcXVhbCBlaXRoZXIgdG8gJ25leHQnIG9yICdwcmV2aW91cycuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAnJHtvcHRzLm9yZGVyfScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGNvbnN0IGVsID0gb3B0cy5lbGVtZW50LkVMRU1FTlQgfHwgb3B0cy5lbGVtZW50O1xuICBjb25zdCBwYXJhbXMgPSB7b3JkZXI6IG9wdHMub3JkZXJ9O1xuICBpZiAob3B0cy5vZmZzZXQpIHtcbiAgICBwYXJhbXMub2Zmc2V0ID0gcGFyc2VGbG9hdFBhcmFtZXRlcignb2Zmc2V0Jywgb3B0cy5vZmZzZXQsICdzZWxlY3RQaWNrZXJXaGVlbFZhbHVlJyk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL3BpY2tlcndoZWVsLyR7ZWx9L3NlbGVjdGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMuZ2V0Q29vcmRpbmF0ZXMgPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZSkge1xuICBsZXQgZWwgPSBnZXN0dXJlLm9wdGlvbnMuZWxlbWVudDtcblxuICAvLyBkZWZhdWx0c1xuICBsZXQgY29vcmRpbmF0ZXMgPSB7eDogMCwgeTogMCwgYXJlT2Zmc2V0czogZmFsc2V9O1xuXG4gIGxldCBvcHRpb25YID0gbnVsbDtcbiAgaWYgKGdlc3R1cmUub3B0aW9ucy54KSB7XG4gICAgb3B0aW9uWCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBnZXN0dXJlLm9wdGlvbnMueCwgJ2dldENvb3JkaW5hdGVzJyk7XG4gIH1cbiAgbGV0IG9wdGlvblkgPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLnkpIHtcbiAgICBvcHRpb25ZID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIGdlc3R1cmUub3B0aW9ucy55LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIGVsZW1lbnQgY29vcmRpbmF0ZXMuXG4gIGlmIChlbCkge1xuICAgIGxldCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gICAgbGV0IHBvcyA9IHt4OiByZWN0LngsIHk6IHJlY3QueX07XG4gICAgbGV0IHNpemUgPSB7dzogcmVjdC53aWR0aCwgaDogcmVjdC5oZWlnaHR9O1xuXG4gICAgLy8gZGVmYXVsdHNcbiAgICBsZXQgb2Zmc2V0WCA9IDA7XG4gICAgbGV0IG9mZnNldFkgPSAwO1xuXG4gICAgLy8gZ2V0IHRoZSByZWFsIG9mZnNldHNcbiAgICBpZiAob3B0aW9uWCB8fCBvcHRpb25ZKSB7XG4gICAgICBvZmZzZXRYID0gKG9wdGlvblggfHwgMCk7XG4gICAgICBvZmZzZXRZID0gKG9wdGlvblkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChvcHRpb25YIHx8IDApO1xuICAgIGNvb3JkaW5hdGVzLnkgPSAob3B0aW9uWSB8fCAwKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZXM7XG59O1xuXG5oZWxwZXJzLmFwcGx5TW92ZVRvT2Zmc2V0ID0gZnVuY3Rpb24gKGZpcnN0Q29vcmRpbmF0ZXMsIHNlY29uZENvb3JkaW5hdGVzKSB7XG4gIGlmIChzZWNvbmRDb29yZGluYXRlcy5hcmVPZmZzZXRzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGZpcnN0Q29vcmRpbmF0ZXMueCArIHNlY29uZENvb3JkaW5hdGVzLngsXG4gICAgICB5OiBmaXJzdENvb3JkaW5hdGVzLnkgKyBzZWNvbmRDb29yZGluYXRlcy55LFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNlY29uZENvb3JkaW5hdGVzO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzLCBnZXN0dXJlc0NoYWluVG9TdHJpbmcgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
