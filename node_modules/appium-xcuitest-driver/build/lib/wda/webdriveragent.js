"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BOOTSTRAP_PATH = exports.WDA_BUNDLE_ID = exports.WebDriverAgent = exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _url2 = _interopRequireDefault(require("url"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("../logger"));

var _noSessionProxy = require("./no-session-proxy");

var _utils = require("./utils");

var _utils2 = require("../utils");

var _xcodebuild = _interopRequireDefault(require("./xcodebuild"));

var _iproxy = _interopRequireDefault(require("./iproxy"));

var _teen_process = require("teen_process");

const BOOTSTRAP_PATH = _path.default.resolve(__dirname, '..', '..', '..', 'WebDriverAgent');

exports.BOOTSTRAP_PATH = BOOTSTRAP_PATH;
const WDA_BUNDLE_ID = 'com.apple.test.WebDriverAgentRunner-Runner';
exports.WDA_BUNDLE_ID = WDA_BUNDLE_ID;
const WDA_LAUNCH_TIMEOUT = 60 * 1000;
const WDA_AGENT_PORT = 8100;
const WDA_BASE_URL = 'http://localhost';

class WebDriverAgent {
  constructor(xcodeVersion, args = {}) {
    this.xcodeVersion = xcodeVersion;
    this.args = _lodash.default.clone(args);
    this.device = args.device;
    this.platformVersion = args.platformVersion;
    this.host = args.host;
    this.realDevice = !!args.realDevice;
    this.setWDAPaths(args.bootstrapPath, args.agentPath);
    this.wdaLocalPort = args.wdaLocalPort;
    this.prebuildWDA = args.prebuildWDA;
    this.webDriverAgentUrl = args.webDriverAgentUrl;
    this.started = false;
    this.wdaConnectionTimeout = args.wdaConnectionTimeout;
    this.useCarthageSsl = _lodash.default.isBoolean(args.useCarthageSsl) && args.useCarthageSsl;
    this.useXctestrunFile = args.useXctestrunFile;
    this.xcodebuild = new _xcodebuild.default(this.xcodeVersion, this.device, {
      platformVersion: this.platformVersion,
      agentPath: this.agentPath,
      bootstrapPath: this.bootstrapPath,
      realDevice: this.realDevice,
      showXcodeLog: !!args.showXcodeLog,
      xcodeConfigFile: args.xcodeConfigFile,
      xcodeOrgId: args.xcodeOrgId,
      xcodeSigningId: args.xcodeSigningId,
      keychainPath: args.keychainPath,
      keychainPassword: args.keychainPassword,
      useSimpleBuildTest: args.useSimpleBuildTest,
      usePrebuiltWDA: args.usePrebuiltWDA,
      updatedWDABundleId: args.updatedWDABundleId,
      launchTimeout: args.wdaLaunchTimeout || WDA_LAUNCH_TIMEOUT,
      wdaRemotePort: this.realDevice ? WDA_AGENT_PORT : this.wdaLocalPort || WDA_AGENT_PORT,
      useXctestrunFile: this.useXctestrunFile,
      derivedDataPath: args.derivedDataPath,
      mjpegServerPort: args.mjpegServerPort
    });
  }

  setWDAPaths(bootstrapPath, agentPath) {
    this.bootstrapPath = bootstrapPath || BOOTSTRAP_PATH;

    _logger.default.info(`Using WDA path: '${this.bootstrapPath}'`);

    this.agentPath = agentPath || _path.default.resolve(this.bootstrapPath, 'WebDriverAgent.xcodeproj');

    _logger.default.info(`Using WDA agent: '${this.agentPath}'`);
  }

  async cleanupObsoleteProcesses() {
    const pids = await (0, _utils2.getPIDsListeningOnPort)(this.url.port, cmdLine => (cmdLine.includes('/WebDriverAgentRunner') || cmdLine.includes('/iproxy')) && !cmdLine.toLowerCase().includes(this.device.udid.toLowerCase()));

    if (!pids.length) {
      _logger.default.debug(`No obsolete cached processes from previous WDA sessions ` + `listening on port ${this.url.port} have been found`);

      return;
    }

    _logger.default.info(`Detected ${pids.length} obsolete cached process${pids.length === 1 ? '' : 'es'} ` + `from previous WDA sessions. Cleaning up...`);

    try {
      await (0, _teen_process.exec)('kill', pids);
    } catch (e) {
      _logger.default.warn(`Failed to kill obsolete cached process${pids.length === 1 ? '' : 'es'} '${pids}'. ` + `Original error: ${e.message}`);
    }
  }

  async isRunning() {
    return !!(await this.getStatus());
  }

  async getStatus() {
    const noSessionProxy = new _noSessionProxy.NoSessionProxy({
      server: this.url.hostname,
      port: this.url.port,
      base: '',
      timeout: 3000
    });

    try {
      return await noSessionProxy.command('/status', 'GET');
    } catch (err) {
      _logger.default.debug(`WDA is not listening at '${this.url.href}'`);

      return null;
    }
  }

  async uninstall() {
    _logger.default.debug(`Removing WDA application from device`);

    try {
      await this.device.removeApp(WDA_BUNDLE_ID);
    } catch (e) {
      _logger.default.warn(`WebDriverAgent uninstall failed. Perhaps, it is already uninstalled? Original error: ${JSON.stringify(e)}`);
    }
  }

  async launch(sessionId) {
    if (this.webDriverAgentUrl) {
      _logger.default.info(`Using provided WebdriverAgent at '${this.webDriverAgentUrl}'`);

      this.url = this.webDriverAgentUrl;
      this.setupProxies(sessionId);
      return;
    }

    _logger.default.info('Launching WebDriverAgent on the device');

    this.setupProxies(sessionId);

    if (!this.useXctestrunFile && !(await _appiumSupport.fs.exists(this.agentPath))) {
      throw new Error(`Trying to use WebDriverAgent project at '${this.agentPath}' but the ` + 'file does not exist');
    }

    if (!this.useXctestrunFile) {
      const didPerformUpgrade = await (0, _utils.checkForDependencies)(this.bootstrapPath, this.useCarthageSsl);

      if (didPerformUpgrade) {
        await this.xcodebuild.cleanProject();
      }
    }

    await (0, _utils2.resetXCTestProcesses)(this.device.udid, !this.realDevice, {
      wdaLocalPort: this.url.port
    });

    if (this.realDevice) {
      this.iproxy = new _iproxy.default(this.device.udid, this.url.port, WDA_AGENT_PORT);
      await this.iproxy.start();
    }

    await this.xcodebuild.init(this.noSessionProxy);

    if (this.prebuildWDA) {
      await this.xcodebuild.prebuild();
    }

    return await this.xcodebuild.start();
  }

  setupProxies(sessionId) {
    const proxyOpts = {
      server: this.url.hostname,
      port: this.url.port,
      base: '',
      timeout: this.wdaConnectionTimeout
    };
    this.jwproxy = new _appiumBaseDriver.JWProxy(proxyOpts);
    this.jwproxy.sessionId = sessionId;
    this.proxyReqRes = this.jwproxy.proxyReqRes.bind(this.jwproxy);
    this.noSessionProxy = new _noSessionProxy.NoSessionProxy(proxyOpts);
    this.noSessionProxyReqRes = this.noSessionProxy.proxyReqRes.bind(this.noSessionProxy);
  }

  async quit() {
    _logger.default.info('Shutting down sub-processes');

    if (this.iproxy) {
      await this.iproxy.quit();
    }

    await this.xcodebuild.quit();
    await this.xcodebuild.reset();

    if (this.jwproxy) {
      this.jwproxy.sessionId = null;
    }

    this.started = false;

    if (!this.args.webDriverAgentUrl) {
      this.webDriverAgentUrl = null;
    }
  }

  get url() {
    if (!this._url) {
      let port = this.wdaLocalPort || WDA_AGENT_PORT;
      this._url = _url2.default.parse(`${WDA_BASE_URL}:${port}`);
    }

    return this._url;
  }

  set url(_url) {
    this._url = _url2.default.parse(_url);
  }

  get fullyStarted() {
    return this.started;
  }

  set fullyStarted(started = false) {
    this.started = started;

    if (this.iproxy) {
      this.iproxy.expectIProxyErrors = !started;
    }
  }

  async retrieveDerivedDataPath() {
    return await this.xcodebuild.retrieveDerivedDataPath();
  }

  async setupCaching(updatedWDABundleId) {
    const status = await this.getStatus();

    if (!status || !status.build) {
      _logger.default.debug('WDA is currently not running. There is nothing to cache');

      return;
    }

    const {
      productBundleIdentifier,
      upgradedAt
    } = status.build;

    if (_appiumSupport.util.hasValue(productBundleIdentifier) && _appiumSupport.util.hasValue(updatedWDABundleId) && updatedWDABundleId !== productBundleIdentifier) {
      _logger.default.info(`Will uninstall running WDA since it has different bundle id. The actual value is '${productBundleIdentifier}'.`);

      return await this.uninstall();
    }

    if (_appiumSupport.util.hasValue(productBundleIdentifier) && !_appiumSupport.util.hasValue(updatedWDABundleId) && _utils.WDA_RUNNER_BUNDLE_ID !== productBundleIdentifier) {
      _logger.default.info(`Will uninstall running WDA since its bundle id is not equal to the default value ${_utils.WDA_RUNNER_BUNDLE_ID}`);

      return await this.uninstall();
    }

    const actualUpgradeTimestamp = await (0, _utils.getWDAUpgradeTimestamp)(this.bootstrapPath);

    _logger.default.debug(`Upgrade timestamp of the currently bundled WDA: ${actualUpgradeTimestamp}`);

    _logger.default.debug(`Upgrade timestamp of the WDA on the device: ${upgradedAt}`);

    if (actualUpgradeTimestamp && upgradedAt && _lodash.default.toLower(`${actualUpgradeTimestamp}`) !== _lodash.default.toLower(`${upgradedAt}`)) {
      _logger.default.info('Will uninstall running WDA since it has different version in comparison to the one ' + `which is bundled with appium-xcuitest-driver module (${actualUpgradeTimestamp} != ${upgradedAt})`);

      return await this.uninstall();
    }

    const message = _appiumSupport.util.hasValue(productBundleIdentifier) ? `Will reuse previously cached WDA instance at '${this.url.href}' with '${productBundleIdentifier}'` : `Will reuse previously cached WDA instance at '${this.url.href}'`;

    _logger.default.info(`${message}. Set the wdaLocalPort capability to a value different from ${this.url.port} if this is an undesired behavior.`);

    this.webDriverAgentUrl = this.url.href;
  }

  async quitAndUninstall() {
    await this.quit();
    await this.uninstall();
  }

}

exports.WebDriverAgent = WebDriverAgent;
var _default = WebDriverAgent;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi93ZGEvd2ViZHJpdmVyYWdlbnQuanMiXSwibmFtZXMiOlsiQk9PVFNUUkFQX1BBVEgiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsIldEQV9CVU5ETEVfSUQiLCJXREFfTEFVTkNIX1RJTUVPVVQiLCJXREFfQUdFTlRfUE9SVCIsIldEQV9CQVNFX1VSTCIsIldlYkRyaXZlckFnZW50IiwiY29uc3RydWN0b3IiLCJ4Y29kZVZlcnNpb24iLCJhcmdzIiwiXyIsImNsb25lIiwiZGV2aWNlIiwicGxhdGZvcm1WZXJzaW9uIiwiaG9zdCIsInJlYWxEZXZpY2UiLCJzZXRXREFQYXRocyIsImJvb3RzdHJhcFBhdGgiLCJhZ2VudFBhdGgiLCJ3ZGFMb2NhbFBvcnQiLCJwcmVidWlsZFdEQSIsIndlYkRyaXZlckFnZW50VXJsIiwic3RhcnRlZCIsIndkYUNvbm5lY3Rpb25UaW1lb3V0IiwidXNlQ2FydGhhZ2VTc2wiLCJpc0Jvb2xlYW4iLCJ1c2VYY3Rlc3RydW5GaWxlIiwieGNvZGVidWlsZCIsIlhjb2RlQnVpbGQiLCJzaG93WGNvZGVMb2ciLCJ4Y29kZUNvbmZpZ0ZpbGUiLCJ4Y29kZU9yZ0lkIiwieGNvZGVTaWduaW5nSWQiLCJrZXljaGFpblBhdGgiLCJrZXljaGFpblBhc3N3b3JkIiwidXNlU2ltcGxlQnVpbGRUZXN0IiwidXNlUHJlYnVpbHRXREEiLCJ1cGRhdGVkV0RBQnVuZGxlSWQiLCJsYXVuY2hUaW1lb3V0Iiwid2RhTGF1bmNoVGltZW91dCIsIndkYVJlbW90ZVBvcnQiLCJkZXJpdmVkRGF0YVBhdGgiLCJtanBlZ1NlcnZlclBvcnQiLCJsb2ciLCJpbmZvIiwiY2xlYW51cE9ic29sZXRlUHJvY2Vzc2VzIiwicGlkcyIsInVybCIsInBvcnQiLCJjbWRMaW5lIiwiaW5jbHVkZXMiLCJ0b0xvd2VyQ2FzZSIsInVkaWQiLCJsZW5ndGgiLCJkZWJ1ZyIsImUiLCJ3YXJuIiwibWVzc2FnZSIsImlzUnVubmluZyIsImdldFN0YXR1cyIsIm5vU2Vzc2lvblByb3h5IiwiTm9TZXNzaW9uUHJveHkiLCJzZXJ2ZXIiLCJob3N0bmFtZSIsImJhc2UiLCJ0aW1lb3V0IiwiY29tbWFuZCIsImVyciIsImhyZWYiLCJ1bmluc3RhbGwiLCJyZW1vdmVBcHAiLCJKU09OIiwic3RyaW5naWZ5IiwibGF1bmNoIiwic2Vzc2lvbklkIiwic2V0dXBQcm94aWVzIiwiZnMiLCJleGlzdHMiLCJFcnJvciIsImRpZFBlcmZvcm1VcGdyYWRlIiwiY2xlYW5Qcm9qZWN0IiwiaXByb3h5IiwiaVByb3h5Iiwic3RhcnQiLCJpbml0IiwicHJlYnVpbGQiLCJwcm94eU9wdHMiLCJqd3Byb3h5IiwiSldQcm94eSIsInByb3h5UmVxUmVzIiwiYmluZCIsIm5vU2Vzc2lvblByb3h5UmVxUmVzIiwicXVpdCIsInJlc2V0IiwiX3VybCIsInBhcnNlIiwiZnVsbHlTdGFydGVkIiwiZXhwZWN0SVByb3h5RXJyb3JzIiwicmV0cmlldmVEZXJpdmVkRGF0YVBhdGgiLCJzZXR1cENhY2hpbmciLCJzdGF0dXMiLCJidWlsZCIsInByb2R1Y3RCdW5kbGVJZGVudGlmaWVyIiwidXBncmFkZWRBdCIsInV0aWwiLCJoYXNWYWx1ZSIsIldEQV9SVU5ORVJfQlVORExFX0lEIiwiYWN0dWFsVXBncmFkZVRpbWVzdGFtcCIsInRvTG93ZXIiLCJxdWl0QW5kVW5pbnN0YWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLGNBQWMsR0FBR0MsY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLElBQTlCLEVBQW9DLElBQXBDLEVBQTBDLGdCQUExQyxDQUF2Qjs7O0FBQ0EsTUFBTUMsYUFBYSxHQUFHLDRDQUF0Qjs7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxLQUFLLElBQWhDO0FBQ0EsTUFBTUMsY0FBYyxHQUFHLElBQXZCO0FBQ0EsTUFBTUMs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QVUsR0FBRWEsT0FBUSwrREFBOEQsS0FBS1YsR0FBTCxDQUFTQyxJQUFLLG9DQUFoRzs7QUFDQSxTQUFLM0IsaUJBQUwsR0FBeUIsS0FBSzBCLEdBQUwsQ0FBU3FCLElBQWxDO0FBQ0Q7O0FBRUQsUUFBTXlDLGdCQUFOLEdBQTBCO0FBQ3hCLFVBQU0sS0FBS2pCLElBQUwsRUFBTjtBQUNBLFVBQU0sS0FBS3ZCLFNBQUwsRUFBTjtBQUNEOztBQXJTa0I7OztlQXdTTi9ELGMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgdXJsIGZyb20gJ3VybCc7XG5pbXBvcnQgeyBKV1Byb3h5IH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IGZzLCB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgTm9TZXNzaW9uUHJveHkgfSBmcm9tIFwiLi9uby1zZXNzaW9uLXByb3h5XCI7XG5pbXBvcnQgeyBjaGVja0ZvckRlcGVuZGVuY2llcywgV0RBX1JVTk5FUl9CVU5ETEVfSUQsIGdldFdEQVVwZ3JhZGVUaW1lc3RhbXAgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IHJlc2V0WENUZXN0UHJvY2Vzc2VzLCBnZXRQSURzTGlzdGVuaW5nT25Qb3J0IH0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IFhjb2RlQnVpbGQgZnJvbSAnLi94Y29kZWJ1aWxkJztcbmltcG9ydCBpUHJveHkgZnJvbSAnLi9pcHJveHknO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5cblxuY29uc3QgQk9PVFNUUkFQX1BBVEggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnV2ViRHJpdmVyQWdlbnQnKTtcbmNvbnN0IFdEQV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLnRlc3QuV2ViRHJpdmVyQWdlbnRSdW5uZXItUnVubmVyJztcbmNvbnN0IFdEQV9MQVVOQ0hfVElNRU9VVCA9IDYwICogMTAwMDtcbmNvbnN0IFdEQV9BR0VOVF9QT1JUID0gODEwMDtcbmNvbnN0IFdEQV9CQVNFX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0JztcblxuXG5jbGFzcyBXZWJEcml2ZXJBZ2VudCB7XG4gIGNvbnN0cnVjdG9yICh4Y29kZVZlcnNpb24sIGFyZ3MgPSB7fSkge1xuICAgIHRoaXMueGNvZGVWZXJzaW9uID0geGNvZGVWZXJzaW9uO1xuXG4gICAgdGhpcy5hcmdzID0gXy5jbG9uZShhcmdzKTtcblxuICAgIHRoaXMuZGV2aWNlID0gYXJncy5kZXZpY2U7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBhcmdzLnBsYXRmb3JtVmVyc2lvbjtcbiAgICB0aGlzLmhvc3QgPSBhcmdzLmhvc3Q7XG4gICAgdGhpcy5yZWFsRGV2aWNlID0gISFhcmdzLnJlYWxEZXZpY2U7XG5cbiAgICB0aGlzLnNldFdEQVBhdGhzKGFyZ3MuYm9vdHN0cmFwUGF0aCwgYXJncy5hZ2VudFBhdGgpO1xuXG4gICAgdGhpcy53ZGFMb2NhbFBvcnQgPSBhcmdzLndkYUxvY2FsUG9ydDtcblxuICAgIHRoaXMucHJlYnVpbGRXREEgPSBhcmdzLnByZWJ1aWxkV0RBO1xuXG4gICAgdGhpcy53ZWJEcml2ZXJBZ2VudFVybCA9IGFyZ3Mud2ViRHJpdmVyQWdlbnRVcmw7XG5cbiAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMud2RhQ29ubmVjdGlvblRpbWVvdXQgPSBhcmdzLndkYUNvbm5lY3Rpb25UaW1lb3V0O1xuXG4gICAgdGhpcy51c2VDYXJ0aGFnZVNzbCA9IF8uaXNCb29sZWFuKGFyZ3MudXNlQ2FydGhhZ2VTc2wpICYmIGFyZ3MudXNlQ2FydGhhZ2VTc2w7XG5cbiAgICB0aGlzLnVzZVhjdGVzdHJ1bkZpbGUgPSBhcmdzLnVzZVhjdGVzdHJ1bkZpbGU7XG5cbiAgICB0aGlzLnhjb2RlYnVpbGQgPSBuZXcgWGNvZGVCdWlsZCh0aGlzLnhjb2RlVmVyc2lvbiwgdGhpcy5kZXZpY2UsIHtcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBhZ2VudFBhdGg6IHRoaXMuYWdlbnRQYXRoLFxuICAgICAgYm9vdHN0cmFwUGF0aDogdGhpcy5ib290c3RyYXBQYXRoLFxuICAgICAgcmVhbERldmljZTogdGhpcy5yZWFsRGV2aWNlLFxuICAgICAgc2hvd1hjb2RlTG9nOiAhIWFyZ3Muc2hvd1hjb2RlTG9nLFxuICAgICAgeGNvZGVDb25maWdGaWxlOiBhcmdzLnhjb2RlQ29uZmlnRmlsZSxcbiAgICAgIHhjb2RlT3JnSWQ6IGFyZ3MueGNvZGVPcmdJZCxcbiAgICAgIHhjb2RlU2lnbmluZ0lkOiBhcmdzLnhjb2RlU2lnbmluZ0lkLFxuICAgICAga2V5Y2hhaW5QYXRoOiBhcmdzLmtleWNoYWluUGF0aCxcbiAgICAgIGtleWNoYWluUGFzc3dvcmQ6IGFyZ3Mua2V5Y2hhaW5QYXNzd29yZCxcbiAgICAgIHVzZVNpbXBsZUJ1aWxkVGVzdDogYXJncy51c2VTaW1wbGVCdWlsZFRlc3QsXG4gICAgICB1c2VQcmVidWlsdFdEQTogYXJncy51c2VQcmVidWlsdFdEQSxcbiAgICAgIHVwZGF0ZWRXREFCdW5kbGVJZDogYXJncy51cGRhdGVkV0RBQnVuZGxlSWQsXG4gICAgICBsYXVuY2hUaW1lb3V0OiBhcmdzLndkYUxhdW5jaFRpbWVvdXQgfHwgV0RBX0xBVU5DSF9USU1FT1VULFxuICAgICAgd2RhUmVtb3RlUG9ydDogdGhpcy5yZWFsRGV2aWNlID8gV0RBX0FHRU5UX1BPUlQgOiAodGhpcy53ZGFMb2NhbFBvcnQgfHwgV0RBX0FHRU5UX1BPUlQpLFxuICAgICAgdXNlWGN0ZXN0cnVuRmlsZTogdGhpcy51c2VYY3Rlc3RydW5GaWxlLFxuICAgICAgZGVyaXZlZERhdGFQYXRoOiBhcmdzLmRlcml2ZWREYXRhUGF0aCxcbiAgICAgIG1qcGVnU2VydmVyUG9ydDogYXJncy5tanBlZ1NlcnZlclBvcnQsXG4gICAgfSk7XG4gIH1cblxuICBzZXRXREFQYXRocyAoYm9vdHN0cmFwUGF0aCwgYWdlbnRQYXRoKSB7XG4gICAgLy8gYWxsb3cgdGhlIHVzZXIgdG8gc3BlY2lmeSBhIHBsYWNlIGZvciBXREEuIFRoaXMgaXMgdW5kb2N1bWVudGVkIGFuZFxuICAgIC8vIG9ubHkgaGVyZSBmb3IgdGhlIHB1cnBvc2VzIG9mIHRlc3RpbmcgZGV2ZWxvcG1lbnQgb2YgV0RBXG4gICAgdGhpcy5ib290c3RyYXBQYXRoID0gYm9vdHN0cmFwUGF0aCB8fCBCT09UU1RSQVBfUEFUSDtcbiAgICBsb2cuaW5mbyhgVXNpbmcgV0RBIHBhdGg6ICcke3RoaXMuYm9vdHN0cmFwUGF0aH0nYCk7XG5cbiAgICAvLyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3ZSBuZWVkIHRvIGJlIGFibGUgdG8gc3BlY2lmeSBhZ2VudFBhdGggdG9vXG4gICAgdGhpcy5hZ2VudFBhdGggPSBhZ2VudFBhdGggfHwgcGF0aC5yZXNvbHZlKHRoaXMuYm9vdHN0cmFwUGF0aCwgJ1dlYkRyaXZlckFnZW50Lnhjb2RlcHJvaicpO1xuICAgIGxvZy5pbmZvKGBVc2luZyBXREEgYWdlbnQ6ICcke3RoaXMuYWdlbnRQYXRofSdgKTtcbiAgfVxuXG4gIGFzeW5jIGNsZWFudXBPYnNvbGV0ZVByb2Nlc3NlcyAoKSB7XG4gICAgY29uc3QgcGlkcyA9IGF3YWl0IGdldFBJRHNMaXN0ZW5pbmdPblBvcnQodGhpcy51cmwucG9ydCxcbiAgICAgIChjbWRMaW5lKSA9PiAoY21kTGluZS5pbmNsdWRlcygnL1dlYkRyaXZlckFnZW50UnVubmVyJykgfHwgY21kTGluZS5pbmNsdWRlcygnL2lwcm94eScpKSAmJlxuICAgICAgICAhY21kTGluZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRoaXMuZGV2aWNlLnVkaWQudG9Mb3dlckNhc2UoKSkpO1xuICAgIGlmICghcGlkcy5sZW5ndGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gb2Jzb2xldGUgY2FjaGVkIHByb2Nlc3NlcyBmcm9tIHByZXZpb3VzIFdEQSBzZXNzaW9ucyBgICtcbiAgICAgICAgICAgICAgICBgbGlzdGVuaW5nIG9uIHBvcnQgJHt0aGlzLnVybC5wb3J0fSBoYXZlIGJlZW4gZm91bmRgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2cuaW5mbyhgRGV0ZWN0ZWQgJHtwaWRzLmxlbmd0aH0gb2Jzb2xldGUgY2FjaGVkIHByb2Nlc3Mke3BpZHMubGVuZ3RoID09PSAxID8gJycgOiAnZXMnfSBgICtcbiAgICAgICAgICAgICBgZnJvbSBwcmV2aW91cyBXREEgc2Vzc2lvbnMuIENsZWFuaW5nIHVwLi4uYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ2tpbGwnLCBwaWRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihgRmFpbGVkIHRvIGtpbGwgb2Jzb2xldGUgY2FjaGVkIHByb2Nlc3Mke3BpZHMubGVuZ3RoID09PSAxID8gJycgOiAnZXMnfSAnJHtwaWRzfScuIGAgK1xuICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGJvb2xlYW4gaWYgV0RBIGlzIHJ1bm5pbmcgb3Igbm90XG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgV0RBIGlzIHJ1bm5pbmdcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBpbnZhbGlkIHJlc3BvbnNlIGNvZGUgb3IgYm9keVxuICAgKi9cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICByZXR1cm4gISEoYXdhaXQgdGhpcy5nZXRTdGF0dXMoKSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGN1cnJlbnQgcnVubmluZyBXREEncyBzdGF0dXMgbGlrZSBiZWxvd1xuICAgKiB7XG4gICAqICAgXCJzdGF0ZVwiOiBcInN1Y2Nlc3NcIixcbiAgICogICBcIm9zXCI6IHtcbiAgICogICAgIFwibmFtZVwiOiBcImlPU1wiLFxuICAgKiAgICAgXCJ2ZXJzaW9uXCI6IFwiMTEuNFwiLFxuICAgKiAgICAgXCJzZGtWZXJzaW9uXCI6IFwiMTEuM1wiXG4gICAqICAgfSxcbiAgICogICBcImlvc1wiOiB7XG4gICAqICAgICBcInNpbXVsYXRvclZlcnNpb25cIjogXCIxMS40XCIsXG4gICAqICAgICBcImlwXCI6IFwiMTcyLjI1NC45OS4zNFwiXG4gICAqICAgfSxcbiAgICogICBcImJ1aWxkXCI6IHtcbiAgICogICAgIFwidGltZVwiOiBcIkp1biAyNCAyMDE4IDE3OjA4OjIxXCIsXG4gICAqICAgICBcInByb2R1Y3RCdW5kbGVJZGVudGlmaWVyXCI6IFwiY29tLmZhY2Vib29rLldlYkRyaXZlckFnZW50UnVubmVyXCJcbiAgICogICB9XG4gICAqIH1cbiAgICpcbiAgICogQHJldHVybiB7P29iamVjdH0gU3RhdGUgT2JqZWN0XG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgaW52YWxpZCByZXNwb25zZSBjb2RlIG9yIGJvZHlcbiAgICovXG4gIGFzeW5jIGdldFN0YXR1cyAoKSB7XG4gICAgY29uc3Qgbm9TZXNzaW9uUHJveHkgPSBuZXcgTm9TZXNzaW9uUHJveHkoe1xuICAgICAgc2VydmVyOiB0aGlzLnVybC5ob3N0bmFtZSxcbiAgICAgIHBvcnQ6IHRoaXMudXJsLnBvcnQsXG4gICAgICBiYXNlOiAnJyxcbiAgICAgIHRpbWVvdXQ6IDMwMDAsXG4gICAgfSk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBub1Nlc3Npb25Qcm94eS5jb21tYW5kKCcvc3RhdHVzJywgJ0dFVCcpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLmRlYnVnKGBXREEgaXMgbm90IGxpc3RlbmluZyBhdCAnJHt0aGlzLnVybC5ocmVmfSdgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVuaW5zdGFsbCAoKSB7XG4gICAgbG9nLmRlYnVnKGBSZW1vdmluZyBXREEgYXBwbGljYXRpb24gZnJvbSBkZXZpY2VgKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5kZXZpY2UucmVtb3ZlQXBwKFdEQV9CVU5ETEVfSUQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBXZWJEcml2ZXJBZ2VudCB1bmluc3RhbGwgZmFpbGVkLiBQZXJoYXBzLCBpdCBpcyBhbHJlYWR5IHVuaW5zdGFsbGVkPyBPcmlnaW5hbCBlcnJvcjogJHtKU09OLnN0cmluZ2lmeShlKX1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsYXVuY2ggKHNlc3Npb25JZCkge1xuICAgIGlmICh0aGlzLndlYkRyaXZlckFnZW50VXJsKSB7XG4gICAgICBsb2cuaW5mbyhgVXNpbmcgcHJvdmlkZWQgV2ViZHJpdmVyQWdlbnQgYXQgJyR7dGhpcy53ZWJEcml2ZXJBZ2VudFVybH0nYCk7XG4gICAgICB0aGlzLnVybCA9IHRoaXMud2ViRHJpdmVyQWdlbnRVcmw7XG4gICAgICB0aGlzLnNldHVwUHJveGllcyhzZXNzaW9uSWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZy5pbmZvKCdMYXVuY2hpbmcgV2ViRHJpdmVyQWdlbnQgb24gdGhlIGRldmljZScpO1xuXG4gICAgdGhpcy5zZXR1cFByb3hpZXMoc2Vzc2lvbklkKTtcblxuICAgIGlmICghdGhpcy51c2VYY3Rlc3RydW5GaWxlICYmICFhd2FpdCBmcy5leGlzdHModGhpcy5hZ2VudFBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRyeWluZyB0byB1c2UgV2ViRHJpdmVyQWdlbnQgcHJvamVjdCBhdCAnJHt0aGlzLmFnZW50UGF0aH0nIGJ1dCB0aGUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgJ2ZpbGUgZG9lcyBub3QgZXhpc3QnKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMudXNlWGN0ZXN0cnVuRmlsZSkge1xuICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIFdEQSBkZXBlbmRlbmNpZXMgaGF2ZSBiZWVuIGJ1aWx0XG4gICAgICBjb25zdCBkaWRQZXJmb3JtVXBncmFkZSA9IGF3YWl0IGNoZWNrRm9yRGVwZW5kZW5jaWVzKHRoaXMuYm9vdHN0cmFwUGF0aCwgdGhpcy51c2VDYXJ0aGFnZVNzbCk7XG4gICAgICBpZiAoZGlkUGVyZm9ybVVwZ3JhZGUpIHtcbiAgICAgICAgLy8gT25seSBwZXJmb3JtIHRoZSBjbGVhbnVwIGFmdGVyIFdEQSB1cGdyYWRlXG4gICAgICAgIGF3YWl0IHRoaXMueGNvZGVidWlsZC5jbGVhblByb2plY3QoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gV2UgbmVlZCB0byBwcm92aWRlIFdEQSBsb2NhbCBwb3J0LCBiZWNhdXNlIGl0IG1pZ2h0IGJlIG9jY3VwaWVkIHdpdGhcbiAgICAvLyBpcHJveHkgaW5zdGFuY2UgaW5pdGlhdGVkIGJ5IHNvbWUgcHJlY2VlZGluZyBydW4gd2l0aCBhIHJlYWwgZGV2aWNlXG4gICAgLy8gKGlwcm94eSBpbnN0YW5jZXMgYXJlIG5vdCBraWxsZWQgb24gc2Vzc2lvbiB0ZXJtaW5hdGlvbiBieSBkZWZhdWx0KVxuICAgIGF3YWl0IHJlc2V0WENUZXN0UHJvY2Vzc2VzKHRoaXMuZGV2aWNlLnVkaWQsICF0aGlzLnJlYWxEZXZpY2UsIHt3ZGFMb2NhbFBvcnQ6IHRoaXMudXJsLnBvcnR9KTtcblxuICAgIGlmICh0aGlzLnJlYWxEZXZpY2UpIHtcbiAgICAgIHRoaXMuaXByb3h5ID0gbmV3IGlQcm94eSh0aGlzLmRldmljZS51ZGlkLCB0aGlzLnVybC5wb3J0LCBXREFfQUdFTlRfUE9SVCk7XG4gICAgICBhd2FpdCB0aGlzLmlwcm94eS5zdGFydCgpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMueGNvZGVidWlsZC5pbml0KHRoaXMubm9TZXNzaW9uUHJveHkpO1xuXG4gICAgLy8gU3RhcnQgdGhlIHhjb2RlYnVpbGQgcHJvY2Vzc1xuICAgIGlmICh0aGlzLnByZWJ1aWxkV0RBKSB7XG4gICAgICBhd2FpdCB0aGlzLnhjb2RlYnVpbGQucHJlYnVpbGQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMueGNvZGVidWlsZC5zdGFydCgpO1xuICB9XG5cbiAgc2V0dXBQcm94aWVzIChzZXNzaW9uSWQpIHtcbiAgICBjb25zdCBwcm94eU9wdHMgPSB7XG4gICAgICBzZXJ2ZXI6IHRoaXMudXJsLmhvc3RuYW1lLFxuICAgICAgcG9ydDogdGhpcy51cmwucG9ydCxcbiAgICAgIGJhc2U6ICcnLFxuICAgICAgdGltZW91dDogdGhpcy53ZGFDb25uZWN0aW9uVGltZW91dCxcbiAgICB9O1xuXG4gICAgdGhpcy5qd3Byb3h5ID0gbmV3IEpXUHJveHkocHJveHlPcHRzKTtcbiAgICB0aGlzLmp3cHJveHkuc2Vzc2lvbklkID0gc2Vzc2lvbklkO1xuICAgIHRoaXMucHJveHlSZXFSZXMgPSB0aGlzLmp3cHJveHkucHJveHlSZXFSZXMuYmluZCh0aGlzLmp3cHJveHkpO1xuXG4gICAgdGhpcy5ub1Nlc3Npb25Qcm94eSA9IG5ldyBOb1Nlc3Npb25Qcm94eShwcm94eU9wdHMpO1xuICAgIHRoaXMubm9TZXNzaW9uUHJveHlSZXFSZXMgPSB0aGlzLm5vU2Vzc2lvblByb3h5LnByb3h5UmVxUmVzLmJpbmQodGhpcy5ub1Nlc3Npb25Qcm94eSk7XG4gIH1cblxuICBhc3luYyBxdWl0ICgpIHtcbiAgICBsb2cuaW5mbygnU2h1dHRpbmcgZG93biBzdWItcHJvY2Vzc2VzJyk7XG5cbiAgICBpZiAodGhpcy5pcHJveHkpIHtcbiAgICAgIGF3YWl0IHRoaXMuaXByb3h5LnF1aXQoKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnhjb2RlYnVpbGQucXVpdCgpO1xuICAgIGF3YWl0IHRoaXMueGNvZGVidWlsZC5yZXNldCgpO1xuXG4gICAgaWYgKHRoaXMuandwcm94eSkge1xuICAgICAgdGhpcy5qd3Byb3h5LnNlc3Npb25JZCA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5zdGFydGVkID0gZmFsc2U7XG5cbiAgICBpZiAoIXRoaXMuYXJncy53ZWJEcml2ZXJBZ2VudFVybCkge1xuICAgICAgLy8gaWYgd2UgcG9wdWxhdGVkIHRoZSB1cmwgb3Vyc2VsdmVzIChkdXJpbmcgYHNldHVwQ2FjaGluZ2AgY2FsbCwgZm9yIGluc3RhbmNlKVxuICAgICAgLy8gdGhlbiBjbGVhbiB0aGF0IHVwLiBJZiB0aGUgdXJsIHdhcyBzdXBwbGllZCwgd2Ugd2FudCB0byBrZWVwIGl0XG4gICAgICB0aGlzLndlYkRyaXZlckFnZW50VXJsID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBnZXQgdXJsICgpIHtcbiAgICBpZiAoIXRoaXMuX3VybCkge1xuICAgICAgbGV0IHBvcnQgPSB0aGlzLndkYUxvY2FsUG9ydCB8fCBXREFfQUdFTlRfUE9SVDtcbiAgICAgIHRoaXMuX3VybCA9IHVybC5wYXJzZShgJHtXREFfQkFTRV9VUkx9OiR7cG9ydH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3VybDtcbiAgfVxuXG4gIHNldCB1cmwgKF91cmwpIHtcbiAgICB0aGlzLl91cmwgPSB1cmwucGFyc2UoX3VybCk7XG4gIH1cblxuICBnZXQgZnVsbHlTdGFydGVkICgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGFydGVkO1xuICB9XG5cbiAgc2V0IGZ1bGx5U3RhcnRlZCAoc3RhcnRlZCA9IGZhbHNlKSB7XG4gICAgLy8gYmVmb3JlIFdEQSBpcyBzdGFydGVkIHdlIGV4cGVjdCBlcnJvcnMgZnJvbSBpcHJveHksIHNpbmNlIGl0IGlzIG5vdFxuICAgIC8vIGNvbW11bmljYXRpbmcgd2l0aCBhbnl0aGluZyB5ZXRcbiAgICB0aGlzLnN0YXJ0ZWQgPSBzdGFydGVkO1xuICAgIGlmICh0aGlzLmlwcm94eSkge1xuICAgICAgdGhpcy5pcHJveHkuZXhwZWN0SVByb3h5RXJyb3JzID0gIXN0YXJ0ZWQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmV0cmlldmVEZXJpdmVkRGF0YVBhdGggKCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnhjb2RlYnVpbGQucmV0cmlldmVEZXJpdmVkRGF0YVBhdGgoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXVzZSBydW5uaW5nIFdEQSBpZiBpdCBoYXMgdGhlIHNhbWUgYnVuZGxlIGlkIHdpdGggdXBkYXRlZFdEQUJ1bmRsZUlkLlxuICAgKiBPciByZXVzZSBpdCBpZiBpdCBoYXMgdGhlIGRlZmF1bHQgaWQgd2l0aG91dCB1cGRhdGVkV0RBQnVuZGxlSWQuXG4gICAqIFVuaW5zdGFsbCBpdCBpZiB0aGUgbWV0aG9kIGZhY2VzIGFuIGV4Y2VwdGlvbiBmb3IgdGhlIGFib3ZlIHNpdHVhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVwZGF0ZWRXREFCdW5kbGVJZCBCdW5kbGVJZCB5b3UnZCBsaWtlIHRvIHVzZVxuICAgKi9cbiAgYXN5bmMgc2V0dXBDYWNoaW5nICh1cGRhdGVkV0RBQnVuZGxlSWQpIHtcbiAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCB0aGlzLmdldFN0YXR1cygpO1xuICAgIGlmICghc3RhdHVzIHx8ICFzdGF0dXMuYnVpbGQpIHtcbiAgICAgIGxvZy5kZWJ1ZygnV0RBIGlzIGN1cnJlbnRseSBub3QgcnVubmluZy4gVGhlcmUgaXMgbm90aGluZyB0byBjYWNoZScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIHByb2R1Y3RCdW5kbGVJZGVudGlmaWVyLFxuICAgICAgdXBncmFkZWRBdCxcbiAgICB9ID0gc3RhdHVzLmJ1aWxkO1xuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHByb2R1Y3RCdW5kbGVJZGVudGlmaWVyKSAmJiB1dGlsLmhhc1ZhbHVlKHVwZGF0ZWRXREFCdW5kbGVJZCkgJiYgdXBkYXRlZFdEQUJ1bmRsZUlkICE9PSBwcm9kdWN0QnVuZGxlSWRlbnRpZmllcikge1xuICAgICAgbG9nLmluZm8oYFdpbGwgdW5pbnN0YWxsIHJ1bm5pbmcgV0RBIHNpbmNlIGl0IGhhcyBkaWZmZXJlbnQgYnVuZGxlIGlkLiBUaGUgYWN0dWFsIHZhbHVlIGlzICcke3Byb2R1Y3RCdW5kbGVJZGVudGlmaWVyfScuYCk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy51bmluc3RhbGwoKTtcbiAgICB9XG4gICAgaWYgKHV0aWwuaGFzVmFsdWUocHJvZHVjdEJ1bmRsZUlkZW50aWZpZXIpICYmICF1dGlsLmhhc1ZhbHVlKHVwZGF0ZWRXREFCdW5kbGVJZCkgJiYgV0RBX1JVTk5FUl9CVU5ETEVfSUQgIT09IHByb2R1Y3RCdW5kbGVJZGVudGlmaWVyKSB7XG4gICAgICBsb2cuaW5mbyhgV2lsbCB1bmluc3RhbGwgcnVubmluZyBXREEgc2luY2UgaXRzIGJ1bmRsZSBpZCBpcyBub3QgZXF1YWwgdG8gdGhlIGRlZmF1bHQgdmFsdWUgJHtXREFfUlVOTkVSX0JVTkRMRV9JRH1gKTtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVuaW5zdGFsbCgpO1xuICAgIH1cblxuICAgIGNvbnN0IGFjdHVhbFVwZ3JhZGVUaW1lc3RhbXAgPSBhd2FpdCBnZXRXREFVcGdyYWRlVGltZXN0YW1wKHRoaXMuYm9vdHN0cmFwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBVcGdyYWRlIHRpbWVzdGFtcCBvZiB0aGUgY3VycmVudGx5IGJ1bmRsZWQgV0RBOiAke2FjdHVhbFVwZ3JhZGVUaW1lc3RhbXB9YCk7XG4gICAgbG9nLmRlYnVnKGBVcGdyYWRlIHRpbWVzdGFtcCBvZiB0aGUgV0RBIG9uIHRoZSBkZXZpY2U6ICR7dXBncmFkZWRBdH1gKTtcbiAgICBpZiAoYWN0dWFsVXBncmFkZVRpbWVzdGFtcCAmJiB1cGdyYWRlZEF0ICYmIF8udG9Mb3dlcihgJHthY3R1YWxVcGdyYWRlVGltZXN0YW1wfWApICE9PSBfLnRvTG93ZXIoYCR7dXBncmFkZWRBdH1gKSkge1xuICAgICAgbG9nLmluZm8oJ1dpbGwgdW5pbnN0YWxsIHJ1bm5pbmcgV0RBIHNpbmNlIGl0IGhhcyBkaWZmZXJlbnQgdmVyc2lvbiBpbiBjb21wYXJpc29uIHRvIHRoZSBvbmUgJyArXG4gICAgICAgIGB3aGljaCBpcyBidW5kbGVkIHdpdGggYXBwaXVtLXhjdWl0ZXN0LWRyaXZlciBtb2R1bGUgKCR7YWN0dWFsVXBncmFkZVRpbWVzdGFtcH0gIT0gJHt1cGdyYWRlZEF0fSlgKTtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnVuaW5zdGFsbCgpO1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2UgPSB1dGlsLmhhc1ZhbHVlKHByb2R1Y3RCdW5kbGVJZGVudGlmaWVyKVxuICAgICAgPyBgV2lsbCByZXVzZSBwcmV2aW91c2x5IGNhY2hlZCBXREEgaW5zdGFuY2UgYXQgJyR7dGhpcy51cmwuaHJlZn0nIHdpdGggJyR7cHJvZHVjdEJ1bmRsZUlkZW50aWZpZXJ9J2BcbiAgICAgIDogYFdpbGwgcmV1c2UgcHJldmlvdXNseSBjYWNoZWQgV0RBIGluc3RhbmNlIGF0ICcke3RoaXMudXJsLmhyZWZ9J2A7XG4gICAgbG9nLmluZm8oYCR7bWVzc2FnZX0uIFNldCB0aGUgd2RhTG9jYWxQb3J0IGNhcGFiaWxpdHkgdG8gYSB2YWx1ZSBkaWZmZXJlbnQgZnJvbSAke3RoaXMudXJsLnBvcnR9IGlmIHRoaXMgaXMgYW4gdW5kZXNpcmVkIGJlaGF2aW9yLmApO1xuICAgIHRoaXMud2ViRHJpdmVyQWdlbnRVcmwgPSB0aGlzLnVybC5ocmVmO1xuICB9XG5cbiAgYXN5bmMgcXVpdEFuZFVuaW5zdGFsbCAoKSB7XG4gICAgYXdhaXQgdGhpcy5xdWl0KCk7XG4gICAgYXdhaXQgdGhpcy51bmluc3RhbGwoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBXZWJEcml2ZXJBZ2VudDtcbmV4cG9ydCB7IFdlYkRyaXZlckFnZW50LCBXREFfQlVORExFX0lELCBCT09UU1RSQVBfUEFUSCB9O1xuIl0sImZpbGUiOiJsaWIvd2RhL3dlYmRyaXZlcmFnZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
