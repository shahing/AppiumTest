"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.YouiEngineDriver = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _desiredCaps = _interopRequireDefault(require("./desired-caps"));

var _logger = _interopRequireDefault(require("./logger"));

var _index = _interopRequireDefault(require("./commands/index"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumAndroidDriver = _interopRequireDefault(require("appium-android-driver"));

var _appiumIosDriver = _interopRequireDefault(require("appium-ios-driver"));

var _appiumXcuitestDriver = _interopRequireDefault(require("appium-xcuitest-driver"));

var _appiumMacDriver = _interopRequireDefault(require("appium-mac-driver"));

const TO_PROXY_COMMON = ['background', 'closeApp', 'getLog', 'getLogTypes', 'getOrientation', 'getStrings', 'launchApp', 'lock', 'removeApp', 'setOrientation'];
const TO_PROXY_IOS_ONLY = ['mobileShake'];
const TO_PROXY_ANDROID_ONLY = ['getNetworkConnection', 'isAppInstalled', 'isLocked', 'longPressKeyCode', 'pressKeyCode', 'setNetworkConnection', 'toggleLocationServices', 'unlock'];
const TO_PROXY_IOS = TO_PROXY_IOS_ONLY.concat(TO_PROXY_COMMON);
const TO_PROXY_ANDROID = TO_PROXY_ANDROID_ONLY.concat(TO_PROXY_COMMON);
const TO_PROXY_MAC = TO_PROXY_COMMON;
const MAX_RETRY_COUNT = 10;
const RETRY_BACKOFF = 3000;

class YouiEngineDriver extends _appiumBaseDriver.BaseDriver {
  resetYouiEngine() {
    this.ready = false;
    this.socket = null;
    this.locatorStrategies = ['id', 'name', 'class name', 'accessibility id'];
    this.proxydriver = null;
    this.proxyAllowList = '';
  }

  constructor(opts, shouldValidateCaps) {
    super(opts, shouldValidateCaps);
    this.desiredCapConstraints = _desiredCaps.default;
    this.settings = new _appiumBaseDriver.DeviceSettings({
      'TimeDilation': 1,
      'SourceTreeFilter': ''
    }, this.onSettingsUpdate.bind(this));
    this.resetYouiEngine();
  }

  validateLocatorStrategy(strategy) {
    super.validateLocatorStrategy(strategy, false);
  }

  async createSession(caps) {
    try {
      let [sessionId] = await super.createSession(caps);

      if (caps.platformName !== null) {
        let appPlatform = caps.platformName.toLowerCase();

        if (appPlatform === "ios") {
          await this.startIOSSession(caps);
        } else if (appPlatform === "android") {
          await this.startAndroidSession(caps);
        } else if (appPlatform === "mac") {
          await this.startMacSession(caps);
        } else if (appPlatform === "yimac") {
          this.startYIMacSession(caps);
        } else if (appPlatform === "bluesky") {
          this.startBlueSkySession(caps);
        } else if (appPlatform === "yitvos") {
          this.startYITVOSSession(caps);
        }
      }

      await this.connectSocket();
      return [sessionId, this.opts];
    } catch (e) {
      await this.deleteSession();
      throw e;
    }
  }

  async onSettingsUpdate(key, value) {
    if (key === "TimeDilation") {
      await this.setTimeDilation(value);
    } else if (key === "SourceTreeFilter") {
      await this.setSourceTreeFilter(value);
    }
  }

  async stop() {
    this.ready = false;
  }

  async deleteSession() {
    _logger.default.debug("Deleting YouiEngine session");

    if (this.caps.platformName !== null) {
      let appPlatform = this.caps.platformName.toLowerCase();

      if (appPlatform === "yimac") {
        this.endYIMacSession(this.caps);
      } else if (appPlatform === "yitvos") {
        this.endYITVOSSession(this.caps);
      }
    }

    if (this.proxydriver !== null) {
      await this.proxydriver.deleteSession();
    }

    await super.deleteSession();
    await this.stop();
  }

  driverShouldDoProxyCmd(command) {
    if (!this.proxydriver) {
      return false;
    }

    for (let allowedCommand of this.proxyAllowList) {
      if (allowedCommand === command) {
        return true;
      }
    }

    return false;
  }

  async executeCommand(cmd, ...args) {
    if (cmd === 'receiveAsyncResponse') {
      _logger.default.debug(`Executing YouiEngineDriver response '${cmd}'`);

      return await this.receiveAsyncResponse(...args);
    } else if (this.ready) {
      if (this.driverShouldDoProxyCmd(cmd)) {
        _logger.default.debug(`Executing proxied WebDriver command '${cmd}'`);

        this.clearNewCommandTimeout();
        let result = this.proxydriver.executeCommand(cmd, ...args);
        this.startNewCommandTimeout(cmd);
        return result;
      } else {
        _logger.default.debug(`Executing YouiEngine WebDriver command '${cmd}'`);

        return super.executeCommand(cmd, ...args);
      }
    } else {
      _logger.default.debug(`Command Error '${cmd}'`);

      throw new _appiumBaseDriver.errors.NoSuchDriverError(`Driver is not ready, cannot execute ${cmd}.`);
    }
  }

  validateDesiredCaps(caps) {
    let res = super.validateDesiredCaps(caps);

    if (!res) {
      return res;
    }

    if (caps.platformName.toLowerCase() !== 'noproxy') {
      if (!caps.youiEngineAppAddress) {
        let msg = 'The desired capabilities must include youiEngineAppAddress';

        _logger.default.errorAndThrow(msg);
      }

      if (!caps.app) {
        let msg = 'The desired capabilities must include app';

        _logger.default.errorAndThrow(msg);
      }

      if (caps.deviceName.toLowerCase() === 'android') {
        if (!caps.avd) {
          let msg = 'The desired capabilities must include avd';

          _logger.default.errorAndThrow(msg);
        }
      }
    }

    return true;
  }

  async setupNewIOSDriver(caps) {
    let iosArgs = {
      javascriptEnabled: true
    };
    let iosdriver = new _appiumIosDriver.default(iosArgs);

    if (caps.platformVersion) {
      let majorVer = caps.platformVersion.toString().split(".")[0];

      if (parseInt(majorVer, 10) >= 10) {
        iosdriver = new _appiumXcuitestDriver.default(iosArgs);
      }
    }

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await iosdriver.createSession(capsCopy);
    return iosdriver;
  }

  async startIOSSession(caps) {
    _logger.default.info("Starting an IOS proxy session");

    this.proxyAllowList = TO_PROXY_IOS;
    this.proxydriver = await this.setupNewIOSDriver(caps);
  }

  async setupNewAndroidDriver(caps) {
    let androidArgs = {
      javascriptEnabled: true
    };
    let androiddriver = new _appiumAndroidDriver.default(androidArgs);

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await androiddriver.createSession(capsCopy);
    return androiddriver;
  }

  async startAndroidSession(caps) {
    _logger.default.info("Starting an Android proxy session");

    this.proxyAllowList = TO_PROXY_ANDROID;
    this.proxydriver = await this.setupNewAndroidDriver(caps);
  }

  async setupNewMacDriver(caps) {
    let macArgs = {
      javascriptEnabled: true
    };
    let macdriver = new _appiumMacDriver.default(macArgs);

    let capsCopy = _lodash.default.cloneDeep(caps);

    capsCopy.newCommandTimeout = 0;
    await macdriver.createSession(capsCopy);
    return macdriver;
  }

  async startMacSession(caps) {
    _logger.default.info("Starting a Mac proxy session");

    this.proxyAllowList = TO_PROXY_MAC;
    this.proxydriver = await this.setupNewMacDriver(caps);
  }

  startYIMacSession(caps) {
    _logger.default.info("Killing app if run");

    let shell = require('shelljs');

    let process_name = caps.app.substring(caps.app.lastIndexOf("/") + 1);
    shell.exec("killall " + process_name);

    _logger.default.info("Launching macOS app");

    this.validateAppLocation(caps.app);

    let spawn = require('child_process').spawn,
        ls = spawn(caps.app);

    ls.stdout.on('data', function (data) {
      if (data != null && caps.showXcodeLog === true) {
        _logger.default.debug('Xcode Log Output: ' + data.toString());
      }
    });
    ls.stderr.on('data', function (data) {
      if (data != null && caps.showXcodeLog === true) {
        _logger.default.debug('Xcode Log Error: ' + data.toString());
      }
    });
    ls.on('exit', function (code) {
      if (code != null && caps.showXcodeLog === true) {
        _logger.default.debug('Application exited with code ' + code.toString());
      }
    });
  }

  endYIMacSession(caps) {
    _logger.default.info("Deleting app");

    let shell = require('shelljs');

    let process_name = caps.app.substring(caps.app.lastIndexOf("/") + 1);
    shell.exec("killall " + process_name);
  }

  startBlueSkySession(caps) {
    _logger.default.info("Launching BlueSky app");

    this.validateAppLocation(caps.app);

    let shell = require('shelljs');

    let bluesky_install_script = "curl -v -# -f -i --user '" + caps.username + ":" + caps.password + "' --digest --progress-bar -F 'mysubmit=Install' -F 'archive=@" + caps.app + "' -F 'passwd=' http://" + caps.youiEngineAppAddress + "/plugin_install | grep '<font color' | sed 's/<font color=\'red\'>//' ";
    shell.exec(bluesky_install_script);
  }

  startYITVOSSession(caps) {
    _logger.default.info("Launching tvOS app");

    this.validateAppLocation(caps.app);

    let shell = require('shelljs');

    if (caps.udid) {
      shell.exec("ios-deploy --id " + caps.udid + " --uninstall --justlaunch --bundle " + caps.app);
    } else {
      shell.exec("ios-deploy --uninstall --justlaunch --bundle " + caps.app);
    }
  }

  endYITVOSSession(caps) {
    _logger.default.info("Deleting app");

    let shell = require('shelljs');

    let bundleid = shell.exec(`osascript -e 'id of app "${caps.app}"'`);

    if (caps.udid) {
      shell.exec("ios-deploy --id " + caps.udid + " --uninstall_only --bundle_id " + bundleid);
    } else {
      shell.exec("ios-deploy --uninstall_only --bundle_id " + bundleid);
    }
  }

  validateAppLocation(app) {
    const fs = require('fs');

    const path = require('path');

    if (!fs.existsSync(app)) {
      let absolutepath = path.resolve(app);
      let msg = 'The app could not be found in following location: ' + absolutepath;

      _logger.default.errorAndThrow(msg);
    }
  }

  async connectSocket() {
    let retryCount = 0;
    let connected = false;

    while (retryCount < MAX_RETRY_COUNT && !connected) {
      if (retryCount > 0) {
        _logger.default.info("Waiting " + RETRY_BACKOFF / 1000 + " seconds before trying...");

        await (0, _asyncbox.sleep)(RETRY_BACKOFF);
      }

      _logger.default.info("Attempt #" + (retryCount + 1));

      let connectedPromise = new _bluebird.default(resolve => {
        let net = require('net');

        let HOST = this.opts.youiEngineAppAddress;
        let PORT = 12345;

        _logger.default.info('Connecting to WebDriver: ' + HOST + ':' + PORT);

        this.socket = new net.Socket();
        this.socket.on('error', function (ex) {
          _logger.default.error(ex);

          _logger.default.error('Check that WebDriver is enabled in application, if a device ensure the proper IP address is used.');

          resolve(false);
        });
        this.socket.on('close', function () {
          _logger.default.info('Connection closed');
        });
        this.socket.on('timeout', function () {
          _logger.default.error('Connection timed out');

          resolve(false);
        });
        this.socket.connect(PORT, HOST, function () {
          _logger.default.info('Connected');

          resolve(true);
        });
      });
      retryCount++;
      connected = await connectedPromise;

      if (!connected && retryCount === MAX_RETRY_COUNT - 1) {
        _logger.default.errorAndThrow("Failed to connect " + MAX_RETRY_COUNT + " times. Aborting.");
      }
    }

    retryCount = 0;
    this.ready = connected;
  }

  async executeSocketCommand(cmd) {
    if (!this.socket.writable) {
      _logger.default.info("Socket is not writable. Trying to reconnect.");

      await this.connectSocket();
    }

    let cmdPromise = new _bluebird.default(resolve => {
      _logger.default.debug('COMMAND: ' + cmd);

      let totaldata = [];
      let endMarker = new Buffer("youiend");
      let socketClient = this.socket;

      let dataHandler = function (data) {
        if (data.length >= endMarker.length) {
          let dataend = new Buffer(endMarker.length);
          let startIndex = data.length - endMarker.length;
          data.copy(dataend, 0, startIndex, startIndex + endMarker.length);

          if (dataend.equals(endMarker)) {
            let lastData = data.slice(0, startIndex);
            totaldata.push(lastData);
            socketClient.removeListener('data', dataHandler);
            resolve(Buffer.concat(totaldata));
          } else {
            totaldata.push(data);
          }
        }
      };

      socketClient.write(cmd + "\n", "UTF8", () => {
        socketClient.on('data', dataHandler);
      });
    });
    return await cmdPromise;
  }

}

exports.YouiEngineDriver = YouiEngineDriver;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  YouiEngineDriver.prototype[cmd] = fn;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiVE9fUFJPWFlfQ09NTU9OIiwiVE9fUFJPWFlfSU9TX09OTFkiLCJUT19QUk9YWV9BTkRST0lEX09OTFkiLCJUT19QUk9YWV9JT1MiLCJjb25jYXQiLCJUT19QUk9YWV9BTkRST0lEIiwiVE9fUFJPWFlfTUFDIiwiTUFYX1JFVFJZX0NPVU5UIiwiUkVUUllfQkFDS09GRiIsIllvdWlFbmdpbmVEcml2ZXIiLCJCYXNlRHJpdmVyIiwicmVzZXRZb3VpRW5naW5lIiwicmVhZHkiLCJzb2NrZXQiLCJsb2NhdG9yU3RyYXRlZ2llcyIsInByb3h5ZHJpdmVyIiwicHJveHlBbGxvd0xpc3QiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJzaG91bGRWYWxpZGF0ZUNhcHMiLCJkZXNpcmVkQ2FwQ29uc3RyYWludHMiLCJzZXR0aW5ncyIsIkRldmljZVNldHRpbmdzIiwib25TZXR0aW5nc1VwZGF0ZSIsImJpbmQiLCJ2YWxpZGF0ZUxvY2F0b3JTdHJhdGVneSIsInN0cmF0ZWd5IiwiY3JlYXRlU2Vzc2lvbiIsImNhcHMiLCJzZXNzaW9uSWQiLCJwbGF0Zm9ybU5hbWUiLCJhcHBQbGF0Zm9ybSIsInRvTG93ZXJDYXNlIiwic3RhcnRJT1NTZXNzaW9uIiwic3RhcnRBbmRyb2lkU2Vzc2lvbiIsInN0YXJ0TWFjU2Vzc2lvbiIsInN0YXJ0WUlNYWNTZXNzaW9uIiwic3RhcnRCbHVlU2t5U2Vzc2lvbiIsInN0YXJ0WUlUVk9TU2Vzc2lvbiIsImNvbm5lY3RTb2NrZXQiLCJlIiwiZGVsZXRlU2Vzc2lvbiIsImtleSIsInZhbHVlIiwic2V0VGltZURpbGF0aW9uIiwic2V0U291cmNlVHJlZUZpbHRlciIsInN0b3AiLCJsb2dnZXIiLCJkZWJ1ZyIsImVuZFlJTWFjU2Vzc2lvbiIsImVuZFlJVFZPU1Nlc3Npb24iLCJkcml2ZXJTaG91bGREb1Byb3h5Q21kIiwiY29tbWFuZCIsImFsbG93ZWRDb21tYW5kIiwiZXhlY3V0ZUNvbW1hbmQiLCJjbWQiLCJhcmdzIiwicmVjZWl2ZUFzeW5jUmVzcG9uc2UiLCJjbGVhck5ld0NvbW1hbmRUaW1lb3V0IiwicmVzdWx0Iiwic3RhcnROZXdDb21tYW5kVGltZW91dCIsImVycm9ycyIsIk5vU3VjaERyaXZlckVycm9yIiwidmFsaWRhdGVEZXNpcmVkQ2FwcyIsInJlcyIsInlvdWlFbmdpbmVBcHBBZGRyZXNzIiwibXNnIiwiZXJyb3JBbmRUaHJvdyIsImFwcCIsImRldmljZU5hbWUiLCJhdmQiLCJzZXR1cE5ld0lPU0RyaXZlciIsImlvc0FyZ3MiLCJqYXZhc2NyaXB0RW5hYmxlZCIsImlvc2RyaXZlciIsIklPU0RyaXZlciIsInBsYXRmb3JtVmVyc2lvbiIsIm1ham9yVmVyIiwidG9TdHJpbmciLCJzcGxpdCIsInBhcnNlSW50IiwiWENVSVRlc3REcml2ZXIiLCJjYXBzQ29weSIsIl8iLCJjbG9uZURlZXAiLCJuZXdDb21tYW5kVGltZW91dCIsImluZm8iLCJzZXR1cE5ld0FuZHJvaWREcml2ZXIiLCJhbmRyb2lkQXJncyIsImFuZHJvaWRkcml2ZXIiLCJBbmRyb2lkRHJpdmVyIiwic2V0dXBOZXdNYWNEcml2ZXIiLCJtYWNBcmdzIiwibWFjZHJpdmVyIiwiTWFjRHJpdmVyIiwic2hlbGwiLCJyZXF1aXJlIiwicHJvY2Vzc19uYW1lIiwic3Vic3RyaW5nIiwibGFzdEluZGV4T2YiLCJleGVjIiwidmFsaWRhdGVBcHBMb2NhdGlvbiIsInNwYXduIiwibHMiLCJzdGRvdXQiLCJvbiIsImRhdGEiLCJzaG93WGNvZGVMb2ciLCJzdGRlcnIiLCJjb2RlIiwiYmx1ZXNreV9pbnN0YWxsX3NjcmlwdCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ1ZGlkIiwiYnVuZGxlaWQiLCJmcyIsInBhdGgiLCJleGlzdHNTeW5jIiwiYWJzb2x1dGVwYXRoIiwicmVzb2x2ZSIsInJldHJ5Q291bnQiLCJjb25uZWN0ZWQiLCJjb25uZWN0ZWRQcm9taXNlIiwiQiIsIm5ldCIsIkhPU1QiLCJQT1JUIiwiU29ja2V0IiwiZXgiLCJlcnJvciIsImNvbm5lY3QiLCJleGVjdXRlU29ja2V0Q29tbWFuZCIsIndyaXRhYmxlIiwiY21kUHJvbWlzZSIsInRvdGFsZGF0YSIsImVuZE1hcmtlciIsIkJ1ZmZlciIsInNvY2tldENsaWVudCIsImRhdGFIYW5kbGVyIiwibGVuZ3RoIiwiZGF0YWVuZCIsInN0YXJ0SW5kZXgiLCJjb3B5IiwiZXF1YWxzIiwibGFzdERhdGEiLCJzbGljZSIsInB1c2giLCJyZW1vdmVMaXN0ZW5lciIsIndyaXRlIiwiZm4iLCJ0b1BhaXJzIiwiY29tbWFuZHMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBT0EsTUFBTUEsZUFBZSxHQUFHLENBQ3RCLFlBRHNCLEVBRXRCLFVBRnNCLEVBR3RCLFFBSHNCLEVBSXRCLGFBSnNCLEVBS3RCLGdCQUxzQixFQU10QixZQU5zQixFQU90QixXQVBzQixFQVF0QixNQVJzQixFQVN0QixXQVRzQixFQVV0QixnQkFWc0IsQ0FBeEI7QUFhQSxNQUFNQyxpQkFBaUIsR0FBRyxDQUN4QixhQUR3QixDQUExQjtBQUlBLE1BQU1DLHFCQUFxQixHQUFHLENBQzVCLHNCQUQ0QixFQUU1QixnQkFGNEIsRUFHNUIsVUFINEIsRUFJNUIsa0JBSjRCLEVBSzVCLGNBTDRCLEVBTTVCLHNCQU40QixFQU81Qix3QkFQNEIsRUFRNUIsUUFSNEIsQ0FBOUI7QUFXQSxNQUFNQyxZQUFZLEdBQUdGLGlCQUFpQixDQUFDRyxNQUFsQixDQUF5QkosZUFBekIsQ0FBckI7QUFDQSxNQUFNSyxnQkFBZ0IsR0FBR0gscUJBQXFCLENBQUNFLE1BQXRCLENBQTZCSixlQUE3QixDQUF6QjtBQUNBLE1BQU1NLFlBQVksR0FBR04sZUFBckI7QUFFQSxNQUFNTyxlQUFlLEdBQUcsRUFBeEI7QUFDQSxNQUFNQyxhQUFhLEdBQUcsSUFBdEI7O0FBRUEsTUFBTUMsZ0JBQU4sU0FBK0JD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RUFBd0JpQyxXQUF4QjtBQUNELE9BRkQ7QUFHRCxLQXJDZ0IsQ0FBakI7QUFzQ0EsV0FBTyxNQUFNTCxVQUFiO0FBQ0Q7O0FBMVp1Qzs7OztBQTZaMUMsS0FBSyxJQUFJLENBQUM5RSxHQUFELEVBQU04RixFQUFOLENBQVQsSUFBc0JsRSxnQkFBRW1FLE9BQUYsQ0FBVUMsY0FBVixDQUF0QixFQUEyQztBQUN6QzlJLEVBQUFBLGdCQUFnQixDQUFDK0ksU0FBakIsQ0FBMkJqRyxHQUEzQixJQUFrQzhGLEVBQWxDO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlRHJpdmVyLCBEZXZpY2VTZXR0aW5ncywgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgZnJvbSAnLi9kZXNpcmVkLWNhcHMnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgY29tbWFuZHMgZnJvbSAnLi9jb21tYW5kcy9pbmRleCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgc2xlZXAgfSBmcm9tICdhc3luY2JveCc7XG5cbi8vIGZvciBwcm94aWVzXG5pbXBvcnQgQW5kcm9pZERyaXZlciBmcm9tICdhcHBpdW0tYW5kcm9pZC1kcml2ZXInO1xuaW1wb3J0IElPU0RyaXZlciBmcm9tICdhcHBpdW0taW9zLWRyaXZlcic7XG5pbXBvcnQgWENVSVRlc3REcml2ZXIgZnJvbSAnYXBwaXVtLXhjdWl0ZXN0LWRyaXZlcic7XG5pbXBvcnQgTWFjRHJpdmVyIGZyb20gJ2FwcGl1bS1tYWMtZHJpdmVyJztcblxuXG5cbi8vIEFkZCBjb21tYW5kcyBmcm9tIHRoZSBmb2xsb3dpbmcgbG9jYXRpb24gdGhhdCBzaG91bGQgYmUgbWFwcGVkIHRvIGV4aXN0aW5nIGRyaXZlcnM6XG4vLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS1iYXNlLWRyaXZlci9ibG9iL21hc3Rlci9saWIvbWpzb253cC9yb3V0ZXMuanNcblxuY29uc3QgVE9fUFJPWFlfQ09NTU9OID0gW1xuICAnYmFja2dyb3VuZCcsXG4gICdjbG9zZUFwcCcsXG4gICdnZXRMb2cnLFxuICAnZ2V0TG9nVHlwZXMnLFxuICAnZ2V0T3JpZW50YXRpb24nLFxuICAnZ2V0U3RyaW5ncycsXG4gICdsYXVuY2hBcHAnLFxuICAnbG9jaycsXG4gICdyZW1vdmVBcHAnLFxuICAnc2V0T3JpZW50YXRpb24nLFxuXTtcblxuY29uc3QgVE9fUFJPWFlfSU9TX09OTFkgPSBbXG4gICdtb2JpbGVTaGFrZScsXG5dO1xuXG5jb25zdCBUT19QUk9YWV9BTkRST0lEX09OTFkgPSBbXG4gICdnZXROZXR3b3JrQ29ubmVjdGlvbicsXG4gICdpc0FwcEluc3RhbGxlZCcsXG4gICdpc0xvY2tlZCcsXG4gICdsb25nUHJlc3NLZXlDb2RlJyxcbiAgJ3ByZXNzS2V5Q29kZScsXG4gICdzZXROZXR3b3JrQ29ubmVjdGlvbicsXG4gICd0b2dnbGVMb2NhdGlvblNlcnZpY2VzJyxcbiAgJ3VubG9jaycsXG5dO1xuXG5jb25zdCBUT19QUk9YWV9JT1MgPSBUT19QUk9YWV9JT1NfT05MWS5jb25jYXQoVE9fUFJPWFlfQ09NTU9OKTtcbmNvbnN0IFRPX1BST1hZX0FORFJPSUQgPSBUT19QUk9YWV9BTkRST0lEX09OTFkuY29uY2F0KFRPX1BST1hZX0NPTU1PTik7XG5jb25zdCBUT19QUk9YWV9NQUMgPSBUT19QUk9YWV9DT01NT047XG5cbmNvbnN0IE1BWF9SRVRSWV9DT1VOVCA9IDEwO1xuY29uc3QgUkVUUllfQkFDS09GRiA9IDMwMDA7XG5cbmNsYXNzIFlvdWlFbmdpbmVEcml2ZXIgZXh0ZW5kcyBCYXNlRHJpdmVyIHtcbiAgcmVzZXRZb3VpRW5naW5lICgpIHtcblxuICAgIHRoaXMucmVhZHkgPSBmYWxzZTtcbiAgICB0aGlzLnNvY2tldCA9IG51bGw7XG4gICAgdGhpcy5sb2NhdG9yU3RyYXRlZ2llcyA9IFsnaWQnLCAnbmFtZScsICdjbGFzcyBuYW1lJywgJ2FjY2Vzc2liaWxpdHkgaWQnXTtcbiAgICB0aGlzLnByb3h5ZHJpdmVyID0gbnVsbDtcbiAgICB0aGlzLnByb3h5QWxsb3dMaXN0ID0gJyc7XG4gIH1cblxuICBjb25zdHJ1Y3RvciAob3B0cywgc2hvdWxkVmFsaWRhdGVDYXBzKSB7XG4gICAgc3VwZXIob3B0cywgc2hvdWxkVmFsaWRhdGVDYXBzKTtcblxuICAgIHRoaXMuZGVzaXJlZENhcENvbnN0cmFpbnRzID0gZGVzaXJlZENhcENvbnN0cmFpbnRzO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3MoeydUaW1lRGlsYXRpb24nOiAxLCAnU291cmNlVHJlZUZpbHRlcic6ICcnfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblNldHRpbmdzVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIHRoaXMucmVzZXRZb3VpRW5naW5lKCk7XG5cbiAgfVxuXG4gIHZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5IChzdHJhdGVneSkge1xuICAgIHN1cGVyLnZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5KHN0cmF0ZWd5LCBmYWxzZSk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTZXNzaW9uIChjYXBzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBbc2Vzc2lvbklkXSA9IGF3YWl0IHN1cGVyLmNyZWF0ZVNlc3Npb24oY2Fwcyk7XG5cbiAgICAgIC8vIHNldHVwIHByb3hpZXMgLSBpZiBwbGF0Zm9ybU5hbWUgaXMgbm90IGVtcHR5LCBtYWtlIGl0IGxlc3MgY2FzZSBzZW5zaXRpdmVcbiAgICAgIGlmIChjYXBzLnBsYXRmb3JtTmFtZSAhPT0gbnVsbCkge1xuICAgICAgICBsZXQgYXBwUGxhdGZvcm0gPSBjYXBzLnBsYXRmb3JtTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoYXBwUGxhdGZvcm0gPT09IFwiaW9zXCIpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0SU9TU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcHBQbGF0Zm9ybSA9PT0gXCJhbmRyb2lkXCIpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0QW5kcm9pZFNlc3Npb24oY2Fwcyk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXBwUGxhdGZvcm0gPT09IFwibWFjXCIpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0TWFjU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcHBQbGF0Zm9ybSA9PT0gXCJ5aW1hY1wiKSB7XG4gICAgICAgICAgdGhpcy5zdGFydFlJTWFjU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcHBQbGF0Zm9ybSA9PT0gXCJibHVlc2t5XCIpIHtcbiAgICAgICAgICB0aGlzLnN0YXJ0Qmx1ZVNreVNlc3Npb24oY2Fwcyk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXBwUGxhdGZvcm0gPT09IFwieWl0dm9zXCIpIHtcbiAgICAgICAgICB0aGlzLnN0YXJ0WUlUVk9TU2Vzc2lvbihjYXBzKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBhd2FpdCB0aGlzLmNvbm5lY3RTb2NrZXQoKTtcbiAgICAgIHJldHVybiBbc2Vzc2lvbklkLCB0aGlzLm9wdHNdO1xuXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgYXdhaXQgdGhpcy5kZWxldGVTZXNzaW9uKCk7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG9uU2V0dGluZ3NVcGRhdGUgKGtleSwgdmFsdWUpIHtcbiAgICBpZiAoa2V5ID09PSBcIlRpbWVEaWxhdGlvblwiKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldFRpbWVEaWxhdGlvbih2YWx1ZSk7XG4gICAgfSBlbHNlIGlmIChrZXkgPT09IFwiU291cmNlVHJlZUZpbHRlclwiKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldFNvdXJjZVRyZWVGaWx0ZXIodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0b3AgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uICgpIHtcbiAgICBsb2dnZXIuZGVidWcoXCJEZWxldGluZyBZb3VpRW5naW5lIHNlc3Npb25cIik7XG5cbiAgICBpZiAodGhpcy5jYXBzLnBsYXRmb3JtTmFtZSAhPT0gbnVsbCkge1xuICAgICAgbGV0IGFwcFBsYXRmb3JtID0gdGhpcy5jYXBzLnBsYXRmb3JtTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGFwcFBsYXRmb3JtID09PSBcInlpbWFjXCIpIHtcbiAgICAgICAgdGhpcy5lbmRZSU1hY1Nlc3Npb24odGhpcy5jYXBzKTtcbiAgICAgIH0gZWxzZSBpZiAoYXBwUGxhdGZvcm0gPT09IFwieWl0dm9zXCIpIHtcbiAgICAgICAgdGhpcy5lbmRZSVRWT1NTZXNzaW9uKHRoaXMuY2Fwcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJveHlkcml2ZXIgIT09IG51bGwpIHtcbiAgICAgIGF3YWl0IHRoaXMucHJveHlkcml2ZXIuZGVsZXRlU2Vzc2lvbigpO1xuICAgIH1cbiAgICBhd2FpdCBzdXBlci5kZWxldGVTZXNzaW9uKCk7XG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG4gIH1cblxuICBkcml2ZXJTaG91bGREb1Byb3h5Q21kIChjb21tYW5kKSB7XG4gICAgaWYgKCF0aGlzLnByb3h5ZHJpdmVyKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gb25seSBhbGxvdyB3aGl0ZSBsaXN0ZWQgY29tbWFuZHNcbiAgICBmb3IgKGxldCBhbGxvd2VkQ29tbWFuZCBvZiB0aGlzLnByb3h5QWxsb3dMaXN0KSB7XG4gICAgICBpZiAoYWxsb3dlZENvbW1hbmQgPT09IGNvbW1hbmQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjbWQsIC4uLmFyZ3MpIHtcbiAgICBpZiAoY21kID09PSAncmVjZWl2ZUFzeW5jUmVzcG9uc2UnKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEV4ZWN1dGluZyBZb3VpRW5naW5lRHJpdmVyIHJlc3BvbnNlICcke2NtZH0nYCk7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWNlaXZlQXN5bmNSZXNwb25zZSguLi5hcmdzKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucmVhZHkpIHtcblxuICAgICAgaWYgKHRoaXMuZHJpdmVyU2hvdWxkRG9Qcm94eUNtZChjbWQpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgRXhlY3V0aW5nIHByb3hpZWQgV2ViRHJpdmVyIGNvbW1hbmQgJyR7Y21kfSdgKTtcblxuICAgICAgICAvLyBUaGVyZSBhcmUgMiBDb21tYW5kVGltZW91dCAoWW91aUVuZ2luZURyaXZlciBhbmQgcHJveHkpXG4gICAgICAgIC8vIE9ubHkgWW91aUVuZ2luZURyaXZlciBDb21tYW5kVGltZW91dCBpcyB1c2VkOyBQcm94eSBpcyBkaXNhYmxlZFxuICAgICAgICAvLyBBbGwgcHJveHkgY29tbWFuZHMgbmVlZHMgdG8gcmVzZXQgdGhlIFlvdWlFbmdpbmVEcml2ZXIgQ29tbWFuZFRpbWVvdXRcbiAgICAgICAgLy8gSGVyZSB3ZSBtYW51YWxseSByZXNldCB0aGUgWW91aUVuZ2luZURyaXZlciBDb21tYW5kVGltZW91dCBmb3IgY29tbWFuZHMgdGhhdCBnb2UgdG8gcHJveHkuXG4gICAgICAgIHRoaXMuY2xlYXJOZXdDb21tYW5kVGltZW91dCgpO1xuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5wcm94eWRyaXZlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgICAgICB0aGlzLnN0YXJ0TmV3Q29tbWFuZFRpbWVvdXQoY21kKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgRXhlY3V0aW5nIFlvdWlFbmdpbmUgV2ViRHJpdmVyIGNvbW1hbmQgJyR7Y21kfSdgKTtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVDb21tYW5kKGNtZCwgLi4uYXJncyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgQ29tbWFuZCBFcnJvciAnJHtjbWR9J2ApO1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hEcml2ZXJFcnJvcihgRHJpdmVyIGlzIG5vdCByZWFkeSwgY2Fubm90IGV4ZWN1dGUgJHtjbWR9LmApO1xuICAgIH1cbiAgfVxuXG4gIHZhbGlkYXRlRGVzaXJlZENhcHMgKGNhcHMpIHtcbiAgICAvLyBjaGVjayB3aXRoIHRoZSBiYXNlIGNsYXNzLCBhbmQgcmV0dXJuIGlmIGl0IGZhaWxzXG4gICAgbGV0IHJlcyA9IHN1cGVyLnZhbGlkYXRlRGVzaXJlZENhcHMoY2Fwcyk7XG4gICAgaWYgKCFyZXMpIHtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgLy8gdXNpbmcgYSBwcm94eVxuICAgIGlmIChjYXBzLnBsYXRmb3JtTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbm9wcm94eScpIHtcbiAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGFzIHlvdWlFbmdpbmVBcHBBZGRyZXNzXG4gICAgICBpZiAoIWNhcHMueW91aUVuZ2luZUFwcEFkZHJlc3MpIHtcbiAgICAgICAgbGV0IG1zZyA9ICdUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgbXVzdCBpbmNsdWRlIHlvdWlFbmdpbmVBcHBBZGRyZXNzJztcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICAgIH1cbiAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGFzIGFwcFxuICAgICAgaWYgKCFjYXBzLmFwcCkge1xuICAgICAgICBsZXQgbXNnID0gJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgYXBwJztcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICAgIH1cblxuICAgICAgLy9BbmRyb2lkIGVtdWxhdG9yIHdpdGggcHJveHlcbiAgICAgIGlmIChjYXBzLmRldmljZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgIGlmICghY2Fwcy5hdmQpIHtcbiAgICAgICAgICBsZXQgbXNnID0gJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgYXZkJztcbiAgICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZmluYWxseSwgcmV0dXJuIHRydWUgc2luY2UgdGhlIHN1cGVyY2xhc3MgY2hlY2sgcGFzc2VkLCBhcyBkaWQgdGhpc1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXN5bmMgc2V0dXBOZXdJT1NEcml2ZXIgKGNhcHMpIHtcbiAgICBsZXQgaW9zQXJncyA9IHtcbiAgICAgIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICAgIH07XG5cbiAgICBsZXQgaW9zZHJpdmVyID0gbmV3IElPU0RyaXZlcihpb3NBcmdzKTtcbiAgICAvLyBJZiBpT1MgdmVyc2lvbiBpcyAxMCBvciBhYm92ZSB3ZSBuZWVkIHRvIHVzZSBYQ1VJVGVzdERyaXZlciAoYW5kIFhjb2RlIDgrKVxuICAgIGlmIChjYXBzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgbGV0IG1ham9yVmVyID0gY2Fwcy5wbGF0Zm9ybVZlcnNpb24udG9TdHJpbmcoKS5zcGxpdChcIi5cIilbMF07XG4gICAgICBpZiAocGFyc2VJbnQobWFqb3JWZXIsIDEwKSA+PSAxMCkge1xuICAgICAgICBpb3Nkcml2ZXIgPSBuZXcgWENVSVRlc3REcml2ZXIoaW9zQXJncyk7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBjYXBzQ29weSA9IF8uY2xvbmVEZWVwKGNhcHMpO1xuICAgIC8vIERpc2FibGluZyB0aGUgcHJveHkgQ29tbWFuZFRpbWVvdXQgaW4gdGhlIGlPUyBkcml2ZXIgc2luY2Ugd2UgYXJlIG5vdyBoYW5kbGluZyBpdCBpbiB0aGUgWW91aUVuZ2luZSBEcml2ZXJcbiAgICBjYXBzQ29weS5uZXdDb21tYW5kVGltZW91dCA9IDA7XG4gICAgYXdhaXQgaW9zZHJpdmVyLmNyZWF0ZVNlc3Npb24oY2Fwc0NvcHkpO1xuXG4gICAgcmV0dXJuIGlvc2RyaXZlcjtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0SU9TU2Vzc2lvbiAoY2Fwcykge1xuICAgIGxvZ2dlci5pbmZvKFwiU3RhcnRpbmcgYW4gSU9TIHByb3h5IHNlc3Npb25cIik7XG4gICAgdGhpcy5wcm94eUFsbG93TGlzdCA9IFRPX1BST1hZX0lPUztcblxuICAgIHRoaXMucHJveHlkcml2ZXIgPSBhd2FpdCB0aGlzLnNldHVwTmV3SU9TRHJpdmVyKGNhcHMpO1xuICB9XG5cbiAgYXN5bmMgc2V0dXBOZXdBbmRyb2lkRHJpdmVyIChjYXBzKSB7XG4gICAgbGV0IGFuZHJvaWRBcmdzID0ge1xuICAgICAgamF2YXNjcmlwdEVuYWJsZWQ6IHRydWVcbiAgICB9O1xuICAgIGxldCBhbmRyb2lkZHJpdmVyID0gbmV3IEFuZHJvaWREcml2ZXIoYW5kcm9pZEFyZ3MpO1xuICAgIGxldCBjYXBzQ29weSA9IF8uY2xvbmVEZWVwKGNhcHMpO1xuICAgIC8vIERpc2FibGluZyB0aGUgcHJveHkgQ29tbWFuZFRpbWVvdXQgaW4gdGhlIEFuZHJvaWQgZHJpdmVyIHNpbmNlIHdlIGFyZSBub3cgaGFuZGxpbmcgaXQgaW4gdGhlIFlvdWlFbmdpbmUgRHJpdmVyXG4gICAgY2Fwc0NvcHkubmV3Q29tbWFuZFRpbWVvdXQgPSAwO1xuXG4gICAgYXdhaXQgYW5kcm9pZGRyaXZlci5jcmVhdGVTZXNzaW9uKGNhcHNDb3B5KTtcblxuICAgIHJldHVybiBhbmRyb2lkZHJpdmVyO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRBbmRyb2lkU2Vzc2lvbiAoY2Fwcykge1xuICAgIGxvZ2dlci5pbmZvKFwiU3RhcnRpbmcgYW4gQW5kcm9pZCBwcm94eSBzZXNzaW9uXCIpO1xuICAgIHRoaXMucHJveHlBbGxvd0xpc3QgPSBUT19QUk9YWV9BTkRST0lEO1xuXG4gICAgdGhpcy5wcm94eWRyaXZlciA9IGF3YWl0IHRoaXMuc2V0dXBOZXdBbmRyb2lkRHJpdmVyKGNhcHMpO1xuICB9XG5cbiAgYXN5bmMgc2V0dXBOZXdNYWNEcml2ZXIgKGNhcHMpIHtcbiAgICBsZXQgbWFjQXJncyA9IHtcbiAgICAgIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlXG4gICAgfTtcbiAgICBsZXQgbWFjZHJpdmVyID0gbmV3IE1hY0RyaXZlcihtYWNBcmdzKTtcbiAgICBsZXQgY2Fwc0NvcHkgPSBfLmNsb25lRGVlcChjYXBzKTtcbiAgICAvLyBEaXNhYmxpbmcgdGhlIHByb3h5IENvbW1hbmRUaW1lb3V0IGluIHRoZSBwcm94aWVkIGRyaXZlciBzaW5jZSB3ZSBhcmUgbm93IGhhbmRsaW5nIGl0IGluIHRoZSBZb3VpRW5naW5lIERyaXZlclxuICAgIGNhcHNDb3B5Lm5ld0NvbW1hbmRUaW1lb3V0ID0gMDtcblxuICAgIGF3YWl0IG1hY2RyaXZlci5jcmVhdGVTZXNzaW9uKGNhcHNDb3B5KTtcblxuICAgIHJldHVybiBtYWNkcml2ZXI7XG4gIH1cblxuICBhc3luYyBzdGFydE1hY1Nlc3Npb24gKGNhcHMpIHtcbiAgICBsb2dnZXIuaW5mbyhcIlN0YXJ0aW5nIGEgTWFjIHByb3h5IHNlc3Npb25cIik7XG4gICAgdGhpcy5wcm94eUFsbG93TGlzdCA9IFRPX1BST1hZX01BQztcblxuICAgIHRoaXMucHJveHlkcml2ZXIgPSBhd2FpdCB0aGlzLnNldHVwTmV3TWFjRHJpdmVyKGNhcHMpO1xuICB9XG5cbiAgc3RhcnRZSU1hY1Nlc3Npb24gKGNhcHMpIHtcbiAgICBsb2dnZXIuaW5mbyhcIktpbGxpbmcgYXBwIGlmIHJ1blwiKTtcbiAgICBsZXQgc2hlbGwgPSByZXF1aXJlKCdzaGVsbGpzJyk7XG4gICAgbGV0IHByb2Nlc3NfbmFtZSA9IGNhcHMuYXBwLnN1YnN0cmluZyhjYXBzLmFwcC5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgICBzaGVsbC5leGVjKFwia2lsbGFsbCBcIiArIHByb2Nlc3NfbmFtZSk7XG5cbiAgICBsb2dnZXIuaW5mbyhcIkxhdW5jaGluZyBtYWNPUyBhcHBcIik7XG4gICAgdGhpcy52YWxpZGF0ZUFwcExvY2F0aW9uKGNhcHMuYXBwKTtcbiAgICBsZXQgc3Bhd24gPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJykuc3Bhd24sXG4gICAgICAgIGxzID0gc3Bhd24oY2Fwcy5hcHApO1xuXG4gICAgLy9QcmludCBYY29kZSBsb2dzIChTVERPVVQpXG4gICAgbHMuc3Rkb3V0Lm9uKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIGlmIChkYXRhICE9IG51bGwgJiYgY2Fwcy5zaG93WGNvZGVMb2cgPT09IHRydWUpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdYY29kZSBMb2cgT3V0cHV0OiAnICsgZGF0YS50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vUHJpbnQgWGNvZGUgbG9ncyAoU1RERVJSKVxuICAgIGxzLnN0ZGVyci5vbignZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGNhcHMuc2hvd1hjb2RlTG9nID09PSB0cnVlKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnWGNvZGUgTG9nIEVycm9yOiAnICsgZGF0YS50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxzLm9uKCdleGl0JywgZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgIGlmIChjb2RlICE9IG51bGwgJiYgY2Fwcy5zaG93WGNvZGVMb2cgPT09IHRydWUpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdBcHBsaWNhdGlvbiBleGl0ZWQgd2l0aCBjb2RlICcgKyBjb2RlLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZW5kWUlNYWNTZXNzaW9uIChjYXBzKSB7XG4gICAgbG9nZ2VyLmluZm8oXCJEZWxldGluZyBhcHBcIik7XG4gICAgbGV0IHNoZWxsID0gcmVxdWlyZSgnc2hlbGxqcycpO1xuICAgIGxldCBwcm9jZXNzX25hbWUgPSBjYXBzLmFwcC5zdWJzdHJpbmcoY2Fwcy5hcHAubGFzdEluZGV4T2YoXCIvXCIpICsgMSk7XG4gICAgc2hlbGwuZXhlYyhcImtpbGxhbGwgXCIgKyBwcm9jZXNzX25hbWUpO1xuICB9XG5cbiAgc3RhcnRCbHVlU2t5U2Vzc2lvbiAoY2Fwcykge1xuICAgIGxvZ2dlci5pbmZvKFwiTGF1bmNoaW5nIEJsdWVTa3kgYXBwXCIpO1xuICAgIHRoaXMudmFsaWRhdGVBcHBMb2NhdGlvbihjYXBzLmFwcCk7XG4gICAgbGV0IHNoZWxsID0gcmVxdWlyZSgnc2hlbGxqcycpO1xuICAgIGxldCBibHVlc2t5X2luc3RhbGxfc2NyaXB0ID0gXCJjdXJsIC12IC0jIC1mIC1pIC0tdXNlciAnXCIgKyBjYXBzLnVzZXJuYW1lICsgXCI6XCIgKyBjYXBzLnBhc3N3b3JkICsgXCInIC0tZGlnZXN0IC0tcHJvZ3Jlc3MtYmFyIC1GICdteXN1Ym1pdD1JbnN0YWxsJyAtRiAnYXJjaGl2ZT1AXCIgKyBjYXBzLmFwcCArIFwiJyAtRiAncGFzc3dkPScgaHR0cDovL1wiICsgY2Fwcy55b3VpRW5naW5lQXBwQWRkcmVzcyArIFwiL3BsdWdpbl9pbnN0YWxsIHwgZ3JlcCAnPGZvbnQgY29sb3InIHwgc2VkICdzLzxmb250IGNvbG9yPVxcJ3JlZFxcJz4vLycgXCI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdXNlbGVzcy1lc2NhcGVcbiAgICBzaGVsbC5leGVjKGJsdWVza3lfaW5zdGFsbF9zY3JpcHQpO1xuICB9XG5cbiAgc3RhcnRZSVRWT1NTZXNzaW9uIChjYXBzKSB7XG4gICAgbG9nZ2VyLmluZm8oXCJMYXVuY2hpbmcgdHZPUyBhcHBcIik7XG4gICAgdGhpcy52YWxpZGF0ZUFwcExvY2F0aW9uKGNhcHMuYXBwKTtcbiAgICBsZXQgc2hlbGwgPSByZXF1aXJlKCdzaGVsbGpzJyk7XG4gICAgaWYgKGNhcHMudWRpZCkge1xuICAgICAgc2hlbGwuZXhlYyhcImlvcy1kZXBsb3kgLS1pZCBcIiArIGNhcHMudWRpZCArIFwiIC0tdW5pbnN0YWxsIC0tanVzdGxhdW5jaCAtLWJ1bmRsZSBcIiArIGNhcHMuYXBwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hlbGwuZXhlYyhcImlvcy1kZXBsb3kgLS11bmluc3RhbGwgLS1qdXN0bGF1bmNoIC0tYnVuZGxlIFwiICsgY2Fwcy5hcHApO1xuICAgIH1cbiAgfVxuXG4gIGVuZFlJVFZPU1Nlc3Npb24gKGNhcHMpIHtcbiAgICAvLyBJZiBtdWx0aXBsZSBhcHBzIHdpdGggb3VyIHNvY2tldCBhcmUgaW5zdGFsbGVkLCBpdCB3aWxsIGNvbm5lY3QgdG8gdGhlIGZpcnN0IGFwcCBpbnN0YWxsZWQuXG4gICAgLy8gRm9yIHRoaXMgcmVhc29uLCBldmVyeSBhcHAgc2hvdWxkIGJlIHVuaW5zdGFsbGVkIGFmdGVyIHJ1bm5pbmcuXG4gICAgbG9nZ2VyLmluZm8oXCJEZWxldGluZyBhcHBcIik7XG4gICAgbGV0IHNoZWxsID0gcmVxdWlyZSgnc2hlbGxqcycpO1xuICAgIGxldCBidW5kbGVpZCA9IHNoZWxsLmV4ZWMoYG9zYXNjcmlwdCAtZSAnaWQgb2YgYXBwIFwiJHtjYXBzLmFwcH1cIidgKTtcbiAgICBpZiAoY2Fwcy51ZGlkKSB7XG4gICAgICBzaGVsbC5leGVjKFwiaW9zLWRlcGxveSAtLWlkIFwiICsgY2Fwcy51ZGlkICsgXCIgLS11bmluc3RhbGxfb25seSAtLWJ1bmRsZV9pZCBcIiArIGJ1bmRsZWlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hlbGwuZXhlYyhcImlvcy1kZXBsb3kgLS11bmluc3RhbGxfb25seSAtLWJ1bmRsZV9pZCBcIiArIGJ1bmRsZWlkKTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZUFwcExvY2F0aW9uIChhcHApIHtcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG4gICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoYXBwKSkge1xuICAgICAgbGV0IGFic29sdXRlcGF0aCA9IHBhdGgucmVzb2x2ZShhcHApO1xuICAgICAgbGV0IG1zZyA9ICdUaGUgYXBwIGNvdWxkIG5vdCBiZSBmb3VuZCBpbiBmb2xsb3dpbmcgbG9jYXRpb246ICcgKyBhYnNvbHV0ZXBhdGg7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNPQ0tFVFNcbiAgYXN5bmMgY29ubmVjdFNvY2tldCAoKSB7XG4gICAgbGV0IHJldHJ5Q291bnQgPSAwO1xuICAgIGxldCBjb25uZWN0ZWQgPSBmYWxzZTtcbiAgICB3aGlsZSAocmV0cnlDb3VudCA8IE1BWF9SRVRSWV9DT1VOVCAmJiAhY29ubmVjdGVkKSB7XG4gICAgICBpZiAocmV0cnlDb3VudCA+IDApIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJXYWl0aW5nIFwiICsgKFJFVFJZX0JBQ0tPRkYgLyAxMDAwKSArIFwiIHNlY29uZHMgYmVmb3JlIHRyeWluZy4uLlwiKTtcbiAgICAgICAgYXdhaXQgc2xlZXAoUkVUUllfQkFDS09GRik7XG4gICAgICB9XG4gICAgICBsb2dnZXIuaW5mbyhcIkF0dGVtcHQgI1wiICsgKHJldHJ5Q291bnQgKyAxKSk7XG5cbiAgICAgIGxldCBjb25uZWN0ZWRQcm9taXNlID0gbmV3IEIoKHJlc29sdmUpID0+IHtcbiAgICAgICAgbGV0IG5ldCA9IHJlcXVpcmUoJ25ldCcpO1xuXG4gICAgICAgIGxldCBIT1NUID0gdGhpcy5vcHRzLnlvdWlFbmdpbmVBcHBBZGRyZXNzO1xuICAgICAgICBsZXQgUE9SVCA9IDEyMzQ1O1xuXG4gICAgICAgIGxvZ2dlci5pbmZvKCdDb25uZWN0aW5nIHRvIFdlYkRyaXZlcjogJyArIEhPU1QgKyAnOicgKyBQT1JUKTtcblxuICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBuZXQuU29ja2V0KCk7XG5cbiAgICAgICAgLy8gQWRkIGFuICdlcnJvcicgZXZlbnQgaGFuZGxlciBmb3IgdGhlIGNsaWVudCBzb2NrZXRcbiAgICAgICAgdGhpcy5zb2NrZXQub24gKCdlcnJvcicsIGZ1bmN0aW9uIChleCkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihleCk7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCdDaGVjayB0aGF0IFdlYkRyaXZlciBpcyBlbmFibGVkIGluIGFwcGxpY2F0aW9uLCBpZiBhIGRldmljZSBlbnN1cmUgdGhlIHByb3BlciBJUCBhZGRyZXNzIGlzIHVzZWQuJyk7XG4gICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgYSAnY2xvc2UnIGV2ZW50IGhhbmRsZXIgZm9yIHRoZSBjbGllbnQgc29ja2V0XG4gICAgICAgIHRoaXMuc29ja2V0Lm9uICgnY2xvc2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oJ0Nvbm5lY3Rpb24gY2xvc2VkJyk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgYSAndGltZW91dCcgZXZlbnQgaGFuZGxlciBmb3IgdGhlIGNsaWVudCBzb2NrZXRcbiAgICAgICAgdGhpcy5zb2NrZXQub24gKCd0aW1lb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcignQ29ubmVjdGlvbiB0aW1lZCBvdXQnKTtcbiAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc29ja2V0LmNvbm5lY3QgKFBPUlQsIEhPU1QsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGVkJyk7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHJ5Q291bnQrKztcbiAgICAgIGNvbm5lY3RlZCA9IGF3YWl0IGNvbm5lY3RlZFByb21pc2U7XG5cbiAgICAgIGlmICghY29ubmVjdGVkICYmIHJldHJ5Q291bnQgPT09IChNQVhfUkVUUllfQ09VTlQgLSAxKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhcIkZhaWxlZCB0byBjb25uZWN0IFwiICsgTUFYX1JFVFJZX0NPVU5UICsgXCIgdGltZXMuIEFib3J0aW5nLlwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0cnlDb3VudCA9IDA7XG4gICAgdGhpcy5yZWFkeSA9IGNvbm5lY3RlZDtcbiAgfVxuXG4gIC8vIHJlc3BvbnNlcyB0byB0aGUgY29tbWFuZHMgYXJlIEJJTkFSWVxuICBhc3luYyBleGVjdXRlU29ja2V0Q29tbWFuZCAoY21kKSB7XG5cbiAgICBpZiAoIXRoaXMuc29ja2V0LndyaXRhYmxlKSB7XG4gICAgICBsb2dnZXIuaW5mbyhcIlNvY2tldCBpcyBub3Qgd3JpdGFibGUuIFRyeWluZyB0byByZWNvbm5lY3QuXCIpO1xuICAgICAgYXdhaXQgdGhpcy5jb25uZWN0U29ja2V0KCk7XG4gICAgfVxuXG4gICAgbGV0IGNtZFByb21pc2UgPSBuZXcgQigocmVzb2x2ZSkgPT4ge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdDT01NQU5EOiAnICsgY21kKTtcblxuICAgICAgbGV0IHRvdGFsZGF0YSA9IFtdO1xuICAgICAgbGV0IGVuZE1hcmtlciA9IG5ldyBCdWZmZXIoXCJ5b3VpZW5kXCIpO1xuICAgICAgbGV0IHNvY2tldENsaWVudCA9IHRoaXMuc29ja2V0O1xuXG5cbiAgICAgIGxldCBkYXRhSGFuZGxlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoaXMgaW5jbHVkZXMgYW4gZW5kIHBhcmtlclxuICAgICAgICAvLyBnZXQgbGFzdCBmZXcgdmFsdWVzIG9mIGJ1ZmZlclxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPj0gZW5kTWFya2VyLmxlbmd0aCkge1xuICAgICAgICAgIGxldCBkYXRhZW5kID0gbmV3IEJ1ZmZlcihlbmRNYXJrZXIubGVuZ3RoKTtcbiAgICAgICAgICBsZXQgc3RhcnRJbmRleCA9IGRhdGEubGVuZ3RoIC0gZW5kTWFya2VyLmxlbmd0aDtcbiAgICAgICAgICBkYXRhLmNvcHkoZGF0YWVuZCwgMCwgc3RhcnRJbmRleCwgc3RhcnRJbmRleCArIGVuZE1hcmtlci5sZW5ndGgpO1xuICAgICAgICAgIC8vbG9nZ2VyLmRlYnVnKCdEQVRBRU5EJyArIGRhdGFlbmQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgaWYgKGRhdGFlbmQuZXF1YWxzKGVuZE1hcmtlcikpIHtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBkYXRhIGVuZFxuICAgICAgICAgICAgbGV0IGxhc3REYXRhID0gZGF0YS5zbGljZSgwLCBzdGFydEluZGV4KTtcbiAgICAgICAgICAgIC8vbG9nZ2VyLmRlYnVnKCdMQVNUIERBVEE6ICcgKyBsYXN0RGF0YS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIHRvdGFsZGF0YS5wdXNoKGxhc3REYXRhKTtcblxuICAgICAgICAgICAgLy9yZW1vdmUgaGFuZGxlclxuICAgICAgICAgICAgc29ja2V0Q2xpZW50LnJlbW92ZUxpc3RlbmVyKCdkYXRhJywgZGF0YUhhbmRsZXIpO1xuXG4gICAgICAgICAgICAvLyByZXNvbHZlXG4gICAgICAgICAgICByZXNvbHZlKEJ1ZmZlci5jb25jYXQodG90YWxkYXRhKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRvdGFsZGF0YS5wdXNoKGRhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgc29ja2V0Q2xpZW50LndyaXRlKGNtZCArIFwiXFxuXCIsIFwiVVRGOFwiLCAoKSA9PiB7XG4gICAgICAgIHNvY2tldENsaWVudC5vbignZGF0YScsIGRhdGFIYW5kbGVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBhd2FpdCBjbWRQcm9taXNlO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gIFlvdWlFbmdpbmVEcml2ZXIucHJvdG90eXBlW2NtZF0gPSBmbjtcbn1cblxuZXhwb3J0IHsgWW91aUVuZ2luZURyaXZlciB9O1xuIl0sImZpbGUiOiJsaWIvZHJpdmVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
